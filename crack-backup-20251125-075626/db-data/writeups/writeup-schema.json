{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OSCP Writeup Schema",
  "description": "JSON Schema for OSCP machine writeups with command tracking, failed attempts, and learning documentation",
  "type": "object",
  "required": [
    "id",
    "name",
    "source",
    "metadata",
    "oscp_relevance",
    "synopsis",
    "skills",
    "tags",
    "attack_phases",
    "key_learnings",
    "time_breakdown"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9]+-[a-z0-9-]+$",
      "description": "Unique identifier in kebab-case (e.g., htb-usage, pg-monsoon)"
    },
    "name": {
      "type": "string",
      "description": "Machine name"
    },
    "source": {
      "type": "object",
      "required": ["platform", "type"],
      "properties": {
        "platform": {
          "type": "string",
          "enum": ["HackTheBox", "ProvingGrounds", "TryHackMe", "VulnHub", "OSCP_Labs", "Custom"],
          "description": "Source platform"
        },
        "type": {
          "type": "string",
          "enum": ["official", "retired", "active", "practice", "custom"],
          "description": "Machine status"
        },
        "release_date": {
          "type": "string",
          "format": "date",
          "description": "Release date (YYYY-MM-DD)"
        },
        "retire_date": {
          "type": "string",
          "format": "date",
          "description": "Retirement date (YYYY-MM-DD)"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Platform URL"
        }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["difficulty", "os"],
      "properties": {
        "difficulty": {
          "type": "string",
          "enum": ["easy", "medium", "hard", "insane"],
          "description": "Machine difficulty"
        },
        "os": {
          "type": "string",
          "enum": ["linux", "windows", "other"],
          "description": "Operating system"
        },
        "os_version": {
          "type": "string",
          "description": "OS version details"
        },
        "machine_author": {
          "type": "string",
          "description": "Machine creator"
        },
        "writeup_author": {
          "type": "string",
          "description": "Writeup author"
        },
        "writeup_date": {
          "type": "string",
          "format": "date",
          "description": "Writeup creation date"
        },
        "ip_address": {
          "type": "string",
          "pattern": "^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$",
          "description": "Machine IP address"
        },
        "points": {
          "type": "integer",
          "description": "Point value"
        }
      }
    },
    "oscp_relevance": {
      "type": "object",
      "required": ["score", "reasoning", "exam_applicable"],
      "properties": {
        "score": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "OSCP relevance rating"
        },
        "reasoning": {
          "type": "string",
          "minLength": 50,
          "description": "Why this machine is OSCP relevant"
        },
        "exam_applicable": {
          "type": "boolean",
          "description": "Techniques directly applicable to OSCP exam"
        },
        "similar_machines": {
          "type": "object",
          "description": "Similar machines from other platforms"
        },
        "time_estimate_exam": {
          "type": "string",
          "description": "Estimated completion time in exam context"
        }
      }
    },
    "synopsis": {
      "type": "string",
      "minLength": 100,
      "description": "Brief summary of attack path"
    },
    "skills": {
      "type": "object",
      "required": ["required", "learned"],
      "properties": {
        "required": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1,
          "description": "Skills required before attempting"
        },
        "learned": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1,
          "description": "Skills learned from machine"
        }
      }
    },
    "tags": {
      "type": "array",
      "items": {"type": "string"},
      "minItems": 3,
      "description": "Tags for categorization (must include OSCP:HIGH|MEDIUM|LOW)"
    },
    "attack_phases": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["phase", "duration_minutes", "description", "commands_used", "key_findings"],
        "properties": {
          "phase": {
            "type": "string",
            "enum": ["enumeration", "foothold", "lateral_movement", "privilege_escalation", "post_exploitation"],
            "description": "Attack phase name"
          },
          "duration_minutes": {
            "type": "integer",
            "minimum": 1,
            "description": "Time spent in this phase"
          },
          "description": {
            "type": "string",
            "minLength": 50,
            "description": "Phase summary"
          },
          "vulnerabilities": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "type", "severity", "exploitability"],
              "properties": {
                "name": {"type": "string"},
                "cve": {
                  "type": ["string", "null"],
                  "pattern": "^CVE-\\d{4}-\\d{4,7}$"
                },
                "type": {"type": "string"},
                "location": {"type": "string"},
                "severity": {
                  "type": "string",
                  "enum": ["critical", "high", "medium", "low"]
                },
                "exploitability": {
                  "type": "string",
                  "enum": ["easy", "medium", "hard"]
                }
              }
            }
          },
          "commands_used": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["command_id", "context", "step_number", "success"],
              "properties": {
                "command_id": {
                  "type": "string",
                  "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
                  "description": "Reference to command in database"
                },
                "context": {
                  "type": "string",
                  "minLength": 20,
                  "description": "Why this command was used"
                },
                "step_number": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Sequential step in phase"
                },
                "command_executed": {
                  "type": "string",
                  "description": "Actual command with values"
                },
                "success": {
                  "type": "boolean",
                  "description": "Whether command succeeded"
                },
                "notes": {
                  "type": "string",
                  "description": "Additional context"
                },
                "screenshots": {
                  "type": "array",
                  "description": "Screenshots associated with this command execution",
                  "items": {
                    "type": "object",
                    "required": ["file"],
                    "properties": {
                      "file": {
                        "type": "string",
                        "pattern": "^images/page\\d{2}_img\\d{2}\\.(png|jpg|jpeg)$",
                        "description": "Relative path to screenshot file (e.g., images/page05_img01.png)"
                      },
                      "caption": {
                        "type": "string",
                        "description": "Human-readable description of what the screenshot shows"
                      },
                      "extracted_from_page": {
                        "type": "integer",
                        "minimum": 1,
                        "description": "PDF page number where image was extracted from"
                      },
                      "confidence": {
                        "type": "string",
                        "enum": ["high", "medium", "low"],
                        "description": "Confidence level of automatic image-to-command mapping"
                      },
                      "context": {
                        "type": "string",
                        "description": "Additional context about why this screenshot is relevant"
                      }
                    }
                  }
                }
              }
            }
          },
          "failed_attempts": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["attempt", "reason", "solution", "lesson_learned"],
              "properties": {
                "attempt": {"type": "string"},
                "command_executed": {"type": "string"},
                "expected": {"type": "string"},
                "actual": {"type": "string"},
                "reason": {"type": "string"},
                "solution": {"type": "string"},
                "lesson_learned": {
                  "type": "string",
                  "minLength": 30,
                  "description": "What this failure teaches"
                },
                "time_wasted_minutes": {"type": "integer"},
                "documentation_importance": {
                  "type": "string",
                  "enum": ["critical", "high", "medium", "low"]
                }
              }
            }
          },
          "key_findings": {
            "type": "array",
            "items": {"type": "string"},
            "minItems": 1,
            "description": "Important discoveries in this phase"
          },
          "oscp_notes": {
            "type": "string",
            "description": "OSCP-specific observations"
          }
        }
      }
    },
    "key_learnings": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["category", "lesson", "detail", "importance"],
        "properties": {
          "category": {
            "type": "string",
            "description": "Learning category"
          },
          "lesson": {
            "type": "string",
            "minLength": 20,
            "description": "Brief lesson statement"
          },
          "detail": {
            "type": "string",
            "minLength": 50,
            "description": "Detailed explanation"
          },
          "importance": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"],
            "description": "Learning importance for OSCP"
          }
        }
      }
    },
    "time_breakdown": {
      "type": "object",
      "required": ["total_minutes", "flags_captured"],
      "properties": {
        "enumeration": {"type": "integer"},
        "foothold": {"type": "integer"},
        "lateral_movement": {"type": "integer"},
        "privilege_escalation": {"type": "integer"},
        "post_exploitation": {"type": "integer"},
        "total_minutes": {
          "type": "integer",
          "minimum": 1
        },
        "total_hours": {"type": "number"},
        "flags_captured": {
          "type": "object",
          "description": "Flag locations"
        },
        "oscp_time_estimate": {
          "type": "string",
          "description": "Estimated time in exam context"
        }
      }
    },
    "alternative_approaches": {
      "type": "object",
      "description": "Alternative methods for phases"
    },
    "references": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["type"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["cve", "blogpost", "hacktricks", "tool", "mitre_attack", "documentation", "other"]
          },
          "url": {
            "type": "string",
            "format": "uri"
          },
          "description": {"type": "string"}
        }
      }
    },
    "files": {
      "type": "object",
      "description": "File locations for writeup artifacts"
    }
  }
}
