{
  "commands": [
    {
      "id": "net-accounts-policy",
      "name": "Net Accounts - Domain Password Policy",
      "description": "Display Active Directory password policy from domain-joined Windows system (lockout threshold, lockout duration, observation window)",
      "command": "net accounts",
      "category": "enumeration",
      "subcategory": "active-directory",
      "variables": [],
      "tags": [
        "ACTIVE_DIRECTORY",
        "PASSWORD_POLICY",
        "WINDOWS",
        "OSCP:HIGH",
        "QUICK_WIN"
      ],
      "flag_explanations": {},
      "success_indicators": [
        "Force user logoff how long after time expires?",
        "Minimum password age",
        "Lockout threshold",
        "Lockout duration",
        "The command completed successfully"
      ],
      "failure_indicators": [
        "Access is denied",
        "The user name or password is incorrect",
        "System error 1355"
      ],
      "next_steps": [
        "kerbrute-userenum",
        "spray-passwords-ldap",
        "crackmapexec-smb-spray",
        "kerbrute-passwordspray"
      ],
      "alternatives": [
        "enum4linux-policy",
        "crackmapexec-policy",
        "ldapsearch-policy"
      ],
      "prerequisites": [],
      "troubleshooting": {
        "Access is denied": "Ensure you are logged in as a domain user on a domain-joined Windows system. Use RDP or WinRM with valid credentials.",
        "System error 1355": "Not executed from a domain-joined system. Use enum4linux-policy or crackmapexec-policy from Linux instead."
      },
      "notes": "CRITICAL for password spraying attacks. Lockout threshold indicates max failed logins before account lockout. Lockout observation window shows time until counter resets. CALCULATION: With 5 attempts threshold and 30min window, you can safely attempt 4 logins per user every 30 minutes = 192 attempts per user per 24 hours. TIME ESTIMATE: <5 seconds. MANUAL ALTERNATIVE: Check Group Policy (gpedit.msc → Computer Configuration → Windows Settings → Security Settings → Account Policies → Account Lockout Policy) or query LDAP for lockoutThreshold attribute. OSCP TIP: Always run this FIRST before any password attacks to avoid locking out accounts and alerting administrators.",
      "oscp_relevance": "high"
    },
    {
      "id": "enum4linux-policy",
      "name": "Enum4linux - Password Policy via SMB",
      "description": "Enumerate Active Directory password policy from Linux via SMB (supports null sessions or authenticated)",
      "command": "enum4linux -P <TARGET>",
      "category": "enumeration",
      "subcategory": "active-directory",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Domain controller IP or hostname",
          "example": "192.168.50.70",
          "required": true
        }
      ],
      "tags": [
        "ACTIVE_DIRECTORY",
        "PASSWORD_POLICY",
        "LINUX",
        "SMB",
        "NULL_SESSION",
        "OSCP:HIGH"
      ],
      "flag_explanations": {
        "-P": "Get password policy information via SMB",
        "-u": "Specify username for authenticated enumeration (optional, use with -p)",
        "-p": "Specify password for authenticated enumeration (optional, use with -u)",
        "-a": "Do all simple enumeration (includes -P plus users, shares, groups)"
      },
      "success_indicators": [
        "Password Complexity",
        "Minimum Password Length",
        "Account Lockout Threshold",
        "Lockout Duration",
        "Observation Window"
      ],
      "failure_indicators": [
        "Cannot connect to server",
        "NT_STATUS_ACCESS_DENIED",
        "Protocol negotiation failed",
        "Connection refused"
      ],
      "next_steps": [
        "enum4linux-users",
        "kerbrute-userenum",
        "crackmapexec-smb-spray"
      ],
      "alternatives": [
        "net-accounts-policy",
        "crackmapexec-policy",
        "ldapsearch-policy"
      ],
      "prerequisites": [],
      "troubleshooting": {
        "NT_STATUS_ACCESS_DENIED": "Null session blocked. Try with credentials: enum4linux -u <USER> -p <PASS> -P <TARGET>",
        "Connection refused": "SMB ports (445/139) may be filtered. Verify connectivity: sudo nmap -p 139,445 -Pn -v <TARGET>",
        "Protocol negotiation failed": "SMBv1 may be disabled. Use crackmapexec-policy instead (supports SMBv2/v3)"
      },
      "notes": "STEALTHY method for external password policy discovery. Often works via NULL SESSION (no credentials required) if SMB null sessions are enabled on DC. NOISE LEVEL: Medium (SMB connection logged). TIME ESTIMATE: 10-30 seconds. MANUAL ALTERNATIVE: Use rpcclient with -N flag for null session: rpcclient -N -U '' <TARGET> then 'getdompwinfo'. WHY THIS WORKS: Windows DCs expose password policy via MS-SAMR RPC interface accessible over SMB. Null sessions may be allowed for backward compatibility. OSCP TIP: Try null session first, then authenticated if blocked. Modern domains often block null sessions.",
      "oscp_relevance": "high"
    },
    {
      "id": "crackmapexec-policy",
      "name": "CrackMapExec - Password Policy Enumeration",
      "description": "Enumerate Active Directory password policy via SMB using CrackMapExec (supports SMBv2/v3, requires credentials)",
      "command": "crackmapexec smb <TARGET> -u <USERNAME> -p <PASSWORD> --pass-pol",
      "category": "enumeration",
      "subcategory": "active-directory",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Domain controller IP or hostname",
          "example": "192.168.50.70",
          "required": true
        },
        {
          "name": "<USERNAME>",
          "description": "Domain username (use any valid domain user)",
          "example": "guest",
          "required": true
        },
        {
          "name": "<PASSWORD>",
          "description": "Password for authentication (use empty string '' for blank password)",
          "example": "''",
          "required": true
        }
      ],
      "tags": [
        "ACTIVE_DIRECTORY",
        "PASSWORD_POLICY",
        "LINUX",
        "SMB",
        "CRACKMAPEXEC",
        "OSCP:HIGH"
      ],
      "flag_explanations": {
        "--pass-pol": "Dump password policy information",
        "-u": "Username (single user or file with -U)",
        "-p": "Password (single password or file with -P)",
        "-d": "Domain name (optional, auto-detected from DC)",
        "--local-auth": "Authenticate to local SAM instead of domain (not useful for domain policy)"
      },
      "success_indicators": [
        "[+] Dumping password policy",
        "Minimum password length",
        "Password complexity",
        "Lockout threshold",
        "Lockout duration",
        "Lockout observation window"
      ],
      "failure_indicators": [
        "[-] Error",
        "STATUS_LOGON_FAILURE",
        "STATUS_ACCESS_DENIED",
        "Connection refused"
      ],
      "next_steps": [
        "crackmapexec-rid",
        "crackmapexec-smb-spray",
        "kerbrute-userenum"
      ],
      "alternatives": [
        "net-accounts-policy",
        "enum4linux-policy",
        "ldapsearch-policy"
      ],
      "prerequisites": [],
      "troubleshooting": {
        "STATUS_LOGON_FAILURE": "Invalid credentials. Try guest account with blank password: crackmapexec smb <TARGET> -u 'guest' -p ''",
        "Connection refused": "SMB port 445 blocked. Check firewall: sudo nmap -p 445 -Pn -v <TARGET>",
        "STATUS_ACCESS_DENIED": "User lacks permissions. Any valid domain user should work - verify credentials are correct."
      },
      "notes": "MODERN alternative to enum4linux with SMBv2/v3 support. REQUIRES valid domain credentials (guest account often works with blank password). ADVANTAGE: Works when SMBv1/null sessions disabled. NOISE LEVEL: Medium (authenticated SMB connection logged). TIME ESTIMATE: 5-15 seconds. WHY THIS WORKS: CrackMapExec uses MS-SAMR RPC over SMB to query password policy from domain controller. Any authenticated domain user can read password policy (not privileged information). OSCP TIP: If you have ANY valid domain credentials, use this instead of enum4linux. Try guest:'' first. Guest account is often enabled with blank password even when null sessions are blocked.",
      "oscp_relevance": "high"
    },
    {
      "id": "ldapsearch-policy",
      "name": "ldapsearch - LDAP Password Policy Query",
      "description": "Query Active Directory password policy directly via LDAP (anonymous or authenticated)",
      "command": "ldapsearch -x -H ldap://<TARGET> -b '<DOMAIN_DN>' -s base '(objectClass=*)' lockoutThreshold lockoutDuration lockOutObservationWindow minPwdLength pwdProperties",
      "category": "enumeration",
      "subcategory": "active-directory",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Domain controller IP or hostname",
          "example": "192.168.50.70",
          "required": true
        },
        {
          "name": "<DOMAIN_DN>",
          "description": "Domain distinguished name (e.g., DC=corp,DC=com for corp.com domain)",
          "example": "DC=corp,DC=com",
          "required": true
        }
      ],
      "tags": [
        "ACTIVE_DIRECTORY",
        "PASSWORD_POLICY",
        "LINUX",
        "LDAP",
        "OSCP:MEDIUM"
      ],
      "flag_explanations": {
        "-x": "Use simple authentication (no SASL)",
        "-H": "LDAP URI (ldap:// or ldaps://)",
        "-b": "Base DN for search",
        "-s base": "Search scope (base = single object)",
        "-D": "Bind DN for authenticated queries (optional, use with -w)",
        "-w": "Password for authenticated bind (optional, use with -D)",
        "'(objectClass=*)'": "LDAP filter (match all)",
        "lockoutThreshold": "Attribute: failed login attempts before lockout",
        "lockoutDuration": "Attribute: lockout duration in 100-nanosecond intervals",
        "lockOutObservationWindow": "Attribute: time window for counting failed attempts",
        "minPwdLength": "Attribute: minimum password length",
        "pwdProperties": "Attribute: password complexity flags"
      },
      "success_indicators": [
        "lockoutThreshold:",
        "lockoutDuration:",
        "lockOutObservationWindow:",
        "minPwdLength:",
        "# numEntries: 1"
      ],
      "failure_indicators": [
        "ldap_bind: Invalid credentials",
        "Can't contact LDAP server",
        "Operations error",
        "# numEntries: 0"
      ],
      "next_steps": [
        "ldapsearch-users",
        "kerbrute-userenum",
        "crackmapexec-smb-spray"
      ],
      "alternatives": [
        "net-accounts-policy",
        "enum4linux-policy",
        "crackmapexec-policy"
      ],
      "prerequisites": [],
      "troubleshooting": {
        "Can't contact LDAP server": "LDAP port 389 may be blocked. Verify: sudo nmap -p 389,636 -Pn -v <TARGET>. Try LDAPS (port 636) with ldaps:// instead of ldap://",
        "Invalid credentials": "Anonymous bind blocked. Use credentials: ldapsearch -x -H ldap://<TARGET> -D '<USER>@<DOMAIN>' -w '<PASSWORD>' -b '<DOMAIN_DN>' ...",
        "Operations error": "Anonymous queries may be disabled. Retry with valid credentials.",
        "Need to convert times": "lockoutDuration and lockOutObservationWindow are in 100-nanosecond intervals. Divide by 600000000 to get minutes."
      },
      "notes": "MOST DIRECT method - queries password policy attributes directly from AD LDAP. May work ANONYMOUSLY if anonymous LDAP binding is enabled (uncommon in modern domains). NOISE LEVEL: Low (LDAP query, often not logged). TIME ESTIMATE: 5-10 seconds. TIME CONVERSION: lockoutDuration and lockOutObservationWindow are in 100-nanosecond intervals (e.g., 18000000000 = 30 minutes). Divide by 600000000 to get minutes. MANUAL ALTERNATIVE: Use AD Explorer (Windows GUI) or PowerShell Get-ADDefaultDomainPasswordPolicy. WHY THIS WORKS: Password policy stored in domain root object in AD, readable by any authenticated user (sometimes anonymous). OSCP TIP: Less common than SMB-based enumeration but useful when SMB is blocked or filtered. Domain DN format: DC=domain,DC=com (replace dots with ',DC='). For corp.com use DC=corp,DC=com.",
      "oscp_relevance": "medium"
    }
  ]
}
