{
  "category": "monitoring",
  "subcategory": "network-monitoring",
  "description": "Network connection monitoring and process-to-port mapping for defense and enumeration",
  "commands": [
    {
      "id": "lsof-network-all",
      "name": "List All Network Connections",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "lsof -i -P -n",
      "description": "List all network connections with process names, PIDs, and ports (no DNS resolution)",
      "variables": [],
      "flag_explanations": {
        "-i": "Select internet addresses (all IPv4/IPv6 network files - TCP/UDP connections, listening sockets)",
        "-P": "Inhibit port-to-service name conversion (show numeric ports instead of 'http', 'ssh')",
        "-n": "Inhibit DNS resolution (show IP addresses instead of hostnames for faster output)"
      },
      "tags": [
        "DEFENSE",
        "DISCOVERY",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "NETWORK",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "QUICK_WIN"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "COMMAND",
        "PID",
        "USER",
        "FD",
        "TYPE",
        "DEVICE",
        "NODE",
        "NAME"
      ],
      "failure_indicators": [
        "lsof: command not found",
        "Permission denied"
      ],
      "next_steps": [
        "Identify processes listening on ports: lsof-listening-ports",
        "Check specific port: lsof-port-specific",
        "Examine suspicious connections",
        "Cross-reference with ps-aux-full for process details"
      ],
      "alternatives": [
        "netstat-listening-tcp",
        "ss-listening-all"
      ],
      "notes": "CRITICAL for OSCP defense monitoring and privilege escalation. Shows: (1) What services are listening, (2) Which processes have active connections, (3) User running each service. The -P and -n flags provide raw data without DNS/service lookups (faster and avoids network activity). Time estimate: 2-5 seconds. Manual alternative: cat /proc/net/tcp; cat /proc/net/udp (manual parsing required)."
    },
    {
      "id": "lsof-listening-ports",
      "name": "List Only Listening Ports",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "lsof -i -P -n -sTCP:LISTEN",
      "description": "Show only processes listening for incoming connections (attack surface identification)",
      "variables": [],
      "flag_explanations": {
        "-i": "Select internet addresses",
        "-P": "Show numeric ports",
        "-n": "Show numeric IPs (no DNS)",
        "-sTCP:LISTEN": "Select only TCP connections in LISTEN state (waiting for incoming connections)"
      },
      "tags": [
        "DEFENSE",
        "DISCOVERY",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "NETWORK",
        "OSCP:HIGH",
        "POST_EXPLOITATION"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "LISTEN",
        "*:port",
        "TCP"
      ],
      "failure_indicators": [
        "lsof: command not found",
        "No output (no listening services)"
      ],
      "next_steps": [
        "Check if listening services are externally accessible: nmap-service-scan",
        "Examine service configurations for misconfigurations",
        "Test for default credentials on listening services",
        "Check file permissions of service binaries: ls -la /path/to/service"
      ],
      "alternatives": [
        "netstat-listening-tcp",
        "ss-listening-ports"
      ],
      "notes": "Filters to only show listening ports (attack surface). OSCP tip: Compare internal listening ports (127.0.0.1:*) vs external (0.0.0.0:* or specific IP). Internal-only ports often have weaker authentication. For UDP listeners: lsof -i -P -n -sUDP:Idle. Time estimate: 2 seconds."
    },
    {
      "id": "lsof-port-specific",
      "name": "Find Process Using Specific Port",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "lsof -i :<PORT>",
      "description": "Identify which process is using a specific port (both TCP and UDP)",
      "variables": [
        {
          "name": "<PORT>",
          "description": "Port number to check",
          "example": "80",
          "required": true
        }
      ],
      "flag_explanations": {
        "-i": "Select internet addresses",
        ":<PORT>": "Filter by specific port number (checks both TCP and UDP)"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "NETWORK",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "QUICK_WIN"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "COMMAND",
        "PID",
        "USER",
        "NAME"
      ],
      "failure_indicators": [
        "No output (port not in use)",
        "lsof: command not found"
      ],
      "next_steps": [
        "Get process details: ps-pid-details",
        "Check process executable: ls -la /proc/<PID>/exe",
        "View process environment: cat /proc/<PID>/environ | tr '\\0' '\\n'",
        "Check service configuration files"
      ],
      "alternatives": [
        "fuser-port-tcp"
      ],
      "notes": "Essential for troubleshooting 'port already in use' errors or identifying what service is bound to a discovered port. For TCP only: lsof -i TCP:<PORT>. For UDP only: lsof -i UDP:<PORT>. Time estimate: <1 second."
    },
    {
      "id": "fuser-port-tcp",
      "name": "Find Process Using Port (fuser)",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "fuser -v <PORT>/tcp",
      "description": "Alternative method to identify process using a specific TCP port",
      "variables": [
        {
          "name": "<PORT>",
          "description": "TCP port number",
          "example": "443",
          "required": true
        }
      ],
      "flag_explanations": {
        "-v": "Verbose - displays USER, PID, ACCESS, COMMAND columns",
        "/tcp": "Specify TCP protocol (use /udp for UDP)"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "NETWORK",
        "OSCP:MEDIUM",
        "POST_EXPLOITATION"
      ],
      "oscp_relevance": "medium",
      "success_indicators": [
        "USER",
        "PID",
        "ACCESS",
        "COMMAND"
      ],
      "failure_indicators": [
        "No process using port",
        "fuser: command not found"
      ],
      "next_steps": [
        "Kill process if needed: kill <PID>",
        "Force kill if hung: kill -9 <PID>",
        "Restart service with correct configuration"
      ],
      "alternatives": [
        "lsof-port-specific"
      ],
      "notes": "Lighter weight than lsof. Good for quick port checks. For UDP: fuser -v <PORT>/udp. Time estimate: <1 second."
    },
    {
      "id": "netstat-listening-tcp",
      "name": "Netstat Listening Ports with PIDs",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "netstat -tulpn",
      "description": "Show all listening TCP/UDP ports with process names and PIDs (classic tool, older systems)",
      "variables": [],
      "flag_explanations": {
        "-t": "Show TCP connections",
        "-u": "Show UDP connections",
        "-l": "Show only listening sockets (waiting for connections)",
        "-p": "Show PID and program name for each socket",
        "-n": "Show numeric addresses (no DNS resolution)"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "NETWORK",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "STARTER"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "Proto",
        "Local Address",
        "Foreign Address",
        "State",
        "PID/Program name"
      ],
      "failure_indicators": [
        "netstat: command not found",
        "(No info) in PID column (run as root for PID info)"
      ],
      "next_steps": [
        "Identify unknown services: searchsploit <SERVICE>",
        "Check service versions: nmap-service-scan",
        "Test for default credentials",
        "Examine service configuration files: find /etc -name <SERVICE>*"
      ],
      "alternatives": [
        "ss-listening-all",
        "lsof-listening-ports"
      ],
      "notes": "Classic tool but deprecated in favor of 'ss' on modern systems. Still widely used in OSCP labs. MUST run with sudo for PID information, otherwise shows '(No info)'. OSCP tip: Focus on: (1) 0.0.0.0:* (externally accessible), (2) 127.0.0.1:* (local only, often weaker auth), (3) Unusual high ports (potential backdoors). Time estimate: 2 seconds."
    },
    {
      "id": "ss-listening-all",
      "name": "Socket Statistics (Listening Ports)",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "ss -tulpn",
      "description": "Modern replacement for netstat - faster socket statistics with process mapping",
      "variables": [],
      "flag_explanations": {
        "-t": "Display TCP sockets",
        "-u": "Display UDP sockets",
        "-l": "Display listening sockets only",
        "-p": "Show process using socket (requires root)",
        "-n": "Numeric - don't resolve service names or hostnames"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "FAST",
        "LINUX",
        "MONITORING",
        "NETWORK",
        "OSCP:HIGH",
        "POST_EXPLOITATION"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "Netid",
        "State",
        "Recv-Q",
        "Send-Q",
        "Local Address:Port",
        "Peer Address:Port",
        "Process"
      ],
      "failure_indicators": [
        "ss: command not found",
        "No process info (need root)"
      ],
      "next_steps": [
        "Compare with external port scan: nmap-service-scan",
        "Test accessible ports for vulnerabilities",
        "Check firewall rules: iptables -L -n -v",
        "Examine service configurations"
      ],
      "alternatives": [
        "netstat-listening-tcp",
        "lsof-listening-ports"
      ],
      "notes": "Modern replacement for netstat - 10x faster on systems with many connections. Same syntax as netstat for easy transition. OSCP tip: Use with grep for specific ports: ss -tulpn | grep :80. For all connections (not just listening): ss -tupn. Time estimate: <1 second."
    },
    {
      "id": "ss-established-connections",
      "name": "Show Established Connections",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "ss -tupn state established",
      "description": "Display only active established connections with process information",
      "variables": [],
      "flag_explanations": {
        "-t": "TCP sockets",
        "-u": "UDP sockets",
        "-p": "Show process",
        "-n": "Numeric output",
        "state established": "Filter to show only established connections (active data transfer)"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "NETWORK",
        "OSCP:MEDIUM",
        "POST_EXPLOITATION"
      ],
      "oscp_relevance": "medium",
      "success_indicators": [
        "ESTAB",
        "Process",
        "Local Address",
        "Peer Address"
      ],
      "failure_indicators": [
        "No established connections",
        "ss: command not found"
      ],
      "next_steps": [
        "Identify suspicious outbound connections",
        "Check for reverse shells (unexpected connections to unknown IPs)",
        "Verify legitimate connections",
        "Block malicious IPs: iptables -A OUTPUT -d <IP> -j DROP"
      ],
      "alternatives": [],
      "notes": "Useful for detecting active attacks or data exfiltration. OSCP defense tip: Unexpected ESTABLISHED connections to external IPs may indicate compromise. Time estimate: <1 second."
    },
    {
      "id": "win-netstat-process-mapping",
      "name": "Windows Netstat with PIDs",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "netstat -ano",
      "description": "Show all Windows network connections with PIDs for process mapping",
      "variables": [],
      "flag_explanations": {
        "-a": "Display all connections and listening ports",
        "-n": "Display addresses and port numbers in numeric form (no name resolution)",
        "-o": "Display owning process ID (PID) for each connection"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "MONITORING",
        "NETWORK",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "WINDOWS"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "Proto",
        "Local Address",
        "Foreign Address",
        "State",
        "PID"
      ],
      "failure_indicators": [
        "ERROR: Access denied"
      ],
      "next_steps": [
        "Map PID to process: win-tasklist-pid",
        "Get process details: win-wmic-process-pid",
        "Check for suspicious connections to unknown IPs",
        "Identify listening services: netstat -ano | findstr LISTENING"
      ],
      "alternatives": [
        "win-ps-netstat-process"
      ],
      "notes": "Essential for Windows network monitoring. Combine with tasklist to map PIDs to names: netstat -ano | findstr LISTENING, then tasklist /fi \"PID eq <PID>\". OSCP tip: Look for (1) LISTENING on 0.0.0.0 (externally accessible), (2) ESTABLISHED to unexpected IPs (C2 traffic), (3) Unusual ports (backdoors). Time estimate: 2 seconds."
    },
    {
      "id": "win-ps-netstat-process",
      "name": "PowerShell Network Connections",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "Get-NetTCPConnection | Select-Object LocalAddress,LocalPort,RemoteAddress,RemotePort,State,OwningProcess",
      "description": "PowerShell cmdlet for TCP connections with process IDs (modern Windows)",
      "variables": [],
      "flag_explanations": {
        "Get-NetTCPConnection": "Retrieves TCP connection properties",
        "Select-Object": "Choose specific properties to display",
        "OwningProcess": "PID of process that owns the connection"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "MONITORING",
        "NETWORK",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "POWERSHELL",
        "WINDOWS"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "LocalAddress",
        "LocalPort",
        "RemoteAddress",
        "State",
        "OwningProcess"
      ],
      "failure_indicators": [
        "Get-NetTCPConnection: command not found",
        "Execution policy blocked"
      ],
      "next_steps": [
        "Get process name: Get-Process -Id <PID>",
        "Filter listening: Get-NetTCPConnection -State Listen",
        "Filter established: Get-NetTCPConnection -State Established",
        "Combine with process info: Get-NetTCPConnection | ForEach-Object {[PSCustomObject]@{LocalPort=$_.LocalPort; Process=(Get-Process -Id $_.OwningProcess).Name}}"
      ],
      "alternatives": [
        "win-netstat-process-mapping"
      ],
      "notes": "Modern PowerShell alternative to netstat. Easier to parse and filter. For UDP: Get-NetUDPEndpoint. Time estimate: 3 seconds. OSCP tip: One-liner to show listening ports with names: Get-NetTCPConnection -State Listen | Select LocalPort,@{Name='Process';Expression={(Get-Process -Id $_.OwningProcess).Name}}"
    },
    {
      "id": "win-tasklist-pid",
      "name": "Windows Get Process by PID",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "tasklist /fi \"PID eq <PID>\"",
      "description": "Look up Windows process name and details by PID (for netstat output)",
      "variables": [
        {
          "name": "<PID>",
          "description": "Process ID from netstat",
          "example": "1234",
          "required": true
        }
      ],
      "flag_explanations": {
        "/fi": "Filter - apply filter to tasklist output",
        "\"PID eq <PID>\"": "Filter expression - show only process with matching PID"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "MONITORING",
        "OSCP:MEDIUM",
        "POST_EXPLOITATION",
        "WINDOWS"
      ],
      "oscp_relevance": "medium",
      "success_indicators": [
        "Image Name",
        "PID",
        "Session Name",
        "Mem Usage"
      ],
      "failure_indicators": [
        "INFO: No tasks running with the specified criteria"
      ],
      "next_steps": [
        "Get full process details: win-wmic-process-pid",
        "Check process executable location: wmic process where ProcessId=<PID> get ExecutablePath",
        "Examine process for vulnerabilities"
      ],
      "alternatives": [
        "win-wmic-process-pid",
        "win-ps-get-process"
      ],
      "notes": "Quick way to map netstat PIDs to process names. Common workflow: netstat -ano | findstr :443 (get PID) \u2192 tasklist /fi \"PID eq 1234\" (get name). Time estimate: <1 second."
    },
    {
      "id": "win-wmic-process-pid",
      "name": "WMIC Get Process by PID",
      "category": "monitoring",
      "subcategory": "network-monitoring",
      "command": "wmic process where ProcessId=<PID> get ProcessId,Name,ExecutablePath,CommandLine",
      "description": "Get detailed Windows process information by PID including full path and command line",
      "variables": [
        {
          "name": "<PID>",
          "description": "Process ID",
          "example": "4567",
          "required": true
        }
      ],
      "flag_explanations": {
        "process": "Query Win32_Process class",
        "where ProcessId=<PID>": "Filter to specific PID",
        "get": "Retrieve specific properties",
        "CommandLine": "Full command with arguments (may contain credentials)"
      },
      "tags": [
        "CREDENTIAL_ACCESS",
        "DEFENSE",
        "ENUMERATION",
        "MONITORING",
        "OSCP:MEDIUM",
        "POST_EXPLOITATION",
        "WINDOWS",
        "WMIC"
      ],
      "oscp_relevance": "medium",
      "success_indicators": [
        "ProcessId",
        "Name",
        "ExecutablePath",
        "CommandLine"
      ],
      "failure_indicators": [
        "No instance(s) available"
      ],
      "next_steps": [
        "Check executable permissions: icacls <ExecutablePath>",
        "Search CommandLine for passwords",
        "Verify process legitimacy",
        "Check if executable is signed: Get-AuthenticodeSignature <PATH>"
      ],
      "alternatives": [
        "win-tasklist-pid"
      ],
      "notes": "More detailed than tasklist. CommandLine often reveals sensitive data. Time estimate: 1 second."
    }
  ]
}