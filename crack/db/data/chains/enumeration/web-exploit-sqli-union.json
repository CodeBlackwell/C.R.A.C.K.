{
  "id": "web-exploit-sqli-union",
  "name": "SQL Injection UNION-Based Data Extraction",
  "description": "Detect SQL injection vulnerability, enumerate database structure using UNION SELECT technique, and extract credentials through branching database-specific exploitation paths",
  "version": "1.0.0",
  "metadata": {
    "author": "CRACK Development Team",
    "created": "2025-10-13",
    "updated": "2025-10-13",
    "tags": [
      "pentest",
      "WEB",
      "SQL_INJECTION",
      "UNION",
      "ENUMERATION",
      "CREDENTIAL_ACCESS",
      "MANUAL_REQUIRED",
      "QUICK_WIN"
    ],
    "category": "enumeration",
    "platform": "web",
    "references": [
      "https://portswigger.net/web-security/sql-injection/union-attacks",
      "https://book.hacktricks.xyz/pentesting-web/sql-injection"
    ]
  },
  "difficulty": "advanced",
  "time_estimate": "30 minutes",
  "prerequisites": [
    "Web application with user input parameters",
    "Network access to target web server",
    "curl or web browser available"
  ],
  "notes": "This chain demonstrates branching logic required for multi-database SQLi exploitation. After detecting database type in step 4, the chain branches into 3 parallel paths (MySQL/PostgreSQL/MSSQL enumeration). Each database path then proceeds to credential extraction. CRITICAL: Always attempt manual exploitation BEFORE sqlmap. Document column count and displayed column positions for exam report. Use next_steps field to implement conditional branching based on database detection results.",
  "steps": [
    {
      "id": "detect-sqli",
      "name": "Detect SQL Injection Vulnerability",
      "objective": "Confirm parameter is vulnerable to SQL injection using error-based technique",
      "description": "Test parameter with single quote payload. Look for database error messages revealing backend type (MySQL, PostgreSQL, MSSQL).",
      "command_ref": "sqli-detection-error",
      "evidence": [
        "Database error message visible in HTTP response",
        "Error reveals database type and version",
        "Query syntax visible in error message"
      ],
      "dependencies": [],
      "repeatable": false,
      "success_criteria": [
        "Error message confirms SQL injection vulnerability",
        "Database type identified from error keywords",
        "Vulnerable parameter confirmed and documented"
      ],
      "failure_conditions": [
        "No error messages visible (potential blind SQLi)",
        "WAF blocking requests with 403 Forbidden",
        "Generic error page without database details"
      ],
      "next_steps": [
        "enum-columns"
      ]
    },
    {
      "id": "enum-columns",
      "name": "Enumerate Column Count",
      "objective": "Determine number of columns in SQL query using ORDER BY technique",
      "description": "Increment ORDER BY value (ORDER BY 1, ORDER BY 2, ...) until error occurs. Last successful value equals column count. CRITICAL: UNION SELECT requires exact column count match.",
      "command_ref": "sqli-column-enum-orderby",
      "evidence": [
        "Last successful ORDER BY number documented",
        "Error message when column count exceeded",
        "Column count confirmed for UNION injection"
      ],
      "dependencies": [
        "detect-sqli"
      ],
      "repeatable": false,
      "success_criteria": [
        "Column count determined accurately",
        "ORDER BY N succeeds, ORDER BY N+1 fails",
        "No syntax errors during enumeration"
      ],
      "failure_conditions": [
        "All ORDER BY values return errors (wrong injection point)",
        "No errors at any column number (different technique needed)",
        "WAF blocking ORDER BY keyword"
      ],
      "next_steps": [
        "test-union"
      ]
    },
    {
      "id": "test-union",
      "name": "Test UNION SELECT Injection",
      "objective": "Verify UNION injection works and identify which columns are displayed on page",
      "description": "Use UNION SELECT with NULL values matching column count. Replace NULLs with test strings ('test1', 'test2') to identify displayed column positions.",
      "command_ref": "sqli-union-select-basic",
      "evidence": [
        "Test strings visible in page output",
        "Displayed column positions identified",
        "No column count mismatch errors"
      ],
      "dependencies": [
        "enum-columns"
      ],
      "repeatable": true,
      "success_criteria": [
        "UNION query executes successfully",
        "At least one test string visible on page",
        "Column positions documented for data extraction"
      ],
      "failure_conditions": [
        "Column count mismatch error",
        "Type conversion error (need CAST)",
        "No injected data visible (hidden columns)"
      ],
      "next_steps": [
        "identify-database"
      ]
    },
    {
      "id": "identify-database",
      "name": "Identify Database Type and Version",
      "objective": "Extract database type, version, current database name, and user",
      "description": "Use database-specific functions in displayed columns: MySQL (version(), database(), user()), PostgreSQL (version(), current_database(), current_user), MSSQL (@@version, DB_NAME(), USER_NAME()). This step determines which branch to follow.",
      "command_ref": "sqli-union-select-basic",
      "evidence": [
        "Database version string visible",
        "Current database name extracted",
        "Database user identified",
        "Database type confirmed (MySQL/PostgreSQL/MSSQL)"
      ],
      "dependencies": [
        "test-union"
      ],
      "repeatable": false,
      "success_criteria": [
        "Database metadata extracted successfully",
        "Database version confirmed",
        "Current database name known for targeting"
      ],
      "failure_conditions": [
        "Wrong database functions used",
        "Syntax error (incorrect DBMS assumed)",
        "Output not visible (wrong column position)"
      ],
      "next_steps": [
        "enum-mysql-tables",
        "enum-postgres-tables",
        "enum-mssql-tables"
      ]
    },
    {
      "id": "enum-mysql-tables",
      "name": "Enumerate MySQL Tables",
      "objective": "Extract table names from MySQL information_schema",
      "description": "Query information_schema.tables to get all table names in current database. Filter out system databases (mysql, information_schema). Focus on tables containing 'user', 'admin', 'credential' keywords.",
      "command_ref": "sqli-union-mysql-info",
      "evidence": [
        "Table names visible in output",
        "Users, admin, credentials tables identified",
        "Non-system tables documented"
      ],
      "dependencies": [
        "identify-database"
      ],
      "repeatable": true,
      "success_criteria": [
        "At least one table name extracted",
        "Non-system tables identified",
        "Promising tables (users, admin, etc.) found"
      ],
      "failure_conditions": [
        "Access denied to information_schema",
        "No tables visible (wrong column position)",
        "Syntax error in CONCAT function"
      ],
      "next_steps": [
        "extract-mysql-data"
      ]
    },
    {
      "id": "enum-postgres-tables",
      "name": "Enumerate PostgreSQL Tables",
      "objective": "Extract table names from PostgreSQL pg_catalog or information_schema",
      "description": "Query information_schema.tables or pg_catalog.pg_tables for table names in public schema. Use PostgreSQL concatenation operator (||) instead of CONCAT.",
      "command_ref": "sqli-union-postgresql-info",
      "evidence": [
        "Table names visible in response",
        "Public schema tables identified",
        "Schema information extracted"
      ],
      "dependencies": [
        "identify-database"
      ],
      "repeatable": true,
      "success_criteria": [
        "Tables extracted successfully",
        "Public schema tables identified",
        "Target tables for credential extraction found"
      ],
      "failure_conditions": [
        "Wrong concatenation syntax (CONCAT instead of ||)",
        "Type mismatch (need ::text cast)",
        "Access denied to information_schema"
      ],
      "next_steps": [
        "extract-postgres-data"
      ]
    },
    {
      "id": "enum-mssql-tables",
      "name": "Enumerate MSSQL Tables",
      "objective": "Extract table names from MSSQL system views",
      "description": "Query sys.tables or information_schema.tables for table names in current database. Use MSSQL + concatenation operator instead of ||.",
      "command_ref": "sqli-union-mssql-info",
      "evidence": [
        "Table names extracted",
        "System and user tables visible",
        "MSSQL-specific metadata retrieved"
      ],
      "dependencies": [
        "identify-database"
      ],
      "repeatable": true,
      "success_criteria": [
        "Tables enumerated successfully",
        "User tables identified and documented",
        "Credential tables found"
      ],
      "failure_conditions": [
        "Wrong concatenation operator (|| instead of +)",
        "Type conversion error (need CAST to VARCHAR)",
        "Access denied to sys.tables"
      ],
      "next_steps": [
        "extract-mssql-data"
      ]
    },
    {
      "id": "extract-mysql-data",
      "name": "Extract MySQL Credentials",
      "objective": "Dump username and password columns from identified tables",
      "description": "Use UNION SELECT to extract data from users/admin tables. Use CONCAT or GROUP_CONCAT to combine multiple rows. Target username and password columns.",
      "command_ref": "sqli-union-mysql-info",
      "evidence": [
        "Usernames and passwords visible",
        "Password hashes or plaintext extracted",
        "Multiple user records retrieved"
      ],
      "dependencies": [
        "enum-mysql-tables"
      ],
      "repeatable": true,
      "success_criteria": [
        "Credentials extracted successfully",
        "Usernames and passwords/hashes visible",
        "At least one admin/privileged account found"
      ],
      "failure_conditions": [
        "Empty result set (table empty)",
        "Wrong column names used",
        "Access denied to target table"
      ]
    },
    {
      "id": "extract-postgres-data",
      "name": "Extract PostgreSQL Credentials",
      "objective": "Dump credentials from PostgreSQL tables",
      "description": "Extract username and password columns using PostgreSQL concatenation (||) operator. Use ::text casting if needed for type compatibility.",
      "command_ref": "sqli-union-postgresql-info",
      "evidence": [
        "Credentials visible in output",
        "Password hashes extracted",
        "User accounts documented"
      ],
      "dependencies": [
        "enum-postgres-tables"
      ],
      "repeatable": true,
      "success_criteria": [
        "Data extraction successful",
        "Credentials documented for authentication",
        "Admin accounts identified"
      ],
      "failure_conditions": [
        "Syntax error (wrong concatenation operator)",
        "Empty table (no credentials)",
        "Access denied to user table"
      ]
    },
    {
      "id": "extract-mssql-data",
      "name": "Extract MSSQL Credentials",
      "objective": "Dump credentials from MSSQL tables",
      "description": "Extract data using MSSQL + concatenation operator and CAST for type conversion. Target username and password columns in identified tables.",
      "command_ref": "sqli-union-mssql-info",
      "evidence": [
        "Usernames and passwords extracted",
        "Hash values visible",
        "Admin accounts identified"
      ],
      "dependencies": [
        "enum-mssql-tables"
      ],
      "repeatable": true,
      "success_criteria": [
        "Credentials successfully dumped",
        "Admin accounts identified for escalation",
        "Password hashes or plaintext retrieved"
      ],
      "failure_conditions": [
        "Type conversion error (need CAST)",
        "Access denied to target table",
        "Empty result set"
      ]
    }
  ]
}