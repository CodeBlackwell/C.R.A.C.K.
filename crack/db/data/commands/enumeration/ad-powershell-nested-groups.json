{
  "category": "enumeration",
  "description": "Active Directory nested group enumeration using PowerShell - recursive group member discovery, manual .NET queries, and PowerView integration",
  "commands": [
    {
      "id": "ps-get-group-members-basic",
      "name": "Get Group Members - Basic LDAP Query (PowerShell)",
      "category": "enumeration",
      "command": "$groupResult = LDAPSearch -LDAPQuery \"(&(objectCategory=group)(name=<GROUP_NAME>))\"; $group = $groupResult[0]; $group.Properties.member",
      "description": "Query AD group to get direct members (Distinguished Names) - first step in nested group enumeration",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "GROUPS",
        "LDAP",
        ".NET",
        "OSCP:HIGH"
      ],
      "variables": [
        {
          "name": "<GROUP_NAME>",
          "description": "AD group name to query (e.g., 'Domain Admins', 'Service Personnel')",
          "example": "Domain Admins",
          "required": true
        }
      ],
      "flag_explanations": {
        "(&(objectCategory=group)(name=...))": "LDAP filter: AND operator (&) requires BOTH conditions - object must be a group AND name must match",
        ".Properties.member": "The 'member' attribute contains Distinguished Names (DNs) of all direct group members"
      },
      "success_indicators": [
        "CN=",
        "DC=",
        "Distinguished Names displayed"
      ],
      "failure_indicators": [
        "Function 'LDAPSearch' is not recognized",
        "Index operation failed",
        "No results found"
      ],
      "next_steps": [
        "ps-nested-group-check-member-type"
      ],
      "alternatives": [
        "powerview-get-netgroupmember"
      ],
      "prerequisites": [
        "ps-ldapsearch-function"
      ],
      "troubleshooting": {
        "Function not recognized": "Create LDAPSearch function first using ps-ldapsearch-function command",
        "Index operation failed": "Group not found or has no members. Verify group name with: LDAPSearch -LDAPQuery \"(objectCategory=group)\" | select -ExpandProperty Properties | select cn",
        "No results": "Group name incorrect. Try wildcard: (&(objectCategory=group)(name=*<PARTIAL>*))"
      },
      "notes": "FOUNDATION FOR NESTED GROUP ENUMERATION:\nMEMBER ATTRIBUTE FORMAT:\nReturns Distinguished Names:\n  CN=username,CN=Users,DC=corp,DC=com\n\nEACH DN NEEDS INDIVIDUAL QUERY:\n- User (leaf node):\nStop\n- Group (nested):\nRequires recursion\n\nNESTED GROUPS IN ENTERPRISE AD:\nCommon pattern:\nGroup contains groups contains users.\n\nOSCP TARGETS:\nGroups with 'Service', 'IT', 'Admin' in names.\nOften contain privileged accounts buried multiple levels deep.\n\nTime:\n5 seconds per query",
      "oscp_relevance": "high",
      "methodology_guidance": {
        "after_success": "For each member DN, query by distinguishedName to determine if it's a user or nested group Build recursive function to traverse nested groups"
      }
    },
    {
      "id": "ps-nested-group-check-member-type",
      "name": "Check if Group Member is User or Group (PowerShell)",
      "category": "enumeration",
      "command": "$memberDN = \"<DISTINGUISHED_NAME>\"; $memberSearch = LDAPSearch -LDAPQuery \"(distinguishedName=$memberDN)\"; $member = $memberSearch[0]; $objectClass = $member.Properties.objectclass; if ($objectClass -contains \"group\") { Write-Host \"[GROUP] $($member.Properties.name[0])\" -ForegroundColor Magenta } elseif ($objectClass -contains \"user\") { Write-Host \"[USER] $($member.Properties.name[0])\" -ForegroundColor Green }",
      "description": "Query a group member by Distinguished Name to determine if it's a user (leaf) or nested group (requires recursion)",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "GROUPS",
        "LDAP",
        "OSCP:HIGH"
      ],
      "variables": [
        {
          "name": "<DISTINGUISHED_NAME>",
          "description": "Full Distinguished Name from group.Properties.member (e.g., 'CN=jeff,CN=Users,DC=corp,DC=com')",
          "example": "CN=Administrator,CN=Users,DC=corp,DC=com",
          "required": true
        }
      ],
      "flag_explanations": {
        "(distinguishedName=...)": "LDAP filter querying by exact DN - the unique identifier for an AD object",
        ".objectclass": "Array property containing object type hierarchy (e.g., ['top', 'person', 'user'] or ['top', 'group'])",
        "-contains": "PowerShell array operator - checks if 'group' or 'user' exists anywhere in the objectClass array"
      },
      "success_indicators": [
        "[GROUP]",
        "[USER]",
        "Name displayed with color coding"
      ],
      "failure_indicators": [
        "Index operation failed",
        "Cannot index into a null array",
        "No results"
      ],
      "next_steps": [
        "ps-nested-group-recursive-function"
      ],
      "alternatives": [
        "powerview-get-netgroupmember"
      ],
      "prerequisites": [
        "ps-ldapsearch-function",
        "ps-get-group-members-basic"
      ],
      "troubleshooting": {
        "Index operation failed": "DN not found. Verify DN exact match including all commas and spaces",
        "Cannot index into null array": "Query returned no results. Check DN format and domain connectivity",
        "No color output": "Run in PowerShell console (not ISE with old versions). Colors require ANSI support."
      },
      "notes": "The objectClass attribute is hierarchical - users have ['top', 'person', 'organizationalPerson', 'user'], groups have ['top', 'group'].\n\nUsing '-contains' handles this hierarchy correctly.\n\nDistinguished Names must match exactly - even extra spaces cause query failures.\n\nOSCP:\nThis logic determines whether to recurse (nested group) or record (user).\n\nIn exams, you'll often find users 2-3 levels deep:\n'Service Personnel' → 'IT Support' → 'Developers' → target user.\n\nOBJECTCLASS ATTRIBUTE:\nHierarchical structure - users vs groups.\nUsing '-contains' handles hierarchy correctly.\n\nDN MATCHING:\nMust match exactly - extra spaces cause failures.\n\nOSCP LOGIC:\n- Nested group:\nRecurse deeper\n- User:\nRecord and stop\n\nTYPICAL EXAM:\n3 levels deep\n\nTime:\n2 seconds per member",
      "oscp_relevance": "high",
      "methodology_guidance": {
        "after_success": "If [GROUP] appears → recursively enumerate that nested group using ps-get-group-members-basic If [USER] appears → extract user details, check for flags in description/info attributes"
      }
    },
    {
      "id": "ps-nested-group-recursive-function",
      "name": "Recursive Nested Group Enumeration Function (PowerShell)",
      "category": "enumeration",
      "command": "function Get-NestedGroupMember { param([string]$GroupName, [int]$Depth = 0); $indent = \"  \" * $Depth; Write-Host \"$indent[+] $GroupName\" -ForegroundColor Cyan; $groupResult = LDAPSearch -LDAPQuery \"(&(objectCategory=group)(name=$GroupName))\"; if ($groupResult.Count -eq 0) { return }; $group = $groupResult[0]; $members = $group.Properties.member; if ($members.Count -eq 0) { return }; foreach ($memberDN in $members) { $memberSearch = LDAPSearch -LDAPQuery \"(distinguishedName=$memberDN)\"; if ($memberSearch.Count -gt 0) { $member = $memberSearch[0]; $memberName = $member.Properties.name[0]; $objectClass = $member.Properties.objectclass; if ($objectClass -contains \"group\") { Write-Host \"$indent  [GROUP] $memberName\" -ForegroundColor Magenta; Get-NestedGroupMember -GroupName $memberName -Depth ($Depth + 1) } elseif ($objectClass -contains \"user\") { Write-Host \"$indent  [USER] $memberName\" -ForegroundColor Green; $script:AllUsers += $member } } } }; $script:AllUsers = @(); Get-NestedGroupMember -GroupName \"<GROUP_NAME>\"",
      "description": "Complete recursive function to enumerate all users in a group hierarchy - automatically traverses nested groups and collects users",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "GROUPS",
        "LDAP",
        "FUNCTION",
        "RECURSIVE",
        "OSCP:HIGH",
        "STARTER"
      ],
      "variables": [
        {
          "name": "<GROUP_NAME>",
          "description": "Top-level group name to start enumeration (e.g., 'Service Personnel', 'Domain Admins')",
          "example": "Service Personnel",
          "required": true
        }
      ],
      "flag_explanations": {
        "param([string]$GroupName, [int]$Depth = 0)": "Function parameters - GroupName is required, Depth tracks recursion level (default 0 for top-level)",
        "$indent = \"  \" * $Depth": "Creates indentation string (2 spaces × depth) for tree visualization",
        "$script:AllUsers += $member": "Script-scoped array - persists across recursive calls to collect all discovered users",
        "Get-NestedGroupMember -GroupName $memberName -Depth ($Depth + 1)": "Recursive call - increments depth and processes nested group"
      },
      "success_indicators": [
        "[+]",
        "[GROUP]",
        "[USER]",
        "Hierarchical tree output",
        "Indentation showing nesting levels"
      ],
      "failure_indicators": [
        "Function not recognized",
        "Maximum recursion depth exceeded",
        "Infinite loop"
      ],
      "next_steps": [
        "ps-get-last-nested-user"
      ],
      "alternatives": [
        "powerview-get-netgroupmember"
      ],
      "prerequisites": [
        "ps-ldapsearch-function"
      ],
      "troubleshooting": {
        "Function not recognized": "LDAPSearch function required. Create using ps-ldapsearch-function first",
        "Maximum recursion depth": "Circular group membership detected. PowerShell default limit is 100 levels. Add visited group tracking to prevent loops.",
        "AllUsers array empty": "No users found. Check group name and verify group has members: LDAPSearch -LDAPQuery \"(&(objectCategory=group)(name=<GROUP>))\" | select -ExpandProperty Properties | select cn,member"
      },
      "notes": "This function implements depth-first traversal of the group hierarchy.\n\nThe $Depth parameter creates visual tree output - easier to understand nesting levels during enumeration.\n\n$script:AllUsers uses script scope (not global) to avoid polluting global namespace while remaining accessible across recursive calls.\n\nTree output format:\nTop-level group (no indent) → Level 1 groups (2 spaces) → Level 2 groups (4 spaces) → Users (indented at their level).\n\nOSCP:\nThis is the complete solution for 'unravel nested groups' lab questions.\n\nCopy-paste this entire function, then call with target group name.\n\nTypical exam scenario:\n3 levels deep, 5-10 total users.\n\nTime estimate:\n10-15 seconds for complete enumeration.",
      "oscp_relevance": "high",
      "methodology_guidance": {
        "after_success": "Access collected users: $script:AllUsers | foreach { $_.Properties.samaccountname } Get last user details: $script:AllUsers[-1] Extract flags from user attributes: $script:AllUsers[-1].Properties.description"
      }
    },
    {
      "id": "ps-get-last-nested-user",
      "name": "Get Last User from Nested Group Enumeration (PowerShell)",
      "category": "enumeration",
      "command": "if ($script:AllUsers.Count -gt 0) { $lastUser = $script:AllUsers[-1]; Write-Host \"`n[+] LAST USER: $($lastUser.Properties.samaccountname[0])\" -ForegroundColor Yellow; foreach ($prop in $lastUser.Properties.PropertyNames) { Write-Host \"$prop : $($lastUser.Properties[$prop])\" -ForegroundColor White } } else { Write-Host \"[-] No users found\" -ForegroundColor Red }",
      "description": "Display all attributes of the last user found in nested group enumeration - useful for finding flags in OSCP labs",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "USERS",
        "FLAG_EXTRACTION",
        "OSCP:HIGH",
        "QUICK_WIN"
      ],
      "variables": [],
      "flag_explanations": {
        "$script:AllUsers[-1]": "Array index -1 gets the LAST element - the final user added during nested group recursion",
        "$lastUser.Properties.PropertyNames": "Collection of all AD attribute names for this user object",
        "foreach ($prop in ...)": "Iterates through every single attribute to display complete user profile"
      },
      "success_indicators": [
        "LAST USER:",
        "samaccountname",
        "description",
        "info",
        "Multiple attributes displayed"
      ],
      "failure_indicators": [
        "No users found",
        "AllUsers variable not defined",
        "Index was outside the bounds"
      ],
      "next_steps": [],
      "alternatives": [
        "powerview-get-netuser"
      ],
      "prerequisites": [
        "ps-nested-group-recursive-function"
      ],
      "troubleshooting": {
        "AllUsers variable not defined": "Run ps-nested-group-recursive-function first to populate the array",
        "No users found": "Group has no user members or only contains nested groups. Check group membership manually.",
        "Index out of bounds": "$script:AllUsers is empty. Verify group enumeration completed successfully."
      },
      "notes": "OSCP LAB PATTERN:\nQuestions ask:\n'enumerate nested groups and find the last user' then extract flag.\n\nCOMMON FLAG LOCATIONS:\n- description:\nMost common\n- info:\nSecondary\n- comment:\nTertiary\n- userParameters:\nRare\n\nFLAG FORMATS:\n- flag{...}\n- OS{...}\n- Plaintext hints\n- Base64 encoded\n\nLAST USER DEFINITION:\nLast DIRECT user member discovered during depth-first traversal.\nNot necessarily last alphabetically.\n\nTime:\nInstant after enumeration",
      "oscp_relevance": "high",
      "methodology_guidance": {
        "after_success": "Search output for flag: Look in 'description', 'info', 'comment', 'adminDescription' fields Check for Base64 encoded flags Document findings in enumeration.md"
      }
    },
    {
      "id": "ps-find-new-domain-admin",
      "name": "Find New Domain Admin User (PowerShell)",
      "category": "enumeration",
      "command": "LDAPSearch -LDAPQuery \"(&(objectCategory=group)(name=Domain Admins))\" | ForEach-Object { $_.Properties.member } | ForEach-Object { $memberDN = $_; $userSearch = LDAPSearch -LDAPQuery \"(distinguishedName=$memberDN)\"; $user = $userSearch[0]; [PSCustomObject]@{ Name = $user.Properties.samaccountname[0]; Created = $user.Properties.whencreated[0]; DN = $memberDN } } | Sort-Object Created | Format-Table -AutoSize",
      "description": "List all Domain Admins members with creation dates sorted chronologically - identify recently added admin accounts",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "DOMAIN_ADMINS",
        "LDAP",
        "OSCP:HIGH",
        "STARTER"
      ],
      "variables": [],
      "flag_explanations": {
        "whencreated": "AD attribute containing account creation timestamp (UTC format)",
        "Sort-Object Created": "Sorts results by creation date - oldest first, newest last",
        "[PSCustomObject]@{...}": "Creates custom object with selected properties for clean output",
        "Format-Table -AutoSize": "Displays results in columnar format with automatic column width"
      },
      "success_indicators": [
        "Name",
        "Created",
        "Table with timestamps",
        "Multiple Domain Admin accounts listed"
      ],
      "failure_indicators": [
        "Function not recognized",
        "Cannot index into null array",
        "No results"
      ],
      "next_steps": [],
      "alternatives": [
        "powerview-get-netgroupmember"
      ],
      "prerequisites": [
        "ps-ldapsearch-function"
      ],
      "troubleshooting": {
        "Cannot index into null array": "User object query failed. Check DN format and domain connectivity",
        "Empty Created column": "User object missing whencreated attribute. Try whenChanged instead",
        "No results": "Domain Admins group empty or you lack read permissions"
      },
      "notes": "DOMAIN ADMIN ACCOUNT AGES:\nBuilt-in accounts:\n- Administrator, krbtgt, Guest\n- Creation date matches domain creation (years old)\n\nNewly added admins:\n- Recent timestamps (days/weeks old)\n\nOSCP LAB PATTERN:\nQuestion:\n'Which NEW user is part of Domain Admins?'\nAnswer:\nAccount with most recent whencreated date.\n\nEXCLUDE BUILT-INS:\nAdministrator, krbtgt, Guest\n\nALTERNATIVE:\nFilter by whencreated > recent date.\n\nTime:\n10 seconds",
      "oscp_relevance": "high",
      "methodology_guidance": {
        "after_success": "Identify the NEWEST account (bottom of sorted list) Verify it's not built-in: Built-in accounts (Administrator, krbtgt) have older creation dates Get full details: LDAPSearch -LDAPQuery \"(samAccountName=<NEW_ADMIN>)\" | select -ExpandProperty Properties"
      }
    },
    {
      "id": "powerview-get-domaingroup-recursive",
      "name": "PowerView - Get Group Members Recursively (PowerView 3.0+)",
      "category": "enumeration",
      "command": "Get-DomainGroupMember -Identity \"<GROUP_NAME>\" -Recurse",
      "description": "PowerView command to enumerate group members including all nested groups automatically",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "POWERVIEW",
        "GROUPS",
        "OSCP:HIGH",
        "QUICK_WIN"
      ],
      "variables": [
        {
          "name": "<GROUP_NAME>",
          "description": "AD group name (e.g., 'Domain Admins', 'Service Personnel')",
          "example": "Domain Admins",
          "required": true
        }
      ],
      "flag_explanations": {
        "-Identity": "PowerView 3.0+ parameter - accepts group name, DN, SID, or GUID (replaces old -GroupName parameter)",
        "-Recurse": "Automatically unfurls nested groups and returns all users at all levels flattened"
      },
      "success_indicators": [
        "MemberName",
        "MemberObjectClass",
        "MemberDistinguishedName",
        "GroupName"
      ],
      "failure_indicators": [
        "Get-DomainGroupMember : The term 'Get-DomainGroupMember' is not recognized",
        "A parameter cannot be found that matches parameter name 'Identity'",
        "Group not found"
      ],
      "next_steps": [
        "ps-powerview-get-user-details"
      ],
      "alternatives": [
        "ps-nested-group-recursive-function"
      ],
      "prerequisites": [],
      "troubleshooting": {
        "Term not recognized": "PowerView not imported. Load with: Import-Module .\\PowerView.ps1",
        "Parameter 'Identity' not found": "You have PowerView 2.0 (old). Use: Get-NetGroupMember -GroupName \"<GROUP>\" instead",
        "Group not found": "Verify group name: Get-DomainGroup | Select-Object name | Where-Object { $_.name -like \"*<PARTIAL>*\" }"
      },
      "notes": "POWERVIEW 3.0+ CHANGES:\nParameter:\n-GroupName became -Identity\n\nFASTEST METHOD:\nIF PowerView available.\n\nWITHOUT -RECURSE:\nOnly direct members (one level).\n\nWITH -RECURSE:\nFlattens entire hierarchy into single list.\n\nOUTPUT:\nIncludes MemberObjectClass to distinguish users from groups.\n\nOSCP BACKUP:\nPowerView may be blocked by AV.\nKnow manual .NET method:\nps-nested-group-recursive-function\n\nTime:\n3-5 seconds",
      "oscp_relevance": "high",
      "methodology_guidance": {
        "after_success": "Filter users only: Get-DomainGroupMember -Identity \"<GROUP_NAME>\" -Recurse | Where-Object { $_.MemberObjectClass -eq \"user\" } Get last user: ($members | Where-Object { $_.MemberObjectClass -eq \"user\" })[-1] Get user details: Get-DomainUser -Identity <USERNAME>"
      }
    },
    {
      "id": "ps-powerview-get-user-details",
      "name": "PowerView - Get User Full Attributes",
      "category": "enumeration",
      "command": "Get-DomainUser -Identity \"<USERNAME>\" | Format-List *",
      "description": "Retrieve all AD attributes for a specific user - useful for flag extraction after nested group enumeration",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "POWERVIEW",
        "USERS",
        "FLAG_EXTRACTION",
        "OSCP:HIGH"
      ],
      "variables": [
        {
          "name": "<USERNAME>",
          "description": "SAM account name (login username) or Distinguished Name",
          "example": "jeff_admin",
          "required": true
        }
      ],
      "flag_explanations": {
        "-Identity": "Accepts samAccountName, DN, SID, or GUID",
        "Format-List *": "PowerShell cmdlet to display ALL properties in list format (one per line) - asterisk means all properties"
      },
      "success_indicators": [
        "samaccountname",
        "description",
        "info",
        "memberof",
        "whencreated",
        "pwdlastset"
      ],
      "failure_indicators": [
        "Get-DomainUser : The term 'Get-DomainUser' is not recognized",
        "User not found",
        "No results"
      ],
      "next_steps": [],
      "alternatives": [
        "ps-get-last-nested-user"
      ],
      "prerequisites": [
        "verify-powerview-imported"
      ],
      "troubleshooting": {
        "Term not recognized": "Import PowerView first",
        "User not found": "Verify username: Get-DomainUser | Select-Object samaccountname | Where-Object { $_.samaccountname -like \"*<PARTIAL>*\" }"
      },
      "notes": "FORMAT-LIST * DISPLAYS 80+ ATTRIBUTES:\nFlag locations:\n- description:\nCommon\n- info:\nSecondary\n\nAccount info:\n- memberof:\nAll group memberships\n- whencreated:\nAccount age\n- pwdlastset:\nPassword age\n- userAccountControl:\nAccount flags\n- adminCount:\nPrivilege indicator\n- servicePrincipalName:\nKerberoasting target\n\nOSCP WORKFLOW:\n1.\n\nNested group enumeration identifies target user\n\n2.\n\nUse this command for full details\n\n3.\n\nExtract flags from attributes\n\nTime:\n2 seconds",
      "oscp_relevance": "high",
      "methodology_guidance": {
        "after_success": "Search output for flags in: description, info, comment, adminDescription, userParameters Check group membership: .memberof property Check password age: pwdlastset attribute"
      }
    },
    {
      "id": "ps-powerview-find-service-accounts",
      "name": "PowerView - Find Service Accounts in Groups",
      "category": "enumeration",
      "command": "Get-DomainGroupMember -Identity \"<GROUP_NAME>\" -Recurse | Where-Object { $_.MemberObjectClass -eq \"user\" -and $_.MemberName -like \"*svc*\" }",
      "description": "Find service accounts buried in nested groups - service accounts often have weak passwords and high privileges",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "POWERVIEW",
        "SERVICE_ACCOUNTS",
        "GROUPS",
        "OSCP:HIGH",
        "QUICK_WIN"
      ],
      "variables": [
        {
          "name": "<GROUP_NAME>",
          "description": "Group name to search (e.g., 'Service Personnel', 'IT Support')",
          "example": "Service Personnel",
          "required": true
        }
      ],
      "flag_explanations": {
        "$_.MemberObjectClass -eq \"user\"": "Filters to only user objects (exclude nested groups)",
        "$_.MemberName -like \"*svc*\"": "PowerShell wildcard match - finds accounts with 'svc' anywhere in the name",
        "-and": "Logical AND - both conditions must be true"
      },
      "success_indicators": [
        "MemberName",
        "Accounts with 'svc' in name",
        "Service account usernames"
      ],
      "failure_indicators": [
        "PowerView not loaded",
        "No results",
        "Group not found"
      ],
      "next_steps": [],
      "alternatives": [],
      "prerequisites": [
        "verify-powerview-imported"
      ],
      "troubleshooting": {
        "No results": "Try broader patterns: *sql*, *admin*, *backup*, *sa* (SQL Server default admin)"
      },
      "notes": "SERVICE ACCOUNT NAMING PATTERNS:\n- svc_*, *svc*\n- sql_*, *sql*\n- backup_*, *backup*\n- sa (SQL Server admin)\n\nCHARACTERISTICS:\n- Rarely changed passwords (pwdlastset old)\n- Often have SPNs (Kerberoastable)\n- Frequently over-privileged (Domain Admins)\n- Descriptions often contain passwords/hints\n\nOSCP:\nHigh-value targets.\nWeak passwords common.\nOften reused across services.\n\nTime:\n5 seconds",
      "oscp_relevance": "high",
      "methodology_guidance": {
        "after_success": "Check for SPNs: Get-DomainUser -Identity <SVC_ACCOUNT> | Select-Object samaccountname,serviceprincipalname Test Kerberoasting: Get-DomainUser -SPN | Where-Object { $_.samaccountname -like \"*svc*\" } Password spray service accounts (weak passwords common)"
      }
    },
    {
      "id": "ps-extract-flag-from-user",
      "name": "Extract Flag from User Attributes (PowerShell)",
      "category": "enumeration",
      "command": "$user = LDAPSearch -LDAPQuery \"(samAccountName=<USERNAME>)\"; $user = $user[0]; Write-Host \"`n[+] Checking flag locations:\" -ForegroundColor Yellow; @('description','info','comment','adminDescription','userParameters') | ForEach-Object { $value = $user.Properties[$_][0]; if ($value) { Write-Host \"$_ : $value\" -ForegroundColor Cyan } }",
      "description": "Check common flag storage locations in user AD attributes - targeted flag extraction for OSCP labs",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "FLAG_EXTRACTION",
        "USERS",
        "OSCP:HIGH",
        "QUICK_WIN"
      ],
      "variables": [
        {
          "name": "<USERNAME>",
          "description": "SAM account name of target user",
          "example": "jeff_admin",
          "required": true
        }
      ],
      "flag_explanations": {
        "@('description','info',...)": "PowerShell array literal - list of attribute names to check",
        "| ForEach-Object": "Pipeline operator - runs code block for each attribute in array",
        "$user.Properties[$_][0]": "$_ = current attribute name, [0] gets first value (attributes can be multi-valued)",
        "if ($value)": "Only displays attributes that have values (skips empty attributes)"
      },
      "success_indicators": [
        "description :",
        "info :",
        "Flag displayed",
        "Attribute values shown"
      ],
      "failure_indicators": [
        "User not found",
        "All attributes empty",
        "Cannot index into null array"
      ],
      "next_steps": [],
      "alternatives": [
        "ps-get-last-nested-user"
      ],
      "prerequisites": [
        "ps-ldapsearch-function"
      ],
      "troubleshooting": {
        "All attributes empty": "Flags may be in less common attributes. Check all: $user.Properties.PropertyNames | ForEach-Object { \"$_ : $($user.Properties[$_])\" }",
        "User not found": "Verify username spelling and case sensitivity"
      },
      "notes": "OSCP FLAG LOCATION FREQUENCY:\n- description:\n70%\n- info:\n15%\n- comment:\n10%\n- adminDescription:\n3%\n- userParameters:\n2%\n\nFLAG FORMATS:\n- flag{...}:\nMost common\n- OS{...}:\nOffSec format\n- Plaintext hints\n- Base64 encoded\n\nRARE LOCATIONS:\n- msDS-CloudExtensionAttribute1-10\n- extensionAttribute1-15\n- otherMailbox\n\nOSCP LAB PATTERN:\n'Enumerate nested groups and extract flag from last user'\n\nTime:\n2 seconds",
      "oscp_relevance": "high",
      "methodology_guidance": {
        "after_success": "If flag is Base64: [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String(\"<BASE64>\")) Document in breakthrough.md Check other users in same group for additional flags"
      }
    },
    {
      "id": "ps-nested-group-one-liner",
      "name": "Nested Group Enumeration - Complete One-Liner (PowerShell)",
      "category": "enumeration",
      "command": "function LDAPSearch { param([string]$LDAPQuery); $PDC = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name; $DN = ([adsi]'').distinguishedName; $DirectoryEntry = New-Object System.DirectoryServices.DirectoryEntry(\"LDAP://$PDC/$DN\"); $DirectorySearcher = New-Object System.DirectoryServices.DirectorySearcher($DirectoryEntry, $LDAPQuery); return $DirectorySearcher.FindAll() }; function Get-NestedGroupMember { param([string]$GroupName, [int]$Depth = 0); $indent = \"  \" * $Depth; Write-Host \"$indent[+] $GroupName\" -ForegroundColor Cyan; $groupResult = LDAPSearch -LDAPQuery \"(&(objectCategory=group)(name=$GroupName))\"; if ($groupResult.Count -eq 0) { return }; $group = $groupResult[0]; $members = $group.Properties.member; if ($members.Count -eq 0) { return }; foreach ($memberDN in $members) { $memberSearch = LDAPSearch -LDAPQuery \"(distinguishedName=$memberDN)\"; if ($memberSearch.Count -gt 0) { $member = $memberSearch[0]; $memberName = $member.Properties.name[0]; $objectClass = $member.Properties.objectclass; if ($objectClass -contains \"group\") { Write-Host \"$indent  [GROUP] $memberName\" -ForegroundColor Magenta; Get-NestedGroupMember -GroupName $memberName -Depth ($Depth + 1) } elseif ($objectClass -contains \"user\") { Write-Host \"$indent  [USER] $memberName\" -ForegroundColor Green; $script:AllUsers += $member } } } }; $script:AllUsers = @(); Get-NestedGroupMember -GroupName \"<GROUP_NAME>\"; if ($script:AllUsers.Count -gt 0) { $lastUser = $script:AllUsers[-1]; Write-Host \"`n[+] LAST USER: $($lastUser.Properties.samaccountname[0])\" -ForegroundColor Yellow; Write-Host \"[+] FLAG LOCATIONS:\" -ForegroundColor Yellow; @('description','info','comment') | ForEach-Object { $value = $lastUser.Properties[$_][0]; if ($value) { Write-Host \"$_ : $value\" -ForegroundColor Cyan } } }",
      "description": "Complete copy-paste solution for OSCP nested group labs - includes LDAPSearch function, recursive enumeration, and automatic flag extraction",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "GROUPS",
        "FLAG_EXTRACTION",
        "OSCP:HIGH",
        "STARTER",
        "QUICK_WIN"
      ],
      "variables": [
        {
          "name": "<GROUP_NAME>",
          "description": "Top-level group name to enumerate",
          "example": "Service Personnel",
          "required": true
        }
      ],
      "flag_explanations": {},
      "success_indicators": [
        "Hierarchical tree output",
        "[+] LAST USER:",
        "FLAG LOCATIONS:",
        "description/info/comment values displayed"
      ],
      "failure_indicators": [
        "Syntax error",
        "Function already exists",
        "No users found"
      ],
      "next_steps": [],
      "alternatives": [
        "powerview-get-domaingroup-recursive"
      ],
      "prerequisites": [],
      "troubleshooting": {
        "Function already exists": "Clear functions: Remove-Item Function:\\LDAPSearch; Remove-Item Function:\\Get-NestedGroupMember",
        "Syntax error": "Copy entire command as single block. Do not split across multiple lines in terminal."
      },
      "notes": "ULTIMATE OSCP NESTED GROUP SOLUTION:\nONE-LINE EXECUTION:\nCopy entire command → replace <GROUP_NAME> → execute\n\nOUTPUT SHOWS:\n1.\n\nTree structure of group hierarchy\n2.\n\nAll users at all levels\n3.\n\nLast user details\n4.\n\nFlag attributes automatically extracted\n\nNO DEPENDENCIES:\n- No PowerView required\n- No separate function files\n- Single copy-paste execution\n\nOSCP EXAM USE:\nQuestion:\n'enumerate nested groups and find flag in last user'\nSolution:\nPaste this command → done\n\nTime:\n15 seconds total",
      "oscp_relevance": "high",
      "methodology_guidance": {
        "after_success": "Copy flag value from output Document enumeration process in enumeration.md Create educational writeup for learning"
      }
    },
    {
      "id": "ps-compare-powerview-versions",
      "name": "PowerView Version Compatibility Check",
      "category": "enumeration",
      "command": "Get-Command Get-NetGroupMember -ErrorAction SilentlyContinue | Select-Object -ExpandProperty ParameterSets | Select-Object -First 1 | Select-Object -ExpandProperty Parameters | Select-Object Name | Where-Object { $_.Name -like \"*Group*\" -or $_.Name -like \"*Identity*\" }",
      "description": "Detect PowerView version by checking parameter names - determines if you have version 2.0 (-GroupName) or 3.0+ (-Identity)",
      "tags": [
        "ACTIVE_DIRECTORY",
        "ENUMERATION",
        "POWERSHELL",
        "POWERVIEW",
        "TROUBLESHOOTING",
        "OSCP:MEDIUM"
      ],
      "variables": [],
      "flag_explanations": {
        "-ErrorAction SilentlyContinue": "Suppresses error if Get-NetGroupMember doesn't exist (PowerView not loaded)",
        "Select-Object -ExpandProperty ParameterSets": "Gets all parameter sets for the command",
        "Where-Object { $_.Name -like \"*Group*\" -or $_.Name -like \"*Identity*\" }": "Filters to show only relevant parameters"
      },
      "success_indicators": [
        "GroupName",
        "Identity",
        "Parameter name displayed"
      ],
      "failure_indicators": [
        "No output (PowerView not loaded)",
        "Command not found"
      ],
      "next_steps": [],
      "alternatives": [],
      "prerequisites": [],
      "troubleshooting": {
        "No output": "PowerView not loaded. Import first: Import-Module .\\PowerView.ps1",
        "Command errors": "Use simpler version check: Get-Command Get-*GroupMember"
      },
      "notes": "POWERVIEW VERSION HISTORY:\nVersion 2.0:\nSpecific parameters:\n- -GroupName\n- -UserName\n- -ComputerName\n\nVersion 3.0+:\nStandardized on -Identity for all commands.\n\nCOMMON ERROR:\n'A parameter cannot be found that matches parameter name GroupName'\n= Using v2.0 syntax on v3.0+ PowerView\n\nOSCP:\n- Most modern distributions:\n3.0+\n- Older lab machines:\nMay have 2.0\n- Know both syntaxes\n\nTime:\n5 seconds",
      "oscp_relevance": "medium",
      "methodology_guidance": {
        "after_success": "If 'GroupName' appears → PowerView 2.0 → Use: Get-NetGroupMember -GroupName \"<GROUP>\" If 'Identity' appears → PowerView 3.0+ → Use: Get-DomainGroupMember -Identity \"<GROUP>\"",
        "manual_alternative": "No output → PowerView not loaded → Use manual .NET methods"
      }
    }
  ]
}
