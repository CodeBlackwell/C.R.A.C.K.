{
  "commands": [
    {
      "id": "ps-ldap-directorysearcher",
      "name": "PowerShell .NET DirectorySearcher LDAP Query",
      "description": "Perform LDAP queries against Active Directory using built-in .NET DirectorySearcher class without importing tools",
      "command": "([adsisearcher]'<LDAP_FILTER>').FindAll()",
      "category": "enumeration",
      "subcategory": "ACTIVE_DIRECTORY",
      "os": "WINDOWS",
      "variables": [
        {
          "name": "<LDAP_FILTER>",
          "description": "LDAP filter query (standard LDAP syntax)",
          "example": "(objectClass=user)",
          "required": true
        }
      ],
      "flags": [],
      "examples": [
        {
          "command": "([adsisearcher]'(objectClass=user)').FindAll()",
          "description": "Enumerate all user objects in Active Directory domain",
          "context": "Basic AD user enumeration"
        },
        {
          "command": "([adsisearcher]'(objectClass=group)').FindAll() | ForEach-Object { $_.Properties.name }",
          "description": "List all AD group names (extracts 'name' property from results)",
          "context": "AD group discovery"
        },
        {
          "command": "([adsisearcher]'(samaccountname=Administrator)').FindOne().Properties",
          "description": "Get detailed properties for Administrator account (FindOne returns single result)",
          "context": "Target-specific user enumeration"
        },
        {
          "command": "([adsisearcher]'(&(objectClass=user)(adminCount=1))').FindAll() | ForEach-Object { $_.Properties.samaccountname }",
          "description": "Find privileged users (adminCount=1 indicates protected admin accounts)",
          "context": "High-value target identification"
        },
        {
          "command": "([adsisearcher]'(&(objectClass=computer)(operatingSystem=*Server*))').FindAll() | ForEach-Object { $_.Properties.dnshostname }",
          "description": "Enumerate all server computers in domain by operating system filter",
          "context": "Server discovery for lateral movement"
        }
      ],
      "educational": {
        "purpose": "Query Active Directory via LDAP using PowerShell's built-in [adsisearcher] type accelerator - no PowerView or external tools required",
        "manual_alternative": "Import PowerView: Import-Module .\\PowerView.ps1; Get-DomainUser (requires file transfer and AV evasion)",
        "common_failures": [
          "Not domain-joined or no domain context - [adsisearcher] requires domain authentication",
          "Complex LDAP filters require proper syntax: (&(condition1)(condition2)) for AND, (|(c1)(c2)) for OR",
          "FindAll() returns System.DirectoryServices.SearchResult - access .Properties for actual data",
          "Forgetting to extract properties - results are objects, not plain strings"
        ],
        "when_to_use": [
          "Initial AD enumeration from compromised domain-joined Windows host",
          "When PowerView/SharpHound uploads trigger AV alerts",
          "Quick queries without importing tools (stealth)",
          "OSCP exam scenarios requiring AD enumeration without tool transfers"
        ],
        "exam_relevance": "HIGH - Built-in method works on any domain-joined Windows host without tool uploads. Critical for OSCP AD enumeration.",
        "time_estimate": "5-30 seconds depending on domain size",
        "technical_notes": [
          "[adsisearcher] is PowerShell type accelerator for System.DirectoryServices.DirectorySearcher",
          "Automatically binds to current user's domain context",
          "LDAP filters use standard RFC 4515 syntax",
          "FindAll() returns all matches, FindOne() returns first match only",
          "Results include .Properties (hashtable) and .Path (LDAP distinguished name)"
        ]
      },
      "oscp_priority": "HIGH",
      "tags": [
        "POWERSHELL",
        "ACTIVE_DIRECTORY",
        "LDAP",
        "ENUMERATION",
        "OSCP:HIGH",
        "NO_TOOLS_REQUIRED"
      ],
      "related_commands": [
        "ps-get-current-domain",
        "ps-nested-group-check-member-type",
        "powerview-get-domainuser"
      ],
      "ldap_filter_examples": {
        "users": "(objectClass=user)",
        "groups": "(objectClass=group)",
        "computers": "(objectClass=computer)",
        "privileged_users": "(&(objectClass=user)(adminCount=1))",
        "domain_admins": "(&(objectClass=group)(name=Domain Admins))",
        "specific_user": "(samaccountname=<USERNAME>)",
        "servers": "(&(objectClass=computer)(operatingSystem=*Server*))",
        "service_accounts": "(&(objectClass=user)(servicePrincipalName=*))"
      },
      "prerequisites": [
        "ps-get-current-domain"
      ],
      "alternatives": [
        "ldapsearch-users-ad",
        "get-netuser"
      ],
      "next_steps": [
        "kerbrute-userenum-ad",
        "impacket-getnpusers-asreproast"
      ],
      "filled_example": "([adsisearcher]'(objectClass=user)').FindAll()"
    }
  ]
}