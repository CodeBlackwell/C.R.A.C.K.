{
  "category": "Debugging & Reverse Engineering",
  "description": "WinDbg and Frida commands for analyzing AV/AMSI internals, debugging evasion techniques, and understanding Windows security mechanisms at assembly level.",
  "commands": [
    {
      "id": "windbg-attach-process",
      "name": "WinDbg Attach to Process",
      "description": "Attach WinDbg debugger to running process for live analysis. Essential for analyzing AMSI.DLL loading, function hooking, and runtime behavior.",
      "category": "debugging",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "debugging",
        "windbg",
        "reverse-engineering",
        "windows"
      ],
      "command": "# Launch WinDbg (x64) and attach:\n# File -> Attach to Process -> Select process -> OK\n\n# Or via command line:\nwindbg.exe -p <PID>\n\n# Common processes to debug:\n# - powershell.exe (AMSI analysis)\n# - cscript.exe / wscript.exe (JScript AMSI)\n# - WINWORD.EXE (VBA analysis)",
      "variables": [
        {
          "name": "<PID>",
          "description": "Process ID to attach to",
          "example": "1234",
          "required": true
        }
      ],
      "notes": "Syntax:\nLaunch WinDbg, attach to target process WinDbg essential for understanding AMSI internals.\n\nAttach to PowerShell to analyze AmsiScanBuffer.\n\nUse sparingly in OSCP (time-consuming).\n\nGood for lab research before exam.\n\n~5 min setup time.\n\nTime estimate:\n5 minutes (first-time setup) References:\ndocs/av-evasion/debugging.md#windbg-basics, PEN-300 Chapter 7.1.1 Manual alternative:\nUse x64dbg, OllyDbg (32-bit), or Visual Studio debugger",
      "success_indicators": [
        "WinDbg attaches to process, breaks at entry point or continues execution. Debugger command prompt ready."
      ],
      "failure_indicators": [
        "Access denied - Run WinDbg as Administrator",
        "Process crashes on attach - Normal for some processes, try non-invasive attach",
        "Wrong architecture - Use WinDbg x64 for 64-bit processes, x86 for 32-bit",
        "Anti-debug detected - Process may have IsDebuggerPresent checks"
      ],
      "filled_example": "# Launch WinDbg (x64) and attach:\n# File -> Attach to Process -> Select process -> OK\n\n# Or via command line:\nwindbg.exe -p 1234\n\n# Common processes to debug:\n# - powershell.exe (AMSI analysis)\n# - cscript.exe / wscript.exe (JScript AMSI)\n# - WINWORD.EXE (VBA analysis)"
    },
    {
      "id": "windbg-breakpoint-commands",
      "name": "WinDbg Breakpoint Commands",
      "description": "Set breakpoints on functions to intercept execution. Critical for analyzing AMSI function flow (AmsiInitialize, AmsiScanBuffer, etc.).",
      "category": "debugging",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "debugging",
        "windbg",
        "breakpoints",
        "amsi"
      ],
      "command": "# Set breakpoint on function\nbp <MODULE>!<FUNCTION>\n\n# Common AMSI breakpoints:\nbp amsi!AmsiInitialize\nbp amsi!AmsiOpenSession\nbp amsi!AmsiScanBuffer\nbp amsi!AmsiCloseSession\n\n# Continue execution\ng\n\n# Step execution\np  # Step over\nt  # Step into\n\n# List breakpoints\nbl\n\n# Clear breakpoint\nbc <BREAKPOINT_NUMBER>",
      "variables": [
        {
          "name": "<MODULE>",
          "description": "DLL module name (amsi, kernel32, ntdll, etc.)",
          "example": "amsi",
          "required": true
        },
        {
          "name": "<FUNCTION>",
          "description": "Function name within module",
          "example": "AmsiScanBuffer",
          "required": true
        },
        {
          "name": "<BREAKPOINT_NUMBER>",
          "description": "Breakpoint ID from 'bl' command",
          "example": "0",
          "required": false
        }
      ],
      "notes": "Syntax:\nExecute in WinDbg command window Breakpoints critical for AMSI research.\n\nAmsiScanBuffer most important (called on every script scan).\n\nPractice setting bp before exam.\n\nTakes 1-2 min per breakpoint.\n\nTime estimate:\n2 minutes per breakpoint References:\ndocs/av-evasion/debugging.md#breakpoints, PEN-300 Chapter 7.1.1 Manual alternative:\nUse x64dbg GUI, hardware breakpoints (ba command), or memory breakpoints",
      "success_indicators": [
        "Breakpoint set. Execution continues until breakpoint hit, then breaks to debugger prompt."
      ],
      "failure_indicators": [
        "Module not loaded - Use 'lm' to list modules, 'sxe ld:amsi' to break on module load",
        "Function not found - Check spelling, use 'x amsi!*' to list exports",
        "Breakpoint never hits - Function not called, check code path"
      ],
      "filled_example": "# Set breakpoint on function\nbp amsi!AmsiScanBuffer\n\n# Common AMSI breakpoints:\nbp amsi!AmsiInitialize\nbp amsi!AmsiOpenSession\nbp amsi!AmsiScanBuffer\nbp amsi!AmsiCloseSession\n\n# Continue execution\ng\n\n# Step execution\np  # Step over\nt  # Step into\n\n# List breakpoints\nbl\n\n# Clear breakpoint\nbc 0"
    },
    {
      "id": "windbg-memory-inspection",
      "name": "WinDbg Memory Inspection",
      "description": "Inspect memory contents at specific addresses. Essential for viewing AMSI context structures, shellcode buffers, and function parameters.",
      "category": "debugging",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "debugging",
        "windbg",
        "memory",
        "analysis"
      ],
      "command": "# Display memory as DWORD (32-bit values)\ndd <ADDRESS>\n\n# Display memory as QWORD (64-bit values)\ndq <ADDRESS>\n\n# Display memory as ASCII string\ndc <ADDRESS>\n\n# Display memory as Unicode string\ndu <ADDRESS>\n\n# Display memory as bytes\ndb <ADDRESS>\n\n# Display specific number of values\ndd <ADDRESS> L<COUNT>",
      "variables": [
        {
          "name": "<ADDRESS>",
          "description": "Memory address or register name (rsp, rcx, rip, etc.)",
          "example": "rsp",
          "required": true
        },
        {
          "name": "<COUNT>",
          "description": "Number of values to display (hex)",
          "example": "10",
          "required": false
        }
      ],
      "notes": "Syntax:\nExecute in WinDbg after breaking at function Memory inspection reveals AMSI context structure (first 4 bytes:\n\"AMSI\").\n\nCritical for understanding context corruption bypass.\n\nUse 'du' for PowerShell strings (Unicode).\n\n~1 min per inspection.\n\nTime estimate:\n1 minute References:\ndocs/av-evasion/debugging.md#memory-inspection, PEN-300 Chapter 7.2 Manual alternative:\nUse Process Explorer memory viewer, x64dbg memory map, or CheatEngine",
      "success_indicators": [
        "Memory contents displayed in specified format (hex, ASCII, Unicode, etc.)."
      ],
      "failure_indicators": [
        "Access violation - Address not valid or not readable",
        "Wrong format - Use du for Unicode strings, da for ASCII",
        "Address not found - Use registers (rsp, rcx) instead of hard-coded addresses"
      ],
      "filled_example": "# Display memory as DWORD (32-bit values)\ndd rsp\n\n# Display memory as QWORD (64-bit values)\ndq rsp\n\n# Display memory as ASCII string\ndc rsp\n\n# Display memory as Unicode string\ndu rsp\n\n# Display memory as bytes\ndb rsp\n\n# Display specific number of values\ndd rsp L10"
    },
    {
      "id": "windbg-disassemble",
      "name": "WinDbg Disassembly View",
      "description": "Disassemble machine code to assembly instructions. Shows function internals, allows understanding of AMSI validation logic and bypass opportunities.",
      "category": "debugging",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "debugging",
        "windbg",
        "assembly",
        "disassembly"
      ],
      "command": "# Unassemble at current instruction pointer\nu\n\n# Unassemble specific address or function\nu <ADDRESS>\nu <MODULE>!<FUNCTION>\n\n# Unassemble with length\nu <ADDRESS> L<COUNT>\n\n# Unassemble current function\nuf .\n\n# Unassemble specific function (full)\nuf <MODULE>!<FUNCTION>",
      "variables": [
        {
          "name": "<ADDRESS>",
          "description": "Memory address or register (rip, etc.)",
          "example": "rip",
          "required": false
        },
        {
          "name": "<MODULE>",
          "description": "DLL module name",
          "example": "amsi",
          "required": false
        },
        {
          "name": "<FUNCTION>",
          "description": "Function name",
          "example": "AmsiScanBuffer",
          "required": false
        },
        {
          "name": "<COUNT>",
          "description": "Number of instructions to display",
          "example": "20",
          "required": false
        }
      ],
      "notes": "Syntax:\nExecute in WinDbg Understanding AmsiScanBuffer disassembly shows WHERE to patch for memory bypass.\n\nLook for 'test', 'cmp', 'je' instructions (validation logic).\n\n'xor rax, rax; ret' = clean return.\n\n~10 min to analyze function.\n\nTime estimate:\n10 minutes (function analysis) References:\ndocs/av-evasion/debugging.md#disassembly, PEN-300 Chapter 7.4.1 Manual alternative:\nUse IDA Pro, Ghidra, Binary Ninja, or x64dbg for static analysis",
      "success_indicators": [
        "Assembly instructions with addresses, opcodes, and mnemonics. Shows function logic flow."
      ],
      "failure_indicators": [
        "Address not executable - Pointing to data section",
        "Symbols not loaded - Use '.reload /f' to force symbol load",
        "Too complex to follow - Use flow graph in IDA/Ghidra"
      ],
      "filled_example": "# Unassemble at current instruction pointer\nu\n\n# Unassemble specific address or function\nu rip\nu amsi!AmsiScanBuffer\n\n# Unassemble with length\nu rip L20\n\n# Unassemble current function\nuf .\n\n# Unassemble specific function (full)\nuf amsi!AmsiScanBuffer"
    },
    {
      "id": "frida-trace-amsi",
      "name": "Frida Trace AMSI Functions",
      "description": "Use Frida dynamic instrumentation to trace AMSI API calls. Non-invasive alternative to WinDbg for analyzing AMSI behavior without debugging.",
      "category": "debugging",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "debugging",
        "frida",
        "amsi",
        "instrumentation"
      ],
      "command": "# List running processes\nfrida-ps\n\n# Trace AMSI functions in PowerShell process\nfrida-trace -p <PID> -x amsi.dll -i Amsi*\n\n# Trace with detailed logging\nfrida-trace -p <PID> -x amsi.dll -i AmsiScanBuffer -i AmsiInitialize",
      "variables": [
        {
          "name": "<PID>",
          "description": "Process ID to trace",
          "example": "5432",
          "required": true
        }
      ],
      "prerequisites": [],
      "notes": "Syntax:\nExecute from Kali or Windows with Frida installed Frida is powerful but may be blocked by AV/EDR.\n\nGood for lab analysis before exam.\n\nShows WHAT PowerShell sends to AMSI for scanning.\n\nCustom handlers reveal buffer contents.\n\n~15 min setup first time.\n\nTime estimate:\n15 minutes (first-time setup) References:\ndocs/av-evasion/debugging.md#frida, PEN-300 Chapter 7.2.2 Manual alternative:\nUse API Monitor, Process Monitor, or WinDbg for function tracing",
      "success_indicators": [
        "Real-time log of AMSI function calls with timestamps. Handler scripts can log arguments and return values."
      ],
      "failure_indicators": [
        "Process crashes - Frida conflict with AV/EDR, disable or use WinDbg",
        "No output - Functions not called, execute AMSI-flagged command",
        "Permission denied - Run with appropriate privileges",
        "Frida not found - Install with pip"
      ],
      "filled_example": "# List running processes\nfrida-ps\n\n# Trace AMSI functions in PowerShell process\nfrida-trace -p 5432 -x amsi.dll -i Amsi*\n\n# Trace with detailed logging\nfrida-trace -p 5432 -x amsi.dll -i AmsiScanBuffer -i AmsiInitialize"
    },
    {
      "id": "windbg-edit-memory",
      "name": "WinDbg Edit Memory (Live Patching)",
      "description": "Modify memory at runtime to test patches. Allows live testing of AMSI bypass patches without recompiling code.",
      "category": "debugging",
      "tags": [
        "anti-virus",
        "AV",
        "evasion",
        "debugging",
        "windbg",
        "memory-patching",
        "amsi"
      ],
      "command": "# Edit memory (DWORD)\ned <ADDRESS> <NEW_VALUE>\n\n# Edit memory (byte)\neb <ADDRESS> <BYTE1> <BYTE2> <BYTE3> ...\n\n# Example: Patch AmsiScanBuffer to return clean\n# Find function address:\nx amsi!AmsiScanBuffer\n\n# Patch with: xor rax,rax (48 31 C0); ret (C3)\neb <ADDRESS> 48 31 C0 C3",
      "variables": [
        {
          "name": "<ADDRESS>",
          "description": "Memory address to modify",
          "example": "7ffa12345678",
          "required": true
        },
        {
          "name": "<NEW_VALUE>",
          "description": "New value to write (hex)",
          "example": "90909090",
          "required": true
        },
        {
          "name": "<BYTE1>",
          "description": "Byte values to write",
          "example": "48",
          "required": true
        },
        {
          "name": "<BYTE2>",
          "description": "Second byte value",
          "example": "0x12",
          "required": true
        },
        {
          "name": "<BYTE3>",
          "description": "Third byte value",
          "example": "0x34",
          "required": true
        }
      ],
      "notes": "Syntax:\nExecute in WinDbg after breaking Live patching validates bypass techniques before implementing in code.\n\nPatch AmsiScanBuffer with 'xor rax,rax; ret' to test if bypass works.\n\nReversible (just restart process).\n\n~5 min to test patch.\n\nTime estimate:\n5 minutes References:\ndocs/av-evasion/debugging.md#live-patching, PEN-300 Chapter 7.4.2 Manual alternative:\nUse x64dbg patches, Cheat Engine, or process memory writers",
      "success_indicators": [
        "Memory modified. Function behavior changes according to patch. Live testing of bypass techniques."
      ],
      "failure_indicators": [
        "Access violation - Memory not writable, use !vprot to check/change permissions",
        "Patch doesn't work - Wrong address or wrong bytes",
        "Process crashes - Patched critical code path incorrectly"
      ],
      "filled_example": "# Edit memory (DWORD)\ned 7ffa12345678 90909090\n\n# Edit memory (byte)\neb 7ffa12345678 48 0x12 0x34 ...\n\n# Example: Patch AmsiScanBuffer to return clean\n# Find function address:\nx amsi!AmsiScanBuffer\n\n# Patch with: xor rax,rax (48 31 C0); ret (C3)\neb 7ffa12345678 48 31 C0 C3"
    }
  ],
  "oscp_relevance": "Debugging skills critical for understanding bypass techniques at low level. Essential for researching new bypasses. WinDbg and Frida both valuable but time-consuming - prioritize for lab research, not exam day.",
  "attack_chain_position": "Research, Development, Pre-Engagement Preparation",
  "related_categories": [
    "amsi-bypass",
    "reverse-engineering",
    "windows-internals"
  ]
}