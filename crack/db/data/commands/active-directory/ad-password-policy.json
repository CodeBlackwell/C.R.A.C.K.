{
  "commands": [
    {
      "id": "net-accounts-policy",
      "name": "Net Accounts - Domain Password Policy",
      "description": "Display Active Directory password policy from domain-joined Windows system (lockout threshold, lockout duration, observation window)",
      "command": "net accounts",
      "category": "enumeration",
      "subcategory": "active-directory",
      "variables": [],
      "tags": [
        "ACTIVE_DIRECTORY",
        "PASSWORD_POLICY",
        "WINDOWS",
        "QUICK_WIN"
      ],
      "flag_explanations": {},
      "success_indicators": [
        "Force user logoff how long after time expires?",
        "Minimum password age",
        "Lockout threshold",
        "Lockout duration",
        "The command completed successfully"
      ],
      "failure_indicators": [
        "Access is denied",
        "The user name or password is incorrect",
        "System error 1355"
      ],
      "next_steps": [
        "kerbrute-userenum",
        "spray-passwords-ldap",
        "crackmapexec-smb-spray",
        "kerbrute-passwordspray"
      ],
      "alternatives": [
        "enum4linux-policy",
        "crackmapexec-policy",
        "ldapsearch-policy"
      ],
      "prerequisites": [],
      "troubleshooting": {
        "Access is denied": "Ensure you are logged in as a domain user on a domain-joined Windows system. Use RDP or WinRM with valid credentials.",
        "System error 1355": "Not executed from a domain-joined system. Use enum4linux-policy or crackmapexec-policy from Linux instead."
      },
      "notes": "CRITICAL for password spraying attacks.\n\nLockout threshold indicates max failed logins before account lockout.\n\nLockout observation window shows time until counter resets.\n\nCALCULATION:\nWith 5 attempts threshold and 30min window, you can safely attempt 4 logins per user every 30 minutes = 192 attempts per user per 24 hours.\n\nTIME ESTIMATE:\n<5 seconds.\n\nMANUAL ALTERNATIVE:\nCheck Group Policy (gpedit.msc \u2192 Computer Configuration \u2192 Windows Settings \u2192 Security Settings \u2192 Account Policies \u2192 Account Lockout Policy) or query LDAP for lockoutThreshold attribute.\n\ncertification TIP:\nAlways run this FIRST before any password attacks to avoid locking out accounts and alerting administrators."
    },
    {
      "id": "enum4linux-policy",
      "name": "Enum4linux - Password Policy via SMB",
      "description": "Enumerate Active Directory password policy from Linux via SMB (supports null sessions or authenticated)",
      "command": "enum4linux -P <TARGET>",
      "category": "enumeration",
      "subcategory": "active-directory",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Domain controller IP or hostname",
          "example": "192.168.50.70",
          "required": true
        }
      ],
      "tags": [
        "ACTIVE_DIRECTORY",
        "PASSWORD_POLICY",
        "LINUX",
        "SMB",
        "NULL_SESSION"
      ],
      "flag_explanations": {
        "-P": "Get password policy information via SMB",
        "-u": "Specify username for authenticated enumeration (optional, use with -p)",
        "-p": "Specify password for authenticated enumeration (optional, use with -u)",
        "-a": "Do all simple enumeration (includes -P plus users, shares, groups)"
      },
      "success_indicators": [
        "Password Complexity",
        "Minimum Password Length",
        "Account Lockout Threshold",
        "Lockout Duration",
        "Observation Window"
      ],
      "failure_indicators": [
        "Cannot connect to server",
        "NT_STATUS_ACCESS_DENIED",
        "Protocol negotiation failed",
        "Connection refused"
      ],
      "next_steps": [
        "enum4linux-users-ad",
        "kerbrute-userenum",
        "crackmapexec-smb-spray"
      ],
      "alternatives": [
        "net-accounts-policy",
        "crackmapexec-policy",
        "ldapsearch-policy"
      ],
      "prerequisites": [],
      "troubleshooting": {
        "NT_STATUS_ACCESS_DENIED": "Null session blocked. Try with credentials: enum4linux -u <USER> -p <PASS> -P <TARGET>",
        "Connection refused": "SMB ports (445/139) may be filtered. Verify connectivity: sudo nmap -p 139,445 -Pn -v <TARGET>",
        "Protocol negotiation failed": "SMBv1 may be disabled. Use crackmapexec-policy instead (supports SMBv2/v3)"
      },
      "notes": "STEALTHY method for external password policy discovery.\n\nOften works via NULL SESSION (no credentials required) if SMB null sessions are enabled on DC.\n\nNOISE LEVEL:\nMedium (SMB connection logged).\n\nTIME ESTIMATE:\n10-30 seconds.\n\nMANUAL ALTERNATIVE:\nUse rpcclient with -N flag for null session:\nrpcclient -N -U '' <TARGET> then 'getdompwinfo'.\n\nWHY THIS WORKS:\nWindows DCs expose password policy via MS-SAMR RPC interface accessible over SMB.\n\nNull sessions may be allowed for backward compatibility.\n\ncertification TIP:\nTry null session first, then authenticated if blocked.\n\nModern domains often block null sessions.",
      "filled_example": "enum4linux -P 192.168.50.70"
    },
    {
      "id": "crackmapexec-policy",
      "name": "CrackMapExec - Password Policy Enumeration",
      "description": "Enumerate Active Directory password policy via SMB using CrackMapExec (supports SMBv2/v3, requires credentials)",
      "command": "crackmapexec smb <TARGET> -u <USERNAME> -p <PASSWORD> --pass-pol",
      "category": "enumeration",
      "subcategory": "active-directory",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Domain controller IP or hostname",
          "example": "192.168.50.70",
          "required": true
        },
        {
          "name": "<USERNAME>",
          "description": "Domain username (use any valid domain user)",
          "example": "guest",
          "required": true
        },
        {
          "name": "<PASSWORD>",
          "description": "Password for authentication (use empty string '' for blank password)",
          "example": "''",
          "required": true
        }
      ],
      "tags": [
        "ACTIVE_DIRECTORY",
        "PASSWORD_POLICY",
        "LINUX",
        "SMB",
        "CRACKMAPEXEC"
      ],
      "flag_explanations": {
        "--pass-pol": "Dump password policy information",
        "-u": "Username (single user or file with -U)",
        "-p": "Password (single password or file with -P)",
        "-d": "Domain name (optional, auto-detected from DC)",
        "--local-auth": "Authenticate to local SAM instead of domain (not useful for domain policy)"
      },
      "success_indicators": [
        "[+] Dumping password policy",
        "Minimum password length",
        "Password complexity",
        "Lockout threshold",
        "Lockout duration",
        "Lockout observation window"
      ],
      "failure_indicators": [
        "[-] Error",
        "STATUS_LOGON_FAILURE",
        "STATUS_ACCESS_DENIED",
        "Connection refused"
      ],
      "next_steps": [
        "crackmapexec-smb-spray",
        "kerbrute-userenum"
      ],
      "alternatives": [
        "net-accounts-policy",
        "enum4linux-policy",
        "ldapsearch-policy"
      ],
      "prerequisites": [],
      "troubleshooting": {
        "STATUS_LOGON_FAILURE": "Invalid credentials. Try guest account with blank password: crackmapexec smb <TARGET> -u 'guest' -p ''",
        "Connection refused": "SMB port 445 blocked. Check firewall: sudo nmap -p 445 -Pn -v <TARGET>",
        "STATUS_ACCESS_DENIED": "User lacks permissions. Any valid domain user should work - verify credentials are correct."
      },
      "notes": "MODERN alternative to enum4linux with SMBv2/v3 support.\n\nREQUIRES valid domain credentials (guest account often works with blank password).\n\nADVANTAGE:\nWorks when SMBv1/null sessions disabled.\n\nNOISE LEVEL:\nMedium (authenticated SMB connection logged).\n\nTIME ESTIMATE:\n5-15 seconds.\n\nWHY THIS WORKS:\nCrackMapExec uses MS-SAMR RPC over SMB to query password policy from domain controller.\n\nAny authenticated domain user can read password policy (not privileged information).\n\ncertification TIP:\nIf you have ANY valid domain credentials, use this instead of enum4linux.\n\nTry guest:'' first.\n\nGuest account is often enabled with blank password even when null sessions are blocked.",
      "filled_example": "crackmapexec smb 192.168.50.70 -u guest -p '' --pass-pol"
    },
    {
      "id": "ldapsearch-policy",
      "name": "ldapsearch - LDAP Password Policy Query",
      "description": "Query Active Directory password policy directly via LDAP (anonymous or authenticated)",
      "command": "ldapsearch -x -H ldap://<TARGET> -b '<DOMAIN_DN>' -s base '(objectClass=*)' lockoutThreshold lockoutDuration lockOutObservationWindow minPwdLength pwdProperties",
      "category": "enumeration",
      "subcategory": "active-directory",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Domain controller IP or hostname",
          "example": "192.168.50.70",
          "required": true
        },
        {
          "name": "<DOMAIN_DN>",
          "description": "Domain distinguished name (e.g., DC=corp,DC=com for corp.com domain)",
          "example": "DC=corp,DC=com",
          "required": true
        }
      ],
      "tags": [
        "ACTIVE_DIRECTORY",
        "PASSWORD_POLICY",
        "LINUX",
        "LDAP"
      ],
      "flag_explanations": {
        "-x": "Use simple authentication (no SASL)",
        "-H": "LDAP URI (ldap:// or ldaps://)",
        "-b": "Base DN for search",
        "-s base": "Search scope (base = single object)",
        "-D": "Bind DN for authenticated queries (optional, use with -w)",
        "-w": "Password for authenticated bind (optional, use with -D)",
        "'(objectClass=*)'": "LDAP filter (match all)",
        "lockoutThreshold": "Attribute: failed login attempts before lockout",
        "lockoutDuration": "Attribute: lockout duration in 100-nanosecond intervals",
        "lockOutObservationWindow": "Attribute: time window for counting failed attempts",
        "minPwdLength": "Attribute: minimum password length",
        "pwdProperties": "Attribute: password complexity flags"
      },
      "success_indicators": [
        "lockoutThreshold:",
        "lockoutDuration:",
        "lockOutObservationWindow:",
        "minPwdLength:",
        "# numEntries: 1"
      ],
      "failure_indicators": [
        "ldap_bind: Invalid credentials",
        "Can't contact LDAP server",
        "Operations error",
        "# numEntries: 0"
      ],
      "next_steps": [
        "ldapsearch-users-ad",
        "kerbrute-userenum",
        "crackmapexec-smb-spray"
      ],
      "alternatives": [
        "net-accounts-policy",
        "enum4linux-policy",
        "crackmapexec-policy"
      ],
      "prerequisites": [],
      "troubleshooting": {
        "Can't contact LDAP server": "LDAP port 389 may be blocked. Verify: sudo nmap -p 389,636 -Pn -v <TARGET>. Try LDAPS (port 636) with ldaps:// instead of ldap://",
        "Invalid credentials": "Anonymous bind blocked. Use credentials: ldapsearch -x -H ldap://<TARGET> -D '<USER>@<DOMAIN>' -w '<PASSWORD>' -b '<DOMAIN_DN>' ...",
        "Operations error": "Anonymous queries may be disabled. Retry with valid credentials.",
        "Need to convert times": "lockoutDuration and lockOutObservationWindow are in 100-nanosecond intervals. Divide by 600000000 to get minutes."
      },
      "notes": "MOST DIRECT method - queries password policy attributes directly from AD LDAP.\n\nMay work ANONYMOUSLY if anonymous LDAP binding is enabled (uncommon in modern domains).\n\nNOISE LEVEL:\nLow (LDAP query, often not logged).\n\nTIME ESTIMATE:\n5-10 seconds.\n\nTIME CONVERSION:\nlockoutDuration and lockOutObservationWindow are in 100-nanosecond intervals (e.g., 18000000000 = 30 minutes).\n\nDivide by 600000000 to get minutes.\n\nMANUAL ALTERNATIVE:\nUse AD Explorer (Windows GUI) or PowerShell Get-ADDefaultDomainPasswordPolicy.\n\nWHY THIS WORKS:\nPassword policy stored in domain root object in AD, readable by any authenticated user (sometimes anonymous).\n\ncertification TIP:\nLess common than SMB-based enumeration but useful when SMB is blocked or filtered.\n\nDomain DN format:\nDC=domain,DC=com (replace dots with ',DC=').\n\nFor corp.com use DC=corp,DC=com.",
      "filled_example": "ldapsearch -x -H ldap://192.168.50.70 -b 'DC=corp,DC=com' -s base '(objectClass=*)' lockoutThreshold lockoutDuration lockOutObservationWindow minPwdLength pwdProperties"
    }
  ]
}