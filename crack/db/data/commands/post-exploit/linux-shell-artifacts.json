{
  "category": "post-exploit",
  "subcategory": "credential-discovery",
  "description": "Shell history, environment variables, and log file enumeration for credential discovery",
  "commands": [
    {
      "id": "linux-bash-history",
      "name": "Read Bash History Files",
      "category": "post-exploit",
      "subcategory": "credential-discovery",
      "command": "cat ~/.bash_history 2>/dev/null; find /home -name '.bash_history' -exec cat {} \\; 2>/dev/null",
      "description": "Read shell history files - often contains passwords typed in commands",
      "variables": [],
      "flag_explanations": {
        "~/.bash_history": "Current user's bash history",
        "find /home": "Search all user home directories",
        "-name '.bash_history'": "Find bash history files",
        "-exec cat {} \\;": "Cat each found file"
      },
      "tags": [
        "CREDENTIAL_ACCESS",
        "DISCOVERY",
        "ENUMERATION",
        "LINUX",
        "POST_EXPLOITATION",
        "QUICK_WIN"
      ],
      "success_indicators": [
        "mysql -u root -p",
        "sshpass -p",
        "export PASSWORD=",
        "curl -u user:pass",
        "Commands with credentials"
      ],
      "failure_indicators": [
        "Permission denied on all files",
        "Empty history files",
        "HISTFILE=/dev/null"
      ],
      "prerequisites": [],
      "next_steps": [
        "linux-mysql-history",
        "linux-env-vars",
        "linux-auth-logs"
      ],
      "alternatives": [
        "cat /home/*/.bash_history"
      ],
      "troubleshooting": {
        "Permission denied": "Check readable user directories first: ls -la /home/",
        "Empty files": "History may be disabled or cleared - check .bashrc for HISTSIZE=0"
      },
      "notes": "GOLDMINE for credentials!\n\nCommon password leaks:\n- mysql -u root -pSECRET (password attached to -p)\n- sshpass -p 'password' ssh user@host\n- export DB_PASSWORD=secret\n- curl -u admin:password http://...\n- git clone https://user:token@github.com/...\n\nAlso check:\n- .zsh_history (ZSH)\n- .sh_history (other shells)\n- .python_history\n- .psql_history (PostgreSQL)\n\nTime estimate: 1-2 minutes.\n\npractical tip: Admins frequently type passwords in commands. History survives logouts!",
      "methodology_guidance": {
        "after_success": "Extract any credentials found. Test password reuse on SSH/su."
      }
    },
    {
      "id": "linux-env-vars",
      "name": "Check Environment Variables for Secrets",
      "category": "post-exploit",
      "subcategory": "credential-discovery",
      "command": "env | grep -iE 'pass|key|secret|token|api|cred|auth'",
      "description": "Search environment variables for sensitive values - common in web apps",
      "variables": [],
      "flag_explanations": {
        "env": "Display all environment variables",
        "-i": "Case insensitive matching",
        "-E": "Extended regex for multiple patterns",
        "pass|key|secret": "Common credential variable names"
      },
      "tags": [
        "CREDENTIAL_ACCESS",
        "DISCOVERY",
        "ENUMERATION",
        "LINUX",
        "POST_EXPLOITATION",
        "QUICK_WIN"
      ],
      "success_indicators": [
        "DB_PASSWORD=",
        "API_KEY=",
        "SECRET_KEY=",
        "AWS_SECRET_ACCESS_KEY=",
        "JWT_SECRET="
      ],
      "failure_indicators": [
        "No matches",
        "Only standard system variables"
      ],
      "prerequisites": [],
      "next_steps": [
        "linux-bash-history",
        "linux-find-env-files"
      ],
      "alternatives": [
        "printenv",
        "set"
      ],
      "troubleshooting": {
        "No output": "Expand search: env (show all) or check process environments"
      },
      "notes": "Modern web apps use environment variables for secrets.\n\nCommon patterns:\n- DB_PASSWORD, DATABASE_URL\n- API_KEY, API_SECRET\n- AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY\n- JWT_SECRET, SESSION_SECRET\n- REDIS_PASSWORD, MONGO_URI\n\nAlso check:\n- /proc/*/environ (other processes)\n- .env files in web directories\n- systemd service files\n\nTime estimate: 1 second.\n\npractical tip: Docker containers often have credentials in env vars.",
      "methodology_guidance": {
        "after_success": "Note all sensitive env vars. Check if reused elsewhere."
      }
    },
    {
      "id": "linux-mysql-history",
      "name": "Read MySQL Command History",
      "category": "post-exploit",
      "subcategory": "credential-discovery",
      "command": "cat ~/.mysql_history 2>/dev/null; find /home -name '.mysql_history' -exec cat {} \\; 2>/dev/null",
      "description": "Read MySQL history files - may contain password changes and sensitive queries",
      "variables": [],
      "flag_explanations": {
        ".mysql_history": "MySQL command history file",
        "find /home": "Search all user directories"
      },
      "tags": [
        "CREDENTIAL_ACCESS",
        "DATABASE",
        "DISCOVERY",
        "LINUX",
        "MYSQL",
        "POST_EXPLOITATION"
      ],
      "success_indicators": [
        "ALTER USER",
        "SET PASSWORD",
        "GRANT ALL",
        "SELECT * FROM users",
        "Password in queries"
      ],
      "failure_indicators": [
        "File not found",
        "Permission denied",
        "Empty file"
      ],
      "prerequisites": [],
      "next_steps": [
        "linux-bash-history",
        "linux-auth-logs"
      ],
      "alternatives": [],
      "troubleshooting": {
        "File not found": "MySQL may not be used or history disabled",
        "Permission denied": "Need access to user's home directory"
      },
      "notes": "MySQL history survives even when user thinks they cleared it.\n\nLook for:\n- ALTER USER 'root'@'localhost' IDENTIFIED BY 'newpassword'\n- SET PASSWORD FOR 'user' = PASSWORD('secret')\n- GRANT ALL PRIVILEGES... IDENTIFIED BY 'password'\n- INSERT INTO users (password) VALUES ('...')\n- SELECT * FROM config WHERE name='password'\n\nAlso check:\n- .psql_history (PostgreSQL)\n- .rediscli_history (Redis)\n- .dbshell (MongoDB)\n\nTime estimate: 1 minute.\n\npractical tip: Database admins often change passwords via CLI, leaving history.",
      "methodology_guidance": {
        "after_success": "Extract any passwords. Test against MySQL and for password reuse."
      }
    },
    {
      "id": "linux-auth-logs",
      "name": "Read Authentication Logs",
      "category": "post-exploit",
      "subcategory": "credential-discovery",
      "command": "cat /var/log/auth.log 2>/dev/null | tail -100; cat /var/log/secure 2>/dev/null | tail -100",
      "description": "Read authentication logs - shows login attempts, sources, and sometimes usernames in failed attempts",
      "variables": [],
      "flag_explanations": {
        "/var/log/auth.log": "Debian/Ubuntu authentication log",
        "/var/log/secure": "RHEL/CentOS authentication log",
        "tail -100": "Last 100 lines to avoid overwhelming output"
      },
      "tags": [
        "DISCOVERY",
        "ENUMERATION",
        "LINUX",
        "LOG_ANALYSIS",
        "POST_EXPLOITATION"
      ],
      "success_indicators": [
        "Accepted password for",
        "Failed password for",
        "session opened for user",
        "sudo: command"
      ],
      "failure_indicators": [
        "Permission denied",
        "File not found",
        "Empty log"
      ],
      "prerequisites": [],
      "next_steps": [
        "linux-bash-history",
        "linux-last-login"
      ],
      "alternatives": [
        "journalctl -u ssh",
        "last"
      ],
      "troubleshooting": {
        "Permission denied": "May need root or adm group membership",
        "File not found": "Try journalctl -u sshd or /var/log/messages"
      },
      "notes": "Auth logs reveal:\n- Successful logins (timing, source IPs)\n- Failed attempts (may indicate valid usernames)\n- Sudo usage (what commands run as root)\n- SSH keys used\n\nFailed login patterns:\n- 'Failed password for invalid user admin' = admin doesn't exist\n- 'Failed password for root' = root exists, password wrong\n\nTime estimate: 1-2 minutes.\n\npractical tip: Failed logins may reveal password hints (typos of real password).\n\nRequires root or adm group to read.",
      "methodology_guidance": {
        "after_success": "Note valid usernames, successful login times, and source IPs"
      }
    },
    {
      "id": "linux-tty-spawn",
      "name": "Spawn Interactive PTY Shell",
      "category": "post-exploit",
      "subcategory": "shell-upgrade",
      "command": "python3 -c 'import pty; pty.spawn(\"/bin/bash\")' || python -c 'import pty; pty.spawn(\"/bin/bash\")' || script -qc /bin/bash /dev/null",
      "description": "Upgrade limited shell to fully interactive PTY - enables sudo, tab completion, arrow keys",
      "variables": [],
      "flag_explanations": {
        "pty.spawn": "Python function to spawn pseudo-terminal",
        "/bin/bash": "Shell to spawn",
        "script -qc": "Alternative using script utility",
        "/dev/null": "Discard typescript output"
      },
      "tags": [
        "LINUX",
        "POST_EXPLOITATION",
        "QUICK_WIN",
        "SHELL_UPGRADE"
      ],
      "success_indicators": [
        "Full bash prompt appears",
        "Tab completion works",
        "Arrow keys work",
        "sudo prompts work"
      ],
      "failure_indicators": [
        "python: command not found",
        "script: command not found",
        "No change in shell behavior"
      ],
      "prerequisites": [],
      "next_steps": [
        "linux-id",
        "linux-sudo-list"
      ],
      "alternatives": [],
      "troubleshooting": {
        "Python not found": "Try perl, ruby, or script method",
        "Still limited": "Export TERM and stty settings (see notes)"
      },
      "notes": "ESSENTIAL after getting reverse shell!\n\nFull upgrade process:\n1. Spawn PTY: python3 -c 'import pty; pty.spawn(\"/bin/bash\")'\n2. Background: Ctrl+Z\n3. On attacker: stty raw -echo; fg\n4. On target: export TERM=xterm\n5. On target: stty rows 50 cols 200\n\nAlternative methods:\n- script -qc /bin/bash /dev/null\n- perl -e 'exec \"/bin/bash\";'\n- ruby -e 'exec \"/bin/bash\"'\n- echo os.system('/bin/bash') | python\n\nTime estimate: 30 seconds.\n\npractical tip: ALWAYS upgrade shell first. sudo, su, and many tools REQUIRE TTY.\n\nWithout TTY:\n- sudo fails: 'sudo: no tty present'\n- su fails: 'must be run from a terminal'\n- vim/nano don't work\n- No tab completion\n- No command history",
      "methodology_guidance": {
        "after_success": "Immediately test sudo -l. Shell is now fully functional."
      }
    }
  ]
}