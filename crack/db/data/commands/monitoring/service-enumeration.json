{
  "category": "monitoring",
  "subcategory": "service-enumeration",
  "description": "Service enumeration commands for Linux (systemd/SysV) and Windows privilege escalation",
  "commands": [
    {
      "id": "systemctl-running-services",
      "name": "List Running systemd Services",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "systemctl list-units --type=service --state=running",
      "description": "Show all currently active systemd services (modern Linux distributions)",
      "variables": [],
      "flag_explanations": {
        "list-units": "List loaded units (services, sockets, targets, etc.)",
        "--type=service": "Filter to show only service units",
        "--state=running": "Filter to show only services in running state (active)"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "SYSTEMD"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "UNIT",
        "LOAD",
        "ACTIVE",
        "SUB",
        "DESCRIPTION",
        ".service"
      ],
      "failure_indicators": [
        "No units found",
        "systemctl: command not found"
      ],
      "next_steps": ["systemctl-service-permissions", "systemctl-enabled-services", "journalctl-service-follow", "linpeas-run"],
      "alternatives": [
        "service-status-all-sysv"
      ],
      "prerequisites": ["ps-aux-full"],
      "notes": "systemd is the init system for most modern Linux distributions (RHEL 7+, Ubuntu 16.04+, Debian 8+).\n\nOSCP tip:\nFocus on custom services (not part of base OS) - often have misconfigurations.\n\nTime estimate:\n2 seconds.\n\nTo see ALL services (including failed):\nsystemctl list-units --type=service --all",
      "methodology_guidance": {
        "after_success": "Check service configuration: systemctl cat <SERVICE> Check service file permissions: systemctl-service-permissions Look for writable service files: find /etc/systemd -writable Identify services running as root: systemctl status <SERVICE>"
      }
    },
    {
      "id": "systemctl-enabled-services",
      "name": "List Enabled (Auto-Start) Services",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "systemctl list-unit-files --type=service --state=enabled",
      "description": "Show services configured to start automatically at boot",
      "variables": [],
      "flag_explanations": {
        "list-unit-files": "List all available unit files (not just loaded units)",
        "--type=service": "Filter to service units",
        "--state=enabled": "Show only services enabled for auto-start at boot"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "OSCP:MEDIUM",
        "PERSISTENCE",
        "POST_EXPLOITATION",
        "SYSTEMD"
      ],
      "oscp_relevance": "medium",
      "success_indicators": [
        "UNIT FILE",
        "STATE",
        "enabled"
      ],
      "failure_indicators": [
        "No unit files found",
        "systemctl: command not found"
      ],
      "next_steps": [],
      "alternatives": [],
      "notes": "Enabled services persist across reboots - key for persistence/backdoor detection.\n\nOSCP tip:\nCustom services in /etc/systemd/system are often exploit targets.\n\nTime estimate:\n3 seconds.",
      "methodology_guidance": {
        "after_success": "Check custom enabled services for persistence mechanisms Disable suspicious services: sudo systemctl disable <SERVICE> Check service executable permissions",
        "oscp_tips": "Examine service file contents: systemctl cat <SERVICE>"
      }
    },
    {
      "id": "systemctl-service-permissions",
      "name": "Check systemd Service File Permissions",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "ls -la /etc/systemd/system/*.service",
      "description": "List custom systemd service files with permissions (privilege escalation vector)",
      "variables": [],
      "flag_explanations": {
        "ls -la": "Long listing with all files including hidden",
        "/etc/systemd/system/": "Directory for custom/user-created service files",
        "*.service": "Wildcard for all service unit files"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "SYSTEMD"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "-rw-r--r--",
        ".service",
        "root root"
      ],
      "failure_indicators": [
        "No such file or directory",
        "Permission denied"
      ],
      "next_steps": ["suid-find", "linpeas-run", "cron-directories-list"],
      "alternatives": ["service-status-all-sysv", "chkconfig-list-sysv"],
      "prerequisites": ["ps-aux-full", "systemctl-running-services"],
      "notes": "CRITICAL for OSCP privilege escalation.\n\nWritable service files = instant root if service runs as root.\n\nAlso check /lib/systemd/system/ (system services).\n\nTime estimate:\n2 seconds.\n\nExploit pattern:\n(1) Find writable .service file, (2) Modify ExecStart=/path/to/reverse_shell, (3) sudo systemctl restart <SERVICE>.",
      "methodology_guidance": {
        "after_success": "If writable: Modify service to run payload as root Check ExecStart path in service file: systemctl cat <SERVICE> Check if service binary is writable: ls -la <EXEC_PATH> Restart service to trigger payload: sudo systemctl restart <SERVICE>"
      }
    },
    {
      "id": "service-status-all-sysv",
      "name": "SysV Init Services Status",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "service --status-all",
      "description": "List all SysV init services with status (+ running, - stopped) - older Linux systems",
      "variables": [],
      "flag_explanations": {
        "--status-all": "Display status of all services (+ for running, - for stopped, ? for unknown)"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "OSCP:MEDIUM",
        "POST_EXPLOITATION",
        "SYSV"
      ],
      "oscp_relevance": "medium",
      "success_indicators": [
        "[+]",
        "[-]",
        "[?]"
      ],
      "failure_indicators": [
        "service: command not found"
      ],
      "next_steps": [],
      "alternatives": [
        "systemctl-running-services"
      ],
      "notes": "SysV init used on older Linux (pre-systemd).\n\nStill found in OSCP labs.\n\n[+] = running, [-] = stopped, [?] = status unknown.\n\nTime estimate:\n3 seconds.\n\nService scripts in /etc/init.d/ - check permissions for privesc.",
      "methodology_guidance": {
        "after_success": "Check specific service: service <NAME> status Check init script permissions: ls -la /etc/init.d/<SERVICE> Look for writable init scripts for privilege escalation",
        "oscp_tips": "Examine service init script: cat /etc/init.d/<SERVICE>"
      }
    },
    {
      "id": "chkconfig-list-sysv",
      "name": "SysV Runlevel Configuration",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "chkconfig --list",
      "description": "Show which SysV services are enabled at each runlevel (RHEL/CentOS)",
      "variables": [],
      "flag_explanations": {
        "--list": "List all services and their runlevel configuration (0-6 runlevels)"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "LINUX",
        "MONITORING",
        "OSCP:LOW",
        "POST_EXPLOITATION",
        "SYSV"
      ],
      "oscp_relevance": "low",
      "success_indicators": [
        "0:off",
        "3:on",
        "5:on"
      ],
      "failure_indicators": [
        "chkconfig: command not found"
      ],
      "next_steps": [],
      "alternatives": [],
      "notes": "RHEL/CentOS specific.\n\nRunlevels:\n0=halt, 1=single-user, 3=multi-user, 5=graphical, 6=reboot.\n\nTime estimate:\n2 seconds.",
      "methodology_guidance": {
        "after_success": "Check service script: cat /etc/init.d/<SERVICE> Disable malicious service: sudo chkconfig <SERVICE> off Check service script permissions for privesc"
      }
    },
    {
      "id": "win-sc-query-services",
      "name": "Windows List All Services",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "sc query",
      "description": "List all Windows services with current state using Service Control command",
      "variables": [],
      "flag_explanations": {
        "query": "Query service status (no arguments = all services)"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "MONITORING",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "WINDOWS"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "SERVICE_NAME:",
        "DISPLAY_NAME:",
        "STATE",
        "RUNNING",
        "STOPPED"
      ],
      "failure_indicators": [
        "ERROR: Access denied"
      ],
      "next_steps": [],
      "alternatives": [
        "win-wmic-service-full",
        "win-ps-get-service"
      ],
      "notes": "Service Control (sc.exe) is built-in Windows service management tool.\n\nOSCP tip:\nFocus on services with STATE=RUNNING and user-created services (non-Microsoft).\n\nTime estimate:\n5 seconds.",
      "methodology_guidance": {
        "after_success": "Query specific service: win-sc-query-config Check service permissions: win-accesschk-service Look for unquoted service paths: win-wmic-service-path Check service binary permissions: icacls <PATH>"
      }
    },
    {
      "id": "win-sc-query-all",
      "name": "Windows List All Services (Including Stopped)",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "sc query state= all",
      "description": "Query all services including stopped ones (comprehensive service enumeration)",
      "variables": [],
      "flag_explanations": {
        "query": "Query service status",
        "state= all": "Include all states (running, stopped, paused). NOTE: Space after '=' is required by sc.exe syntax"
      },
      "tags": [
        "COMPREHENSIVE",
        "DEFENSE",
        "ENUMERATION",
        "MONITORING",
        "OSCP:MEDIUM",
        "POST_EXPLOITATION",
        "WINDOWS"
      ],
      "oscp_relevance": "medium",
      "success_indicators": [
        "SERVICE_NAME:",
        "RUNNING",
        "STOPPED"
      ],
      "failure_indicators": [
        "ERROR: Invalid parameter"
      ],
      "next_steps": [],
      "alternatives": [
        "win-wmic-service-full",
        "get-service"
      ],
      "notes": "Space after '=' is REQUIRED:\n'state= all' not 'state=all'.\n\nShows stopped services which may have weak permissions or unquoted paths.\n\nTime estimate:\n10 seconds.",
      "methodology_guidance": {
        "after_success": "Check stopped service configurations (may auto-start) Query service details: sc qc <SERVICE_NAME> Check service binary permissions Look for services with weak permissions"
      }
    },
    {
      "id": "win-sc-query-config",
      "name": "Windows Service Configuration Details",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "sc qc <SERVICE_NAME>",
      "description": "Get detailed configuration for specific Windows service (binary path, start type, dependencies)",
      "variables": [
        {
          "name": "<SERVICE_NAME>",
          "description": "Service name (not display name)",
          "example": "Spooler",
          "required": true
        }
      ],
      "flag_explanations": {
        "qc": "Query Configuration - shows service configuration details including BINARY_PATH_NAME, START_TYPE, DEPENDENCIES"
      },
      "tags": [
        "DEFENSE",
        "DETAILED",
        "ENUMERATION",
        "MONITORING",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "WINDOWS"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "BINARY_PATH_NAME",
        "SERVICE_START_NAME",
        "START_TYPE",
        "DEPENDENCIES"
      ],
      "failure_indicators": [
        "FAILED 1060",
        "The specified service does not exist"
      ],
      "next_steps": [],
      "alternatives": [
        "win-wmic-service-path"
      ],
      "notes": "CRITICAL for Windows privilege escalation.\n\nCheck for:\n(1) Unquoted service paths with spaces, (2) Writable service binaries, (3) Services running as LocalSystem/SYSTEM.\n\nTime estimate:\n1 second.\n\nCommon privesc:\nUnquoted path 'C:\\Program Files\\My Service\\service.exe' â†’ Place malicious 'C:\\Program.exe'.",
      "methodology_guidance": {
        "after_success": "Check if BINARY_PATH_NAME has unquoted spaces: win-unquoted-service-path-check Check binary permissions: icacls \"<BINARY_PATH>\" Check if SERVICE_START_NAME is LocalSystem (high privileges) Modify service binary if writable: win-sc-config-binpath"
      }
    },
    {
      "id": "win-wmic-service-full",
      "name": "WMIC Service Enumeration",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "wmic service list brief",
      "description": "List all Windows services with brief details using WMI",
      "variables": [],
      "flag_explanations": {
        "service": "Query Win32_Service WMI class",
        "list": "List service instances",
        "brief": "Display brief format (ExitCode, Name, ProcessId, StartMode, State, Status)"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "MONITORING",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "WINDOWS",
        "WMIC"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "Name",
        "ProcessId",
        "StartMode",
        "State",
        "Status"
      ],
      "failure_indicators": [
        "ERROR: Access denied",
        "WMIC is deprecated"
      ],
      "next_steps": [],
      "alternatives": [
        "win-sc-query-all",
        "win-ps-get-service"
      ],
      "notes": "WMIC deprecated in Windows 11+ but still in OSCP labs.\n\nFor specific properties:\nwmic service get Name,PathName,StartMode,State.\n\nTime estimate:\n5 seconds.",
      "methodology_guidance": {
        "after_success": "Get full service details: win-wmic-service-path Filter running services: wmic service where \"State='Running'\" list brief Check for non-standard services (not from Microsoft) PowerShell alternative: win-ps-get-service"
      }
    },
    {
      "id": "win-wmic-service-path",
      "name": "WMIC Service Paths (Unquoted Path Check)",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "wmic service get Name,PathName,StartMode,State",
      "description": "List Windows services with full binary paths to identify unquoted service path vulnerabilities",
      "variables": [],
      "flag_explanations": {
        "service": "Query Win32_Service class",
        "get": "Retrieve specific properties",
        "Name": "Service name",
        "PathName": "Full path to service executable (CRITICAL for finding unquoted paths)",
        "StartMode": "Auto, Manual, or Disabled",
        "State": "Running, Stopped, etc."
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "MONITORING",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "PRIVILEGE_ESCALATION",
        "UNQUOTED_PATH",
        "WINDOWS",
        "WMIC"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "Name",
        "PathName",
        "C:\\Program Files",
        "StartMode"
      ],
      "failure_indicators": [
        "ERROR: Access denied"
      ],
      "next_steps": [],
      "alternatives": [
        "win-sc-query-config",
        "win-unquoted-service-paths"
      ],
      "notes": "CRITICAL Windows privesc technique.\n\nUnquoted path 'C:\\Program Files\\My App\\service.exe' allows placing 'C:\\Program.exe' or 'C:\\Program Files\\My.exe'.\n\nTime estimate:\n5 seconds.\n\nFilter for unquoted:\nwmic service get Name,PathName | findstr /v /i \"C:\\Windows\" | findstr /i /v '\"'.",
      "methodology_guidance": {
        "after_success": "Identify unquoted paths with spaces: PathName without quotes and containing spaces Check directory permissions: icacls \"C:\\Program Files\\<DIR>\" Place malicious executable in exploitable path Restart service: sc stop <SERVICE> && sc start <SERVICE>"
      }
    },
    {
      "id": "win-ps-get-service",
      "name": "PowerShell Get Services",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "Get-Service | Where-Object {$_.Status -eq \"Running\"}",
      "description": "PowerShell cmdlet to list running Windows services",
      "variables": [],
      "flag_explanations": {
        "Get-Service": "Retrieves all Windows services",
        "Where-Object": "Filters results based on condition",
        "$_.Status -eq \"Running\"": "Filter to show only services with Running status"
      },
      "tags": [
        "DEFENSE",
        "ENUMERATION",
        "MONITORING",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "POWERSHELL",
        "WINDOWS"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "Status",
        "Name",
        "DisplayName",
        "Running"
      ],
      "failure_indicators": [
        "Get-Service: command not found",
        "Execution policy blocked"
      ],
      "next_steps": [],
      "alternatives": [
        "win-sc-query-services",
        "win-wmic-service-full"
      ],
      "notes": "Modern PowerShell approach.\n\nFor all services:\nGet-Service (no filter).\n\nFor stopped:\nWhere-Object {$_.Status -eq 'Stopped'}.\n\nTime estimate:\n3 seconds.",
      "methodology_guidance": {
        "after_success": "Get service details: win-ps-get-service-details Check service binary paths: Get-WmiObject win32_service Filter non-Microsoft services: Where-Object {$_.Name -notlike 'Microsoft*'} Check service permissions with AccessChk"
      }
    },
    {
      "id": "win-ps-get-service-details",
      "name": "PowerShell Service Details with Paths",
      "category": "monitoring",
      "subcategory": "service-enumeration",
      "command": "Get-WmiObject win32_service | Select-Object Name,State,PathName",
      "description": "PowerShell WMI query for service details including executable paths",
      "variables": [],
      "flag_explanations": {
        "Get-WmiObject": "Query WMI objects",
        "win32_service": "WMI class for services",
        "Select-Object": "Choose specific properties",
        "PathName": "Full path to service executable (unquoted path detection)"
      },
      "tags": [
        "DEFENSE",
        "DETAILED",
        "ENUMERATION",
        "MONITORING",
        "OSCP:HIGH",
        "POST_EXPLOITATION",
        "POWERSHELL",
        "PRIVILEGE_ESCALATION",
        "WINDOWS",
        "WMI"
      ],
      "oscp_relevance": "high",
      "success_indicators": [
        "Name",
        "State",
        "PathName"
      ],
      "failure_indicators": [
        "Access denied",
        "Execution policy blocked"
      ],
      "next_steps": [],
      "alternatives": [
        "win-wmic-service-path",
        "win-sc-query-config"
      ],
      "notes": "PowerShell WMI approach (modern).\n\nTime estimate:\n5 seconds.\n\nOne-liner for unquoted path detection:\nGet-WmiObject win32_service | Where-Object {$_.PathName -notlike '\"*' -and $_.PathName -like '* *' -and $_.PathName -like 'C:\\Program*'} | Select Name,PathName",
      "methodology_guidance": {
        "after_success": "Filter for unquoted paths: Where-Object {$_.PathName -notlike '\"*' -and $_.PathName -like '* *'} Check path permissions: Get-Acl <PATH> Search for writable service binaries Modern alternative: Get-CimInstance win32_service"
      }
    }
  ]
}
