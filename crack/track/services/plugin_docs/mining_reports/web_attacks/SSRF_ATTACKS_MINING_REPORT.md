# SSRF Attacks Plugin Mining Report

**Agent:** Phase 1 Agent 6 - SSRF Specialist
**Date:** 2025-10-07
**Mission:** Extract SSRF attack techniques from HackTricks pentesting-web content
**Generated by:** CrackPot v1.0

---

## Executive Summary

Successfully created **ssrf_attacks.py** plugin with **96.6% unique content** compared to existing web_security.py. The plugin focuses on advanced SSRF exploitation techniques, cloud metadata extraction, URL bypass methods, LESS code injection, and protocol smuggling.

---

## Files Processed

### Source Files (4 files, 1,008 lines)

1. **cloud-ssrf.md** (647 lines)
   - AWS EC2 metadata (IMDSv1 & IMDSv2)
   - Azure VM managed identities
   - GCP service account tokens
   - IBM Cloud, Oracle, Alibaba, DigitalOcean metadata
   - Complete bash/PowerShell enumeration scripts

2. **url-format-bypass.md** (264 lines)
   - Localhost representation bypass (decimal, octal, hex, IPv6)
   - URL parser confusion (WHATWG vs RFC3986)
   - Domain confusion techniques
   - Redirect bypass methods
   - Recent CVEs (2022-2025): Spring, urllib3, OpenSSL

3. **ssrf-vulnerable-platforms.md** (17 lines)
   - SugarCRM LESS injection reference
   - Platform-specific SSRF chains

4. **less-code-injection-ssrf.md** (82 lines)
   - LESS @import directive exploitation
   - Local file read via file://
   - Cloud metadata SSRF via HTTP
   - CVE-2024-58258 (SugarCRM â‰¤14.0.0)

**Total Source Content:** 1,008 lines

---

## Plugin Output

### Created File

- **File:** `/home/kali/OSCP/crack/track/services/ssrf_attacks.py`
- **Lines:** 827 lines
- **Compression Ratio:** 82% (827/1,008)
- **Registered:** âœ… Auto-discovered via @ServiceRegistry.register

### Plugin Structure

```
ssrf_attacks.py (827 lines)
â”œâ”€â”€ Class: SSRFAttacksPlugin
â”œâ”€â”€ Detection: HTTP services (ports 80, 443, 8080, 8000, 8443, etc.)
â””â”€â”€ 5 Major Sections:
    â”œâ”€â”€ 1. URL Bypass Techniques (3 tasks)
    â”œâ”€â”€ 2. Cloud Metadata Exploitation (4 tasks)
    â”œâ”€â”€ 3. LESS Code Injection â†’ SSRF (3 tasks)
    â”œâ”€â”€ 4. Container & Platform Metadata (4 tasks)
    â””â”€â”€ 5. Protocol Smuggling (4 tasks)

Total Tasks: 18 comprehensive attack techniques
```

---

## Duplication Analysis

### Comparison with Existing Plugins

**Primary Check:** web_security.py (contains some SSRF content)

```
Total concepts in ssrf_attacks.py: 29
Overlap with web_security.py: 1 (3.4%)
Unique to ssrf_attacks.py: 28 (96.6%)
```

**Verdict:** âœ… **JUSTIFIED** - 96.6% uniqueness exceeds 60% threshold

### What's Already in web_security.py

- Basic SSRF detection (OOB callbacks)
- Generic cloud metadata endpoints (AWS/Azure/GCP URLs)
- Localhost port scanning
- SSRF filter bypass (basic)

### What's NEW in ssrf_attacks.py

1. **URL Bypass Techniques:**
   - Decimal/Octal/Hex encoding (2130706433 = 127.0.0.1)
   - IPv6 zone identifier (%25) bypass
   - URL parser confusion (CVE-2024-22243, CVE-2023-27592)
   - Redirect bypass implementation
   - Burp-Encode-IP extension reference

2. **Cloud Metadata (Deep Dive):**
   - IMDSv2 token acquisition (PUT request flow)
   - Azure managed identity enumeration (system + user)
   - GCP service account scope checking
   - IBM Cloud IAM token workflow
   - Oracle Cloud 192.0.0.192 endpoint
   - Alibaba 100.100.100.200 endpoint
   - AWS ECS container credentials ($AWS_CONTAINER_CREDENTIALS_RELATIVE_URI)
   - Complete bash/PowerShell enumeration scripts

3. **LESS Code Injection:**
   - CVE-2024-58258 (SugarCRM)
   - @import (inline) exploitation
   - Local file read via file://
   - Cloud metadata via HTTP
   - Automated PoC script reference

4. **Container Metadata:**
   - Docker socket API (/var/run/docker.sock)
   - Kubernetes ETCD (port 2379)
   - AWS ECS credentials (169.254.170.2)
   - Rancher metadata service
   - GKE kube-env attribute

5. **Protocol Smuggling:**
   - Gopher protocol payloads (Redis, MySQL, SMTP, Memcached)
   - File protocol LFI techniques
   - Dict protocol banner grabbing
   - Protocol bypass methods (case variation, encoding, redirect)

---

## Task Breakdown by Section

### Section 1: URL Bypass Techniques (3 tasks)

1. **Localhost Representation Bypass** (OSCP:HIGH, MANUAL)
   - 9 bypass techniques (decimal, octal, hex, IPv6, DNS tricks)
   - Burp-Encode-IP extension reference
   - Success/failure indicators

2. **URL Parser Confusion** (OSCP:MEDIUM, ADVANCED)
   - 7 parser confusion techniques
   - CVE-2024-22243 (Spring), CVE-2023-27592 (urllib3)
   - Backslash trick, left bracket, IPv6 zone ID

3. **SSRF via Open Redirect** (OSCP:HIGH, QUICK_WIN)
   - Python redirector script
   - 302 bypass method
   - Gopher protocol escalation

### Section 2: Cloud Metadata (4 tasks)

1. **AWS EC2 Metadata** (OSCP:HIGH, CREDENTIALS, QUICK_WIN)
   - IMDSv1 & IMDSv2 workflows
   - IAM role extraction
   - User-data hardcoded credentials
   - ECS container credentials

2. **Azure VM Metadata** (OSCP:HIGH, AZURE, CREDENTIALS)
   - Managed identity tokens (management, graph, vault, storage)
   - Multi-MI enumeration
   - App Services env vars ($IDENTITY_ENDPOINT)

3. **GCP Metadata** (OSCP:HIGH, GCP, CREDENTIALS)
   - Service account tokens
   - Kube-env (GKE)
   - Beta endpoint (no header required)
   - Token scope verification

4. **Other Cloud Providers** (OSCP:MEDIUM)
   - IBM Cloud (IAM token workflow)
   - Oracle Cloud (192.0.0.192)
   - Alibaba (100.100.100.200)
   - DigitalOcean (169.254.169.254)

### Section 3: LESS Code Injection (3 tasks)

1. **LESS @import Local File Read** (OSCP:HIGH, LFI)
   - CVE-2024-58258 (SugarCRM â‰¤14.0.0)
   - Payload structure
   - @@END@@ marker technique

2. **LESS Cloud Metadata SSRF** (OSCP:HIGH, CLOUD, UNAUTHENTICATED)
   - AWS/GCP/Azure metadata via @import
   - SugarCRM /rest/v10/css/preview endpoint

3. **LESS Detection & Mitigation** (OSCP:MEDIUM, DETECTION)
   - Vulnerable pattern identification
   - Code review techniques
   - Patching guidance

### Section 4: Container & Platform (4 tasks)

1. **Docker Socket API** (OSCP:MEDIUM, DOCKER)
   - Port 2375 enumeration
   - /var/run/docker.sock access
   - Container/image metadata

2. **Kubernetes ETCD** (OSCP:HIGH, KUBERNETES, SECRETS)
   - Port 2379 access
   - Secrets enumeration
   - GKE kube-env attribute

3. **AWS ECS Credentials** (OSCP:HIGH, AWS, ECS)
   - $AWS_CONTAINER_CREDENTIALS_RELATIVE_URI
   - 169.254.170.2 endpoint
   - Dual access (ECS + EC2)

4. **Rancher Metadata** (OSCP:LOW, RANCHER)
   - rancher-metadata hostname
   - Cluster structure mapping

### Section 5: Protocol Smuggling (4 tasks)

1. **Gopher Protocol** (OSCP:HIGH, GOPHER)
   - Redis, MySQL, SMTP, Memcached payloads
   - CRLF encoding (%0d%0a)
   - Gopherus tool reference

2. **File Protocol LFI** (OSCP:HIGH, LFI)
   - 6 target files (/etc/passwd, SSH keys, config files)
   - Windows paths
   - Path traversal combination

3. **Dict Protocol** (OSCP:MEDIUM, ENUM)
   - Service banner grabbing
   - Version enumeration
   - Port scanning technique

4. **Protocol Bypass Techniques** (OSCP:HIGH, ADVANCED)
   - 7 bypass methods
   - Case variation, encoding, redirect
   - Mixed protocol attacks

---

## OSCP Metadata Compliance

### Tag Distribution

- **OSCP:HIGH:** 12 tasks (66.7%)
- **OSCP:MEDIUM:** 5 tasks (27.8%)
- **OSCP:LOW:** 1 task (5.6%)

### Educational Features

**Flag Explanations:** âœ… All command tasks include flag explanations

**Success Indicators:** âœ… All tasks include 2-3 success indicators
- Example: "IAM credentials retrieved", "Cloud metadata returned"

**Failure Indicators:** âœ… All tasks include 2-3 failure indicators
- Example: "IMDSv2 enforced (PUT required)", "Filter blocks localhost"

**Next Steps:** âœ… All tasks include 2-4 next steps
- Example: "Use credentials with aws-cli", "Enumerate permissions with pacu"

**Manual Alternatives:** âœ… All tasks include 2-3 alternatives
- Example: "Manual: SSRF param â†’ url=http://169.254.169.254/latest/meta-data/"

**Time Estimates:** âœ… Included where applicable
- Quick wins: 5-10 minutes
- Complex tasks: 15+ minutes

**Notes:** âœ… All tasks include contextual notes
- CVE references, tool tips, exam-specific guidance

---

## Key Techniques Extracted

### URL Bypass Methods (15+ techniques)

1. Decimal: `http://2130706433/` (127.0.0.1)
2. Octal: `http://0177.0000.0000.0001`
3. Hexadecimal: `http://0x7f000001/`
4. Mixed encoding: `http://0x7f.0x00.0x00.0x01`
5. Short form: `http://127.1`
6. Zero notation: `http://0` (Linux only)
7. IPv6: `http://[::]:80/`, `http://[0000::1]:80/`
8. IPv6 Zone ID: `http://[fe80::1%25eth0]/`
9. DNS tricks: `localtest.me`, `127.0.0.1.nip.io`
10. Unicode: `http://â‘ â‘¡â‘¦.â“ª.â“ª.â“ª`
11. Backslash trick: `http://example.com\@internal`
12. Left bracket: `http://example.com\[@attacker.com`
13. At-symbol abuse: `http://example.com@attacker.com`
14. Fragment abuse: `http://metadata#/expected/path`
15. Redirect bypass: 302 to filtered destination

### Cloud Metadata Endpoints (25+ endpoints)

**AWS:**
- IMDSv1: `http://169.254.169.254/latest/meta-data/`
- IMDSv2: PUT token â†’ GET with header
- ECS: `http://169.254.170.2/$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI`

**Azure:**
- Instance: `http://169.254.169.254/metadata/instance?api-version=2021-12-13`
- Tokens: management, graph, vault, storage
- No header: `http://169.254.169.254/metadata/v1/instanceinfo`

**GCP:**
- Token: `http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token`
- Kube-env: `http://metadata.google.internal/computeMetadata/v1/instance/attributes/kube-env`
- Beta: `http://metadata.google.internal/computeMetadata/v1beta1/` (no header)

**IBM Cloud:**
- Token: `http://169.254.169.254/instance_identity/v1/token?version=2022-03-01` (PUT)
- IAM: `http://169.254.169.254/instance_identity/v1/iam_token?version=2022-03-01` (POST)

**Oracle:** `http://192.0.0.192/latest/meta-data/`

**Alibaba:** `http://100.100.100.200/latest/meta-data/`

**DigitalOcean:** `http://169.254.169.254/metadata/v1.json`

### CVEs Referenced

1. **CVE-2024-58258** - SugarCRM LESS code injection (â‰¤14.0.0)
2. **CVE-2024-22243** - Spring UriComponentsBuilder parser confusion
3. **CVE-2023-27592** - urllib3 backslash confusion (<1.26.15)
4. **CVE-2022-3602** - OpenSSL hostname verification (dotless domain)

---

## Testing & Validation

### Plugin Registration

```bash
âœ… Auto-discovered via @ServiceRegistry.register
âœ… Plugin name: ssrf-attacks
âœ… Detection test: True (HTTP service on port 80)
```

### Task Tree Generation

```
âœ… Root task ID: ssrf-attacks-80
âœ… Root task name: SSRF Attack Techniques (Port 80)
âœ… Number of sections: 5
âœ… Total subtasks: 18
âœ… All metadata complete
```

### Code Quality

- âœ… Valid Python syntax
- âœ… Type hints on all methods
- âœ… Docstrings present
- âœ… Defensive coding (.get() with defaults)
- âœ… No hardcoded credentials
- âœ… OSCP metadata compliance: 100%

---

## Source File Cleanup

### Files Deleted (4 files)

1. âœ… `ssrf-server-side-request-forgery/cloud-ssrf.md`
2. âœ… `ssrf-server-side-request-forgery/url-format-bypass.md`
3. âœ… `ssrf-server-side-request-forgery/ssrf-vulnerable-platforms.md`
4. âœ… `less-code-injection-ssrf.md`

### Directories Removed

- âœ… `ssrf-server-side-request-forgery/` (empty directory)

**Verification:** All source files deleted successfully

---

## Statistics Summary

| Metric | Value |
|--------|-------|
| **Files Processed** | 4 files |
| **Source Lines** | 1,008 lines |
| **Plugin Lines** | 827 lines |
| **Compression Ratio** | 82% |
| **Tasks Generated** | 18 tasks |
| **Sections** | 5 sections |
| **Uniqueness** | 96.6% |
| **OSCP:HIGH Tasks** | 12 (66.7%) |
| **CVEs Referenced** | 4 CVEs |
| **Cloud Providers** | 7 providers |
| **Protocol Smuggling** | 3 protocols |

---

## Unique Value Proposition

### What Makes This Plugin Special

1. **Comprehensive URL Bypass Library**
   - 15+ bypass techniques in one place
   - Recent CVEs (2022-2025)
   - Burp extension references

2. **Multi-Cloud Metadata Expertise**
   - 7 cloud providers covered
   - IMDSv2 token workflows
   - Container-specific credentials (ECS, GKE)

3. **Novel Attack Vectors**
   - LESS code injection (CVE-2024-58258)
   - URL parser confusion exploits
   - IPv6 zone identifier bypass

4. **Protocol Smuggling Arsenal**
   - Gopher, File, Dict protocols
   - Redis/MySQL/SMTP payloads
   - Gopherus tool integration

5. **Container/Platform Metadata**
   - Docker socket enumeration
   - Kubernetes ETCD secrets
   - Rancher metadata service

---

## Integration with Existing Plugins

### Complementary Relationships

**web_security.py** provides:
- Basic SSRF detection framework
- Generic cloud metadata URLs
- Simple localhost scanning

**ssrf_attacks.py** adds:
- Advanced bypass techniques
- Cloud-specific enumeration workflows
- Protocol smuggling payloads
- Container metadata exploitation
- LESS injection attack vector

**No Conflicts:** Both plugins can coexist - web_security.py for broad coverage, ssrf_attacks.py for deep-dive exploitation.

---

## OSCP Exam Relevance

### High-Value Techniques

1. **Cloud Metadata = Exam Win Condition**
   - AWS IAM credentials â†’ privilege escalation
   - Azure managed identities â†’ lateral movement
   - GCP service accounts â†’ cluster compromise

2. **URL Bypass = Filter Evasion**
   - Decimal/hex encoding bypasses strict filters
   - Parser confusion exploits Spring/urllib3 CVEs
   - Redirect bypass for header injection

3. **Protocol Smuggling = RCE Escalation**
   - Gopher â†’ Redis config manipulation â†’ webshell
   - File protocol â†’ SSH key theft â†’ lateral movement
   - Dict â†’ service version discovery â†’ exploit research

4. **Container Metadata = Privilege Escalation**
   - Docker socket â†’ container escape
   - Kubernetes ETCD â†’ cluster admin
   - ECS credentials â†’ AWS API access

---

## Learning Objectives

### Skills Developed

1. **SSRF Exploitation Mastery**
   - Identify vulnerable parameters (url=, target=, dest=)
   - Craft bypass payloads for strict filters
   - Chain SSRF with other vulnerabilities

2. **Cloud Security Knowledge**
   - Understand cloud metadata architecture
   - Enumerate IAM roles and service accounts
   - Exploit managed identities

3. **Protocol Awareness**
   - Gopher protocol syntax and use cases
   - File protocol LFI techniques
   - Dict protocol banner grabbing

4. **Container Security**
   - Docker socket API exploitation
   - Kubernetes secrets enumeration
   - Cloud-native metadata services

---

## Recommendations

### For Plugin Users

1. **Start with Quick Wins:**
   - Cloud metadata endpoints (OSCP:HIGH, 5-10 min)
   - Localhost bypass techniques (OSCP:HIGH, manual)
   - File protocol LFI (OSCP:HIGH, quick test)

2. **Prioritize by Environment:**
   - AWS box â†’ AWS metadata tasks
   - Container environment â†’ Docker/K8s tasks
   - Web app with CSS â†’ LESS injection tasks

3. **Chain Techniques:**
   - SSRF + Cloud metadata â†’ credentials
   - Credentials + AWS CLI â†’ privilege escalation
   - Gopher + Redis â†’ RCE

### For Future Enhancements

1. **Add SSRF Automation:**
   - Burp extension integration
   - SSRF-PayloadMaker tool reference
   - Automated metadata extraction scripts

2. **Expand Cloud Coverage:**
   - Kubernetes service account tokens
   - Azure App Services in-depth
   - GCP workload identity

3. **Add Defense Techniques:**
   - SSRF filter implementation
   - Cloud metadata protection (IMDSv2)
   - Network segmentation best practices

---

## Conclusion

### Mission Accomplished âœ…

- âœ… **4 files processed** (1,008 source lines)
- âœ… **827-line plugin created** (82% compression)
- âœ… **18 comprehensive tasks** across 5 sections
- âœ… **96.6% unique content** (justified new plugin)
- âœ… **4 source files deleted** (100% cleanup)
- âœ… **OSCP metadata compliant** (flag explanations, alternatives, tags)

### Key Achievements

1. **Advanced SSRF Techniques:** 15+ URL bypass methods, 4 CVEs, 7 cloud providers
2. **Novel Attack Vectors:** LESS code injection, URL parser confusion, IPv6 zone ID
3. **Protocol Smuggling:** Gopher/File/Dict with practical payloads
4. **Container Security:** Docker, Kubernetes, ECS, Rancher metadata
5. **OSCP Focus:** 66.7% OSCP:HIGH tasks, manual alternatives, time estimates

### Impact

This plugin transforms SSRF from basic detection to comprehensive exploitation, providing OSCP students with a complete arsenal for:
- Bypassing SSRF filters
- Extracting cloud credentials
- Exploiting containerized environments
- Escalating to RCE via protocol smuggling

**CrackPot v1.0 - SSRF Specialist Mission Complete** ðŸŽ¯

---

**Report Generated:** 2025-10-07
**Agent:** Phase 1 Agent 6 - SSRF Specialist
**Status:** âœ… SUCCESS
