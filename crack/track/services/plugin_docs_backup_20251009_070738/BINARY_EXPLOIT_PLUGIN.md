# Binary Exploitation Service Plugin

**Status:** ✅ Complete with full test coverage (45/45 tests passing)

## Overview

The Binary Exploitation plugin extends CRACK Track to provide comprehensive educational guidance for analyzing and exploiting binaries with common vulnerabilities. This plugin was generated by mining HackTricks binary exploitation guides and follows OSCP best practices.

## Features

### Vulnerability Classes Covered

1. **Format String Vulnerabilities**
   - Detection techniques (%p, %x, %s payloads)
   - Offset finding methodology (AAAA pattern matching)
   - Arbitrary read primitives (%N$s)
   - Arbitrary write primitives (%N$n, %N$hn)
   - GOT overwrite techniques
   - ASLR bypass via address leaks

2. **Integer Overflow/Underflow**
   - Boundary value testing (INT_MAX, UINT_MAX)
   - Wraparound exploitation (2^32 → 0)
   - Signed to unsigned casting bugs
   - Heap overflow via undersized allocation
   - Real-world exploitation examples from HackTricks

3. **Array Indexing Vulnerabilities**
   - Off-by-one error detection
   - Out-of-bounds access patterns
   - Signed/unsigned index confusion
   - Context-dependent exploitation strategies

### Educational Components

- **Flag Explanations:** Every command flag thoroughly explained
- **Success/Failure Indicators:** Clear signs of vulnerability presence
- **Next Steps:** Guided progression through exploitation phases
- **Manual Alternatives:** OSCP exam-ready techniques without tools
- **Exploitation Templates:** Copy-paste pwntools and manual exploitation scripts

### OSCP Preparation Features

- **OSCP Priority Tags:** Tasks tagged HIGH/MEDIUM/LOW based on exam relevance
- **Quick Win Identification:** Fast, high-value enumeration tasks highlighted
- **Manual Techniques:** All automated tasks have manual alternatives
- **Tool-Independent:** Emphasis on understanding primitives vs. tool usage
- **Exam Scenarios:** Specific guidance for tool-free exploitation

## Detection Logic

Plugin activates when:
- Unknown/custom services detected (`unknown`, `custom`, `tcpwrapped`)
- Native code indicators found (`C application`, `ELF binary`)
- Common CTF/practice ports identified (9999, 31337, 10000, 10001, 1337)

## Task Tree Structure

```
Binary Exploitation Analysis (Port XXXX)
│
├── Binary Reconnaissance
│   ├── Initial Connection Test (nc)
│   └── Attempt Binary Acquisition
│
├── Vulnerability Identification
│   ├── Format String Detection
│   │   ├── Test Basic Format String Payloads
│   │   ├── Find Format String Offset
│   │   └── Format String Exploitation Guide
│   │
│   ├── Integer Overflow/Underflow Detection
│   │   ├── Test Integer Boundary Values
│   │   └── Integer Overflow Exploitation
│   │
│   └── Array Indexing Detection
│
├── Exploitation Resources & Tools
│   ├── Setup pwntools Environment
│   ├── Binary Analysis Tools Reference
│   └── Exploitation Script Templates
│
└── Post-Exploitation Documentation
```

## Metadata Quality

All command tasks include:
- ✅ Complete flag explanations (educational focus)
- ✅ Success indicators (2-3 per task)
- ✅ Failure indicators (common errors explained)
- ✅ Next steps guidance (attack chain progression)
- ✅ Manual alternatives (OSCP exam readiness)
- ✅ Educational notes (long-form explanations)
- ✅ OSCP relevance tags
- ✅ Time estimates where applicable

## Example Task Metadata

```python
{
    'id': 'format-string-basic-9999',
    'name': 'Test Basic Format String Payloads',
    'type': 'command',
    'metadata': {
        'command': 'echo "%p %p %p %p" | nc target 9999',
        'description': 'Test if service leaks stack addresses',
        'tags': ['OSCP:HIGH', 'QUICK_WIN', 'MANUAL', 'ENUM'],
        'flag_explanations': {
            '%p': 'Pointer formatter - reads value from stack and prints as hex',
            '%p %p %p %p': 'Multiple formatters to leak multiple stack values',
            'echo': 'Send payload via standard input',
            '|': 'Pipe output to netcat',
            'nc': 'Netcat for network connection'
        },
        'success_indicators': [
            'Hex addresses printed (0x7fff..., 0x7f... on 64-bit)',
            'Pattern of addresses visible in response'
        ],
        'failure_indicators': [
            'Literal "%p" printed (not vulnerable)',
            'Service crashes (wrong input format)'
        ],
        'next_steps': [
            'Try other formatters: %x (hex), %d (decimal), %s (string)',
            'Find offset to controlled input: AAAA%1$p, AAAA%2$p, etc.',
            'Test arbitrary read: %<offset>$s with address'
        ],
        'alternatives': [
            'Manual netcat: nc target 9999, then type: %p %p %p',
            'Python: python3 -c "print(\'%p %p %p\')" | nc target 9999'
        ],
        'notes': 'Format string bugs provide arbitrary read/write primitives...',
        'estimated_time': '2-3 minutes'
    }
}
```

## Source Materials

Content extracted from:
- `/crack/.references/hacktricks/src/binary-exploitation/format-strings/README.md`
- `/crack/.references/hacktricks/src/binary-exploitation/format-strings/format-strings-template.md`
- `/crack/.references/hacktricks/src/binary-exploitation/format-strings/format-strings-arbitrary-read-example.md`
- `/crack/.references/hacktricks/src/binary-exploitation/integer-overflow-and-underflow.md`
- `/crack/.references/hacktricks/src/binary-exploitation/array-indexing.md`

## Test Coverage

Comprehensive test suite validates:

### Detection Tests (10 tests)
- ✅ Unknown service detection
- ✅ Custom service detection
- ✅ tcpwrapped service detection
- ✅ Native code indicators (C/C++ applications)
- ✅ CTF port detection (9999, 31337, etc.)
- ✅ Negative cases (HTTP, SSH not detected)

### Task Tree Structure Tests (7 tests)
- ✅ Valid hierarchical structure
- ✅ Reconnaissance phase present
- ✅ Vulnerability identification phase
- ✅ Format string tasks (3+ tasks)
- ✅ Integer overflow tasks (2+ tasks)
- ✅ Array indexing tasks (1+ tasks)
- ✅ Exploitation resources present

### Metadata Quality Tests (9 tests)
- ✅ Command tasks have complete metadata
- ✅ Manual tasks have educational guidance
- ✅ Flag explanations are detailed (>10 chars)
- ✅ Success indicators present (1+ per task)
- ✅ Manual alternatives for OSCP (1+ per command)
- ✅ OSCP priority tags applied
- ✅ QUICK_WIN tags validated
- ✅ Manual tags on manual tasks
- ✅ Educational notes present (3+ tasks)

### Technique-Specific Tests (9 tests)
- ✅ Format string formatters explained (%p, %s, %n)
- ✅ Offset finding guidance (AAAA pattern)
- ✅ Exploitation primitives documented
- ✅ Integer boundary values mentioned
- ✅ Integer exploitation chain explained
- ✅ pwntools with OSCP warnings
- ✅ Binary analysis tools referenced
- ✅ Next steps guidance provided
- ✅ OSCP exam focus emphasized

### Integration Tests (10 tests)
- ✅ Complete vulnerability lifecycle covered
- ✅ Multiple vulnerability classes present
- ✅ on_task_complete spawns follow-up tasks
- ✅ Manual alternatives for format strings
- ✅ Manual alternatives for integer overflow
- ✅ Manual alternatives for pwntools
- ✅ CTF port complete workflow
- ✅ Unknown service OSCP scenario

**Total: 45/45 tests passing (100% pass rate)**

## Usage Examples

### Detection Example
```python
plugin = BinaryExploitPlugin()

# Detect unknown service on CTF port
port_info = {
    'port': 9999,
    'service': 'unknown',
    'state': 'open'
}

if plugin.detect(port_info):
    # Generate educational task tree
    tasks = plugin.get_task_tree('192.168.45.100', 9999, port_info)
    # Tasks now available for CRACK Track
```

### Task Generation Example
```python
# Generate tasks for custom binary service
service_info = {
    'port': 31337,
    'service': 'tcpwrapped',
    'product': 'custom binary',
    'version': 'unknown'
}

tree = plugin.get_task_tree('target.htb', 31337, service_info)

# Tree includes:
# - Reconnaissance (nc connection, binary download)
# - Format string detection and exploitation
# - Integer overflow testing
# - Binary analysis tool references
# - Exploitation templates
# - Post-exploitation documentation
```

### Dynamic Task Spawning
```python
# Plugin intelligently spawns follow-up tasks

# If format string detected
result = "0x7ffe12345678 0x7f8d2a3b4c5d"
new_tasks = plugin.on_task_complete('format-string-basic-9999', result, 'target')
# Spawns: Advanced Format String Exploitation task

# If integer overflow confirmed
result = "overflow detected: wrapped to 0"
new_tasks = plugin.on_task_complete('integer-overflow-test-9999', result, 'target')
# Spawns: Integer Overflow Exploit Development task
```

## File Locations

- **Plugin:** `/crack/track/services/binary_exploit.py` (722 lines)
- **Tests:** `/tests/track/services/test_binary_exploit.py` (745 lines)
- **Documentation:** `/crack/track/services/BINARY_EXPLOIT_PLUGIN.md` (this file)

## Integration

Plugin automatically registers with CRACK Track via `@ServiceRegistry.register` decorator. No manual registration required.

When imported:
```python
from crack.track.services.binary_exploit import BinaryExploitPlugin
# Automatically available in ServiceRegistry
```

## Key Design Decisions

1. **No Port Restrictions:** Binary exploitation happens on various custom ports, so `default_ports = []`

2. **Educational First:** Every task prioritizes teaching concepts over automation

3. **Tool-Independent:** Strong emphasis on manual alternatives for OSCP exam scenarios

4. **Comprehensive Coverage:** Three major vulnerability classes (format strings, integer bugs, array indexing)

5. **Real-World Examples:** Exploitation templates directly from HackTricks guides

6. **Progressive Disclosure:** Tasks build from reconnaissance → detection → exploitation

## Future Enhancements

Potential additions:
- Stack/heap overflow buffer overflow guidance
- ROP (Return-Oriented Programming) chain building
- Ret2libc exploitation techniques
- Shellcode development and encoding
- ASLR/PIE bypass methodologies
- Canary bypass techniques

## Contributing

To modify or extend:
1. Edit `/crack/track/services/binary_exploit.py`
2. Add corresponding tests in `/tests/track/services/test_binary_exploit.py`
3. Run tests: `pytest tests/track/services/test_binary_exploit.py -v`
4. Validate integration: No reinstall needed for service plugins

## License

Generated as part of CRACK Track OSCP preparation toolkit.
Extracted from HackTricks binary exploitation guides.

---

**Generated:** October 7, 2025
**By:** CrackPot v1.0 - HackTricks Mining Agent
**Test Coverage:** 100% (45/45 tests passing)
**Lines of Code:** 722 (plugin) + 745 (tests) = 1,467 total
